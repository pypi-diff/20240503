# Comparing `tmp/mneflow-0.5.8.tar.gz` & `tmp/mneflow-0.5.9.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "C:\Users\ipzub\projs\mneflow\dist\.tmp-xoi1rtoc\mneflow-0.5.8.tar", last modified: Wed Apr 24 07:28:16 2024, max compression
+gzip compressed data, was "C:\Users\ipzub\projs\mneflow\dist\.tmp-uayf8f_m\mneflow-0.5.9.tar", last modified: Fri May  3 14:05:29 2024, max compression
```

## Comparing `mneflow-0.5.8.tar` & `mneflow-0.5.9.tar`

### file list

```diff
@@ -1,18 +1,18 @@
-drwxrwxrwx   0        0        0        0 2024-04-24 07:28:16.079479 mneflow-0.5.8/
--rw-rw-rw-   0        0        0     1549 2023-10-03 11:35:20.000000 mneflow-0.5.8/LICENSE.md
--rw-rw-rw-   0        0        0      958 2024-04-24 07:28:16.078465 mneflow-0.5.8/PKG-INFO
--rw-rw-rw-   0        0        0     2893 2024-02-26 13:04:59.000000 mneflow-0.5.8/README.md
-drwxrwxrwx   0        0        0        0 2024-04-24 07:28:16.052573 mneflow-0.5.8/mneflow/
--rw-rw-rw-   0        0        0      212 2024-04-23 16:25:42.000000 mneflow-0.5.8/mneflow/__init__.py
--rw-rw-rw-   0        0        0    15542 2024-04-23 16:35:15.000000 mneflow-0.5.8/mneflow/data.py
--rw-rw-rw-   0        0        0    20231 2024-03-03 10:13:10.000000 mneflow-0.5.8/mneflow/layers.py
--rw-rw-rw-   0        0        0   126798 2024-04-23 16:10:01.000000 mneflow-0.5.8/mneflow/models.py
--rw-rw-rw-   0        0        0    53760 2024-04-17 07:12:46.000000 mneflow-0.5.8/mneflow/utils.py
-drwxrwxrwx   0        0        0        0 2024-04-24 07:28:16.077464 mneflow-0.5.8/mneflow.egg-info/
--rw-rw-rw-   0        0        0      958 2024-04-24 07:28:15.000000 mneflow-0.5.8/mneflow.egg-info/PKG-INFO
--rw-rw-rw-   0        0        0      272 2024-04-24 07:28:16.000000 mneflow-0.5.8/mneflow.egg-info/SOURCES.txt
--rw-rw-rw-   0        0        0        1 2024-04-24 07:28:15.000000 mneflow-0.5.8/mneflow.egg-info/dependency_links.txt
--rw-rw-rw-   0        0        0       66 2024-04-24 07:28:16.000000 mneflow-0.5.8/mneflow.egg-info/requires.txt
--rw-rw-rw-   0        0        0        8 2024-04-24 07:28:16.000000 mneflow-0.5.8/mneflow.egg-info/top_level.txt
--rw-rw-rw-   0        0        0       42 2024-04-24 07:28:16.079479 mneflow-0.5.8/setup.cfg
--rw-rw-rw-   0        0        0     1511 2024-04-24 07:27:51.000000 mneflow-0.5.8/setup.py
+drwxrwxrwx   0        0        0        0 2024-05-03 14:05:29.933736 mneflow-0.5.9/
+-rw-rw-rw-   0        0        0     1549 2023-10-03 11:35:20.000000 mneflow-0.5.9/LICENSE.md
+-rw-rw-rw-   0        0        0      958 2024-05-03 14:05:29.931688 mneflow-0.5.9/PKG-INFO
+-rw-rw-rw-   0        0        0     2893 2024-02-26 13:04:59.000000 mneflow-0.5.9/README.md
+drwxrwxrwx   0        0        0        0 2024-05-03 14:05:29.905568 mneflow-0.5.9/mneflow/
+-rw-rw-rw-   0        0        0      212 2024-05-03 13:58:44.000000 mneflow-0.5.9/mneflow/__init__.py
+-rw-rw-rw-   0        0        0    15542 2024-04-23 16:35:15.000000 mneflow-0.5.9/mneflow/data.py
+-rw-rw-rw-   0        0        0    20233 2024-05-03 13:30:30.000000 mneflow-0.5.9/mneflow/layers.py
+-rw-rw-rw-   0        0        0   127158 2024-05-03 13:48:52.000000 mneflow-0.5.9/mneflow/models.py
+-rw-rw-rw-   0        0        0    53760 2024-04-17 07:12:46.000000 mneflow-0.5.9/mneflow/utils.py
+drwxrwxrwx   0        0        0        0 2024-05-03 14:05:29.930181 mneflow-0.5.9/mneflow.egg-info/
+-rw-rw-rw-   0        0        0      958 2024-05-03 14:05:29.000000 mneflow-0.5.9/mneflow.egg-info/PKG-INFO
+-rw-rw-rw-   0        0        0      272 2024-05-03 14:05:29.000000 mneflow-0.5.9/mneflow.egg-info/SOURCES.txt
+-rw-rw-rw-   0        0        0        1 2024-05-03 14:05:29.000000 mneflow-0.5.9/mneflow.egg-info/dependency_links.txt
+-rw-rw-rw-   0        0        0       66 2024-05-03 14:05:29.000000 mneflow-0.5.9/mneflow.egg-info/requires.txt
+-rw-rw-rw-   0        0        0        8 2024-05-03 14:05:29.000000 mneflow-0.5.9/mneflow.egg-info/top_level.txt
+-rw-rw-rw-   0        0        0       42 2024-05-03 14:05:29.933736 mneflow-0.5.9/setup.cfg
+-rw-rw-rw-   0        0        0     1511 2024-04-25 10:22:44.000000 mneflow-0.5.9/setup.py
```

### Comparing `mneflow-0.5.8/LICENSE.md` & `mneflow-0.5.9/LICENSE.md`

 * *Files identical despite different names*

### Comparing `mneflow-0.5.8/PKG-INFO` & `mneflow-0.5.9/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: mneflow
-Version: 0.5.8
+Version: 0.5.9
 Summary: Neural networks for MEG and EEG data
 Home-page: https://github.com/zubara/mneflow
 Download-URL: https://github.com/zubara/mneflow/archive/master.zip
 Maintainer: Ivan Zubarev
 Maintainer-email: ivan.zubarev@aalto.fi
 License: BSD-3
 Platform: any
@@ -18,10 +18,10 @@
 Classifier: Operating System :: POSIX
 Classifier: Operating System :: Unix
 Classifier: Operating System :: MacOS
 Description-Content-Type: text/x-rst
 License-File: LICENSE.md
 Requires-Dist: numpy
 Requires-Dist: scipy
-Requires-Dist: mne<=1.6,>=1.0
-Requires-Dist: tensorflow<=2.16rc,>=2.12.0
+Requires-Dist: mne<=1.7,>=1.0
+Requires-Dist: tensorflow<=2.16.1,>=2.12.0
 Requires-Dist: matplotlib
```

### Comparing `mneflow-0.5.8/README.md` & `mneflow-0.5.9/README.md`

 * *Files identical despite different names*

### Comparing `mneflow-0.5.8/mneflow/data.py` & `mneflow-0.5.9/mneflow/data.py`

 * *Files identical despite different names*

### Comparing `mneflow-0.5.8/mneflow/layers.py` & `mneflow-0.5.9/mneflow/layers.py`

 * *Files 0% similar despite different names*

```diff
@@ -5,14 +5,15 @@
 @author: Ivan Zubarev, ivan.zubarev@aalto.fi
 """
 #TODO: keras compatible layers
 #TODO: pooling layer
 
 #import functools
 import tensorflow as tf
+
 from tensorflow.keras.initializers import Constant
 from tensorflow.keras.activations import relu
 from tensorflow.keras import constraints as k_con, regularizers as k_reg, saving
 # import tensorflow.compat.v1 as tf
 # tf.disable_v2_behavior()
 import numpy as np
```

### Comparing `mneflow-0.5.8/mneflow/models.py` & `mneflow-0.5.9/mneflow/models.py`

 * *Files 1% similar despite different names*

```diff
@@ -145,7781 +145,7804 @@
 00000900: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00000910: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00000920: 2020 2020 2020 2020 2027 6d6f 6465 6c73           'models
 00000930: 2729 2020 0d0a 2020 2020 2020 2020 0d0a  ')  ..        ..
 00000940: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
 00000950: 6120 3d20 6d65 7461 0d0a 2020 2020 2020  a = meta..      
 00000960: 2020 7365 6c66 2e6d 6f64 656c 5f70 6174    self.model_pat
-00000970: 6820 3d20 6f73 2e70 6174 682e 6a6f 696e  h = os.path.join
-00000980: 286d 6574 612e 6461 7461 5b27 7061 7468  (meta.data['path
-00000990: 275d 2c20 276d 6f64 656c 735c 5c27 290d  '], 'models\\').
-000009a0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-000009b0: 6f73 2e70 6174 682e 6578 6973 7473 2873  os.path.exists(s
-000009c0: 656c 662e 6d6f 6465 6c5f 7061 7468 293a  elf.model_path):
-000009d0: 0d0a 2020 2020 2020 2020 2020 2020 6f73  ..            os
-000009e0: 2e6d 6b64 6972 2873 656c 662e 6d6f 6465  .mkdir(self.mode
-000009f0: 6c5f 7061 7468 2920 2020 2020 2020 2020  l_path)         
-00000a00: 2020 200d 0a0d 0a20 2020 2020 2020 200d     ....        .
-00000a10: 0a20 2020 2020 2020 2069 6620 6461 7461  .        if data
-00000a20: 7365 743a 0d0a 2020 2020 2020 2020 2020  set:..          
-00000a30: 2020 7365 6c66 2e64 6174 6173 6574 203d    self.dataset =
-00000a40: 2064 6174 6173 6574 0d0a 2020 2020 2020   dataset..      
-00000a50: 2020 656c 6966 206e 6f74 2064 6174 6173    elif not datas
-00000a60: 6574 2061 6e64 206d 6574 613a 0d0a 2020  et and meta:..  
-00000a70: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-00000a80: 6174 6173 6574 203d 2044 6174 6173 6574  ataset = Dataset
-00000a90: 286d 6574 612c 202a 2a6d 6574 612e 6461  (meta, **meta.da
-00000aa0: 7461 290d 0a20 2020 2020 2020 2065 6c73  ta)..        els
-00000ab0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00000ac0: 7072 696e 7428 2250 726f 7669 6465 2044  print("Provide D
-00000ad0: 6174 6173 6574 206f 7220 4d65 7461 6461  ataset or Metada
-00000ae0: 7461 2066 696c 6522 290d 0a20 2020 2020  ta file")..     
-00000af0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00000b00: 2073 656c 662e 696e 7075 745f 7368 6170   self.input_shap
-00000b10: 6520 3d20 2873 656c 662e 6461 7461 7365  e = (self.datase
-00000b20: 742e 685f 7061 7261 6d73 5b27 6e5f 7365  t.h_params['n_se
-00000b30: 7127 5d2c 0d0a 2020 2020 2020 2020 2020  q'],..          
-00000b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000b50: 2020 7365 6c66 2e64 6174 6173 6574 2e68    self.dataset.h
-00000b60: 5f70 6172 616d 735b 276e 5f74 275d 2c0d  _params['n_t'],.
-00000b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00000b80: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00000b90: 662e 6461 7461 7365 742e 685f 7061 7261  f.dataset.h_para
-00000ba0: 6d73 5b27 6e5f 6368 275d 290d 0a20 2020  ms['n_ch'])..   
-00000bb0: 2020 2020 2073 656c 662e 795f 7368 6170       self.y_shap
-00000bc0: 6520 3d20 7365 6c66 2e64 6174 6173 6574  e = self.dataset
-00000bd0: 2e79 5f73 6861 7065 0d0a 2020 2020 2020  .y_shape..      
-00000be0: 2020 7365 6c66 2e6f 7574 5f64 696d 203d    self.out_dim =
-00000bf0: 206e 702e 7072 6f64 2873 656c 662e 795f   np.prod(self.y_
-00000c00: 7368 6170 6529 0d0a 2020 2020 2020 2020  shape)..        
-00000c10: 7365 6c66 2e69 6e70 7574 7320 3d20 6c61  self.inputs = la
-00000c20: 7965 7273 2e49 6e70 7574 2873 6861 7065  yers.Input(shape
-00000c30: 3d28 7365 6c66 2e69 6e70 7574 5f73 6861  =(self.input_sha
-00000c40: 7065 2929 0d0a 2020 2020 2020 2020 2373  pe))..        #s
-00000c50: 656c 662e 7472 6169 6e65 6420 3d20 4661  elf.trained = Fa
-00000c60: 6c73 650d 0a20 2020 2020 2020 2073 656c  lse..        sel
-00000c70: 662e 795f 7072 6564 203d 2073 656c 662e  f.y_pred = self.
-00000c80: 6275 696c 645f 6772 6170 6828 290d 0a20  build_graph().. 
-00000c90: 2020 2020 2020 2073 656c 662e 6c6f 6720         self.log 
-00000ca0: 3d20 6469 6374 2829 0d0a 2020 2020 2020  = dict()..      
-00000cb0: 2020 7365 6c66 2e63 6d20 3d20 6e70 2e7a    self.cm = np.z
-00000cc0: 6572 6f73 285b 7365 6c66 2e79 5f73 6861  eros([self.y_sha
-00000cd0: 7065 5b2d 315d 2c20 7365 6c66 2e79 5f73  pe[-1], self.y_s
-00000ce0: 6861 7065 5b2d 315d 5d29 0d0a 2020 2020  hape[-1]])..    
-00000cf0: 2020 2020 7365 6c66 2e63 765f 7061 7474      self.cv_patt
-00000d00: 6572 6e73 203d 2064 6566 6175 6c74 6469  erns = defaultdi
-00000d10: 6374 2864 6963 7429 0d0a 2020 2020 2020  ct(dict)..      
-00000d20: 2020 7365 6c66 2e63 765f 7765 6967 6874    self.cv_weight
-00000d30: 7320 3d20 6465 6661 756c 7464 6963 7428  s = defaultdict(
-00000d40: 6c69 7374 290d 0a20 2020 2020 2020 2069  list)..        i
-00000d50: 6620 6e6f 7420 6861 7361 7474 7228 7365  f not hasattr(se
-00000d60: 6c66 2c20 2773 636f 7065 2729 3a0d 0a20  lf, 'scope'):.. 
-00000d70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00000d80: 7363 6f70 6520 3d20 2762 6173 656d 6f64  scope = 'basemod
-00000d90: 656c 270d 0a20 2020 2020 2020 2073 656c  el'..        sel
-00000da0: 662e 6d6f 6465 6c5f 6e61 6d65 203d 2022  f.model_name = "
-00000db0: 5f22 2e6a 6f69 6e28 5b73 656c 662e 7363  _".join([self.sc
-00000dc0: 6f70 652c 0d0a 2020 2020 2020 2020 2020  ope,..          
-00000dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00000de0: 2020 2020 2020 2020 2020 6d65 7461 2e64            meta.d
-00000df0: 6174 615b 2764 6174 615f 6964 275d 5d29  ata['data_id']])
-00000e00: 0d0a 0d0a 0d0a 0d0a 2020 2020 2320 4063  ........    # @c
-00000e10: 6c61 7373 6d65 7468 6f64 0d0a 2020 2020  lassmethod..    
-00000e20: 2320 6465 6620 6672 6f6d 5f63 6f6e 6669  # def from_confi
-00000e30: 6728 636c 732c 2063 6f6e 6669 6729 3a0d  g(cls, config):.
-00000e40: 0a20 2020 2023 2020 2020 2072 6574 7572  .    #     retur
-00000e50: 6e20 636c 7328 2a2a 636f 6e66 6967 290d  n cls(**config).
-00000e60: 0a0d 0a20 2020 2023 2064 6566 2067 6574  ...    # def get
-00000e70: 5f63 6f6e 6669 6728 7365 6c66 293a 0d0a  _config(self):..
-00000e80: 2020 2020 2320 2020 2020 636f 6e66 6967      #     config
-00000e90: 203d 207b 0d0a 2020 2020 2320 2020 2020   = {..    #     
-00000ea0: 2020 2020 2266 6322 3a20 7365 6c66 2e66      "fc": self.f
-00000eb0: 630d 0a20 2020 2023 2020 2020 207d 0d0a  c..    #     }..
-00000ec0: 2020 2020 2320 2020 2020 7265 7475 726e      #     return
-00000ed0: 2063 6f6e 6669 670d 0a0d 0a0d 0a0d 0a20   config........ 
-00000ee0: 2020 2064 6566 2062 7569 6c64 2873 656c     def build(sel
-00000ef0: 662c 206f 7074 696d 697a 6572 3d22 6164  f, optimizer="ad
-00000f00: 616d 222c 206c 6f73 733d 4e6f 6e65 2c20  am", loss=None, 
-00000f10: 6d65 7472 6963 733d 4e6f 6e65 2c20 6d61  metrics=None, ma
-00000f20: 7070 696e 673d 4e6f 6e65 2c0d 0a20 2020  pping=None,..   
-00000f30: 2020 2020 2020 2020 2020 206c 6561 726e             learn
-00000f40: 5f72 6174 653d 3365 2d34 293a 0d0a 2020  _rate=3e-4):..  
-00000f50: 2020 2020 2020 2222 2243 6f6d 7069 6c65        """Compile
-00000f60: 2061 206d 6f64 656c 2e0d 0a0d 0a20 2020   a model.....   
-00000f70: 2020 2020 2050 6172 616d 6574 6572 730d       Parameters.
-00000f80: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00000f90: 2d2d 2d0d 0a20 2020 2020 2020 206f 7074  ---..        opt
-00000fa0: 696d 697a 6572 203a 2073 7472 2c20 7466  imizer : str, tf
-00000fb0: 2e6f 7074 696d 697a 6572 732e 4f70 7469  .optimizers.Opti
-00000fc0: 6d69 7a65 720d 0a20 2020 2020 2020 2020  mizer..         
-00000fd0: 2020 2044 6561 6675 6c74 7320 746f 2022     Deafults to "
-00000fe0: 6164 616d 220d 0a0d 0a20 2020 2020 2020  adam"....       
-00000ff0: 206c 6f73 7320 3a20 7374 722c 2074 662e   loss : str, tf.
-00001000: 6b65 7261 732e 6c6f 7373 6573 2e4c 6f73  keras.losses.Los
-00001010: 730d 0a20 2020 2020 2020 2020 2020 2044  s..            D
-00001020: 6566 6175 6c74 7320 746f 204d 5345 2069  efaults to MSE i
-00001030: 6e20 7461 7267 6574 5f74 7970 6520 6973  n target_type is
-00001040: 2022 666c 6f61 7422 2061 6e64 0d0a 2020   "float" and..  
-00001050: 2020 2020 2020 2020 2020 2273 6f66 746d            "softm
-00001060: 6178 5f63 726f 7373 656e 7472 6f70 7922  ax_crossentropy"
-00001070: 2069 6620 2274 6172 6765 745f 7479 7065   if "target_type
-00001080: 2220 6973 2069 6e74 0d0a 0d0a 2020 2020  " is int....    
-00001090: 2020 2020 6d65 7472 6963 7320 3a20 7374      metrics : st
-000010a0: 722c 2074 662e 6b65 7261 732e 6d65 7472  r, tf.keras.metr
-000010b0: 6963 732e 4d65 7472 6963 0d0a 2020 2020  ics.Metric..    
-000010c0: 2020 2020 2020 2020 4465 6661 756c 7473          Defaults
-000010d0: 2074 6f20 524d 5345 2069 6e20 7461 7267   to RMSE in targ
-000010e0: 6574 5f74 7970 6520 6973 2022 666c 6f61  et_type is "floa
-000010f0: 7422 2061 6e64 0d0a 2020 2020 2020 2020  t" and..        
-00001100: 2020 2020 2020 2020 2263 6174 6567 6f72          "categor
-00001110: 6963 616c 5f61 6363 7572 6163 7922 2069  ical_accuracy" i
-00001120: 6620 2274 6172 6765 745f 7479 7065 2220  f "target_type" 
-00001130: 6973 2069 6e74 0d0a 0d0a 2020 2020 2020  is int....      
-00001140: 2020 6c65 6172 6e5f 7261 7465 203a 2066    learn_rate : f
-00001150: 6c6f 6174 0d0a 2020 2020 2020 2020 2020  loat..          
-00001160: 2020 4c65 6172 6e69 6e67 2072 6174 652c    Learning rate,
-00001170: 2064 6566 6175 6c74 7320 746f 2033 652d   defaults to 3e-
-00001180: 340d 0a0d 0a20 2020 2020 2020 206d 6170  4....        map
-00001190: 7069 6e67 203a 2073 7472 0d0a 0d0a 2020  ping : str....  
-000011a0: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-000011b0: 2020 2023 2049 6e69 7469 616c 697a 6520     # Initialize 
-000011c0: 636f 6d70 7574 6174 696f 6e61 6c20 6772  computational gr
-000011d0: 6170 680d 0a20 2020 2020 2020 2069 6620  aph..        if 
-000011e0: 6d61 7070 696e 673a 0d0a 2020 2020 2020  mapping:..      
-000011f0: 2020 2020 2020 6d61 705f 6675 6e20 3d20        map_fun = 
-00001200: 7466 2e6b 6572 6173 2e61 6374 6976 6174  tf.keras.activat
-00001210: 696f 6e73 2e67 6574 286d 6170 7069 6e67  ions.get(mapping
-00001220: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00001230: 656c 662e 795f 7072 6564 3d20 6d61 705f  elf.y_pred= map_
-00001240: 6675 6e28 7365 6c66 2e79 5f70 7265 6429  fun(self.y_pred)
-00001250: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-00001260: 2e6b 6d20 3d20 7466 2e6b 6572 6173 2e4d  .km = tf.keras.M
-00001270: 6f64 656c 2869 6e70 7574 733d 7365 6c66  odel(inputs=self
-00001280: 2e69 6e70 7574 732c 206f 7574 7075 7473  .inputs, outputs
-00001290: 3d73 656c 662e 795f 7072 6564 290d 0a0d  =self.y_pred)...
-000012a0: 0a20 2020 2020 2020 2070 6172 616d 7320  .        params 
-000012b0: 3d20 7b22 6f70 7469 6d69 7a65 7222 3a20  = {"optimizer": 
-000012c0: 7466 2e6f 7074 696d 697a 6572 732e 6765  tf.optimizers.ge
-000012d0: 7428 6f70 7469 6d69 7a65 7229 2e66 726f  t(optimizer).fro
-000012e0: 6d5f 636f 6e66 6967 280d 0a20 2020 2020  m_config(..     
-000012f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001310: 2020 2020 2020 207b 226c 6561 726e 696e         {"learnin
-00001320: 675f 7261 7465 223a 6c65 6172 6e5f 7261  g_rate":learn_ra
-00001330: 7465 7d29 7d0d 0a0d 0a20 2020 2020 2020  te})}....       
-00001340: 2069 6620 6c6f 7373 3a20 2020 200d 0a20   if loss:    .. 
-00001350: 2020 2020 2020 2020 2020 2070 6172 616d             param
-00001360: 735b 226c 6f73 7322 5d20 3d20 7466 2e6b  s["loss"] = tf.k
-00001370: 6572 6173 2e6c 6f73 7365 732e 6765 7428  eras.losses.get(
-00001380: 6c6f 7373 290d 0a20 2020 2020 2020 2020  loss)..         
-00001390: 2020 206c 6f73 735f 6e61 6d65 203d 206c     loss_name = l
-000013a0: 6f73 730d 0a0d 0a20 2020 2020 2020 2069  oss....        i
-000013b0: 6620 6d65 7472 6963 733a 0d0a 2020 2020  f metrics:..    
-000013c0: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-000013d0: 7369 6e73 7461 6e63 6528 6d65 7472 6963  sinstance(metric
-000013e0: 732c 206c 6973 7429 3a0d 0a20 2020 2020  s, list):..     
-000013f0: 2020 2020 2020 2020 2020 206d 6574 7269             metri
-00001400: 6373 203d 205b 6d65 7472 6963 735d 0d0a  cs = [metrics]..
-00001410: 2020 2020 2020 2020 2020 2020 7061 7261              para
-00001420: 6d73 5b22 6d65 7472 6963 7322 5d20 3d20  ms["metrics"] = 
-00001430: 5b74 662e 6b65 7261 732e 6d65 7472 6963  [tf.keras.metric
-00001440: 732e 6765 7428 6d65 7472 6963 2920 666f  s.get(metric) fo
-00001450: 7220 6d65 7472 6963 2069 6e20 6d65 7472  r metric in metr
-00001460: 6963 735d 0d0a 0d0a 2020 2020 2020 2020  ics]....        
-00001470: 230d 0a20 2020 2020 2020 2023 7365 6c66  #..        #self
-00001480: 2e73 7065 6373 2e73 6574 6465 6661 756c  .specs.setdefaul
-00001490: 7428 2775 6e69 746e 6f72 6d5f 7363 6f70  t('unitnorm_scop
-000014a0: 6527 2c20 5b5d 290d 0a20 2020 2020 2020  e', [])..       
-000014b0: 2320 496e 6974 6961 6c69 7a65 206f 7074  # Initialize opt
-000014c0: 696d 697a 6572 0d0a 2020 2020 2020 2020  imizer..        
-000014d0: 6966 2073 656c 662e 6461 7461 7365 742e  if self.dataset.
-000014e0: 685f 7061 7261 6d73 5b22 7461 7267 6574  h_params["target
-000014f0: 5f74 7970 6522 5d20 696e 205b 2766 6c6f  _type"] in ['flo
-00001500: 6174 272c 2027 7369 676e 616c 275d 3a0d  at', 'signal']:.
-00001510: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
-00001520: 616d 732e 7365 7464 6566 6175 6c74 2822  ams.setdefault("
-00001530: 6c6f 7373 222c 2074 662e 6b65 7261 732e  loss", tf.keras.
-00001540: 6c6f 7373 6573 2e4d 6561 6e53 7175 6172  losses.MeanSquar
-00001550: 6564 4572 726f 7228 6e61 6d65 3d27 4d53  edError(name='MS
-00001560: 4527 2929 0d0a 2020 2020 2020 2020 2020  E'))..          
-00001570: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00001580: 2020 2020 7061 7261 6d73 2e73 6574 6465      params.setde
-00001590: 6661 756c 7428 226d 6574 7269 6373 222c  fault("metrics",
-000015a0: 205b 7466 2e6b 6572 6173 2e6d 6574 7269   [tf.keras.metri
-000015b0: 6373 2e52 6f6f 744d 6561 6e53 7175 6172  cs.RootMeanSquar
-000015c0: 6564 4572 726f 7228 6e61 6d65 3d22 524d  edError(name="RM
-000015d0: 5345 2229 5d29 0d0a 0d0a 2020 2020 2020  SE")])....      
-000015e0: 2020 656c 6966 2073 656c 662e 6461 7461    elif self.data
-000015f0: 7365 742e 685f 7061 7261 6d73 5b22 7461  set.h_params["ta
-00001600: 7267 6574 5f74 7970 6522 5d20 696e 205b  rget_type"] in [
-00001610: 2769 6e74 275d 3a0d 0a20 2020 2020 2020  'int']:..       
-00001620: 2020 2020 2070 6172 616d 732e 7365 7464       params.setd
-00001630: 6566 6175 6c74 2822 6c6f 7373 222c 2074  efault("loss", t
-00001640: 662e 6b65 7261 732e 6c6f 7373 6573 2e43  f.keras.losses.C
-00001650: 6174 6567 6f72 6963 616c 4372 6f73 7365  ategoricalCrosse
-00001660: 6e74 726f 7079 2866 726f 6d5f 6c6f 6769  ntropy(from_logi
-00001670: 7473 3d54 7275 652c 0d0a 2020 2020 2020  ts=True,..      
-00001680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000970: 6820 3d20 6d65 7461 2e6d 6f64 656c 5f73  h = meta.model_s
+00000980: 7065 6373 5b27 6d6f 6465 6c5f 7061 7468  pecs['model_path
+00000990: 275d 2023 6f73 2e70 6174 682e 6a6f 696e  '] #os.path.join
+000009a0: 286d 6574 612e 6461 7461 5b27 7061 7468  (meta.data['path
+000009b0: 275d 2c20 276d 6f64 656c 7327 290d 0a20  '], 'models').. 
+000009c0: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
+000009d0: 2e70 6174 682e 6578 6973 7473 2873 656c  .path.exists(sel
+000009e0: 662e 6d6f 6465 6c5f 7061 7468 293a 0d0a  f.model_path):..
+000009f0: 2020 2020 2020 2020 2020 2020 6f73 2e6d              os.m
+00000a00: 6b64 6972 2873 656c 662e 6d6f 6465 6c5f  kdir(self.model_
+00000a10: 7061 7468 2920 2020 2020 2020 2020 2020  path)           
+00000a20: 200d 0a0d 0a20 2020 2020 2020 200d 0a20   ....        .. 
+00000a30: 2020 2020 2020 2069 6620 6461 7461 7365         if datase
+00000a40: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
+00000a50: 7365 6c66 2e64 6174 6173 6574 203d 2064  self.dataset = d
+00000a60: 6174 6173 6574 0d0a 2020 2020 2020 2020  ataset..        
+00000a70: 656c 6966 206e 6f74 2064 6174 6173 6574  elif not dataset
+00000a80: 2061 6e64 206d 6574 613a 0d0a 2020 2020   and meta:..    
+00000a90: 2020 2020 2020 2020 7365 6c66 2e64 6174          self.dat
+00000aa0: 6173 6574 203d 2044 6174 6173 6574 286d  aset = Dataset(m
+00000ab0: 6574 612c 202a 2a6d 6574 612e 6461 7461  eta, **meta.data
+00000ac0: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
+00000ad0: 0d0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
+00000ae0: 696e 7428 2250 726f 7669 6465 2044 6174  int("Provide Dat
+00000af0: 6173 6574 206f 7220 4d65 7461 6461 7461  aset or Metadata
+00000b00: 2066 696c 6522 290d 0a20 2020 2020 2020   file")..       
+00000b10: 2020 2020 200d 0a20 2020 2020 2020 2073       ..        s
+00000b20: 656c 662e 696e 7075 745f 7368 6170 6520  elf.input_shape 
+00000b30: 3d20 2873 656c 662e 6461 7461 7365 742e  = (self.dataset.
+00000b40: 685f 7061 7261 6d73 5b27 6e5f 7365 7127  h_params['n_seq'
+00000b50: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+00000b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000b70: 7365 6c66 2e64 6174 6173 6574 2e68 5f70  self.dataset.h_p
+00000b80: 6172 616d 735b 276e 5f74 275d 2c0d 0a20  arams['n_t'],.. 
+00000b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000ba0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00000bb0: 6461 7461 7365 742e 685f 7061 7261 6d73  dataset.h_params
+00000bc0: 5b27 6e5f 6368 275d 290d 0a20 2020 2020  ['n_ch'])..     
+00000bd0: 2020 2073 656c 662e 795f 7368 6170 6520     self.y_shape 
+00000be0: 3d20 7365 6c66 2e64 6174 6173 6574 2e79  = self.dataset.y
+00000bf0: 5f73 6861 7065 0d0a 2020 2020 2020 2020  _shape..        
+00000c00: 7365 6c66 2e6f 7574 5f64 696d 203d 206e  self.out_dim = n
+00000c10: 702e 7072 6f64 2873 656c 662e 795f 7368  p.prod(self.y_sh
+00000c20: 6170 6529 0d0a 2020 2020 2020 2020 7365  ape)..        se
+00000c30: 6c66 2e69 6e70 7574 7320 3d20 6c61 7965  lf.inputs = laye
+00000c40: 7273 2e49 6e70 7574 2873 6861 7065 3d28  rs.Input(shape=(
+00000c50: 7365 6c66 2e69 6e70 7574 5f73 6861 7065  self.input_shape
+00000c60: 2929 0d0a 2020 2020 2020 2020 2373 656c  ))..        #sel
+00000c70: 662e 7472 6169 6e65 6420 3d20 4661 6c73  f.trained = Fals
+00000c80: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
+00000c90: 795f 7072 6564 203d 2073 656c 662e 6275  y_pred = self.bu
+00000ca0: 696c 645f 6772 6170 6828 290d 0a20 2020  ild_graph()..   
+00000cb0: 2020 2020 2073 656c 662e 6c6f 6720 3d20       self.log = 
+00000cc0: 6469 6374 2829 0d0a 2020 2020 2020 2020  dict()..        
+00000cd0: 7365 6c66 2e63 6d20 3d20 6e70 2e7a 6572  self.cm = np.zer
+00000ce0: 6f73 285b 7365 6c66 2e79 5f73 6861 7065  os([self.y_shape
+00000cf0: 5b2d 315d 2c20 7365 6c66 2e79 5f73 6861  [-1], self.y_sha
+00000d00: 7065 5b2d 315d 5d29 0d0a 2020 2020 2020  pe[-1]])..      
+00000d10: 2020 7365 6c66 2e63 765f 7061 7474 6572    self.cv_patter
+00000d20: 6e73 203d 2064 6566 6175 6c74 6469 6374  ns = defaultdict
+00000d30: 2864 6963 7429 0d0a 2020 2020 2020 2020  (dict)..        
+00000d40: 7365 6c66 2e63 765f 7765 6967 6874 7320  self.cv_weights 
+00000d50: 3d20 6465 6661 756c 7464 6963 7428 6c69  = defaultdict(li
+00000d60: 7374 290d 0a20 2020 2020 2020 2069 6620  st)..        if 
+00000d70: 6e6f 7420 6861 7361 7474 7228 7365 6c66  not hasattr(self
+00000d80: 2c20 2773 636f 7065 2729 3a0d 0a20 2020  , 'scope'):..   
+00000d90: 2020 2020 2020 2020 2073 656c 662e 7363           self.sc
+00000da0: 6f70 6520 3d20 2762 6173 656d 6f64 656c  ope = 'basemodel
+00000db0: 270d 0a20 2020 2020 2020 2073 656c 662e  '..        self.
+00000dc0: 6d6f 6465 6c5f 6e61 6d65 203d 2022 5f22  model_name = "_"
+00000dd0: 2e6a 6f69 6e28 5b73 656c 662e 7363 6f70  .join([self.scop
+00000de0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00000df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000e00: 2020 2020 2020 2020 6d65 7461 2e64 6174          meta.dat
+00000e10: 615b 2764 6174 615f 6964 275d 5d29 0d0a  a['data_id']])..
+00000e20: 0d0a 0d0a 0d0a 2020 2020 2320 4063 6c61  ......    # @cla
+00000e30: 7373 6d65 7468 6f64 0d0a 2020 2020 2320  ssmethod..    # 
+00000e40: 6465 6620 6672 6f6d 5f63 6f6e 6669 6728  def from_config(
+00000e50: 636c 732c 2063 6f6e 6669 6729 3a0d 0a20  cls, config):.. 
+00000e60: 2020 2023 2020 2020 2072 6574 7572 6e20     #     return 
+00000e70: 636c 7328 2a2a 636f 6e66 6967 290d 0a0d  cls(**config)...
+00000e80: 0a20 2020 2023 2064 6566 2067 6574 5f63  .    # def get_c
+00000e90: 6f6e 6669 6728 7365 6c66 293a 0d0a 2020  onfig(self):..  
+00000ea0: 2020 2320 2020 2020 636f 6e66 6967 203d    #     config =
+00000eb0: 207b 0d0a 2020 2020 2320 2020 2020 2020   {..    #       
+00000ec0: 2020 2266 6322 3a20 7365 6c66 2e66 630d    "fc": self.fc.
+00000ed0: 0a20 2020 2023 2020 2020 207d 0d0a 2020  .    #     }..  
+00000ee0: 2020 2320 2020 2020 7265 7475 726e 2063    #     return c
+00000ef0: 6f6e 6669 670d 0a0d 0a0d 0a0d 0a20 2020  onfig........   
+00000f00: 2064 6566 2062 7569 6c64 2873 656c 662c   def build(self,
+00000f10: 206f 7074 696d 697a 6572 3d22 6164 616d   optimizer="adam
+00000f20: 222c 206c 6f73 733d 4e6f 6e65 2c20 6d65  ", loss=None, me
+00000f30: 7472 6963 733d 4e6f 6e65 2c20 6d61 7070  trics=None, mapp
+00000f40: 696e 673d 4e6f 6e65 2c0d 0a20 2020 2020  ing=None,..     
+00000f50: 2020 2020 2020 2020 206c 6561 726e 5f72           learn_r
+00000f60: 6174 653d 3365 2d34 293a 0d0a 2020 2020  ate=3e-4):..    
+00000f70: 2020 2020 2222 2243 6f6d 7069 6c65 2061      """Compile a
+00000f80: 206d 6f64 656c 2e0d 0a0d 0a20 2020 2020   model.....     
+00000f90: 2020 2050 6172 616d 6574 6572 730d 0a20     Parameters.. 
+00000fa0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+00000fb0: 2d0d 0a20 2020 2020 2020 206f 7074 696d  -..        optim
+00000fc0: 697a 6572 203a 2073 7472 2c20 7466 2e6f  izer : str, tf.o
+00000fd0: 7074 696d 697a 6572 732e 4f70 7469 6d69  ptimizers.Optimi
+00000fe0: 7a65 720d 0a20 2020 2020 2020 2020 2020  zer..           
+00000ff0: 2044 6561 6675 6c74 7320 746f 2022 6164   Deafults to "ad
+00001000: 616d 220d 0a0d 0a20 2020 2020 2020 206c  am"....        l
+00001010: 6f73 7320 3a20 7374 722c 2074 662e 6b65  oss : str, tf.ke
+00001020: 7261 732e 6c6f 7373 6573 2e4c 6f73 730d  ras.losses.Loss.
+00001030: 0a20 2020 2020 2020 2020 2020 2044 6566  .            Def
+00001040: 6175 6c74 7320 746f 204d 5345 2069 6e20  aults to MSE in 
+00001050: 7461 7267 6574 5f74 7970 6520 6973 2022  target_type is "
+00001060: 666c 6f61 7422 2061 6e64 0d0a 2020 2020  float" and..    
+00001070: 2020 2020 2020 2020 2273 6f66 746d 6178          "softmax
+00001080: 5f63 726f 7373 656e 7472 6f70 7922 2069  _crossentropy" i
+00001090: 6620 2274 6172 6765 745f 7479 7065 2220  f "target_type" 
+000010a0: 6973 2069 6e74 0d0a 0d0a 2020 2020 2020  is int....      
+000010b0: 2020 6d65 7472 6963 7320 3a20 7374 722c    metrics : str,
+000010c0: 2074 662e 6b65 7261 732e 6d65 7472 6963   tf.keras.metric
+000010d0: 732e 4d65 7472 6963 0d0a 2020 2020 2020  s.Metric..      
+000010e0: 2020 2020 2020 4465 6661 756c 7473 2074        Defaults t
+000010f0: 6f20 524d 5345 2069 6e20 7461 7267 6574  o RMSE in target
+00001100: 5f74 7970 6520 6973 2022 666c 6f61 7422  _type is "float"
+00001110: 2061 6e64 0d0a 2020 2020 2020 2020 2020   and..          
+00001120: 2020 2020 2020 2263 6174 6567 6f72 6963        "categoric
+00001130: 616c 5f61 6363 7572 6163 7922 2069 6620  al_accuracy" if 
+00001140: 2274 6172 6765 745f 7479 7065 2220 6973  "target_type" is
+00001150: 2069 6e74 0d0a 0d0a 2020 2020 2020 2020   int....        
+00001160: 6c65 6172 6e5f 7261 7465 203a 2066 6c6f  learn_rate : flo
+00001170: 6174 0d0a 2020 2020 2020 2020 2020 2020  at..            
+00001180: 4c65 6172 6e69 6e67 2072 6174 652c 2064  Learning rate, d
+00001190: 6566 6175 6c74 7320 746f 2033 652d 340d  efaults to 3e-4.
+000011a0: 0a0d 0a20 2020 2020 2020 206d 6170 7069  ...        mappi
+000011b0: 6e67 203a 2073 7472 0d0a 0d0a 2020 2020  ng : str....    
+000011c0: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+000011d0: 2023 2049 6e69 7469 616c 697a 6520 636f   # Initialize co
+000011e0: 6d70 7574 6174 696f 6e61 6c20 6772 6170  mputational grap
+000011f0: 680d 0a20 2020 2020 2020 2069 6620 6d61  h..        if ma
+00001200: 7070 696e 673a 0d0a 2020 2020 2020 2020  pping:..        
+00001210: 2020 2020 6d61 705f 6675 6e20 3d20 7466      map_fun = tf
+00001220: 2e6b 6572 6173 2e61 6374 6976 6174 696f  .keras.activatio
+00001230: 6e73 2e67 6574 286d 6170 7069 6e67 290d  ns.get(mapping).
+00001240: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00001250: 662e 795f 7072 6564 203d 206d 6170 5f66  f.y_pred = map_f
+00001260: 756e 2873 656c 662e 795f 7072 6564 290d  un(self.y_pred).
+00001270: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00001280: 6b6d 203d 2074 662e 6b65 7261 732e 4d6f  km = tf.keras.Mo
+00001290: 6465 6c28 696e 7075 7473 3d73 656c 662e  del(inputs=self.
+000012a0: 696e 7075 7473 2c20 6f75 7470 7574 733d  inputs, outputs=
+000012b0: 7365 6c66 2e79 5f70 7265 6429 0d0a 0d0a  self.y_pred)....
+000012c0: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
+000012d0: 207b 226f 7074 696d 697a 6572 223a 2074   {"optimizer": t
+000012e0: 662e 6f70 7469 6d69 7a65 7273 2e67 6574  f.optimizers.get
+000012f0: 286f 7074 696d 697a 6572 292e 6672 6f6d  (optimizer).from
+00001300: 5f63 6f6e 6669 6728 0d0a 2020 2020 2020  _config(..      
+00001310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001330: 2020 2020 2020 7b22 6c65 6172 6e69 6e67        {"learning
+00001340: 5f72 6174 6522 3a6c 6561 726e 5f72 6174  _rate":learn_rat
+00001350: 657d 297d 0d0a 0d0a 2020 2020 2020 2020  e})}....        
+00001360: 6966 206c 6f73 733a 2020 2020 0d0a 2020  if loss:    ..  
+00001370: 2020 2020 2020 2020 2020 7061 7261 6d73            params
+00001380: 5b22 6c6f 7373 225d 203d 2074 662e 6b65  ["loss"] = tf.ke
+00001390: 7261 732e 6c6f 7373 6573 2e67 6574 286c  ras.losses.get(l
+000013a0: 6f73 7329 0d0a 2020 2020 2020 2020 2020  oss)..          
+000013b0: 2020 6c6f 7373 5f6e 616d 6520 3d20 6c6f    loss_name = lo
+000013c0: 7373 0d0a 0d0a 2020 2020 2020 2020 6966  ss....        if
+000013d0: 206d 6574 7269 6373 3a0d 0a20 2020 2020   metrics:..     
+000013e0: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+000013f0: 696e 7374 616e 6365 286d 6574 7269 6373  instance(metrics
+00001400: 2c20 6c69 7374 293a 0d0a 2020 2020 2020  , list):..      
+00001410: 2020 2020 2020 2020 2020 6d65 7472 6963            metric
+00001420: 7320 3d20 5b6d 6574 7269 6373 5d0d 0a20  s = [metrics].. 
+00001430: 2020 2020 2020 2020 2020 2070 6172 616d             param
+00001440: 735b 226d 6574 7269 6373 225d 203d 205b  s["metrics"] = [
+00001450: 7466 2e6b 6572 6173 2e6d 6574 7269 6373  tf.keras.metrics
+00001460: 2e67 6574 286d 6574 7269 6329 2066 6f72  .get(metric) for
+00001470: 206d 6574 7269 6320 696e 206d 6574 7269   metric in metri
+00001480: 6373 5d0d 0a0d 0a20 2020 2020 2020 2023  cs]....        #
+00001490: 0d0a 2020 2020 2020 2020 2373 656c 662e  ..        #self.
+000014a0: 7370 6563 732e 7365 7464 6566 6175 6c74  specs.setdefault
+000014b0: 2827 756e 6974 6e6f 726d 5f73 636f 7065  ('unitnorm_scope
+000014c0: 272c 205b 5d29 0d0a 2020 2020 2020 2023  ', [])..       #
+000014d0: 2049 6e69 7469 616c 697a 6520 6f70 7469   Initialize opti
+000014e0: 6d69 7a65 720d 0a20 2020 2020 2020 2069  mizer..        i
+000014f0: 6620 7365 6c66 2e64 6174 6173 6574 2e68  f self.dataset.h
+00001500: 5f70 6172 616d 735b 2274 6172 6765 745f  _params["target_
+00001510: 7479 7065 225d 2069 6e20 5b27 666c 6f61  type"] in ['floa
+00001520: 7427 2c20 2773 6967 6e61 6c27 5d3a 0d0a  t', 'signal']:..
+00001530: 2020 2020 2020 2020 2020 2020 7061 7261              para
+00001540: 6d73 2e73 6574 6465 6661 756c 7428 226c  ms.setdefault("l
+00001550: 6f73 7322 2c20 7466 2e6b 6572 6173 2e6c  oss", tf.keras.l
+00001560: 6f73 7365 732e 4d65 616e 5371 7561 7265  osses.MeanSquare
+00001570: 6445 7272 6f72 286e 616d 653d 274d 5345  dError(name='MSE
+00001580: 2729 290d 0a20 2020 2020 2020 2020 2020  '))..           
+00001590: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
+000015a0: 2020 2070 6172 616d 732e 7365 7464 6566     params.setdef
+000015b0: 6175 6c74 2822 6d65 7472 6963 7322 2c20  ault("metrics", 
+000015c0: 5b74 662e 6b65 7261 732e 6d65 7472 6963  [tf.keras.metric
+000015d0: 732e 526f 6f74 4d65 616e 5371 7561 7265  s.RootMeanSquare
+000015e0: 6445 7272 6f72 286e 616d 653d 2252 4d53  dError(name="RMS
+000015f0: 4522 295d 290d 0a0d 0a20 2020 2020 2020  E")])....       
+00001600: 2065 6c69 6620 7365 6c66 2e64 6174 6173   elif self.datas
+00001610: 6574 2e68 5f70 6172 616d 735b 2274 6172  et.h_params["tar
+00001620: 6765 745f 7479 7065 225d 2069 6e20 5b27  get_type"] in ['
+00001630: 696e 7427 5d3a 0d0a 2020 2020 2020 2020  int']:..        
+00001640: 2020 2020 7061 7261 6d73 2e73 6574 6465      params.setde
+00001650: 6661 756c 7428 226c 6f73 7322 2c20 7466  fault("loss", tf
+00001660: 2e6b 6572 6173 2e6c 6f73 7365 732e 4361  .keras.losses.Ca
+00001670: 7465 676f 7269 6361 6c43 726f 7373 656e  tegoricalCrossen
+00001680: 7472 6f70 7928 6672 6f6d 5f6c 6f67 6974  tropy(from_logit
+00001690: 733d 5472 7565 2c0d 0a20 2020 2020 2020  s=True,..       
 000016a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000016b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000016c0: 2020 2020 2020 2020 2020 2020 206e 616d               nam
-000016d0: 653d 2743 6174 2e43 4527 2929 0d0a 2020  e='Cat.CE'))..  
-000016e0: 2020 2020 2020 2020 2020 7061 7261 6d73            params
-000016f0: 2e73 6574 6465 6661 756c 7428 226d 6574  .setdefault("met
-00001700: 7269 6373 222c 205b 7466 2e6b 6572 6173  rics", [tf.keras
-00001710: 2e6d 6574 7269 6373 2e43 6174 6567 6f72  .metrics.Categor
-00001720: 6963 616c 4163 6375 7261 6379 286e 616d  icalAccuracy(nam
-00001730: 653d 2243 6174 2e20 4163 6322 295d 290d  e="Cat. Acc")]).
-00001740: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-00001750: 6b6d 2e63 6f6d 7069 6c65 286f 7074 696d  km.compile(optim
-00001760: 697a 6572 3d70 6172 616d 735b 226f 7074  izer=params["opt
-00001770: 696d 697a 6572 225d 2c0d 0a20 2020 2020  imizer"],..     
-00001780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001790: 2020 206c 6f73 733d 7061 7261 6d73 5b22     loss=params["
-000017a0: 6c6f 7373 225d 2c0d 0a20 2020 2020 2020  loss"],..       
-000017b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000017c0: 206d 6574 7269 6373 3d70 6172 616d 735b   metrics=params[
-000017d0: 226d 6574 7269 6373 225d 290d 0a20 2020  "metrics"])..   
-000017e0: 2020 2020 200d 0a20 2020 2020 2020 2069       ..        i
-000017f0: 6620 6e6f 7420 6c6f 7373 3a0d 0a20 2020  f not loss:..   
-00001800: 2020 2020 2020 2020 206c 6f73 735f 6e61           loss_na
-00001810: 6d65 203d 2027 4d53 4527 0d0a 2020 2020  me = 'MSE'..    
-00001820: 2020 2020 5f20 3d20 7061 7261 6d73 2e70      _ = params.p
-00001830: 6f70 2827 6c6f 7373 2729 0d0a 2020 2020  op('loss')..    
-00001840: 2020 2020 6d65 7472 6963 7320 3d20 7061      metrics = pa
-00001850: 7261 6d73 2e70 6f70 2827 6d65 7472 6963  rams.pop('metric
-00001860: 7327 290d 0a20 2020 2020 2020 206d 6574  s')..        met
-00001870: 7269 635f 6e61 6d65 7320 3d20 273a 272e  ric_names = ':'.
-00001880: 6a6f 696e 285b 6d2e 6e61 6d65 2066 6f72  join([m.name for
-00001890: 206d 2069 6e20 6d65 7472 6963 735d 290d   m in metrics]).
-000018a0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
-000018b0: 2020 2070 6172 616d 5f6e 616d 6573 203d     param_names =
-000018c0: 207b 6b3a 2076 2e6e 616d 6520 666f 7220   {k: v.name for 
-000018d0: 6b2c 7620 696e 2070 6172 616d 732e 6974  k,v in params.it
-000018e0: 656d 7328 297d 0d0a 2020 2020 2020 2020  ems()}..        
-000018f0: 7061 7261 6d5f 6e61 6d65 735b 276d 6574  param_names['met
-00001900: 7269 6373 275d 203d 206d 6574 7269 635f  rics'] = metric_
-00001910: 6e61 6d65 730d 0a20 2020 2020 2020 2070  names..        p
-00001920: 6172 616d 5f6e 616d 6573 5b27 6c6f 7373  aram_names['loss
-00001930: 275d 203d 206c 6f73 735f 6e61 6d65 0d0a  '] = loss_name..
-00001940: 2020 2020 2020 2020 7061 7261 6d5f 6e61          param_na
-00001950: 6d65 735b 276c 6561 726e 5f72 6174 6527  mes['learn_rate'
-00001960: 5d20 3d20 6c65 6172 6e5f 7261 7465 0d0a  ] = learn_rate..
-00001970: 2020 2020 2020 2020 7061 7261 6d5f 6e61          param_na
-00001980: 6d65 735b 2774 7261 696e 6564 275d 203d  mes['trained'] =
-00001990: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-000019a0: 7365 6c66 2e6d 6574 612e 7570 6461 7465  self.meta.update
-000019b0: 2874 7261 696e 5f70 6172 616d 733d 7061  (train_params=pa
-000019c0: 7261 6d5f 6e61 6d65 7329 0d0a 2020 2020  ram_names)..    
-000019d0: 2020 2020 2373 656c 662e 7370 6563 735b      #self.specs[
-000019e0: 276d 6f64 656c 5f6e 616d 6527 5d20 3d20  'model_name'] = 
-000019f0: 6d6f 6465 6c5f 6e61 6d65 0d0a 0d0a 2020  model_name....  
-00001a00: 2020 2020 2020 2373 6176 6520 696e 7469        #save inti
-00001a10: 616c 206d 6f64 656c 2077 6569 6768 7473  al model weights
-00001a20: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-00001a30: 2020 2020 7365 6c66 2e6b 6d2e 7361 7665      self.km.save
-00001a40: 5f77 6569 6768 7473 286f 732e 7061 7468  _weights(os.path
-00001a50: 2e6a 6f69 6e28 7365 6c66 2e6d 6f64 656c  .join(self.model
-00001a60: 5f70 6174 682c 200d 0a20 2020 2020 2020  _path, ..       
-00001a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000016c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000016d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000016e0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+000016f0: 3d27 4361 745f 4345 2729 290d 0a20 2020  ='Cat_CE'))..   
+00001700: 2020 2020 2020 2020 2070 6172 616d 732e           params.
+00001710: 7365 7464 6566 6175 6c74 2822 6d65 7472  setdefault("metr
+00001720: 6963 7322 2c20 5b74 662e 6b65 7261 732e  ics", [tf.keras.
+00001730: 6d65 7472 6963 732e 4361 7465 676f 7269  metrics.Categori
+00001740: 6361 6c41 6363 7572 6163 7928 6e61 6d65  calAccuracy(name
+00001750: 3d22 4361 745f 4163 6322 295d 290d 0a0d  ="Cat_Acc")])...
+00001760: 0a20 2020 2020 2020 2073 656c 662e 6b6d  .        self.km
+00001770: 2e63 6f6d 7069 6c65 286f 7074 696d 697a  .compile(optimiz
+00001780: 6572 3d70 6172 616d 735b 226f 7074 696d  er=params["optim
+00001790: 697a 6572 225d 2c0d 0a20 2020 2020 2020  izer"],..       
+000017a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000017b0: 206c 6f73 733d 7061 7261 6d73 5b22 6c6f   loss=params["lo
+000017c0: 7373 225d 2c0d 0a20 2020 2020 2020 2020  ss"],..         
+000017d0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+000017e0: 6574 7269 6373 3d70 6172 616d 735b 226d  etrics=params["m
+000017f0: 6574 7269 6373 225d 290d 0a20 2020 2020  etrics"])..     
+00001800: 2020 200d 0a20 2020 2020 2020 2069 6620     ..        if 
+00001810: 6e6f 7420 6c6f 7373 3a0d 0a20 2020 2020  not loss:..     
+00001820: 2020 2020 2020 206c 6f73 735f 6e61 6d65         loss_name
+00001830: 203d 2027 4d53 4527 0d0a 2020 2020 2020   = 'MSE'..      
+00001840: 2020 5f20 3d20 7061 7261 6d73 2e70 6f70    _ = params.pop
+00001850: 2827 6c6f 7373 2729 0d0a 2020 2020 2020  ('loss')..      
+00001860: 2020 6d65 7472 6963 7320 3d20 7061 7261    metrics = para
+00001870: 6d73 2e70 6f70 2827 6d65 7472 6963 7327  ms.pop('metrics'
+00001880: 290d 0a20 2020 2020 2020 206d 6574 7269  )..        metri
+00001890: 635f 6e61 6d65 7320 3d20 273a 272e 6a6f  c_names = ':'.jo
+000018a0: 696e 285b 6d2e 6e61 6d65 2066 6f72 206d  in([m.name for m
+000018b0: 2069 6e20 6d65 7472 6963 735d 290d 0a20   in metrics]).. 
+000018c0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+000018d0: 2070 6172 616d 5f6e 616d 6573 203d 207b   param_names = {
+000018e0: 6b3a 2076 2e6e 616d 6520 666f 7220 6b2c  k: v.name for k,
+000018f0: 7620 696e 2070 6172 616d 732e 6974 656d  v in params.item
+00001900: 7328 297d 0d0a 2020 2020 2020 2020 7061  s()}..        pa
+00001910: 7261 6d5f 6e61 6d65 735b 276d 6574 7269  ram_names['metri
+00001920: 6373 275d 203d 206d 6574 7269 635f 6e61  cs'] = metric_na
+00001930: 6d65 730d 0a20 2020 2020 2020 2070 6172  mes..        par
+00001940: 616d 5f6e 616d 6573 5b27 6c6f 7373 275d  am_names['loss']
+00001950: 203d 206c 6f73 735f 6e61 6d65 0d0a 2020   = loss_name..  
+00001960: 2020 2020 2020 7061 7261 6d5f 6e61 6d65        param_name
+00001970: 735b 276c 6561 726e 5f72 6174 6527 5d20  s['learn_rate'] 
+00001980: 3d20 6c65 6172 6e5f 7261 7465 0d0a 2020  = learn_rate..  
+00001990: 2020 2020 2020 7061 7261 6d5f 6e61 6d65        param_name
+000019a0: 735b 2774 7261 696e 6564 275d 203d 2046  s['trained'] = F
+000019b0: 616c 7365 0d0a 2020 2020 2020 2020 7365  alse..        se
+000019c0: 6c66 2e6d 6574 612e 7570 6461 7465 2874  lf.meta.update(t
+000019d0: 7261 696e 5f70 6172 616d 733d 7061 7261  rain_params=para
+000019e0: 6d5f 6e61 6d65 7329 0d0a 2020 2020 2020  m_names)..      
+000019f0: 2020 2373 656c 662e 7370 6563 735b 276d    #self.specs['m
+00001a00: 6f64 656c 5f6e 616d 6527 5d20 3d20 6d6f  odel_name'] = mo
+00001a10: 6465 6c5f 6e61 6d65 0d0a 0d0a 2020 2020  del_name....    
+00001a20: 2020 2020 2373 6176 6520 696e 7469 616c      #save intial
+00001a30: 206d 6f64 656c 2077 6569 6768 7473 0d0a   model weights..
+00001a40: 2020 2020 2020 2020 2320 7365 6c66 2e6b          # self.k
+00001a50: 6d2e 7361 7665 286f 732e 7061 7468 2e6a  m.save(os.path.j
+00001a60: 6f69 6e28 7365 6c66 2e6d 6f64 656c 5f70  oin(self.model_p
+00001a70: 6174 682c 200d 0a20 2020 2020 2020 2023  ath, ..        #
 00001a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001a90: 2020 2073 656c 662e 6d6f 6465 6c5f 6e61     self.model_na
-00001aa0: 6d65 202b 2027 5f69 6e69 742e 7765 6967  me + '_init.weig
-00001ab0: 6874 732e 6835 2729 290d 0a0d 0a0d 0a20  hts.h5'))...... 
-00001ac0: 2020 2020 2020 2070 7269 6e74 2827 496e         print('In
-00001ad0: 7075 7420 7368 6170 653a 272c 2073 656c  put shape:', sel
-00001ae0: 662e 696e 7075 745f 7368 6170 6529 0d0a  f.input_shape)..
-00001af0: 2020 2020 2020 2020 7072 696e 7428 2779          print('y
-00001b00: 5f70 7265 643a 272c 2073 656c 662e 795f  _pred:', self.y_
-00001b10: 7072 6564 2e73 6861 7065 290d 0a20 2020  pred.shape)..   
-00001b20: 2020 2020 2070 7269 6e74 2827 496e 6974       print('Init
-00001b30: 6961 6c69 7a61 7469 6f6e 2063 6f6d 706c  ialization compl
-00001b40: 6574 6521 2729 0d0a 0d0a 2020 2020 6465  ete!')....    de
-00001b50: 6620 6275 696c 645f 6772 6170 6828 7365  f build_graph(se
-00001b60: 6c66 293a 0d0a 2020 2020 2020 2020 2222  lf):..        ""
-00001b70: 2242 7569 6c64 2063 6f6d 7075 7461 7469  "Build computati
-00001b80: 6f6e 616c 2067 7261 7068 2075 7369 6e67  onal graph using
-00001b90: 2064 6566 696e 6564 2070 6c61 6365 686f   defined placeho
-00001ba0: 6c64 6572 2073 656c 662e 580d 0a20 2020  lder self.X..   
-00001bb0: 2020 2020 2061 7320 696e 7075 742e 0d0a       as input...
-00001bc0: 0d0a 2020 2020 2020 2020 4361 6e20 6265  ..        Can be
-00001bd0: 206f 7665 7272 6964 656e 2069 6e20 6120   overriden in a 
-00001be0: 7375 622d 636c 6173 7320 666f 7220 6375  sub-class for cu
-00001bf0: 7374 6f6d 697a 6564 2061 7263 6869 7465  stomized archite
-00001c00: 6374 7572 652e 0d0a 0d0a 2020 2020 2020  cture.....      
-00001c10: 2020 5265 7475 726e 730d 0a20 2020 2020    Returns..     
-00001c20: 2020 202d 2d2d 2d2d 2d2d 2d0d 0a20 2020     --------..   
-00001c30: 2020 2020 2079 5f70 7265 6420 3a20 7466       y_pred : tf
-00001c40: 2e54 656e 736f 720d 0a20 2020 2020 2020  .Tensor..       
-00001c50: 2020 2020 204f 7574 7075 7420 6f66 2074       Output of t
-00001c60: 6865 2066 6f72 7761 7264 2070 6173 7320  he forward pass 
-00001c70: 6f66 2074 6865 2063 6f6d 7075 7461 7469  of the computati
-00001c80: 6f6e 616c 2067 7261 7068 2e0d 0a20 2020  onal graph...   
-00001c90: 2020 2020 2020 2020 2050 7265 6469 6374           Predict
-00001ca0: 696f 6e20 6f66 2074 6865 2074 6172 6765  ion of the targe
-00001cb0: 7420 7661 7269 6162 6c65 2e0d 0a20 2020  t variable...   
-00001cc0: 2020 2020 2022 2222 0d0a 0d0a 2020 2020       """....    
-00001cd0: 2020 2020 666c 6174 203d 2046 6c61 7474      flat = Flatt
-00001ce0: 656e 2829 2873 656c 662e 696e 7075 7473  en()(self.inputs
-00001cf0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00001d00: 6663 203d 2046 756c 6c79 436f 6e6e 6563  fc = FullyConnec
-00001d10: 7465 6428 7369 7a65 3d73 656c 662e 6f75  ted(size=self.ou
-00001d20: 745f 6469 6d2c 206e 6f6e 6c69 6e3d 7466  t_dim, nonlin=tf
-00001d30: 2e69 6465 6e74 6974 792c 0d0a 2020 2020  .identity,..    
-00001d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001d50: 2020 2020 7370 6563 733d 7365 6c66 2e73      specs=self.s
-00001d60: 7065 6373 290d 0a20 2020 2020 2020 2079  pecs)..        y
-00001d70: 5f70 7265 6420 3d20 7365 6c66 2e66 6328  _pred = self.fc(
-00001d80: 666c 6174 290d 0a20 2020 2020 2020 2072  flat)..        r
-00001d90: 6574 7572 6e20 795f 7072 6564 0d0a 0d0a  eturn y_pred....
-00001da0: 0d0a 2020 2020 6465 6620 7472 6169 6e28  ..    def train(
-00001db0: 7365 6c66 2c20 6e5f 6570 6f63 6873 3d31  self, n_epochs=1
-00001dc0: 302c 2065 7661 6c5f 7374 6570 3d4e 6f6e  0, eval_step=Non
-00001dd0: 652c 206d 696e 5f64 656c 7461 3d31 652d  e, min_delta=1e-
-00001de0: 362c 0d0a 2020 2020 2020 2020 2020 2020  6,..            
-00001df0: 2020 6561 726c 795f 7374 6f70 7069 6e67    early_stopping
-00001e00: 3d33 2c20 6d6f 6465 3d27 7369 6e67 6c65  =3, mode='single
-00001e10: 5f66 6f6c 6427 2c20 7072 756e 655f 7765  _fold', prune_we
-00001e20: 6967 6874 733d 4661 6c73 652c 0d0a 2020  ights=False,..  
-00001e30: 2020 2020 2020 2020 2020 2020 636f 6c6c              coll
-00001e40: 6563 745f 7061 7474 6572 6e73 203d 2046  ect_patterns = F
-00001e50: 616c 7365 2c20 636c 6173 735f 7765 6967  alse, class_weig
-00001e60: 6874 7320 3d20 4e6f 6e65 2920 3a0d 0a0d  hts = None) :...
-00001e70: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-00001e80: 2020 2020 2020 5472 6169 6e20 6120 6d6f        Train a mo
-00001e90: 6465 6c0d 0a0d 0a20 2020 2020 2020 2050  del....        P
-00001ea0: 6172 616d 6574 6572 730d 0a20 2020 2020  arameters..     
-00001eb0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a     -----------..
-00001ec0: 0d0a 2020 2020 2020 2020 6e5f 6570 6f63  ..        n_epoc
-00001ed0: 6873 203a 2069 6e74 0d0a 2020 2020 2020  hs : int..      
-00001ee0: 2020 2020 2020 4d61 7869 6d75 6d20 6e75        Maximum nu
-00001ef0: 6d62 6572 206f 6620 7472 6169 6e69 6e67  mber of training
-00001f00: 2065 6f70 6368 732e 0d0a 0d0a 2020 2020   eopchs.....    
-00001f10: 2020 2020 6576 616c 5f73 7465 7020 3a20      eval_step : 
-00001f20: 696e 742c 204e 6f6e 650d 0a20 2020 2020  int, None..     
-00001f30: 2020 2020 2020 2069 7465 7261 7469 6f6e         iteration
-00001f40: 7320 7065 7220 6570 6f63 682e 2049 6620  s per epoch. If 
-00001f50: 4e6f 6e65 2065 6163 6820 6570 6f63 6820  None each epoch 
-00001f60: 7061 7373 6573 2074 6865 2074 7261 696e  passes the train
-00001f70: 696e 6720 7365 740d 0a20 2020 2020 2020  ing set..       
-00001f80: 2020 2020 2065 7861 6374 6c79 206f 6e63       exactly onc
-00001f90: 650d 0a0d 0a20 2020 2020 2020 2065 6172  e....        ear
-00001fa0: 6c79 5f73 746f 7070 696e 6720 3a20 696e  ly_stopping : in
-00001fb0: 740d 0a20 2020 2020 2020 2020 2020 2050  t..            P
-00001fc0: 6174 6965 6e63 6520 7061 7261 6d65 7465  atience paramete
-00001fd0: 7220 666f 7220 6561 726c 7920 7374 6f70  r for early stop
-00001fe0: 7069 6e67 2e20 5370 6563 6966 6965 7320  ping. Specifies 
-00001ff0: 7468 6520 6e75 6d62 6572 0d0a 2020 2020  the number..    
-00002000: 2020 2020 2020 2020 6f66 2065 706f 6368          of epoch
-00002010: 7327 7320 6475 7269 6e67 2077 6869 6368  s's during which
-00002020: 2076 616c 6964 6174 696f 6e20 636f 7374   validation cost
-00002030: 2069 7320 616c 6c6f 7765 6420 746f 0d0a   is allowed to..
-00002040: 2020 2020 2020 2020 2020 2020 7269 7365              rise
-00002050: 2062 6566 6f72 6520 7472 6169 6e69 6e67   before training
-00002060: 2073 746f 7073 2e0d 0a0d 0a20 2020 2020   stops.....     
-00002070: 2020 206d 696e 5f64 656c 7461 203a 2066     min_delta : f
-00002080: 6c6f 6174 2c20 6f70 7469 6f6e 616c 0d0a  loat, optional..
-00002090: 2020 2020 2020 2020 2020 2020 436f 6e76              Conv
-000020a0: 6572 6765 6e63 6520 7468 7265 7368 6f6c  ergence threshol
-000020b0: 6420 666f 7220 7661 6c69 6461 7469 6f6e  d for validation
-000020c0: 2063 6f73 7420 6475 7269 6e67 2074 7261   cost during tra
-000020d0: 696e 696e 672e 0d0a 2020 2020 2020 2020  ining...        
-000020e0: 2020 2020 4465 6661 756c 7473 2074 6f20      Defaults to 
-000020f0: 3165 2d36 2e0d 0a0d 0a20 2020 2020 2020  1e-6.....       
-00002100: 206d 6f64 6520 3a20 7374 722c 206f 7074   mode : str, opt
-00002110: 696f 6e61 6c0d 0a20 2020 2020 2020 2020  ional..         
-00002120: 2020 2063 616e 2062 6520 2773 696e 676c     can be 'singl
-00002130: 655f 666f 6c64 272c 2027 6376 272c 2027  e_fold', 'cv', '
-00002140: 6c6f 736f 272e 2044 6566 6175 6c74 7320  loso'. Defaults 
-00002150: 746f 2027 7369 6e67 6c65 5f66 6f6c 6427  to 'single_fold'
-00002160: 0d0a 0d0a 2020 2020 2020 2020 636f 6c6c  ....        coll
-00002170: 6563 745f 7061 7474 6572 6e73 203a 2062  ect_patterns : b
-00002180: 6f6f 6c0d 0a20 2020 2020 2020 2020 2020  ool..           
-00002190: 2057 6865 7468 6572 2074 6f20 636f 6d70   Whether to comp
-000021a0: 7574 6520 616e 6420 7374 6f72 6520 7061  ute and store pa
-000021b0: 7474 6572 6e73 2061 6674 6572 2074 7261  tterns after tra
-000021c0: 696e 696e 6720 6561 6368 2066 6f6c 642e  ining each fold.
-000021d0: 0d0a 0d0a 2020 2020 2020 2020 636c 6173  ....        clas
-000021e0: 735f 7765 6967 6874 7320 3a20 4e6f 6e65  s_weights : None
-000021f0: 2c20 6469 6374 0d0a 2020 2020 2020 2020  , dict..        
-00002200: 2020 2020 5768 6574 6865 7220 746f 2061      Whether to a
-00002210: 7070 6c79 2063 7574 6f6d 2077 6567 6968  pply cutom wegih
-00002220: 7473 2066 726f 2065 6163 6820 636c 6173  ts fro each clas
-00002230: 730d 0a20 2020 2020 2020 2022 2222 0d0a  s..        """..
-00002240: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-00002250: 2020 2020 6966 206e 6f74 2065 7661 6c5f      if not eval_
-00002260: 7374 6570 3a0d 0a20 2020 2020 2020 2020  step:..         
-00002270: 2020 2074 7261 696e 5f73 697a 6520 3d20     train_size = 
-00002280: 7365 6c66 2e64 6174 6173 6574 2e68 5f70  self.dataset.h_p
-00002290: 6172 616d 735b 2774 7261 696e 5f73 697a  arams['train_siz
-000022a0: 6527 5d0d 0a20 2020 2020 2020 2020 2020  e']..           
-000022b0: 2065 7661 6c5f 7374 6570 203d 2074 7261   eval_step = tra
-000022c0: 696e 5f73 697a 6520 2f2f 2073 656c 662e  in_size // self.
-000022d0: 6461 7461 7365 742e 685f 7061 7261 6d73  dataset.h_params
-000022e0: 5b27 7472 6169 6e5f 6261 7463 6827 5d20  ['train_batch'] 
-000022f0: 2b20 310d 0a20 2020 2020 2020 200d 0a20  + 1..        .. 
-00002300: 2020 2020 2020 2074 7261 696e 5f70 6172         train_par
-00002310: 616d 7320 3d20 6469 6374 286e 5f65 706f  ams = dict(n_epo
-00002320: 6368 733d 6e5f 6570 6f63 6873 2c20 0d0a  chs=n_epochs, ..
-00002330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002340: 2020 2020 2020 2020 2020 2020 6576 616c              eval
-00002350: 5f73 7465 703d 6576 616c 5f73 7465 702c  _step=eval_step,
-00002360: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00002370: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00002380: 6172 6c79 5f73 746f 7070 696e 673d 6561  arly_stopping=ea
-00002390: 726c 795f 7374 6f70 7069 6e67 2c20 0d0a  rly_stopping, ..
-000023a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000023b0: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-000023c0: 3d6d 6f64 6529 0d0a 2020 2020 2020 2020  =mode)..        
-000023d0: 7365 6c66 2e6d 6574 612e 7570 6461 7465  self.meta.update
-000023e0: 2874 7261 696e 5f70 6172 616d 733d 7472  (train_params=tr
-000023f0: 6169 6e5f 7061 7261 6d73 290d 0a20 2020  ain_params)..   
-00002400: 2020 2020 2073 746f 705f 6561 726c 7920       stop_early 
-00002410: 3d20 7466 2e6b 6572 6173 2e63 616c 6c62  = tf.keras.callb
-00002420: 6163 6b73 2e45 6172 6c79 5374 6f70 7069  acks.EarlyStoppi
-00002430: 6e67 286d 6f6e 6974 6f72 3d27 7661 6c5f  ng(monitor='val_
-00002440: 6c6f 7373 272c 0d0a 2020 2020 2020 2020  loss',..        
-00002450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002470: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
-00002480: 6e5f 6465 6c74 613d 6d69 6e5f 6465 6c74  n_delta=min_delt
-00002490: 612c 0d0a 2020 2020 2020 2020 2020 2020  a,..            
-000024a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000024b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000024c0: 2020 2020 2020 2020 2020 7061 7469 656e            patien
-000024d0: 6365 3d73 656c 662e 6d65 7461 2e74 7261  ce=self.meta.tra
-000024e0: 696e 5f70 6172 616d 735b 2765 6172 6c79  in_params['early
-000024f0: 5f73 746f 7070 696e 6727 5d2c 0d0a 2020  _stopping'],..  
+00001a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001aa0: 2020 2073 656c 662e 6d6f 6465 6c5f 6e61     self.model_na
+00001ab0: 6d65 202b 2027 2e68 3527 2929 0d0a 2020  me + '.h5'))..  
+00001ac0: 2020 2020 2020 7365 6c66 2e6b 6d2e 7361        self.km.sa
+00001ad0: 7665 5f77 6569 6768 7473 286f 732e 7061  ve_weights(os.pa
+00001ae0: 7468 2e6a 6f69 6e28 7365 6c66 2e6d 6f64  th.join(self.mod
+00001af0: 656c 5f70 6174 682c 200d 0a20 2020 2020  el_path, ..     
+00001b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001b20: 2020 2020 2073 656c 662e 6d6f 6465 6c5f       self.model_
+00001b30: 6e61 6d65 202b 2027 5f69 6e69 742e 7765  name + '_init.we
+00001b40: 6967 6874 7331 2e68 3527 2929 0d0a 0d0a  ights1.h5'))....
+00001b50: 0d0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
+00001b60: 2749 6e70 7574 2073 6861 7065 3a27 2c20  'Input shape:', 
+00001b70: 7365 6c66 2e69 6e70 7574 5f73 6861 7065  self.input_shape
+00001b80: 290d 0a20 2020 2020 2020 2070 7269 6e74  )..        print
+00001b90: 2827 795f 7072 6564 3a27 2c20 7365 6c66  ('y_pred:', self
+00001ba0: 2e79 5f70 7265 642e 7368 6170 6529 0d0a  .y_pred.shape)..
+00001bb0: 2020 2020 2020 2020 7072 696e 7428 2749          print('I
+00001bc0: 6e69 7469 616c 697a 6174 696f 6e20 636f  nitialization co
+00001bd0: 6d70 6c65 7465 2127 290d 0a0d 0a20 2020  mplete!')....   
+00001be0: 2064 6566 2062 7569 6c64 5f67 7261 7068   def build_graph
+00001bf0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+00001c00: 2022 2222 4275 696c 6420 636f 6d70 7574   """Build comput
+00001c10: 6174 696f 6e61 6c20 6772 6170 6820 7573  ational graph us
+00001c20: 696e 6720 6465 6669 6e65 6420 706c 6163  ing defined plac
+00001c30: 6568 6f6c 6465 7220 7365 6c66 2e58 0d0a  eholder self.X..
+00001c40: 2020 2020 2020 2020 6173 2069 6e70 7574          as input
+00001c50: 2e0d 0a0d 0a20 2020 2020 2020 2043 616e  .....        Can
+00001c60: 2062 6520 6f76 6572 7269 6465 6e20 696e   be overriden in
+00001c70: 2061 2073 7562 2d63 6c61 7373 2066 6f72   a sub-class for
+00001c80: 2063 7573 746f 6d69 7a65 6420 6172 6368   customized arch
+00001c90: 6974 6563 7475 7265 2e0d 0a0d 0a20 2020  itecture.....   
+00001ca0: 2020 2020 2052 6574 7572 6e73 0d0a 2020       Returns..  
+00001cb0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0d0a        --------..
+00001cc0: 2020 2020 2020 2020 795f 7072 6564 203a          y_pred :
+00001cd0: 2074 662e 5465 6e73 6f72 0d0a 2020 2020   tf.Tensor..    
+00001ce0: 2020 2020 2020 2020 4f75 7470 7574 206f          Output o
+00001cf0: 6620 7468 6520 666f 7277 6172 6420 7061  f the forward pa
+00001d00: 7373 206f 6620 7468 6520 636f 6d70 7574  ss of the comput
+00001d10: 6174 696f 6e61 6c20 6772 6170 682e 0d0a  ational graph...
+00001d20: 2020 2020 2020 2020 2020 2020 5072 6564              Pred
+00001d30: 6963 7469 6f6e 206f 6620 7468 6520 7461  iction of the ta
+00001d40: 7267 6574 2076 6172 6961 626c 652e 0d0a  rget variable...
+00001d50: 2020 2020 2020 2020 2222 220d 0a0d 0a20          """.... 
+00001d60: 2020 2020 2020 2066 6c61 7420 3d20 466c         flat = Fl
+00001d70: 6174 7465 6e28 2928 7365 6c66 2e69 6e70  atten()(self.inp
+00001d80: 7574 7329 0d0a 2020 2020 2020 2020 7365  uts)..        se
+00001d90: 6c66 2e66 6320 3d20 4675 6c6c 7943 6f6e  lf.fc = FullyCon
+00001da0: 6e65 6374 6564 2873 697a 653d 7365 6c66  nected(size=self
+00001db0: 2e6f 7574 5f64 696d 2c20 6e6f 6e6c 696e  .out_dim, nonlin
+00001dc0: 3d74 662e 6964 656e 7469 7479 2c0d 0a20  =tf.identity,.. 
+00001dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001de0: 2020 2020 2020 2073 7065 6373 3d73 656c         specs=sel
+00001df0: 662e 7370 6563 7329 0d0a 2020 2020 2020  f.specs)..      
+00001e00: 2020 795f 7072 6564 203d 2073 656c 662e    y_pred = self.
+00001e10: 6663 2866 6c61 7429 0d0a 2020 2020 2020  fc(flat)..      
+00001e20: 2020 7265 7475 726e 2079 5f70 7265 640d    return y_pred.
+00001e30: 0a0d 0a0d 0a20 2020 2064 6566 2074 7261  .....    def tra
+00001e40: 696e 2873 656c 662c 206e 5f65 706f 6368  in(self, n_epoch
+00001e50: 733d 3130 2c20 6576 616c 5f73 7465 703d  s=10, eval_step=
+00001e60: 4e6f 6e65 2c20 6d69 6e5f 6465 6c74 613d  None, min_delta=
+00001e70: 3165 2d36 2c0d 0a20 2020 2020 2020 2020  1e-6,..         
+00001e80: 2020 2020 2065 6172 6c79 5f73 746f 7070       early_stopp
+00001e90: 696e 673d 332c 206d 6f64 653d 2773 696e  ing=3, mode='sin
+00001ea0: 676c 655f 666f 6c64 272c 2070 7275 6e65  gle_fold', prune
+00001eb0: 5f77 6569 6768 7473 3d46 616c 7365 2c0d  _weights=False,.
+00001ec0: 0a20 2020 2020 2020 2020 2020 2020 2063  .              c
+00001ed0: 6f6c 6c65 6374 5f70 6174 7465 726e 7320  ollect_patterns 
+00001ee0: 3d20 4661 6c73 652c 2063 6c61 7373 5f77  = False, class_w
+00001ef0: 6569 6768 7473 203d 204e 6f6e 6529 203a  eights = None) :
+00001f00: 0d0a 0d0a 2020 2020 2020 2020 2222 220d  ....        """.
+00001f10: 0a20 2020 2020 2020 2054 7261 696e 2061  .        Train a
+00001f20: 206d 6f64 656c 0d0a 0d0a 2020 2020 2020   model....      
+00001f30: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
+00001f40: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00001f50: 2d0d 0a0d 0a20 2020 2020 2020 206e 5f65  -....        n_e
+00001f60: 706f 6368 7320 3a20 696e 740d 0a20 2020  pochs : int..   
+00001f70: 2020 2020 2020 2020 204d 6178 696d 756d           Maximum
+00001f80: 206e 756d 6265 7220 6f66 2074 7261 696e   number of train
+00001f90: 696e 6720 656f 7063 6873 2e0d 0a0d 0a20  ing eopchs..... 
+00001fa0: 2020 2020 2020 2065 7661 6c5f 7374 6570         eval_step
+00001fb0: 203a 2069 6e74 2c20 4e6f 6e65 0d0a 2020   : int, None..  
+00001fc0: 2020 2020 2020 2020 2020 6974 6572 6174            iterat
+00001fd0: 696f 6e73 2070 6572 2065 706f 6368 2e20  ions per epoch. 
+00001fe0: 4966 204e 6f6e 6520 6561 6368 2065 706f  If None each epo
+00001ff0: 6368 2070 6173 7365 7320 7468 6520 7472  ch passes the tr
+00002000: 6169 6e69 6e67 2073 6574 0d0a 2020 2020  aining set..    
+00002010: 2020 2020 2020 2020 6578 6163 746c 7920          exactly 
+00002020: 6f6e 6365 0d0a 0d0a 2020 2020 2020 2020  once....        
+00002030: 6561 726c 795f 7374 6f70 7069 6e67 203a  early_stopping :
+00002040: 2069 6e74 0d0a 2020 2020 2020 2020 2020   int..          
+00002050: 2020 5061 7469 656e 6365 2070 6172 616d    Patience param
+00002060: 6574 6572 2066 6f72 2065 6172 6c79 2073  eter for early s
+00002070: 746f 7070 696e 672e 2053 7065 6369 6669  topping. Specifi
+00002080: 6573 2074 6865 206e 756d 6265 720d 0a20  es the number.. 
+00002090: 2020 2020 2020 2020 2020 206f 6620 6570             of ep
+000020a0: 6f63 6873 2773 2064 7572 696e 6720 7768  ochs's during wh
+000020b0: 6963 6820 7661 6c69 6461 7469 6f6e 2063  ich validation c
+000020c0: 6f73 7420 6973 2061 6c6c 6f77 6564 2074  ost is allowed t
+000020d0: 6f0d 0a20 2020 2020 2020 2020 2020 2072  o..            r
+000020e0: 6973 6520 6265 666f 7265 2074 7261 696e  ise before train
+000020f0: 696e 6720 7374 6f70 732e 0d0a 0d0a 2020  ing stops.....  
+00002100: 2020 2020 2020 6d69 6e5f 6465 6c74 6120        min_delta 
+00002110: 3a20 666c 6f61 742c 206f 7074 696f 6e61  : float, optiona
+00002120: 6c0d 0a20 2020 2020 2020 2020 2020 2043  l..            C
+00002130: 6f6e 7665 7267 656e 6365 2074 6872 6573  onvergence thres
+00002140: 686f 6c64 2066 6f72 2076 616c 6964 6174  hold for validat
+00002150: 696f 6e20 636f 7374 2064 7572 696e 6720  ion cost during 
+00002160: 7472 6169 6e69 6e67 2e0d 0a20 2020 2020  training...     
+00002170: 2020 2020 2020 2044 6566 6175 6c74 7320         Defaults 
+00002180: 746f 2031 652d 362e 0d0a 0d0a 2020 2020  to 1e-6.....    
+00002190: 2020 2020 6d6f 6465 203a 2073 7472 2c20      mode : str, 
+000021a0: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
+000021b0: 2020 2020 2020 6361 6e20 6265 2027 7369        can be 'si
+000021c0: 6e67 6c65 5f66 6f6c 6427 2c20 2763 7627  ngle_fold', 'cv'
+000021d0: 2c20 276c 6f73 6f27 2e20 4465 6661 756c  , 'loso'. Defaul
+000021e0: 7473 2074 6f20 2773 696e 676c 655f 666f  ts to 'single_fo
+000021f0: 6c64 270d 0a0d 0a20 2020 2020 2020 2063  ld'....        c
+00002200: 6f6c 6c65 6374 5f70 6174 7465 726e 7320  ollect_patterns 
+00002210: 3a20 626f 6f6c 0d0a 2020 2020 2020 2020  : bool..        
+00002220: 2020 2020 5768 6574 6865 7220 746f 2063      Whether to c
+00002230: 6f6d 7075 7465 2061 6e64 2073 746f 7265  ompute and store
+00002240: 2070 6174 7465 726e 7320 6166 7465 7220   patterns after 
+00002250: 7472 6169 6e69 6e67 2065 6163 6820 666f  training each fo
+00002260: 6c64 2e0d 0a0d 0a20 2020 2020 2020 2063  ld.....        c
+00002270: 6c61 7373 5f77 6569 6768 7473 203a 204e  lass_weights : N
+00002280: 6f6e 652c 2064 6963 740d 0a20 2020 2020  one, dict..     
+00002290: 2020 2020 2020 2057 6865 7468 6572 2074         Whether t
+000022a0: 6f20 6170 706c 7920 6375 746f 6d20 7765  o apply cutom we
+000022b0: 6769 6874 7320 6672 6f20 6561 6368 2063  gihts fro each c
+000022c0: 6c61 7373 0d0a 2020 2020 2020 2020 2222  lass..        ""
+000022d0: 220d 0a0d 0a20 2020 2020 2020 200d 0a20  "....        .. 
+000022e0: 2020 2020 2020 2069 6620 6e6f 7420 6576         if not ev
+000022f0: 616c 5f73 7465 703a 0d0a 2020 2020 2020  al_step:..      
+00002300: 2020 2020 2020 7472 6169 6e5f 7369 7a65        train_size
+00002310: 203d 2073 656c 662e 6461 7461 7365 742e   = self.dataset.
+00002320: 685f 7061 7261 6d73 5b27 7472 6169 6e5f  h_params['train_
+00002330: 7369 7a65 275d 0d0a 2020 2020 2020 2020  size']..        
+00002340: 2020 2020 6576 616c 5f73 7465 7020 3d20      eval_step = 
+00002350: 7472 6169 6e5f 7369 7a65 202f 2f20 7365  train_size // se
+00002360: 6c66 2e64 6174 6173 6574 2e68 5f70 6172  lf.dataset.h_par
+00002370: 616d 735b 2774 7261 696e 5f62 6174 6368  ams['train_batch
+00002380: 275d 202b 2031 0d0a 2020 2020 2020 2020  '] + 1..        
+00002390: 0d0a 2020 2020 2020 2020 7472 6169 6e5f  ..        train_
+000023a0: 7061 7261 6d73 203d 2064 6963 7428 6e5f  params = dict(n_
+000023b0: 6570 6f63 6873 3d6e 5f65 706f 6368 732c  epochs=n_epochs,
+000023c0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+000023d0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000023e0: 7661 6c5f 7374 6570 3d65 7661 6c5f 7374  val_step=eval_st
+000023f0: 6570 2c20 0d0a 2020 2020 2020 2020 2020  ep, ..          
+00002400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002410: 2020 6561 726c 795f 7374 6f70 7069 6e67    early_stopping
+00002420: 3d65 6172 6c79 5f73 746f 7070 696e 672c  =early_stopping,
+00002430: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+00002440: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00002450: 6f64 653d 6d6f 6465 290d 0a20 2020 2020  ode=mode)..     
+00002460: 2020 2073 656c 662e 6d65 7461 2e75 7064     self.meta.upd
+00002470: 6174 6528 7472 6169 6e5f 7061 7261 6d73  ate(train_params
+00002480: 3d74 7261 696e 5f70 6172 616d 7329 0d0a  =train_params)..
+00002490: 2020 2020 2020 2020 7374 6f70 5f65 6172          stop_ear
+000024a0: 6c79 203d 2074 662e 6b65 7261 732e 6361  ly = tf.keras.ca
+000024b0: 6c6c 6261 636b 732e 4561 726c 7953 746f  llbacks.EarlySto
+000024c0: 7070 696e 6728 6d6f 6e69 746f 723d 2776  pping(monitor='v
+000024d0: 616c 5f6c 6f73 7327 2c0d 0a20 2020 2020  al_loss',..     
+000024e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000024f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00002500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002530: 2020 2020 7265 7374 6f72 655f 6265 7374      restore_best
-00002540: 5f77 6569 6768 7473 3d54 7275 6529 0d0a  _weights=True)..
-00002550: 2020 2020 2020 2020 726d 7373 203d 2064          rmss = d
-00002560: 6566 6175 6c74 6469 6374 286c 6973 7429  efaultdict(list)
-00002570: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-00002580: 765f 6c6f 7373 6573 203d 205b 5d0d 0a20  v_losses = [].. 
-00002590: 2020 2020 2020 2073 656c 662e 6376 5f6d         self.cv_m
-000025a0: 6574 7269 6373 203d 205b 5d0d 0a20 2020  etrics = []..   
-000025b0: 2020 2020 2073 656c 662e 6376 5f74 6573       self.cv_tes
-000025c0: 745f 6c6f 7373 6573 203d 205b 5d0d 0a20  t_losses = [].. 
-000025d0: 2020 2020 2020 2073 656c 662e 6376 5f74         self.cv_t
-000025e0: 6573 745f 6d65 7472 6963 7320 3d20 5b5d  est_metrics = []
-000025f0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-00002600: 2020 2020 6966 2063 6c61 7373 5f77 6569      if class_wei
-00002610: 6768 7473 3a0d 0a20 2020 2020 2020 2020  ghts:..         
-00002620: 2020 206d 756c 7469 706c 6965 7220 3d20     multiplier = 
-00002630: 312e 202f 206d 696e 2863 6c61 7373 5f77  1. / min(class_w
-00002640: 6569 6768 7473 2e76 616c 7565 7328 2929  eights.values())
-00002650: 0d0a 2020 2020 2020 2020 2020 2020 636c  ..            cl
-00002660: 6173 735f 7765 6967 6874 7320 3d20 7b6b  ass_weights = {k
-00002670: 3a76 2a6d 756c 7469 706c 6965 7220 666f  :v*multiplier fo
-00002680: 7220 6b2c 7620 696e 2063 6c61 7373 5f77  r k,v in class_w
-00002690: 6569 6768 7473 2e69 7465 6d73 2829 7d0d  eights.items()}.
-000026a0: 0a0d 0a20 2020 2020 2020 2065 6c73 653a  ...        else:
-000026b0: 0d0a 2020 2020 2020 2020 2020 2020 636c  ..            cl
-000026c0: 6173 735f 7765 6967 6874 7320 3d20 4e6f  ass_weights = No
-000026d0: 6e65 0d0a 2020 2020 2020 2020 7072 696e  ne..        prin
-000026e0: 7428 2243 6c61 7373 2077 6569 6768 7473  t("Class weights
-000026f0: 3a20 222c 2063 6c61 7373 5f77 6569 6768  : ", class_weigh
-00002700: 7473 290d 0a20 2020 2020 2020 2069 6620  ts)..        if 
-00002710: 6d6f 6465 203d 3d20 2773 696e 676c 655f  mode == 'single_
-00002720: 666f 6c64 273a 0d0a 2020 2020 2020 2020  fold':..        
-00002730: 2020 2020 6e5f 666f 6c64 7320 3d20 310d      n_folds = 1.
-00002740: 0a20 2020 2020 2020 2020 2020 2074 7261  .            tra
-00002750: 696e 2c20 7661 6c20 3d20 7365 6c66 2e64  in, val = self.d
-00002760: 6174 6173 6574 2e5f 6275 696c 645f 6461  ataset._build_da
-00002770: 7461 7365 7428 7365 6c66 2e64 6174 6173  taset(self.datas
-00002780: 6574 2e68 5f70 6172 616d 735b 2774 7261  et.h_params['tra
-00002790: 696e 5f70 6174 6873 275d 2c0d 0a20 2020  in_paths'],..   
-000027a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000027b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000027c0: 2020 2020 2020 2020 2020 2020 7472 6169              trai
-000027d0: 6e5f 6261 7463 683d 7365 6c66 2e64 6174  n_batch=self.dat
-000027e0: 6173 6574 2e74 7261 696e 696e 675f 6261  aset.training_ba
-000027f0: 7463 682c 0d0a 2020 2020 2020 2020 2020  tch,..          
-00002800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002820: 2020 2020 2074 6573 745f 6261 7463 683d       test_batch=
-00002830: 7365 6c66 2e64 6174 6173 6574 2e76 616c  self.dataset.val
-00002840: 6964 6174 696f 6e5f 6261 7463 682c 0d0a  idation_batch,..
-00002850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002870: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00002880: 706c 6974 3d54 7275 652c 2076 616c 5f66  plit=True, val_f
-00002890: 6f6c 645f 696e 643d 3029 0d0a 0d0a 2020  old_ind=0)....  
-000028a0: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
-000028b0: 5f68 6973 7420 3d20 7365 6c66 2e6b 6d2e  _hist = self.km.
-000028c0: 6669 7428 7472 6169 6e2c 0d0a 2020 2020  fit(train,..    
-000028d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000028e0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-000028f0: 616c 6964 6174 696f 6e5f 6461 7461 3d76  alidation_data=v
-00002900: 616c 2c0d 0a20 2020 2020 2020 2020 2020  al,..           
-00002910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002920: 2020 2020 2020 2020 6570 6f63 6873 3d73          epochs=s
-00002930: 656c 662e 6d65 7461 2e74 7261 696e 5f70  elf.meta.train_p
-00002940: 6172 616d 735b 276e 5f65 706f 6368 7327  arams['n_epochs'
-00002950: 5d2c 200d 0a20 2020 2020 2020 2020 2020  ], ..           
+00002510: 206d 696e 5f64 656c 7461 3d6d 696e 5f64   min_delta=min_d
+00002520: 656c 7461 2c0d 0a20 2020 2020 2020 2020  elta,..         
+00002530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002550: 2020 2020 2020 2020 2020 2020 2070 6174               pat
+00002560: 6965 6e63 653d 7365 6c66 2e6d 6574 612e  ience=self.meta.
+00002570: 7472 6169 6e5f 7061 7261 6d73 5b27 6561  train_params['ea
+00002580: 726c 795f 7374 6f70 7069 6e67 275d 2c0d  rly_stopping'],.
+00002590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000025a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000025b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000025c0: 2020 2020 2020 2072 6573 746f 7265 5f62         restore_b
+000025d0: 6573 745f 7765 6967 6874 733d 5472 7565  est_weights=True
+000025e0: 290d 0a20 2020 2020 2020 2072 6d73 7320  )..        rmss 
+000025f0: 3d20 6465 6661 756c 7464 6963 7428 6c69  = defaultdict(li
+00002600: 7374 290d 0a20 2020 2020 2020 2073 656c  st)..        sel
+00002610: 662e 6376 5f6c 6f73 7365 7320 3d20 5b5d  f.cv_losses = []
+00002620: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
+00002630: 765f 6d65 7472 6963 7320 3d20 5b5d 0d0a  v_metrics = []..
+00002640: 2020 2020 2020 2020 7365 6c66 2e63 765f          self.cv_
+00002650: 7465 7374 5f6c 6f73 7365 7320 3d20 5b5d  test_losses = []
+00002660: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
+00002670: 765f 7465 7374 5f6d 6574 7269 6373 203d  v_test_metrics =
+00002680: 205b 5d0d 0a20 2020 2020 2020 200d 0a20   []..        .. 
+00002690: 2020 2020 2020 2069 6620 636c 6173 735f         if class_
+000026a0: 7765 6967 6874 733a 0d0a 2020 2020 2020  weights:..      
+000026b0: 2020 2020 2020 6d75 6c74 6970 6c69 6572        multiplier
+000026c0: 203d 2031 2e20 2f20 6d69 6e28 636c 6173   = 1. / min(clas
+000026d0: 735f 7765 6967 6874 732e 7661 6c75 6573  s_weights.values
+000026e0: 2829 290d 0a20 2020 2020 2020 2020 2020  ())..           
+000026f0: 2063 6c61 7373 5f77 6569 6768 7473 203d   class_weights =
+00002700: 207b 6b3a 762a 6d75 6c74 6970 6c69 6572   {k:v*multiplier
+00002710: 2066 6f72 206b 2c76 2069 6e20 636c 6173   for k,v in clas
+00002720: 735f 7765 6967 6874 732e 6974 656d 7328  s_weights.items(
+00002730: 297d 0d0a 0d0a 2020 2020 2020 2020 656c  )}....        el
+00002740: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00002750: 2063 6c61 7373 5f77 6569 6768 7473 203d   class_weights =
+00002760: 204e 6f6e 650d 0a20 2020 2020 2020 2070   None..        p
+00002770: 7269 6e74 2822 436c 6173 7320 7765 6967  rint("Class weig
+00002780: 6874 733a 2022 2c20 636c 6173 735f 7765  hts: ", class_we
+00002790: 6967 6874 7329 0d0a 2020 2020 2020 2020  ights)..        
+000027a0: 6966 206d 6f64 6520 3d3d 2027 7369 6e67  if mode == 'sing
+000027b0: 6c65 5f66 6f6c 6427 3a0d 0a20 2020 2020  le_fold':..     
+000027c0: 2020 2020 2020 206e 5f66 6f6c 6473 203d         n_folds =
+000027d0: 2031 0d0a 2020 2020 2020 2020 2020 2020   1..            
+000027e0: 7472 6169 6e2c 2076 616c 203d 2073 656c  train, val = sel
+000027f0: 662e 6461 7461 7365 742e 5f62 7569 6c64  f.dataset._build
+00002800: 5f64 6174 6173 6574 2873 656c 662e 6461  _dataset(self.da
+00002810: 7461 7365 742e 685f 7061 7261 6d73 5b27  taset.h_params['
+00002820: 7472 6169 6e5f 7061 7468 7327 5d2c 0d0a  train_paths'],..
+00002830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002850: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00002860: 7261 696e 5f62 6174 6368 3d73 656c 662e  rain_batch=self.
+00002870: 6461 7461 7365 742e 7472 6169 6e69 6e67  dataset.training
+00002880: 5f62 6174 6368 2c0d 0a20 2020 2020 2020  _batch,..       
+00002890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000028a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000028b0: 2020 2020 2020 2020 7465 7374 5f62 6174          test_bat
+000028c0: 6368 3d73 656c 662e 6461 7461 7365 742e  ch=self.dataset.
+000028d0: 7661 6c69 6461 7469 6f6e 5f62 6174 6368  validation_batch
+000028e0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000028f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002910: 2020 7370 6c69 743d 5472 7565 2c20 7661    split=True, va
+00002920: 6c5f 666f 6c64 5f69 6e64 3d30 290d 0a0d  l_fold_ind=0)...
+00002930: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00002940: 662e 745f 6869 7374 203d 2073 656c 662e  f.t_hist = self.
+00002950: 6b6d 2e66 6974 2874 7261 696e 2c0d 0a20  km.fit(train,.. 
 00002960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002970: 2020 2020 2020 2020 7374 6570 735f 7065          steps_pe
-00002980: 725f 6570 6f63 683d 7365 6c66 2e6d 6574  r_epoch=self.met
-00002990: 612e 7472 6169 6e5f 7061 7261 6d73 5b27  a.train_params['
-000029a0: 6576 616c 5f73 7465 7027 5d2c 0d0a 2020  eval_step'],..  
-000029b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000029c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000029d0: 2073 6875 6666 6c65 3d54 7275 652c 0d0a   shuffle=True,..
-000029e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002980: 2020 7661 6c69 6461 7469 6f6e 5f64 6174    validation_dat
+00002990: 613d 7661 6c2c 0d0a 2020 2020 2020 2020  a=val,..        
+000029a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000029b0: 2020 2020 2020 2020 2020 2065 706f 6368             epoch
+000029c0: 733d 7365 6c66 2e6d 6574 612e 7472 6169  s=self.meta.trai
+000029d0: 6e5f 7061 7261 6d73 5b27 6e5f 6570 6f63  n_params['n_epoc
+000029e0: 6873 275d 2c20 0d0a 2020 2020 2020 2020  hs'], ..        
 000029f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002a00: 2020 2076 616c 6964 6174 696f 6e5f 7374     validation_st
-00002a10: 6570 733d 7365 6c66 2e64 6174 6173 6574  eps=self.dataset
-00002a20: 2e76 616c 6964 6174 696f 6e5f 7374 6570  .validation_step
-00002a30: 732c 0d0a 0d0a 2020 2020 2020 2020 2020  s,....          
-00002a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002a50: 2020 2020 2020 2020 2063 616c 6c62 6163           callbac
-00002a60: 6b73 3d5b 7374 6f70 5f65 6172 6c79 5d2c  ks=[stop_early],
-00002a70: 2076 6572 626f 7365 3d32 2c0d 0a20 2020   verbose=2,..   
+00002a00: 2020 2020 2020 2020 2020 2073 7465 7073             steps
+00002a10: 5f70 6572 5f65 706f 6368 3d73 656c 662e  _per_epoch=self.
+00002a20: 6d65 7461 2e74 7261 696e 5f70 6172 616d  meta.train_param
+00002a30: 735b 2765 7661 6c5f 7374 6570 275d 2c0d  s['eval_step'],.
+00002a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002a60: 2020 2020 7368 7566 666c 653d 5472 7565      shuffle=True
+00002a70: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 00002a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002aa0: 636c 6173 735f 7765 6967 6874 3d63 6c61  class_weight=cla
-00002ab0: 7373 5f77 6569 6768 7473 290d 0a20 2020  ss_weights)..   
-00002ac0: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
-00002ad0: 7461 2e74 7261 696e 5f70 6172 616d 732e  ta.train_params.
-00002ae0: 7570 6461 7465 287b 2274 7261 696e 6564  update({"trained
-00002af0: 223a 5472 7565 7d29 0d0a 0d0a 2020 2020  ":True})....    
-00002b00: 2020 2020 2020 2020 2363 6f6d 7075 7465          #compute
-00002b10: 2076 616c 6964 6174 696f 6e20 6c6f 7373   validation loss
-00002b20: 2061 6e64 206d 6574 7269 630d 0a20 2020   and metric..   
-00002b30: 2020 2020 2020 2020 2076 5f6c 6f73 732c           v_loss,
-00002b40: 2076 5f6d 6574 7269 6320 3d20 7365 6c66   v_metric = self
-00002b50: 2e65 7661 6c75 6174 6528 7365 6c66 2e64  .evaluate(self.d
-00002b60: 6174 6173 6574 2e76 616c 290d 0a0d 0a20  ataset.val).... 
-00002b70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00002b80: 6376 5f6c 6f73 7365 732e 6170 7065 6e64  cv_losses.append
-00002b90: 2876 5f6c 6f73 7329 0d0a 2020 2020 2020  (v_loss)..      
-00002ba0: 2020 2020 2020 7365 6c66 2e63 765f 6d65        self.cv_me
-00002bb0: 7472 6963 732e 6170 7065 6e64 2876 5f6d  trics.append(v_m
-00002bc0: 6574 7269 6329 0d0a 0d0a 2020 2020 2020  etric)....      
-00002bd0: 2020 2020 2020 6966 206c 656e 2873 656c        if len(sel
-00002be0: 662e 6461 7461 7365 742e 685f 7061 7261  f.dataset.h_para
-00002bf0: 6d73 5b27 7465 7374 5f70 6174 6873 275d  ms['test_paths']
-00002c00: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00002c10: 2020 2020 2020 2020 745f 6c6f 7373 2c20          t_loss, 
-00002c20: 745f 6d65 7472 6963 203d 2073 656c 662e  t_metric = self.
-00002c30: 6576 616c 7561 7465 2873 656c 662e 6461  evaluate(self.da
-00002c40: 7461 7365 742e 685f 7061 7261 6d73 5b27  taset.h_params['
-00002c50: 7465 7374 5f70 6174 6873 275d 290d 0a20  test_paths']).. 
-00002c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002c70: 2020 2023 2070 7269 6e74 2822 2222 5465     # print("""Te
-00002c80: 7374 2070 6572 666f 726d 616e 6365 3a0d  st performance:.
-00002c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002ca0: 2020 2020 2023 2020 2020 2020 204c 6f73       #       Los
-00002cb0: 733a 207b 3a2e 3466 7d20 0d0a 2020 2020  s: {:.4f} ..    
-00002cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002cd0: 2320 2020 2020 2020 4d65 7472 6963 3a20  #       Metric: 
-00002ce0: 7b3a 2e34 667d 2222 222e 666f 726d 6174  {:.4f}""".format
-00002cf0: 2874 5f6c 6f73 732c 2074 5f6d 6574 7269  (t_loss, t_metri
-00002d00: 6329 290d 0a20 2020 2020 2020 2020 2020  c))..           
-00002d10: 2020 2020 2020 2020 2073 656c 662e 6376           self.cv
-00002d20: 5f74 6573 745f 6c6f 7373 6573 2e61 7070  _test_losses.app
-00002d30: 656e 6428 745f 6c6f 7373 290d 0a20 2020  end(t_loss)..   
-00002d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002d50: 2073 656c 662e 6376 5f74 6573 745f 6d65   self.cv_test_me
-00002d60: 7472 6963 732e 6170 7065 6e64 2874 5f6d  trics.append(t_m
-00002d70: 6574 7269 6329 0d0a 0d0a 2020 2020 2020  etric)....      
-00002d80: 2020 2020 2020 2363 6f6d 7075 7465 2073        #compute s
-00002d90: 7065 6369 6669 6320 6d65 7472 6963 7320  pecific metrics 
-00002da0: 666f 7220 636c 6173 7369 6669 6361 7469  for classificati
-00002db0: 6f6e 2061 6e64 2072 6567 7265 7373 7369  on and regresssi
-00002dc0: 6f6e 0d0a 2020 2020 2020 2020 2020 2020  on..            
-00002dd0: 795f 7472 7565 2c20 795f 7072 6564 203d  y_true, y_pred =
-00002de0: 2073 656c 662e 7072 6564 6963 7428 7365   self.predict(se
-00002df0: 6c66 2e64 6174 6173 6574 2e76 616c 290d  lf.dataset.val).
-00002e00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00002e10: 7365 6c66 2e64 6174 6173 6574 2e68 5f70  self.dataset.h_p
-00002e20: 6172 616d 735b 2774 6172 6765 745f 7479  arams['target_ty
-00002e30: 7065 275d 203d 3d20 2766 6c6f 6174 273a  pe'] == 'float':
-00002e40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00002e50: 2020 726d 7320 3d20 7265 6772 6573 7369    rms = regressi
-00002e60: 6f6e 5f6d 6574 7269 6373 2879 5f74 7275  on_metrics(y_tru
-00002e70: 652c 2079 5f70 7265 6429 0d0a 2020 2020  e, y_pred)..    
-00002e80: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00002e90: 7428 2256 616c 6964 6174 696f 6e20 7365  t("Validation se
-00002ea0: 743a 2043 6f72 7220 3d22 2c20 726d 735b  t: Corr =", rms[
-00002eb0: 2763 6327 5d2c 2022 2052 3220 3d22 2c20  'cc'], " R2 =", 
-00002ec0: 726d 735b 2772 3227 5d29 0d0a 2020 2020  rms['r2'])..    
-00002ed0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00002ee0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00002ef0: 6d73 203d 204e 6f6e 650d 0a20 2020 2020  ms = None..     
-00002f00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00002f10: 636d 202b 3d20 7365 6c66 2e5f 636f 6e66  cm += self._conf
-00002f20: 7573 696f 6e5f 6d61 7472 6978 2879 5f74  usion_matrix(y_t
-00002f30: 7275 652c 2079 5f70 7265 6429 0d0a 0d0a  rue, y_pred)....
-00002f40: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-00002f50: 6f6c 6c65 6374 5f70 6174 7465 726e 7320  ollect_patterns 
-00002f60: 616e 6420 7365 6c66 2e73 636f 7065 203d  and self.scope =
-00002f70: 3d20 276c 6663 6e6e 273a 0d0a 2020 2020  = 'lfcnn':..    
-00002f80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00002f90: 2e63 6f6c 6c65 6374 5f70 6174 7465 726e  .collect_pattern
-00002fa0: 7328 666f 6c64 3d30 2c20 6e5f 666f 6c64  s(fold=0, n_fold
-00002fb0: 733d 6e5f 666f 6c64 732c 206e 5f63 6f6d  s=n_folds, n_com
-00002fc0: 703d 696e 7428 636f 6c6c 6563 745f 7061  p=int(collect_pa
-00002fd0: 7474 6572 6e73 2929 0d0a 0d0a 2020 2020  tterns))....    
-00002fe0: 2020 2020 656c 6966 206d 6f64 6520 3d3d      elif mode ==
-00002ff0: 2027 6376 273a 0d0a 2020 2020 2020 2020   'cv':..        
-00003000: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
-00003010: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
-00003020: 6e5f 666f 6c64 7320 3d20 6c65 6e28 7365  n_folds = len(se
-00003030: 6c66 2e64 6174 6173 6574 2e68 5f70 6172  lf.dataset.h_par
-00003040: 616d 735b 2766 6f6c 6473 275d 5b30 5d29  ams['folds'][0])
-00003050: 0d0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
-00003060: 696e 7428 2252 756e 6e69 6e67 2063 726f  int("Running cro
-00003070: 7373 2d76 616c 6964 6174 696f 6e20 7769  ss-validation wi
-00003080: 7468 207b 7d20 666f 6c64 7322 2e66 6f72  th {} folds".for
-00003090: 6d61 7428 6e5f 666f 6c64 7329 290d 0a0d  mat(n_folds))...
-000030a0: 0a0d 0a20 2020 2020 2020 2020 2020 2066  ...            f
-000030b0: 6f72 206a 6a20 696e 2072 616e 6765 286e  or jj in range(n
-000030c0: 5f66 6f6c 6473 293a 0d0a 2020 2020 2020  _folds):..      
-000030d0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-000030e0: 2266 6f6c 643a 222c 206a 6a29 0d0a 2020  "fold:", jj)..  
-000030f0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00003100: 6169 6e2c 2076 616c 203d 2073 656c 662e  ain, val = self.
-00003110: 6461 7461 7365 742e 5f62 7569 6c64 5f64  dataset._build_d
-00003120: 6174 6173 6574 2873 656c 662e 6461 7461  ataset(self.data
-00003130: 7365 742e 685f 7061 7261 6d73 5b27 7472  set.h_params['tr
-00003140: 6169 6e5f 7061 7468 7327 5d2c 0d0a 2020  ain_paths'],..  
-00003150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003180: 2074 7261 696e 5f62 6174 6368 3d73 656c   train_batch=sel
-00003190: 662e 6461 7461 7365 742e 7472 6169 6e69  f.dataset.traini
-000031a0: 6e67 5f62 6174 6368 2c0d 0a20 2020 2020  ng_batch,..     
-000031b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000031c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000031d0: 2020 2020 2020 2020 2020 2020 2020 7465                te
-000031e0: 7374 5f62 6174 6368 3d73 656c 662e 6461  st_batch=self.da
-000031f0: 7461 7365 742e 7661 6c69 6461 7469 6f6e  taset.validation
-00003200: 5f62 6174 6368 2c0d 0a20 2020 2020 2020  _batch,..       
-00003210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003230: 2020 2020 2020 2020 2020 2020 7370 6c69              spli
-00003240: 743d 5472 7565 2c20 7661 6c5f 666f 6c64  t=True, val_fold
-00003250: 5f69 6e64 3d6a 6a29 0d0a 2020 2020 2020  _ind=jj)..      
-00003260: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
-00003270: 5f68 6973 7420 3d20 7365 6c66 2e6b 6d2e  _hist = self.km.
-00003280: 6669 7428 7472 6169 6e2c 0d0a 2020 2020  fit(train,..    
-00003290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000032a0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-000032b0: 616c 6964 6174 696f 6e5f 6461 7461 3d76  alidation_data=v
-000032c0: 616c 2c0d 0a20 2020 2020 2020 2020 2020  al,..           
-000032d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000032e0: 2020 2020 2020 2020 6570 6f63 6873 3d73          epochs=s
-000032f0: 656c 662e 6d65 7461 2e74 7261 696e 5f70  elf.meta.train_p
-00003300: 6172 616d 735b 276e 5f65 706f 6368 7327  arams['n_epochs'
-00003310: 5d2c 200d 0a20 2020 2020 2020 2020 2020  ], ..           
+00002a90: 2020 2020 2020 7661 6c69 6461 7469 6f6e        validation
+00002aa0: 5f73 7465 7073 3d73 656c 662e 6461 7461  _steps=self.data
+00002ab0: 7365 742e 7661 6c69 6461 7469 6f6e 5f73  set.validation_s
+00002ac0: 7465 7073 2c0d 0a0d 0a20 2020 2020 2020  teps,....       
+00002ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002ae0: 2020 2020 2020 2020 2020 2020 6361 6c6c              call
+00002af0: 6261 636b 733d 5b73 746f 705f 6561 726c  backs=[stop_earl
+00002b00: 795d 2c20 7665 7262 6f73 653d 322c 0d0a  y], verbose=2,..
+00002b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002b30: 2020 2063 6c61 7373 5f77 6569 6768 743d     class_weight=
+00002b40: 636c 6173 735f 7765 6967 6874 7329 0d0a  class_weights)..
+00002b50: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00002b60: 2e6d 6574 612e 7472 6169 6e5f 7061 7261  .meta.train_para
+00002b70: 6d73 2e75 7064 6174 6528 7b22 7472 6169  ms.update({"trai
+00002b80: 6e65 6422 3a54 7275 657d 290d 0a0d 0a20  ned":True}).... 
+00002b90: 2020 2020 2020 2020 2020 2023 636f 6d70             #comp
+00002ba0: 7574 6520 7661 6c69 6461 7469 6f6e 206c  ute validation l
+00002bb0: 6f73 7320 616e 6420 6d65 7472 6963 0d0a  oss and metric..
+00002bc0: 2020 2020 2020 2020 2020 2020 765f 6c6f              v_lo
+00002bd0: 7373 2c20 765f 6d65 7472 6963 203d 2073  ss, v_metric = s
+00002be0: 656c 662e 6576 616c 7561 7465 2873 656c  elf.evaluate(sel
+00002bf0: 662e 6461 7461 7365 742e 7661 6c29 0d0a  f.dataset.val)..
+00002c00: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00002c10: 6c66 2e63 765f 6c6f 7373 6573 2e61 7070  lf.cv_losses.app
+00002c20: 656e 6428 765f 6c6f 7373 290d 0a20 2020  end(v_loss)..   
+00002c30: 2020 2020 2020 2020 2073 656c 662e 6376           self.cv
+00002c40: 5f6d 6574 7269 6373 2e61 7070 656e 6428  _metrics.append(
+00002c50: 765f 6d65 7472 6963 290d 0a0d 0a20 2020  v_metric)....   
+00002c60: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+00002c70: 7365 6c66 2e64 6174 6173 6574 2e68 5f70  self.dataset.h_p
+00002c80: 6172 616d 735b 2774 6573 745f 7061 7468  arams['test_path
+00002c90: 7327 5d29 3a0d 0a20 2020 2020 2020 2020  s']):..         
+00002ca0: 2020 2020 2020 2020 2020 2074 5f6c 6f73             t_los
+00002cb0: 732c 2074 5f6d 6574 7269 6320 3d20 7365  s, t_metric = se
+00002cc0: 6c66 2e65 7661 6c75 6174 6528 7365 6c66  lf.evaluate(self
+00002cd0: 2e64 6174 6173 6574 2e68 5f70 6172 616d  .dataset.h_param
+00002ce0: 735b 2774 6573 745f 7061 7468 7327 5d29  s['test_paths'])
+00002cf0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00002d00: 2020 2020 2020 2320 7072 696e 7428 2222        # print(""
+00002d10: 2254 6573 7420 7065 7266 6f72 6d61 6e63  "Test performanc
+00002d20: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00002d30: 2020 2020 2020 2020 2320 2020 2020 2020          #       
+00002d40: 4c6f 7373 3a20 7b3a 2e34 667d 200d 0a20  Loss: {:.4f} .. 
+00002d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002d60: 2020 2023 2020 2020 2020 204d 6574 7269     #       Metri
+00002d70: 633a 207b 3a2e 3466 7d22 2222 2e66 6f72  c: {:.4f}""".for
+00002d80: 6d61 7428 745f 6c6f 7373 2c20 745f 6d65  mat(t_loss, t_me
+00002d90: 7472 6963 2929 0d0a 2020 2020 2020 2020  tric))..        
+00002da0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00002db0: 2e63 765f 7465 7374 5f6c 6f73 7365 732e  .cv_test_losses.
+00002dc0: 6170 7065 6e64 2874 5f6c 6f73 7329 0d0a  append(t_loss)..
+00002dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002de0: 2020 2020 7365 6c66 2e63 765f 7465 7374      self.cv_test
+00002df0: 5f6d 6574 7269 6373 2e61 7070 656e 6428  _metrics.append(
+00002e00: 745f 6d65 7472 6963 290d 0a0d 0a20 2020  t_metric)....   
+00002e10: 2020 2020 2020 2020 2023 636f 6d70 7574           #comput
+00002e20: 6520 7370 6563 6966 6963 206d 6574 7269  e specific metri
+00002e30: 6373 2066 6f72 2063 6c61 7373 6966 6963  cs for classific
+00002e40: 6174 696f 6e20 616e 6420 7265 6772 6573  ation and regres
+00002e50: 7373 696f 6e0d 0a20 2020 2020 2020 2020  ssion..         
+00002e60: 2020 2079 5f74 7275 652c 2079 5f70 7265     y_true, y_pre
+00002e70: 6420 3d20 7365 6c66 2e70 7265 6469 6374  d = self.predict
+00002e80: 2873 656c 662e 6461 7461 7365 742e 7661  (self.dataset.va
+00002e90: 6c29 0d0a 2020 2020 2020 2020 2020 2020  l)..            
+00002ea0: 6966 2073 656c 662e 6461 7461 7365 742e  if self.dataset.
+00002eb0: 685f 7061 7261 6d73 5b27 7461 7267 6574  h_params['target
+00002ec0: 5f74 7970 6527 5d20 3d3d 2027 666c 6f61  _type'] == 'floa
+00002ed0: 7427 3a0d 0a20 2020 2020 2020 2020 2020  t':..           
+00002ee0: 2020 2020 2072 6d73 203d 2072 6567 7265       rms = regre
+00002ef0: 7373 696f 6e5f 6d65 7472 6963 7328 795f  ssion_metrics(y_
+00002f00: 7472 7565 2c20 795f 7072 6564 290d 0a20  true, y_pred).. 
+00002f10: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00002f20: 7269 6e74 2822 5661 6c69 6461 7469 6f6e  rint("Validation
+00002f30: 2073 6574 3a20 436f 7272 203d 222c 2072   set: Corr =", r
+00002f40: 6d73 5b27 6363 275d 2c20 2220 5232 203d  ms['cc'], " R2 =
+00002f50: 222c 2072 6d73 5b27 7232 275d 290d 0a20  ", rms['r2']).. 
+00002f60: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00002f70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00002f80: 2020 726d 7320 3d20 4e6f 6e65 0d0a 2020    rms = None..  
+00002f90: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00002fa0: 6c66 2e63 6d20 2b3d 2073 656c 662e 5f63  lf.cm += self._c
+00002fb0: 6f6e 6675 7369 6f6e 5f6d 6174 7269 7828  onfusion_matrix(
+00002fc0: 795f 7472 7565 2c20 795f 7072 6564 290d  y_true, y_pred).
+00002fd0: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
+00002fe0: 6620 636f 6c6c 6563 745f 7061 7474 6572  f collect_patter
+00002ff0: 6e73 2061 6e64 2073 656c 662e 7363 6f70  ns and self.scop
+00003000: 6520 3d3d 2027 6c66 636e 6e27 3a0d 0a20  e == 'lfcnn':.. 
+00003010: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00003020: 656c 662e 636f 6c6c 6563 745f 7061 7474  elf.collect_patt
+00003030: 6572 6e73 2866 6f6c 643d 302c 206e 5f66  erns(fold=0, n_f
+00003040: 6f6c 6473 3d6e 5f66 6f6c 6473 2c20 6e5f  olds=n_folds, n_
+00003050: 636f 6d70 3d69 6e74 2863 6f6c 6c65 6374  comp=int(collect
+00003060: 5f70 6174 7465 726e 7329 290d 0a0d 0a20  _patterns)).... 
+00003070: 2020 2020 2020 2065 6c69 6620 6d6f 6465         elif mode
+00003080: 203d 3d20 2763 7627 3a0d 0a20 2020 2020   == 'cv':..     
+00003090: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+000030a0: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
+000030b0: 2020 206e 5f66 6f6c 6473 203d 206c 656e     n_folds = len
+000030c0: 2873 656c 662e 6461 7461 7365 742e 685f  (self.dataset.h_
+000030d0: 7061 7261 6d73 5b27 666f 6c64 7327 5d5b  params['folds'][
+000030e0: 305d 290d 0a20 2020 2020 2020 2020 2020  0])..           
+000030f0: 2070 7269 6e74 2822 5275 6e6e 696e 6720   print("Running 
+00003100: 6372 6f73 732d 7661 6c69 6461 7469 6f6e  cross-validation
+00003110: 2077 6974 6820 7b7d 2066 6f6c 6473 222e   with {} folds".
+00003120: 666f 726d 6174 286e 5f66 6f6c 6473 2929  format(n_folds))
+00003130: 0d0a 0d0a 0d0a 2020 2020 2020 2020 2020  ......          
+00003140: 2020 666f 7220 6a6a 2069 6e20 7261 6e67    for jj in rang
+00003150: 6528 6e5f 666f 6c64 7329 3a0d 0a20 2020  e(n_folds):..   
+00003160: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00003170: 6e74 2822 666f 6c64 3a22 2c20 6a6a 290d  nt("fold:", jj).
+00003180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003190: 2074 7261 696e 2c20 7661 6c20 3d20 7365   train, val = se
+000031a0: 6c66 2e64 6174 6173 6574 2e5f 6275 696c  lf.dataset._buil
+000031b0: 645f 6461 7461 7365 7428 7365 6c66 2e64  d_dataset(self.d
+000031c0: 6174 6173 6574 2e68 5f70 6172 616d 735b  ataset.h_params[
+000031d0: 2774 7261 696e 5f70 6174 6873 275d 2c0d  'train_paths'],.
+000031e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000031f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003210: 2020 2020 7472 6169 6e5f 6261 7463 683d      train_batch=
+00003220: 7365 6c66 2e64 6174 6173 6574 2e74 7261  self.dataset.tra
+00003230: 696e 696e 675f 6261 7463 682c 0d0a 2020  ining_batch,..  
+00003240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003270: 2074 6573 745f 6261 7463 683d 7365 6c66   test_batch=self
+00003280: 2e64 6174 6173 6574 2e76 616c 6964 6174  .dataset.validat
+00003290: 696f 6e5f 6261 7463 682c 0d0a 2020 2020  ion_batch,..    
+000032a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000032b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000032c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000032d0: 706c 6974 3d54 7275 652c 2076 616c 5f66  plit=True, val_f
+000032e0: 6f6c 645f 696e 643d 6a6a 290d 0a20 2020  old_ind=jj)..   
+000032f0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00003300: 662e 745f 6869 7374 203d 2073 656c 662e  f.t_hist = self.
+00003310: 6b6d 2e66 6974 2874 7261 696e 2c0d 0a20  km.fit(train,.. 
 00003320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003330: 2020 2020 2020 2020 7374 6570 735f 7065          steps_pe
-00003340: 725f 6570 6f63 683d 7365 6c66 2e6d 6574  r_epoch=self.met
-00003350: 612e 7472 6169 6e5f 7061 7261 6d73 5b27  a.train_params['
-00003360: 6576 616c 5f73 7465 7027 5d2c 0d0a 2020  eval_step'],..  
-00003370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003390: 2073 6875 6666 6c65 3d54 7275 652c 0d0a   shuffle=True,..
-000033a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003340: 2020 7661 6c69 6461 7469 6f6e 5f64 6174    validation_dat
+00003350: 613d 7661 6c2c 0d0a 2020 2020 2020 2020  a=val,..        
+00003360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003370: 2020 2020 2020 2020 2020 2065 706f 6368             epoch
+00003380: 733d 7365 6c66 2e6d 6574 612e 7472 6169  s=self.meta.trai
+00003390: 6e5f 7061 7261 6d73 5b27 6e5f 6570 6f63  n_params['n_epoc
+000033a0: 6873 275d 2c20 0d0a 2020 2020 2020 2020  hs'], ..        
 000033b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000033c0: 2020 2076 616c 6964 6174 696f 6e5f 7374     validation_st
-000033d0: 6570 733d 7365 6c66 2e64 6174 6173 6574  eps=self.dataset
-000033e0: 2e76 616c 6964 6174 696f 6e5f 7374 6570  .validation_step
-000033f0: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
-00003400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003410: 2020 2020 2020 2063 616c 6c62 6163 6b73         callbacks
-00003420: 3d5b 7374 6f70 5f65 6172 6c79 5d2c 2076  =[stop_early], v
-00003430: 6572 626f 7365 3d32 2c0d 0a20 2020 2020  erbose=2,..     
+000033c0: 2020 2020 2020 2020 2020 2073 7465 7073             steps
+000033d0: 5f70 6572 5f65 706f 6368 3d73 656c 662e  _per_epoch=self.
+000033e0: 6d65 7461 2e74 7261 696e 5f70 6172 616d  meta.train_param
+000033f0: 735b 2765 7661 6c5f 7374 6570 275d 2c0d  s['eval_step'],.
+00003400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003420: 2020 2020 7368 7566 666c 653d 5472 7565      shuffle=True
+00003430: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 00003440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003450: 2020 2020 2020 2020 2020 2020 2020 636c                cl
-00003460: 6173 735f 7765 6967 6874 3d63 6c61 7373  ass_weight=class
-00003470: 5f77 6569 6768 7473 290d 0a20 2020 2020  _weights)..     
-00003480: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
-00003490: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000034a0: 662e 6d65 7461 2e74 7261 696e 5f70 6172  f.meta.train_par
-000034b0: 616d 732e 7570 6461 7465 287b 2274 7261  ams.update({"tra
-000034c0: 696e 6564 223a 5472 7565 7d29 0d0a 2020  ined":True})..  
-000034d0: 2020 2020 2020 2020 2020 2020 2020 765f                v_
-000034e0: 6c6f 7373 2c20 765f 6d65 7472 6963 203d  loss, v_metric =
-000034f0: 2073 656c 662e 6576 616c 7561 7465 2876   self.evaluate(v
-00003500: 616c 290d 0a20 2020 2020 2020 2020 2020  al)..           
-00003510: 2020 2020 2073 656c 662e 6376 5f6c 6f73       self.cv_los
-00003520: 7365 732e 6170 7065 6e64 2876 5f6c 6f73  ses.append(v_los
-00003530: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-00003540: 2020 2020 7365 6c66 2e63 765f 6d65 7472      self.cv_metr
-00003550: 6963 732e 6170 7065 6e64 2876 5f6d 6574  ics.append(v_met
-00003560: 7269 6329 0d0a 2020 2020 2020 2020 2020  ric)..          
-00003570: 2020 2020 2020 6966 206c 656e 2873 656c        if len(sel
-00003580: 662e 6461 7461 7365 742e 685f 7061 7261  f.dataset.h_para
-00003590: 6d73 5b27 7465 7374 5f70 6174 6873 275d  ms['test_paths']
-000035a0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-000035b0: 2020 2020 2020 2020 745f 6c6f 7373 2c20          t_loss, 
-000035c0: 745f 6d65 7472 6963 203d 2073 656c 662e  t_metric = self.
-000035d0: 6576 616c 7561 7465 2873 656c 662e 6461  evaluate(self.da
-000035e0: 7461 7365 742e 685f 7061 7261 6d73 5b27  taset.h_params['
-000035f0: 7465 7374 5f70 6174 6873 275d 290d 0a20  test_paths']).. 
-00003600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003610: 2020 2070 7269 6e74 2822 2222 5465 7374     print("""Test
-00003620: 2070 6572 666f 726d 616e 6365 3a0d 0a20   performance:.. 
-00003630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003640: 2020 2020 2020 2020 204c 6f73 733a 207b           Loss: {
-00003650: 3a2e 3466 7d20 0d0a 2020 2020 2020 2020  :.4f} ..        
-00003660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003670: 2020 4d65 7472 6963 3a20 7b3a 2e34 667d    Metric: {:.4f}
-00003680: 2222 222e 666f 726d 6174 2874 5f6c 6f73  """.format(t_los
-00003690: 732c 2074 5f6d 6574 7269 6329 290d 0a20  s, t_metric)).. 
-000036a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000036b0: 2020 2073 656c 662e 6376 5f74 6573 745f     self.cv_test_
-000036c0: 6c6f 7373 6573 2e61 7070 656e 6428 745f  losses.append(t_
-000036d0: 6c6f 7373 290d 0a20 2020 2020 2020 2020  loss)..         
-000036e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000036f0: 6376 5f74 6573 745f 6d65 7472 6963 732e  cv_test_metrics.
-00003700: 6170 7065 6e64 2874 5f6d 6574 7269 6329  append(t_metric)
-00003710: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00003720: 2020 2020 795f 7472 7565 2c20 795f 7072      y_true, y_pr
-00003730: 6564 203d 2073 656c 662e 7072 6564 6963  ed = self.predic
-00003740: 7428 7661 6c29 0d0a 0d0a 2020 2020 2020  t(val)....      
-00003750: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00003760: 662e 6461 7461 7365 742e 685f 7061 7261  f.dataset.h_para
-00003770: 6d73 5b27 7461 7267 6574 5f74 7970 6527  ms['target_type'
-00003780: 5d20 3d3d 2027 666c 6f61 7427 3a0d 0a20  ] == 'float':.. 
-00003790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000037a0: 2020 2072 6d73 203d 2072 6567 7265 7373     rms = regress
-000037b0: 696f 6e5f 6d65 7472 6963 7328 795f 7472  ion_metrics(y_tr
-000037c0: 7565 2c20 795f 7072 6564 290d 0a20 2020  ue, y_pred)..   
-000037d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000037e0: 2066 6f72 206b 2c76 2069 6e20 726d 732e   for k,v in rms.
-000037f0: 6974 656d 7328 293a 0d0a 2020 2020 2020  items():..      
-00003800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003810: 2020 726d 7373 5b6b 5d2e 6170 7065 6e64    rmss[k].append
-00003820: 2876 290d 0a20 2020 2020 2020 2020 2020  (v)..           
-00003830: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-00003840: 5661 6c69 6461 7469 6f6e 2073 6574 3a20  Validation set: 
-00003850: 436f 7272 203d 222c 2072 6d73 5b27 6363  Corr =", rms['cc
-00003860: 275d 2c20 2220 5232 203d 222c 2072 6d73  '], " R2 =", rms
-00003870: 5b27 7232 275d 290d 0a20 2020 2020 2020  ['r2'])..       
-00003880: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+00003450: 2020 2020 2020 7661 6c69 6461 7469 6f6e        validation
+00003460: 5f73 7465 7073 3d73 656c 662e 6461 7461  _steps=self.data
+00003470: 7365 742e 7661 6c69 6461 7469 6f6e 5f73  set.validation_s
+00003480: 7465 7073 2c0d 0a20 2020 2020 2020 2020  teps,..         
+00003490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000034a0: 2020 2020 2020 2020 2020 6361 6c6c 6261            callba
+000034b0: 636b 733d 5b73 746f 705f 6561 726c 795d  cks=[stop_early]
+000034c0: 2c20 7665 7262 6f73 653d 322c 0d0a 2020  , verbose=2,..  
+000034d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000034e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000034f0: 2063 6c61 7373 5f77 6569 6768 743d 636c   class_weight=cl
+00003500: 6173 735f 7765 6967 6874 7329 0d0a 2020  ass_weights)..  
+00003510: 2020 2020 2020 2020 2020 2020 2020 0d0a                ..
+00003520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003530: 7365 6c66 2e6d 6574 612e 7472 6169 6e5f  self.meta.train_
+00003540: 7061 7261 6d73 2e75 7064 6174 6528 7b22  params.update({"
+00003550: 7472 6169 6e65 6422 3a54 7275 657d 290d  trained":True}).
+00003560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003570: 2076 5f6c 6f73 732c 2076 5f6d 6574 7269   v_loss, v_metri
+00003580: 6320 3d20 7365 6c66 2e65 7661 6c75 6174  c = self.evaluat
+00003590: 6528 7661 6c29 0d0a 2020 2020 2020 2020  e(val)..        
+000035a0: 2020 2020 2020 2020 7365 6c66 2e63 765f          self.cv_
+000035b0: 6c6f 7373 6573 2e61 7070 656e 6428 765f  losses.append(v_
+000035c0: 6c6f 7373 290d 0a20 2020 2020 2020 2020  loss)..         
+000035d0: 2020 2020 2020 2073 656c 662e 6376 5f6d         self.cv_m
+000035e0: 6574 7269 6373 2e61 7070 656e 6428 765f  etrics.append(v_
+000035f0: 6d65 7472 6963 290d 0a20 2020 2020 2020  metric)..       
+00003600: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+00003610: 7365 6c66 2e64 6174 6173 6574 2e68 5f70  self.dataset.h_p
+00003620: 6172 616d 735b 2774 6573 745f 7061 7468  arams['test_path
+00003630: 7327 5d29 3a0d 0a20 2020 2020 2020 2020  s']):..         
+00003640: 2020 2020 2020 2020 2020 2074 5f6c 6f73             t_los
+00003650: 732c 2074 5f6d 6574 7269 6320 3d20 7365  s, t_metric = se
+00003660: 6c66 2e65 7661 6c75 6174 6528 7365 6c66  lf.evaluate(self
+00003670: 2e64 6174 6173 6574 2e68 5f70 6172 616d  .dataset.h_param
+00003680: 735b 2774 6573 745f 7061 7468 7327 5d29  s['test_paths'])
+00003690: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000036a0: 2020 2020 2020 7072 696e 7428 2222 2254        print("""T
+000036b0: 6573 7420 7065 7266 6f72 6d61 6e63 653a  est performance:
+000036c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000036d0: 2020 2020 2020 2020 2020 2020 4c6f 7373              Loss
+000036e0: 3a20 7b3a 2e34 667d 200d 0a20 2020 2020  : {:.4f} ..     
+000036f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003700: 2020 2020 204d 6574 7269 633a 207b 3a2e       Metric: {:.
+00003710: 3466 7d22 2222 2e66 6f72 6d61 7428 745f  4f}""".format(t_
+00003720: 6c6f 7373 2c20 745f 6d65 7472 6963 2929  loss, t_metric))
+00003730: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00003740: 2020 2020 2020 7365 6c66 2e63 765f 7465        self.cv_te
+00003750: 7374 5f6c 6f73 7365 732e 6170 7065 6e64  st_losses.append
+00003760: 2874 5f6c 6f73 7329 0d0a 2020 2020 2020  (t_loss)..      
+00003770: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00003780: 6c66 2e63 765f 7465 7374 5f6d 6574 7269  lf.cv_test_metri
+00003790: 6373 2e61 7070 656e 6428 745f 6d65 7472  cs.append(t_metr
+000037a0: 6963 290d 0a0d 0a20 2020 2020 2020 2020  ic)....         
+000037b0: 2020 2020 2020 2079 5f74 7275 652c 2079         y_true, y
+000037c0: 5f70 7265 6420 3d20 7365 6c66 2e70 7265  _pred = self.pre
+000037d0: 6469 6374 2876 616c 290d 0a0d 0a20 2020  dict(val)....   
+000037e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000037f0: 7365 6c66 2e64 6174 6173 6574 2e68 5f70  self.dataset.h_p
+00003800: 6172 616d 735b 2774 6172 6765 745f 7479  arams['target_ty
+00003810: 7065 275d 203d 3d20 2766 6c6f 6174 273a  pe'] == 'float':
+00003820: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00003830: 2020 2020 2020 726d 7320 3d20 7265 6772        rms = regr
+00003840: 6573 7369 6f6e 5f6d 6574 7269 6373 2879  ession_metrics(y
+00003850: 5f74 7275 652c 2079 5f70 7265 6429 0d0a  _true, y_pred)..
+00003860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003870: 2020 2020 666f 7220 6b2c 7620 696e 2072      for k,v in r
+00003880: 6d73 2e69 7465 6d73 2829 3a0d 0a20 2020  ms.items():..   
 00003890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000038a0: 2020 2020 7365 6c66 2e63 6d20 2b3d 2073      self.cm += s
-000038b0: 656c 662e 5f63 6f6e 6675 7369 6f6e 5f6d  elf._confusion_m
-000038c0: 6174 7269 7828 795f 7472 7565 2c20 795f  atrix(y_true, y_
-000038d0: 7072 6564 290d 0a20 2020 2020 2020 2020  pred)..         
-000038e0: 2020 2020 2020 2020 2020 2072 6d73 203d             rms =
-000038f0: 204e 6f6e 650d 0a0d 0a20 2020 2020 2020   None....       
-00003900: 2020 2020 2020 2020 2069 6620 636f 6c6c           if coll
-00003910: 6563 745f 7061 7474 6572 6e73 2061 6e64  ect_patterns and
-00003920: 2073 656c 662e 7363 6f70 6520 3d3d 2027   self.scope == '
-00003930: 6c66 636e 6e27 3a0d 0a20 2020 2020 2020  lfcnn':..       
-00003940: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00003950: 662e 636f 6c6c 6563 745f 7061 7474 6572  f.collect_patter
-00003960: 6e73 2866 6f6c 643d 6a6a 2c20 6e5f 666f  ns(fold=jj, n_fo
-00003970: 6c64 733d 6e5f 666f 6c64 732c 0d0a 2020  lds=n_folds,..  
-00003980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000039a0: 2020 2020 2020 2020 6e5f 636f 6d70 3d69          n_comp=i
-000039b0: 6e74 2863 6f6c 6c65 6374 5f70 6174 7465  nt(collect_patte
-000039c0: 726e 7329 290d 0a0d 0a0d 0a20 2020 2020  rns))......     
-000039d0: 2020 2020 2020 2020 2020 2069 6620 6a6a             if jj
-000039e0: 203c 206e 5f66 6f6c 6473 202d 2031 3a0d   < n_folds - 1:.
-000039f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003a00: 2020 2020 2073 656c 662e 6b6d 2e6c 6f61       self.km.loa
-00003a10: 645f 7765 6967 6874 7328 6f73 2e70 6174  d_weights(os.pat
-00003a20: 682e 6a6f 696e 2873 656c 662e 6d6f 6465  h.join(self.mode
-00003a30: 6c5f 7061 7468 2c20 0d0a 2020 2020 2020  l_path, ..      
-00003a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003a70: 7365 6c66 2e6d 6f64 656c 5f6e 616d 6520  self.model_name 
-00003a80: 2b20 2769 6e69 742e 6835 2729 290d 0a20  + 'init.h5')).. 
-00003a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003aa0: 2020 2073 656c 662e 7368 7566 666c 655f     self.shuffle_
-00003ab0: 7765 6967 6874 7328 290d 0a20 2020 2020  weights()..     
-00003ac0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00003ad0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00003ae0: 2020 2020 2020 224e 6f74 2073 6875 6666        "Not shuff
-00003af0: 6c69 6e67 2074 6865 2077 6569 6768 7473  ling the weights
-00003b00: 2066 6f72 2074 6865 206c 6173 7420 666f   for the last fo
-00003b10: 6c64 220d 0a0d 0a20 2020 2020 2020 2020  ld"....         
-00003b20: 2020 2020 2020 2070 7269 6e74 2822 2222         print("""
-00003b30: 466f 6c64 3a20 7b7d 2056 616c 6964 6174  Fold: {} Validat
-00003b40: 696f 6e20 7065 7266 6f72 6d61 6e63 653a  ion performance:
-00003b50: 5c6e 0d0a 2020 2020 2020 2020 2020 2020  \n..            
-00003b60: 2020 2020 2020 2020 2020 4c6f 7373 3a20            Loss: 
-00003b70: 7b3a 2e34 667d 2c20 0d0a 2020 2020 2020  {:.4f}, ..      
-00003b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003b90: 4d65 7472 6963 3a20 7b3a 2e34 667d 2222  Metric: {:.4f}""
-00003ba0: 222e 666f 726d 6174 286a 6a2c 2076 5f6c  ".format(jj, v_l
-00003bb0: 6f73 732c 2076 5f6d 6574 7269 6329 290d  oss, v_metric)).
-00003bc0: 0a0d 0a20 2020 2020 2020 2020 2020 206d  ...            m
-00003bd0: 6574 7269 6373 203d 2073 656c 662e 6376  etrics = self.cv
-00003be0: 5f6d 6574 7269 6373 0d0a 2020 2020 2020  _metrics..      
-00003bf0: 2020 2020 2020 6c6f 7373 6573 203d 2073        losses = s
-00003c00: 656c 662e 6376 5f6c 6f73 7365 730d 0a0d  elf.cv_losses...
-00003c10: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00003c20: 6e74 2822 7b7d 2077 6974 6820 7b7d 2066  nt("{} with {} f
-00003c30: 6f6c 6473 2063 6f6d 706c 6574 6564 2e20  olds completed. 
-00003c40: 4c6f 7373 3a20 7b3a 2e34 667d 202b 2f2d  Loss: {:.4f} +/-
-00003c50: 207b 3a2e 3466 7d2e 204d 6574 7269 633a   {:.4f}. Metric:
-00003c60: 207b 3a2e 3466 7d20 2b2f 2d20 7b3a 2e34   {:.4f} +/- {:.4
-00003c70: 667d 222e 666f 726d 6174 286d 6f64 652c  f}".format(mode,
-00003c80: 206e 5f66 6f6c 6473 2c20 6e70 2e6d 6561   n_folds, np.mea
-00003c90: 6e28 6c6f 7373 6573 292c 206e 702e 7374  n(losses), np.st
-00003ca0: 6428 6c6f 7373 6573 292c 206e 702e 6d65  d(losses), np.me
-00003cb0: 616e 286d 6574 7269 6373 292c 206e 702e  an(metrics), np.
-00003cc0: 7374 6428 6d65 7472 6963 7329 2929 0d0a  std(metrics)))..
-00003cd0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00003ce0: 2073 656c 662e 6461 7461 7365 742e 685f   self.dataset.h_
-00003cf0: 7061 7261 6d73 5b27 7461 7267 6574 5f74  params['target_t
-00003d00: 7970 6527 5d20 3d3d 2027 666c 6f61 7427  ype'] == 'float'
-00003d10: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00003d20: 2020 2072 6d73 203d 207b 6b3a 6e70 2e6d     rms = {k:np.m
-00003d30: 6561 6e28 7629 2066 6f72 206b 2c20 7620  ean(v) for k, v 
-00003d40: 696e 2072 6d73 732e 6974 656d 7328 297d  in rmss.items()}
-00003d50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00003d60: 2020 726d 732e 7570 6461 7465 287b 6b20    rms.update({k 
-00003d70: 2b20 275f 7374 6427 3a6e 702e 7374 6428  + '_std':np.std(
-00003d80: 7629 2066 6f72 206b 2c20 7620 696e 2072  v) for k, v in r
-00003d90: 6d73 732e 6974 656d 7328 297d 290d 0a20  mss.items()}).. 
-00003da0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00003db0: 7269 6e74 2822 5661 6c69 6461 7469 6f6e  rint("Validation
-00003dc0: 2073 6574 3a20 436f 7272 203a 207b 3a2e   set: Corr : {:.
-00003dd0: 3366 7d20 2b2f 2d20 7b3a 2e33 667d 2e20  3f} +/- {:.3f}. 
-00003de0: 5c0d 0a20 2020 2020 2020 2020 2020 2020  \..             
-00003df0: 2020 2020 2020 2020 2052 5e32 3a20 7b3a           R^2: {:
-00003e00: 2e33 667d 202b 2f2d 207b 3a2e 3366 7d22  .3f} +/- {:.3f}"
-00003e10: 2e66 6f72 6d61 7428 0d0a 2020 2020 2020  .format(..      
-00003e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003e30: 726d 735b 2763 6327 5d2c 2072 6d73 5b27  rms['cc'], rms['
-00003e40: 6363 5f73 7464 275d 2c20 726d 735b 2772  cc_std'], rms['r
-00003e50: 3227 5d2c 2072 6d73 5b27 7232 5f73 7464  2'], rms['r2_std
-00003e60: 275d 2929 0d0a 2020 2020 2020 2020 2020  ']))..          
-00003e70: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00003e80: 2020 2020 2020 2020 2072 6d73 203d 204e           rms = N
-00003e90: 6f6e 650d 0a0d 0a0d 0a20 2020 2020 2020  one......       
-00003ea0: 2065 6c69 6620 6d6f 6465 203d 3d20 226c   elif mode == "l
-00003eb0: 6f73 6f22 3a0d 0a20 2020 2020 2020 2020  oso":..         
-00003ec0: 2020 206e 5f66 6f6c 6473 203d 206c 656e     n_folds = len
-00003ed0: 2873 656c 662e 6461 7461 7365 742e 685f  (self.dataset.h_
-00003ee0: 7061 7261 6d73 5b27 7472 6169 6e5f 7061  params['train_pa
-00003ef0: 7468 7327 5d29 0d0a 2020 2020 2020 2020  ths'])..        
-00003f00: 2020 2020 7072 696e 7428 2252 756e 6e69      print("Runni
-00003f10: 6e67 206c 6561 7665 2d6f 6e65 2d73 7562  ng leave-one-sub
-00003f20: 6a65 6374 2d6f 7574 2043 5620 7769 7468  ject-out CV with
-00003f30: 207b 7d20 7375 626a 6563 7422 2e66 6f72   {} subject".for
-00003f40: 6d61 7428 6e5f 666f 6c64 7329 290d 0a0d  mat(n_folds))...
-00003f50: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00003f60: 206a 6a20 696e 2072 616e 6765 286e 5f66   jj in range(n_f
-00003f70: 6f6c 6473 293a 0d0a 2020 2020 2020 2020  olds):..        
-00003f80: 2020 2020 2020 2020 7072 696e 7428 2266          print("f
-00003f90: 6f6c 643a 222c 206a 6a29 0d0a 0d0a 2020  old:", jj)....  
-00003fa0: 2020 2020 2020 2020 2020 2020 2020 7465                te
-00003fb0: 7374 5f73 7562 6a20 3d20 7365 6c66 2e64  st_subj = self.d
-00003fc0: 6174 6173 6574 2e68 5f70 6172 616d 735b  ataset.h_params[
-00003fd0: 2774 7261 696e 5f70 6174 6873 275d 5b6a  'train_paths'][j
-00003fe0: 6a5d 0d0a 2020 2020 2020 2020 2020 2020  j]..            
-00003ff0: 2020 2020 7472 6169 6e5f 7375 626a 7320      train_subjs 
-00004000: 3d20 7365 6c66 2e64 6174 6173 6574 2e68  = self.dataset.h
-00004010: 5f70 6172 616d 735b 2774 7261 696e 5f70  _params['train_p
-00004020: 6174 6873 275d 2e63 6f70 7928 290d 0a20  aths'].copy().. 
-00004030: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00004040: 7261 696e 5f73 7562 6a73 2e70 6f70 286a  rain_subjs.pop(j
-00004050: 6a29 0d0a 0d0a 2020 2020 2020 2020 2020  j)....          
-00004060: 2020 2020 2020 7072 696e 7428 7472 6169        print(trai
-00004070: 6e5f 7375 626a 7329 0d0a 2020 2020 2020  n_subjs)..      
-00004080: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00004090: 272a 2a2a 2729 0d0a 2020 2020 2020 2020  '***')..        
-000040a0: 2020 2020 2020 2020 7072 696e 7428 7465          print(te
-000040b0: 7374 5f73 7562 6a29 0d0a 0d0a 2020 2020  st_subj)....    
-000040c0: 2020 2020 2020 2020 2020 2020 7472 6169              trai
-000040d0: 6e2c 2076 616c 203d 2073 656c 662e 6461  n, val = self.da
-000040e0: 7461 7365 742e 5f62 7569 6c64 5f64 6174  taset._build_dat
-000040f0: 6173 6574 2874 7261 696e 5f73 7562 6a73  aset(train_subjs
-00004100: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00004110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004130: 2020 2020 2020 7472 6169 6e5f 6261 7463        train_batc
-00004140: 683d 7365 6c66 2e64 6174 6173 6574 2e74  h=self.dataset.t
-00004150: 7261 696e 696e 675f 6261 7463 682c 0d0a  raining_batch,..
-00004160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004190: 2020 2074 6573 745f 6261 7463 683d 7365     test_batch=se
-000041a0: 6c66 2e64 6174 6173 6574 2e76 616c 6964  lf.dataset.valid
-000041b0: 6174 696f 6e5f 6261 7463 682c 0d0a 2020  ation_batch,..  
-000041c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000041d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000041e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000041f0: 2073 706c 6974 3d54 7275 652c 2076 616c   split=True, val
-00004200: 5f66 6f6c 645f 696e 643d 3029 0d0a 0d0a  _fold_ind=0)....
-00004210: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00004220: 2020 7365 6c66 2e74 5f68 6973 7420 3d20    self.t_hist = 
-00004230: 7365 6c66 2e6b 6d2e 6669 7428 7472 6169  self.km.fit(trai
-00004240: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
-00004250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004260: 2020 2020 2020 2076 616c 6964 6174 696f         validatio
-00004270: 6e5f 6461 7461 3d76 616c 2c0d 0a20 2020  n_data=val,..   
-00004280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000042a0: 6570 6f63 6873 3d73 656c 662e 6d65 7461  epochs=self.meta
-000042b0: 2e74 7261 696e 5f70 6172 616d 735b 276e  .train_params['n
-000042c0: 5f65 706f 6368 7327 5d2c 200d 0a20 2020  _epochs'], ..   
+000038a0: 2020 2020 2072 6d73 735b 6b5d 2e61 7070       rmss[k].app
+000038b0: 656e 6428 7629 0d0a 2020 2020 2020 2020  end(v)..        
+000038c0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+000038d0: 7428 2256 616c 6964 6174 696f 6e20 7365  t("Validation se
+000038e0: 743a 2043 6f72 7220 3d22 2c20 726d 735b  t: Corr =", rms[
+000038f0: 2763 6327 5d2c 2022 2052 3220 3d22 2c20  'cc'], " R2 =", 
+00003900: 726d 735b 2772 3227 5d29 0d0a 2020 2020  rms['r2'])..    
+00003910: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00003920: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00003930: 2020 2020 2020 2073 656c 662e 636d 202b         self.cm +
+00003940: 3d20 7365 6c66 2e5f 636f 6e66 7573 696f  = self._confusio
+00003950: 6e5f 6d61 7472 6978 2879 5f74 7275 652c  n_matrix(y_true,
+00003960: 2079 5f70 7265 6429 0d0a 2020 2020 2020   y_pred)..      
+00003970: 2020 2020 2020 2020 2020 2020 2020 726d                rm
+00003980: 7320 3d20 4e6f 6e65 0d0a 0d0a 2020 2020  s = None....    
+00003990: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+000039a0: 6f6c 6c65 6374 5f70 6174 7465 726e 7320  ollect_patterns 
+000039b0: 616e 6420 7365 6c66 2e73 636f 7065 203d  and self.scope =
+000039c0: 3d20 276c 6663 6e6e 273a 0d0a 2020 2020  = 'lfcnn':..    
+000039d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000039e0: 7365 6c66 2e63 6f6c 6c65 6374 5f70 6174  self.collect_pat
+000039f0: 7465 726e 7328 666f 6c64 3d6a 6a2c 206e  terns(fold=jj, n
+00003a00: 5f66 6f6c 6473 3d6e 5f66 6f6c 6473 2c0d  _folds=n_folds,.
+00003a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003a30: 2020 2020 2020 2020 2020 206e 5f63 6f6d             n_com
+00003a40: 703d 696e 7428 636f 6c6c 6563 745f 7061  p=int(collect_pa
+00003a50: 7474 6572 6e73 2929 0d0a 0d0a 0d0a 2020  tterns))......  
+00003a60: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00003a70: 206a 6a20 3c20 6e5f 666f 6c64 7320 2d20   jj < n_folds - 
+00003a80: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
+00003a90: 2020 2020 2020 2020 7365 6c66 2e6b 6d2e          self.km.
+00003aa0: 6c6f 6164 5f77 6569 6768 7473 286f 732e  load_weights(os.
+00003ab0: 7061 7468 2e6a 6f69 6e28 7365 6c66 2e6d  path.join(self.m
+00003ac0: 6f64 656c 5f70 6174 682c 200d 0a20 2020  odel_path, ..   
+00003ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003af0: 2020 2020 2020 2073 656c 662e 6d6f 6465         self.mode
+00003b00: 6c5f 6e61 6d65 202b 2027 5f69 6e69 742e  l_name + '_init.
+00003b10: 7765 6967 6874 732e 6835 2729 2c0d 0a20  weights.h5'),.. 
+00003b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003b40: 2020 2020 2020 2020 736b 6970 5f6d 6973          skip_mis
+00003b50: 6d61 7463 683d 5472 7565 290d 0a20 2020  match=True)..   
+00003b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003b70: 2073 656c 662e 7368 7566 666c 655f 7765   self.shuffle_we
+00003b80: 6967 6874 7328 290d 0a20 2020 2020 2020  ights()..       
+00003b90: 2020 2020 2020 2020 2020 2020 2073 746f               sto
+00003ba0: 705f 6561 726c 792e 6265 7374 203d 206e  p_early.best = n
+00003bb0: 702e 496e 660d 0a20 2020 2020 2020 2020  p.Inf..         
+00003bc0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00003bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003be0: 2020 224e 6f74 2073 6875 6666 6c69 6e67    "Not shuffling
+00003bf0: 2074 6865 2077 6569 6768 7473 2066 6f72   the weights for
+00003c00: 2074 6865 206c 6173 7420 666f 6c64 220d   the last fold".
+00003c10: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+00003c20: 2020 2070 7269 6e74 2822 2222 466f 6c64     print("""Fold
+00003c30: 3a20 7b7d 2056 616c 6964 6174 696f 6e20  : {} Validation 
+00003c40: 7065 7266 6f72 6d61 6e63 653a 5c6e 0d0a  performance:\n..
+00003c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003c60: 2020 2020 2020 4c6f 7373 3a20 7b3a 2e34        Loss: {:.4
+00003c70: 667d 2c20 0d0a 2020 2020 2020 2020 2020  f}, ..          
+00003c80: 2020 2020 2020 2020 2020 2020 4d65 7472              Metr
+00003c90: 6963 3a20 7b3a 2e34 667d 2222 222e 666f  ic: {:.4f}""".fo
+00003ca0: 726d 6174 286a 6a2c 2076 5f6c 6f73 732c  rmat(jj, v_loss,
+00003cb0: 2076 5f6d 6574 7269 6329 290d 0a0d 0a20   v_metric)).... 
+00003cc0: 2020 2020 2020 2020 2020 206d 6574 7269             metri
+00003cd0: 6373 203d 2073 656c 662e 6376 5f6d 6574  cs = self.cv_met
+00003ce0: 7269 6373 0d0a 2020 2020 2020 2020 2020  rics..          
+00003cf0: 2020 6c6f 7373 6573 203d 2073 656c 662e    losses = self.
+00003d00: 6376 5f6c 6f73 7365 730d 0a0d 0a20 2020  cv_losses....   
+00003d10: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+00003d20: 7b7d 2077 6974 6820 7b7d 2066 6f6c 6473  {} with {} folds
+00003d30: 2063 6f6d 706c 6574 6564 2e20 4c6f 7373   completed. Loss
+00003d40: 3a20 7b3a 2e34 667d 202b 2f2d 207b 3a2e  : {:.4f} +/- {:.
+00003d50: 3466 7d2e 204d 6574 7269 633a 207b 3a2e  4f}. Metric: {:.
+00003d60: 3466 7d20 2b2f 2d20 7b3a 2e34 667d 222e  4f} +/- {:.4f}".
+00003d70: 666f 726d 6174 286d 6f64 652c 206e 5f66  format(mode, n_f
+00003d80: 6f6c 6473 2c20 6e70 2e6d 6561 6e28 6c6f  olds, np.mean(lo
+00003d90: 7373 6573 292c 206e 702e 7374 6428 6c6f  sses), np.std(lo
+00003da0: 7373 6573 292c 206e 702e 6d65 616e 286d  sses), np.mean(m
+00003db0: 6574 7269 6373 292c 206e 702e 7374 6428  etrics), np.std(
+00003dc0: 6d65 7472 6963 7329 2929 0d0a 0d0a 2020  metrics)))....  
+00003dd0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00003de0: 662e 6461 7461 7365 742e 685f 7061 7261  f.dataset.h_para
+00003df0: 6d73 5b27 7461 7267 6574 5f74 7970 6527  ms['target_type'
+00003e00: 5d20 3d3d 2027 666c 6f61 7427 3a0d 0a20  ] == 'float':.. 
+00003e10: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00003e20: 6d73 203d 207b 6b3a 6e70 2e6d 6561 6e28  ms = {k:np.mean(
+00003e30: 7629 2066 6f72 206b 2c20 7620 696e 2072  v) for k, v in r
+00003e40: 6d73 732e 6974 656d 7328 297d 0d0a 2020  mss.items()}..  
+00003e50: 2020 2020 2020 2020 2020 2020 2020 726d                rm
+00003e60: 732e 7570 6461 7465 287b 6b20 2b20 275f  s.update({k + '_
+00003e70: 7374 6427 3a6e 702e 7374 6428 7629 2066  std':np.std(v) f
+00003e80: 6f72 206b 2c20 7620 696e 2072 6d73 732e  or k, v in rmss.
+00003e90: 6974 656d 7328 297d 290d 0a20 2020 2020  items()})..     
+00003ea0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00003eb0: 2822 5661 6c69 6461 7469 6f6e 2073 6574  ("Validation set
+00003ec0: 3a20 436f 7272 203a 207b 3a2e 3366 7d20  : Corr : {:.3f} 
+00003ed0: 2b2f 2d20 7b3a 2e33 667d 2e20 5c0d 0a20  +/- {:.3f}. \.. 
+00003ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003ef0: 2020 2020 2052 5e32 3a20 7b3a 2e33 667d       R^2: {:.3f}
+00003f00: 202b 2f2d 207b 3a2e 3366 7d22 2e66 6f72   +/- {:.3f}".for
+00003f10: 6d61 7428 0d0a 2020 2020 2020 2020 2020  mat(..          
+00003f20: 2020 2020 2020 2020 2020 2020 726d 735b              rms[
+00003f30: 2763 6327 5d2c 2072 6d73 5b27 6363 5f73  'cc'], rms['cc_s
+00003f40: 7464 275d 2c20 726d 735b 2772 3227 5d2c  td'], rms['r2'],
+00003f50: 2072 6d73 5b27 7232 5f73 7464 275d 2929   rms['r2_std']))
+00003f60: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00003f70: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00003f80: 2020 2020 2072 6d73 203d 204e 6f6e 650d       rms = None.
+00003f90: 0a0d 0a0d 0a20 2020 2020 2020 2065 6c69  .....        eli
+00003fa0: 6620 6d6f 6465 203d 3d20 226c 6f73 6f22  f mode == "loso"
+00003fb0: 3a0d 0a20 2020 2020 2020 2020 2020 206e  :..            n
+00003fc0: 5f66 6f6c 6473 203d 206c 656e 2873 656c  _folds = len(sel
+00003fd0: 662e 6461 7461 7365 742e 685f 7061 7261  f.dataset.h_para
+00003fe0: 6d73 5b27 7472 6169 6e5f 7061 7468 7327  ms['train_paths'
+00003ff0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00004000: 7072 696e 7428 2252 756e 6e69 6e67 206c  print("Running l
+00004010: 6561 7665 2d6f 6e65 2d73 7562 6a65 6374  eave-one-subject
+00004020: 2d6f 7574 2043 5620 7769 7468 207b 7d20  -out CV with {} 
+00004030: 7375 626a 6563 7422 2e66 6f72 6d61 7428  subject".format(
+00004040: 6e5f 666f 6c64 7329 290d 0a0d 0a20 2020  n_folds))....   
+00004050: 2020 2020 2020 2020 2066 6f72 206a 6a20           for jj 
+00004060: 696e 2072 616e 6765 286e 5f66 6f6c 6473  in range(n_folds
+00004070: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00004080: 2020 2020 7072 696e 7428 2266 6f6c 643a      print("fold:
+00004090: 222c 206a 6a29 0d0a 0d0a 2020 2020 2020  ", jj)....      
+000040a0: 2020 2020 2020 2020 2020 7465 7374 5f73            test_s
+000040b0: 7562 6a20 3d20 7365 6c66 2e64 6174 6173  ubj = self.datas
+000040c0: 6574 2e68 5f70 6172 616d 735b 2774 7261  et.h_params['tra
+000040d0: 696e 5f70 6174 6873 275d 5b6a 6a5d 0d0a  in_paths'][jj]..
+000040e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000040f0: 7472 6169 6e5f 7375 626a 7320 3d20 7365  train_subjs = se
+00004100: 6c66 2e64 6174 6173 6574 2e68 5f70 6172  lf.dataset.h_par
+00004110: 616d 735b 2774 7261 696e 5f70 6174 6873  ams['train_paths
+00004120: 275d 2e63 6f70 7928 290d 0a20 2020 2020  '].copy()..     
+00004130: 2020 2020 2020 2020 2020 2074 7261 696e             train
+00004140: 5f73 7562 6a73 2e70 6f70 286a 6a29 0d0a  _subjs.pop(jj)..
+00004150: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004160: 2020 7072 696e 7428 7472 6169 6e5f 7375    print(train_su
+00004170: 626a 7329 0d0a 2020 2020 2020 2020 2020  bjs)..          
+00004180: 2020 2020 2020 7072 696e 7428 272a 2a2a        print('***
+00004190: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
+000041a0: 2020 2020 7072 696e 7428 7465 7374 5f73      print(test_s
+000041b0: 7562 6a29 0d0a 0d0a 2020 2020 2020 2020  ubj)....        
+000041c0: 2020 2020 2020 2020 7472 6169 6e2c 2076          train, v
+000041d0: 616c 203d 2073 656c 662e 6461 7461 7365  al = self.datase
+000041e0: 742e 5f62 7569 6c64 5f64 6174 6173 6574  t._build_dataset
+000041f0: 2874 7261 696e 5f73 7562 6a73 2c0d 0a20  (train_subjs,.. 
+00004200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004230: 2020 7472 6169 6e5f 6261 7463 683d 7365    train_batch=se
+00004240: 6c66 2e64 6174 6173 6574 2e74 7261 696e  lf.dataset.train
+00004250: 696e 675f 6261 7463 682c 0d0a 2020 2020  ing_batch,..    
+00004260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004280: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00004290: 6573 745f 6261 7463 683d 7365 6c66 2e64  est_batch=self.d
+000042a0: 6174 6173 6574 2e76 616c 6964 6174 696f  ataset.validatio
+000042b0: 6e5f 6261 7463 682c 0d0a 2020 2020 2020  n_batch,..      
+000042c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000042d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000042e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000042f0: 7374 6570 735f 7065 725f 6570 6f63 683d  steps_per_epoch=
-00004300: 7365 6c66 2e6d 6574 612e 7472 6169 6e5f  self.meta.train_
-00004310: 7061 7261 6d73 5b27 6576 616c 5f73 7465  params['eval_ste
-00004320: 7027 5d2c 0d0a 2020 2020 2020 2020 2020  p'],..          
-00004330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004340: 2020 2020 2020 2020 2073 6875 6666 6c65           shuffle
-00004350: 3d54 7275 652c 0d0a 2020 2020 2020 2020  =True,..        
-00004360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004370: 2020 2020 2020 2020 2020 2076 616c 6964             valid
-00004380: 6174 696f 6e5f 7374 6570 733d 7365 6c66  ation_steps=self
-00004390: 2e64 6174 6173 6574 2e76 616c 6964 6174  .dataset.validat
-000043a0: 696f 6e5f 7374 6570 732c 0d0a 2020 2020  ion_steps,..    
-000043b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000043c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000043d0: 616c 6c62 6163 6b73 3d5b 7374 6f70 5f65  allbacks=[stop_e
-000043e0: 6172 6c79 5d2c 2076 6572 626f 7365 3d32  arly], verbose=2
-000043f0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00004400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004410: 2020 2020 2020 636c 6173 735f 7765 6967        class_weig
-00004420: 6874 3d63 6c61 7373 5f77 6569 6768 7473  ht=class_weights
-00004430: 290d 0a0d 0a0d 0a20 2020 2020 2020 2020  )......         
-00004440: 2020 2020 2020 2074 6573 7420 3d20 7365         test = se
-00004450: 6c66 2e64 6174 6173 6574 2e5f 6275 696c  lf.dataset._buil
-00004460: 645f 6461 7461 7365 7428 7465 7374 5f73  d_dataset(test_s
-00004470: 7562 6a2c 0d0a 2020 2020 2020 2020 2020  ubj,..          
-00004480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000044a0: 2020 2020 2020 2020 2074 6573 745f 6261           test_ba
-000044b0: 7463 683d 4e6f 6e65 2c0d 0a20 2020 2020  tch=None,..     
-000044c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000044d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000044e0: 2020 2020 2020 2020 2020 2020 2020 7370                sp
-000044f0: 6c69 743d 4661 6c73 6529 0d0a 0d0a 2020  lit=False)....  
-00004500: 2020 2020 2020 2020 2020 2020 2020 765f                v_
-00004510: 6c6f 7373 2c20 765f 6d65 7472 6963 203d  loss, v_metric =
-00004520: 2073 656c 662e 6576 616c 7561 7465 2876   self.evaluate(v
-00004530: 616c 290d 0a20 2020 2020 2020 2020 2020  al)..           
-00004540: 2020 2020 2074 5f6c 6f73 732c 2074 5f6d       t_loss, t_m
-00004550: 6574 7269 6320 3d20 7365 6c66 2e65 7661  etric = self.eva
-00004560: 6c75 6174 6528 7465 7374 290d 0a0d 0a20  luate(test).... 
-00004570: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00004580: 7269 6e74 2822 5375 626a 3a20 7b7d 204c  rint("Subj: {} L
-00004590: 6f73 733a 207b 3a2e 3466 7d2c 204d 6574  oss: {:.4f}, Met
-000045a0: 7269 633a 207b 3a2e 3466 7d22 2e66 6f72  ric: {:.4f}".for
-000045b0: 6d61 7428 6a6a 2c20 745f 6c6f 7373 2c20  mat(jj, t_loss, 
-000045c0: 745f 6d65 7472 6963 2929 0d0a 2020 2020  t_metric))..    
-000045d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000045e0: 2e63 765f 6c6f 7373 6573 2e61 7070 656e  .cv_losses.appen
-000045f0: 6428 765f 6c6f 7373 290d 0a20 2020 2020  d(v_loss)..     
-00004600: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00004610: 6376 5f6d 6574 7269 6373 2e61 7070 656e  cv_metrics.appen
-00004620: 6428 765f 6d65 7472 6963 290d 0a20 2020  d(v_metric)..   
-00004630: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00004640: 662e 6376 5f74 6573 745f 6c6f 7373 6573  f.cv_test_losses
-00004650: 2e61 7070 656e 6428 745f 6c6f 7373 290d  .append(t_loss).
-00004660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004670: 2073 656c 662e 6376 5f74 6573 745f 6d65   self.cv_test_me
-00004680: 7472 6963 732e 6170 7065 6e64 2874 5f6d  trics.append(t_m
-00004690: 6574 7269 6329 0d0a 0d0a 2020 2020 2020  etric)....      
-000046a0: 2020 2020 2020 2020 2020 795f 7472 7565            y_true
-000046b0: 2c20 795f 7072 6564 203d 2073 656c 662e  , y_pred = self.
-000046c0: 7072 6564 6963 7428 7661 6c29 0d0a 2020  predict(val)..  
-000046d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000046e0: 2073 656c 662e 6461 7461 7365 742e 685f   self.dataset.h_
-000046f0: 7061 7261 6d73 5b27 7461 7267 6574 5f74  params['target_t
-00004700: 7970 6527 5d20 3d3d 2027 666c 6f61 7427  ype'] == 'float'
-00004710: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00004720: 2020 2020 2020 2079 5f74 7275 652c 2079         y_true, y
-00004730: 5f70 7265 6420 3d20 7365 6c66 2e70 7265  _pred = self.pre
-00004740: 6469 6374 2876 616c 290d 0a20 2020 2020  dict(val)..     
-00004750: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00004760: 6d73 203d 2072 6567 7265 7373 696f 6e5f  ms = regression_
-00004770: 6d65 7472 6963 7328 795f 7472 7565 2c20  metrics(y_true, 
-00004780: 795f 7072 6564 290d 0a20 2020 2020 2020  y_pred)..       
-00004790: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-000047a0: 206b 2c76 2069 6e20 726d 732e 6974 656d   k,v in rms.item
-000047b0: 7328 293a 0d0a 2020 2020 2020 2020 2020  s():..          
-000047c0: 2020 2020 2020 2020 2020 2020 2020 726d                rm
-000047d0: 7373 5b6b 5d2e 6170 7065 6e64 2876 290d  ss[k].append(v).
-000047e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000047f0: 2020 2020 2070 7269 6e74 2822 5661 6c69       print("Vali
-00004800: 6461 7469 6f6e 2073 6574 3a20 436f 7272  dation set: Corr
-00004810: 203d 222c 2072 6d73 5b27 6363 275d 2c20   =", rms['cc'], 
-00004820: 2220 5232 203d 222c 2072 6d73 5b27 7232  " R2 =", rms['r2
-00004830: 275d 290d 0a20 2020 2020 2020 2020 2020  '])..           
-00004840: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00004850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004860: 7365 6c66 2e63 6d20 2b3d 2073 656c 662e  self.cm += self.
-00004870: 5f63 6f6e 6675 7369 6f6e 5f6d 6174 7269  _confusion_matri
-00004880: 7828 795f 7472 7565 2c20 795f 7072 6564  x(y_true, y_pred
-00004890: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000048a0: 2020 2020 2020 2072 6d73 203d 204e 6f6e         rms = Non
-000048b0: 650d 0a0d 0a20 2020 2020 2020 2020 2020  e....           
-000048c0: 2020 2020 2069 6620 636f 6c6c 6563 745f       if collect_
-000048d0: 7061 7474 6572 6e73 2061 6e64 2073 656c  patterns and sel
-000048e0: 662e 7363 6f70 6520 3d3d 2027 6c66 636e  f.scope == 'lfcn
-000048f0: 6e27 3a0d 0a20 2020 2020 2020 2020 2020  n':..           
-00004900: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
-00004910: 6c6c 6563 745f 7061 7474 6572 6e73 2866  llect_patterns(f
-00004920: 6f6c 643d 6a6a 2c20 6e5f 666f 6c64 733d  old=jj, n_folds=
-00004930: 6e5f 666f 6c64 732c 0d0a 2020 2020 2020  n_folds,..      
-00004940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004960: 2020 2020 6e5f 636f 6d70 3d69 6e74 2863      n_comp=int(c
-00004970: 6f6c 6c65 6374 5f70 6174 7465 726e 7329  ollect_patterns)
-00004980: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-00004990: 2020 2020 2069 6620 6a6a 203c 206e 5f66       if jj < n_f
-000049a0: 6f6c 6473 202d 313a 0d0a 2020 2020 2020  olds -1:..      
-000049b0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000049c0: 6c66 2e6b 6d2e 6c6f 6164 5f77 6569 6768  lf.km.load_weigh
-000049d0: 7473 286f 732e 7061 7468 2e6a 6f69 6e28  ts(os.path.join(
-000049e0: 7365 6c66 2e6d 6f64 656c 5f70 6174 682c  self.model_path,
-000049f0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00004a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a20: 2020 2020 2020 2020 2073 656c 662e 6d6f           self.mo
-00004a30: 6465 6c5f 6e61 6d65 202b 2027 696e 6974  del_name + 'init
-00004a40: 2e68 3527 2929 0d0a 2020 2020 2020 2020  .h5'))..        
-00004a50: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00004a60: 2e73 6875 6666 6c65 5f77 6569 6768 7473  .shuffle_weights
-00004a70: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00004a80: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00004a90: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00004aa0: 4e6f 7420 7368 7566 666c 696e 6720 7468  Not shuffling th
-00004ab0: 6520 7765 6967 6874 7320 666f 7220 7468  e weights for th
-00004ac0: 6520 6c61 7374 2066 6f6c 6422 0d0a 0d0a  e last fold"....
-00004ad0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00004ae0: 656c 662e 6461 7461 7365 742e 685f 7061  elf.dataset.h_pa
-00004af0: 7261 6d73 5b27 7461 7267 6574 5f74 7970  rams['target_typ
-00004b00: 6527 5d20 3d3d 2027 666c 6f61 7427 3a0d  e'] == 'float':.
-00004b10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004b20: 2072 6d73 203d 207b 6b3a 6e70 2e6d 6561   rms = {k:np.mea
-00004b30: 6e28 7629 2066 6f72 206b 2c20 7620 696e  n(v) for k, v in
-00004b40: 2072 6d73 732e 6974 656d 7328 297d 0d0a   rmss.items()}..
+000042e0: 2020 2020 2020 2020 2020 2020 2073 706c               spl
+000042f0: 6974 3d54 7275 652c 2076 616c 5f66 6f6c  it=True, val_fol
+00004300: 645f 696e 643d 3029 0d0a 0d0a 0d0a 2020  d_ind=0)......  
+00004310: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00004320: 6c66 2e74 5f68 6973 7420 3d20 7365 6c66  lf.t_hist = self
+00004330: 2e6b 6d2e 6669 7428 7472 6169 6e2c 0d0a  .km.fit(train,..
+00004340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004360: 2020 2076 616c 6964 6174 696f 6e5f 6461     validation_da
+00004370: 7461 3d76 616c 2c0d 0a20 2020 2020 2020  ta=val,..       
+00004380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004390: 2020 2020 2020 2020 2020 2020 6570 6f63              epoc
+000043a0: 6873 3d73 656c 662e 6d65 7461 2e74 7261  hs=self.meta.tra
+000043b0: 696e 5f70 6172 616d 735b 276e 5f65 706f  in_params['n_epo
+000043c0: 6368 7327 5d2c 200d 0a20 2020 2020 2020  chs'], ..       
+000043d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000043e0: 2020 2020 2020 2020 2020 2020 7374 6570              step
+000043f0: 735f 7065 725f 6570 6f63 683d 7365 6c66  s_per_epoch=self
+00004400: 2e6d 6574 612e 7472 6169 6e5f 7061 7261  .meta.train_para
+00004410: 6d73 5b27 6576 616c 5f73 7465 7027 5d2c  ms['eval_step'],
+00004420: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004440: 2020 2020 2073 6875 6666 6c65 3d54 7275       shuffle=Tru
+00004450: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00004460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004470: 2020 2020 2020 2076 616c 6964 6174 696f         validatio
+00004480: 6e5f 7374 6570 733d 7365 6c66 2e64 6174  n_steps=self.dat
+00004490: 6173 6574 2e76 616c 6964 6174 696f 6e5f  aset.validation_
+000044a0: 7374 6570 732c 0d0a 2020 2020 2020 2020  steps,..        
+000044b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000044c0: 2020 2020 2020 2020 2020 2063 616c 6c62             callb
+000044d0: 6163 6b73 3d5b 7374 6f70 5f65 6172 6c79  acks=[stop_early
+000044e0: 5d2c 2076 6572 626f 7365 3d32 2c0d 0a20  ], verbose=2,.. 
+000044f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004510: 2020 636c 6173 735f 7765 6967 6874 3d63    class_weight=c
+00004520: 6c61 7373 5f77 6569 6768 7473 290d 0a0d  lass_weights)...
+00004530: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+00004540: 2020 2074 6573 7420 3d20 7365 6c66 2e64     test = self.d
+00004550: 6174 6173 6574 2e5f 6275 696c 645f 6461  ataset._build_da
+00004560: 7461 7365 7428 7465 7374 5f73 7562 6a2c  taset(test_subj,
+00004570: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000045a0: 2020 2020 2074 6573 745f 6261 7463 683d       test_batch=
+000045b0: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2020  None,..         
+000045c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000045d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000045e0: 2020 2020 2020 2020 2020 7370 6c69 743d            split=
+000045f0: 4661 6c73 6529 0d0a 0d0a 2020 2020 2020  False)....      
+00004600: 2020 2020 2020 2020 2020 765f 6c6f 7373            v_loss
+00004610: 2c20 765f 6d65 7472 6963 203d 2073 656c  , v_metric = sel
+00004620: 662e 6576 616c 7561 7465 2876 616c 290d  f.evaluate(val).
+00004630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004640: 2074 5f6c 6f73 732c 2074 5f6d 6574 7269   t_loss, t_metri
+00004650: 6320 3d20 7365 6c66 2e65 7661 6c75 6174  c = self.evaluat
+00004660: 6528 7465 7374 290d 0a0d 0a20 2020 2020  e(test)....     
+00004670: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00004680: 2822 5375 626a 3a20 7b7d 204c 6f73 733a  ("Subj: {} Loss:
+00004690: 207b 3a2e 3466 7d2c 204d 6574 7269 633a   {:.4f}, Metric:
+000046a0: 207b 3a2e 3466 7d22 2e66 6f72 6d61 7428   {:.4f}".format(
+000046b0: 6a6a 2c20 745f 6c6f 7373 2c20 745f 6d65  jj, t_loss, t_me
+000046c0: 7472 6963 2929 0d0a 2020 2020 2020 2020  tric))..        
+000046d0: 2020 2020 2020 2020 7365 6c66 2e63 765f          self.cv_
+000046e0: 6c6f 7373 6573 2e61 7070 656e 6428 765f  losses.append(v_
+000046f0: 6c6f 7373 290d 0a20 2020 2020 2020 2020  loss)..         
+00004700: 2020 2020 2020 2073 656c 662e 6376 5f6d         self.cv_m
+00004710: 6574 7269 6373 2e61 7070 656e 6428 765f  etrics.append(v_
+00004720: 6d65 7472 6963 290d 0a20 2020 2020 2020  metric)..       
+00004730: 2020 2020 2020 2020 2073 656c 662e 6376           self.cv
+00004740: 5f74 6573 745f 6c6f 7373 6573 2e61 7070  _test_losses.app
+00004750: 656e 6428 745f 6c6f 7373 290d 0a20 2020  end(t_loss)..   
+00004760: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00004770: 662e 6376 5f74 6573 745f 6d65 7472 6963  f.cv_test_metric
+00004780: 732e 6170 7065 6e64 2874 5f6d 6574 7269  s.append(t_metri
+00004790: 6329 0d0a 0d0a 2020 2020 2020 2020 2020  c)....          
+000047a0: 2020 2020 2020 795f 7472 7565 2c20 795f        y_true, y_
+000047b0: 7072 6564 203d 2073 656c 662e 7072 6564  pred = self.pred
+000047c0: 6963 7428 7661 6c29 0d0a 2020 2020 2020  ict(val)..      
+000047d0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+000047e0: 662e 6461 7461 7365 742e 685f 7061 7261  f.dataset.h_para
+000047f0: 6d73 5b27 7461 7267 6574 5f74 7970 6527  ms['target_type'
+00004800: 5d20 3d3d 2027 666c 6f61 7427 3a0d 0a20  ] == 'float':.. 
+00004810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004820: 2020 2079 5f74 7275 652c 2079 5f70 7265     y_true, y_pre
+00004830: 6420 3d20 7365 6c66 2e70 7265 6469 6374  d = self.predict
+00004840: 2876 616c 290d 0a20 2020 2020 2020 2020  (val)..         
+00004850: 2020 2020 2020 2020 2020 2072 6d73 203d             rms =
+00004860: 2072 6567 7265 7373 696f 6e5f 6d65 7472   regression_metr
+00004870: 6963 7328 795f 7472 7565 2c20 795f 7072  ics(y_true, y_pr
+00004880: 6564 290d 0a20 2020 2020 2020 2020 2020  ed)..           
+00004890: 2020 2020 2020 2020 2066 6f72 206b 2c76           for k,v
+000048a0: 2069 6e20 726d 732e 6974 656d 7328 293a   in rms.items():
+000048b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000048c0: 2020 2020 2020 2020 2020 726d 7373 5b6b            rmss[k
+000048d0: 5d2e 6170 7065 6e64 2876 290d 0a20 2020  ].append(v)..   
+000048e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000048f0: 2070 7269 6e74 2822 5661 6c69 6461 7469   print("Validati
+00004900: 6f6e 2073 6574 3a20 436f 7272 203d 222c  on set: Corr =",
+00004910: 2072 6d73 5b27 6363 275d 2c20 2220 5232   rms['cc'], " R2
+00004920: 203d 222c 2072 6d73 5b27 7232 275d 290d   =", rms['r2']).
+00004930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004940: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00004950: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00004960: 2e63 6d20 2b3d 2073 656c 662e 5f63 6f6e  .cm += self._con
+00004970: 6675 7369 6f6e 5f6d 6174 7269 7828 795f  fusion_matrix(y_
+00004980: 7472 7565 2c20 795f 7072 6564 290d 0a20  true, y_pred).. 
+00004990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000049a0: 2020 2072 6d73 203d 204e 6f6e 650d 0a0d     rms = None...
+000049b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000049c0: 2069 6620 636f 6c6c 6563 745f 7061 7474   if collect_patt
+000049d0: 6572 6e73 2061 6e64 2073 656c 662e 7363  erns and self.sc
+000049e0: 6f70 6520 3d3d 2027 6c66 636e 6e27 3a0d  ope == 'lfcnn':.
+000049f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004a00: 2020 2020 2073 656c 662e 636f 6c6c 6563       self.collec
+00004a10: 745f 7061 7474 6572 6e73 2866 6f6c 643d  t_patterns(fold=
+00004a20: 6a6a 2c20 6e5f 666f 6c64 733d 6e5f 666f  jj, n_folds=n_fo
+00004a30: 6c64 732c 0d0a 2020 2020 2020 2020 2020  lds,..          
+00004a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004a60: 6e5f 636f 6d70 3d69 6e74 2863 6f6c 6c65  n_comp=int(colle
+00004a70: 6374 5f70 6174 7465 726e 7329 290d 0a0d  ct_patterns))...
+00004a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004a90: 2069 6620 6a6a 203c 206e 5f66 6f6c 6473   if jj < n_folds
+00004aa0: 202d 313a 0d0a 2020 2020 2020 2020 2020   -1:..          
+00004ab0: 2020 2020 2020 2020 2020 7365 6c66 2e6b            self.k
+00004ac0: 6d2e 6c6f 6164 5f77 6569 6768 7473 286f  m.load_weights(o
+00004ad0: 732e 7061 7468 2e6a 6f69 6e28 7365 6c66  s.path.join(self
+00004ae0: 2e6d 6f64 656c 5f70 6174 682c 200d 0a20  .model_path, .. 
+00004af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004b20: 2020 2020 2073 656c 662e 6d6f 6465 6c5f       self.model_
+00004b30: 6e61 6d65 202b 2027 696e 6974 2e68 3527  name + 'init.h5'
+00004b40: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
 00004b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004b60: 726d 732e 7570 6461 7465 287b 6b20 2b20  rms.update({k + 
-00004b70: 275f 7374 6427 3a6e 702e 7374 6428 7629  '_std':np.std(v)
-00004b80: 2066 6f72 206b 2c20 7620 696e 2072 6d73   for k, v in rms
-00004b90: 732e 6974 656d 7328 297d 290d 0a20 2020  s.items()})..   
-00004ba0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00004bb0: 6e74 2822 5661 6c69 6461 7469 6f6e 2073  nt("Validation s
-00004bc0: 6574 3a20 436f 7272 203a 207b 3a2e 3366  et: Corr : {:.3f
-00004bd0: 7d20 2b2f 2d20 7b3a 2e33 667d 2e20 5c0d  } +/- {:.3f}. \.
-00004be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004bf0: 2020 2020 2020 2052 5e32 3a20 7b3a 2e33         R^2: {:.3
-00004c00: 667d 202b 2f2d 207b 3a2e 3366 7d22 2e66  f} +/- {:.3f}".f
-00004c10: 6f72 6d61 7428 0d0a 2020 2020 2020 2020  ormat(..        
-00004c20: 2020 2020 2020 2020 2020 2020 2020 726d                rm
-00004c30: 735b 2763 6327 5d2c 2072 6d73 5b27 6363  s['cc'], rms['cc
-00004c40: 5f73 7464 275d 2c20 726d 735b 2772 3227  _std'], rms['r2'
-00004c50: 5d2c 2072 6d73 5b27 7232 5f73 7464 275d  ], rms['r2_std']
-00004c60: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-00004c70: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00004c80: 2020 2020 2020 2072 6d73 203d 204e 6f6e         rms = Non
-00004c90: 650d 0a0d 0a20 2020 2020 2020 2020 2020  e....           
-00004ca0: 2023 7365 6c66 2e75 7064 6174 655f 6c6f   #self.update_lo
-00004cb0: 6728 726d 732c 2070 7265 6669 783d 276c  g(rms, prefix='l
-00004cc0: 6f73 6f5f 2729 0d0a 0d0a 2020 2020 2020  oso_')....      
-00004cd0: 2020 7072 696e 7428 2222 227b 7d20 7769    print("""{} wi
-00004ce0: 7468 207b 7d20 666f 6c64 2873 2920 636f  th {} fold(s) co
-00004cf0: 6d70 6c65 7465 642e 205c 6e0d 0a20 2020  mpleted. \n..   
-00004d00: 2020 2020 2020 2020 2020 2056 616c 6964             Valid
-00004d10: 6174 696f 6e20 5065 7266 6f72 6d61 6e63  ation Performanc
-00004d20: 653a 200d 0a20 2020 2020 2020 2020 2020  e: ..           
-00004d30: 2020 204c 6f73 733a 207b 3a2e 3466 7d20     Loss: {:.4f} 
-00004d40: 2b2f 2d20 7b3a 2e34 667d 2e0d 0a20 2020  +/- {:.4f}...   
-00004d50: 2020 2020 2020 2020 2020 204d 6574 7269             Metri
-00004d60: 633a 207b 3a2e 3466 7d20 2b2f 2d20 7b3a  c: {:.4f} +/- {:
-00004d70: 2e34 667d 2222 220d 0a20 2020 2020 2020  .4f}"""..       
-00004d80: 2020 2020 2020 202e 666f 726d 6174 286d         .format(m
-00004d90: 6f64 652c 206e 5f66 6f6c 6473 2c0d 0a20  ode, n_folds,.. 
-00004da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004db0: 2020 2020 206e 702e 6d65 616e 2873 656c       np.mean(sel
-00004dc0: 662e 6376 5f6c 6f73 7365 7329 2c20 6e70  f.cv_losses), np
-00004dd0: 2e73 7464 2873 656c 662e 6376 5f6c 6f73  .std(self.cv_los
-00004de0: 7365 7329 2c0d 0a20 2020 2020 2020 2020  ses),..         
-00004df0: 2020 2020 2020 2020 2020 2020 206e 702e               np.
-00004e00: 6d65 616e 2873 656c 662e 6376 5f6d 6574  mean(self.cv_met
-00004e10: 7269 6373 292c 206e 702e 7374 6428 7365  rics), np.std(se
-00004e20: 6c66 2e63 765f 6d65 7472 6963 7329 2929  lf.cv_metrics)))
-00004e30: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-00004e40: 2020 2020 6966 206c 656e 2873 656c 662e      if len(self.
-00004e50: 6461 7461 7365 742e 685f 7061 7261 6d73  dataset.h_params
-00004e60: 5b27 7465 7374 5f70 6174 6873 275d 2920  ['test_paths']) 
-00004e70: 3e20 303a 0d0a 2020 2020 2020 2020 2020  > 0:..          
-00004e80: 2020 7072 696e 7428 2222 225c 6e0d 0a20    print("""\n.. 
-00004e90: 2020 2020 2020 2020 2020 2020 2054 6573               Tes
-00004ea0: 7420 5065 7266 6f72 6d61 6e63 653a 200d  t Performance: .
-00004eb0: 0a20 2020 2020 2020 2020 2020 2020 204c  .              L
-00004ec0: 6f73 733a 207b 3a2e 3466 7d20 2b2f 2d20  oss: {:.4f} +/- 
-00004ed0: 7b3a 2e34 667d 2e0d 0a20 2020 2020 2020  {:.4f}...       
-00004ee0: 2020 2020 2020 204d 6574 7269 633a 207b         Metric: {
-00004ef0: 3a2e 3466 7d20 2b2f 2d20 7b3a 2e34 667d  :.4f} +/- {:.4f}
-00004f00: 2222 220d 0a20 2020 2020 2020 2020 2020  """..           
-00004f10: 2020 202e 666f 726d 6174 286e 702e 6d65     .format(np.me
-00004f20: 616e 2873 656c 662e 6376 5f74 6573 745f  an(self.cv_test_
-00004f30: 6c6f 7373 6573 292c 200d 0a20 2020 2020  losses), ..     
-00004f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004f50: 206e 702e 7374 6428 7365 6c66 2e63 765f   np.std(self.cv_
-00004f60: 7465 7374 5f6c 6f73 7365 7329 2c0d 0a20  test_losses),.. 
-00004f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004f80: 2020 2020 206e 702e 6d65 616e 2873 656c       np.mean(sel
-00004f90: 662e 6376 5f74 6573 745f 6d65 7472 6963  f.cv_test_metric
-00004fa0: 7329 2c20 0d0a 2020 2020 2020 2020 2020  s), ..          
-00004fb0: 2020 2020 2020 2020 2020 2020 6e70 2e73              np.s
-00004fc0: 7464 2873 656c 662e 6376 5f74 6573 745f  td(self.cv_test_
-00004fd0: 6d65 7472 6963 7329 2929 0d0a 2020 2020  metrics)))..    
-00004fe0: 2020 2020 0d0a 2020 2020 2020 2020 7365      ..        se
-00004ff0: 6c66 2e6d 6574 612e 7472 6169 6e5f 7061  lf.meta.train_pa
-00005000: 7261 6d73 2e75 7064 6174 6528 7b22 7472  rams.update({"tr
-00005010: 6169 6e65 6422 3a54 7275 657d 290d 0a20  ained":True}).. 
-00005020: 2020 2020 2020 2073 656c 662e 7570 6461         self.upda
-00005030: 7465 5f6c 6f67 2872 6d73 3d72 6d73 2c20  te_log(rms=rms, 
-00005040: 7072 6566 6978 3d6d 6f64 6529 2020 2020  prefix=mode)    
-00005050: 0d0a 2020 2020 2020 2020 2372 6574 7572  ..        #retur
-00005060: 6e20 7365 6c66 2e63 765f 6c6f 7373 6573  n self.cv_losses
-00005070: 2c20 7365 6c66 2e63 765f 6d65 7472 6963  , self.cv_metric
-00005080: 730d 0a0d 0a0d 0a20 2020 2064 6566 2070  s......    def p
-00005090: 7275 6e65 5f77 6569 6768 7473 2873 656c  rune_weights(sel
-000050a0: 662c 2069 6e63 7265 6173 655f 7265 6775  f, increase_regu
-000050b0: 6c61 7269 7a61 7469 6f6e 3d33 2e29 3a0d  larization=3.):.
-000050c0: 0a20 2020 2020 2020 2073 746f 705f 6561  .        stop_ea
-000050d0: 726c 7920 3d20 7466 2e6b 6572 6173 2e63  rly = tf.keras.c
-000050e0: 616c 6c62 6163 6b73 2e45 6172 6c79 5374  allbacks.EarlySt
-000050f0: 6f70 7069 6e67 286d 6f6e 6974 6f72 3d27  opping(monitor='
-00005100: 7661 6c5f 6c6f 7373 272c 0d0a 2020 2020  val_loss',..    
+00004b60: 2020 2020 2020 2020 2020 2020 2073 6b69               ski
+00004b70: 705f 6d69 736d 6174 6368 3d54 7275 6529  p_mismatch=True)
+00004b80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004b90: 2020 2020 2020 7365 6c66 2e73 6875 6666        self.shuff
+00004ba0: 6c65 5f77 6569 6768 7473 2829 0d0a 2020  le_weights()..  
+00004bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004bc0: 2020 7374 6f70 5f65 6172 6c79 2e62 6573    stop_early.bes
+00004bd0: 7420 3d20 6e70 2e49 6e66 0d0a 2020 2020  t = np.Inf..    
+00004be0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00004bf0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00004c00: 2020 2020 2020 2022 4e6f 7420 7368 7566         "Not shuf
+00004c10: 666c 696e 6720 7468 6520 7765 6967 6874  fling the weight
+00004c20: 7320 666f 7220 7468 6520 6c61 7374 2066  s for the last f
+00004c30: 6f6c 6422 0d0a 0d0a 2020 2020 2020 2020  old"....        
+00004c40: 2020 2020 6966 2073 656c 662e 6461 7461      if self.data
+00004c50: 7365 742e 685f 7061 7261 6d73 5b27 7461  set.h_params['ta
+00004c60: 7267 6574 5f74 7970 6527 5d20 3d3d 2027  rget_type'] == '
+00004c70: 666c 6f61 7427 3a0d 0a20 2020 2020 2020  float':..       
+00004c80: 2020 2020 2020 2020 2072 6d73 203d 207b           rms = {
+00004c90: 6b3a 6e70 2e6d 6561 6e28 7629 2066 6f72  k:np.mean(v) for
+00004ca0: 206b 2c20 7620 696e 2072 6d73 732e 6974   k, v in rmss.it
+00004cb0: 656d 7328 297d 0d0a 2020 2020 2020 2020  ems()}..        
+00004cc0: 2020 2020 2020 2020 726d 732e 7570 6461          rms.upda
+00004cd0: 7465 287b 6b20 2b20 275f 7374 6427 3a6e  te({k + '_std':n
+00004ce0: 702e 7374 6428 7629 2066 6f72 206b 2c20  p.std(v) for k, 
+00004cf0: 7620 696e 2072 6d73 732e 6974 656d 7328  v in rmss.items(
+00004d00: 297d 290d 0a20 2020 2020 2020 2020 2020  )})..           
+00004d10: 2020 2020 2070 7269 6e74 2822 5661 6c69       print("Vali
+00004d20: 6461 7469 6f6e 2073 6574 3a20 436f 7272  dation set: Corr
+00004d30: 203a 207b 3a2e 3366 7d20 2b2f 2d20 7b3a   : {:.3f} +/- {:
+00004d40: 2e33 667d 2e20 5c0d 0a20 2020 2020 2020  .3f}. \..       
+00004d50: 2020 2020 2020 2020 2020 2020 2020 2052                 R
+00004d60: 5e32 3a20 7b3a 2e33 667d 202b 2f2d 207b  ^2: {:.3f} +/- {
+00004d70: 3a2e 3366 7d22 2e66 6f72 6d61 7428 0d0a  :.3f}".format(..
+00004d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004d90: 2020 2020 2020 726d 735b 2763 6327 5d2c        rms['cc'],
+00004da0: 2072 6d73 5b27 6363 5f73 7464 275d 2c20   rms['cc_std'], 
+00004db0: 726d 735b 2772 3227 5d2c 2072 6d73 5b27  rms['r2'], rms['
+00004dc0: 7232 5f73 7464 275d 2929 0d0a 2020 2020  r2_std']))..    
+00004dd0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00004de0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00004df0: 6d73 203d 204e 6f6e 650d 0a0d 0a20 2020  ms = None....   
+00004e00: 2020 2020 2020 2020 2023 7365 6c66 2e75           #self.u
+00004e10: 7064 6174 655f 6c6f 6728 726d 732c 2070  pdate_log(rms, p
+00004e20: 7265 6669 783d 276c 6f73 6f5f 2729 0d0a  refix='loso_')..
+00004e30: 0d0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
+00004e40: 2222 227b 7d20 7769 7468 207b 7d20 666f  """{} with {} fo
+00004e50: 6c64 2873 2920 636f 6d70 6c65 7465 642e  ld(s) completed.
+00004e60: 205c 6e0d 0a20 2020 2020 2020 2020 2020   \n..           
+00004e70: 2020 2056 616c 6964 6174 696f 6e20 5065     Validation Pe
+00004e80: 7266 6f72 6d61 6e63 653a 200d 0a20 2020  rformance: ..   
+00004e90: 2020 2020 2020 2020 2020 204c 6f73 733a             Loss:
+00004ea0: 207b 3a2e 3466 7d20 2b2f 2d20 7b3a 2e34   {:.4f} +/- {:.4
+00004eb0: 667d 2e0d 0a20 2020 2020 2020 2020 2020  f}...           
+00004ec0: 2020 204d 6574 7269 633a 207b 3a2e 3466     Metric: {:.4f
+00004ed0: 7d20 2b2f 2d20 7b3a 2e34 667d 2222 220d  } +/- {:.4f}""".
+00004ee0: 0a20 2020 2020 2020 2020 2020 2020 202e  .              .
+00004ef0: 666f 726d 6174 286d 6f64 652c 206e 5f66  format(mode, n_f
+00004f00: 6f6c 6473 2c0d 0a20 2020 2020 2020 2020  olds,..         
+00004f10: 2020 2020 2020 2020 2020 2020 206e 702e               np.
+00004f20: 6d65 616e 2873 656c 662e 6376 5f6c 6f73  mean(self.cv_los
+00004f30: 7365 7329 2c20 6e70 2e73 7464 2873 656c  ses), np.std(sel
+00004f40: 662e 6376 5f6c 6f73 7365 7329 2c0d 0a20  f.cv_losses),.. 
+00004f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004f60: 2020 2020 206e 702e 6d65 616e 2873 656c       np.mean(sel
+00004f70: 662e 6376 5f6d 6574 7269 6373 292c 206e  f.cv_metrics), n
+00004f80: 702e 7374 6428 7365 6c66 2e63 765f 6d65  p.std(self.cv_me
+00004f90: 7472 6963 7329 2929 0d0a 2020 2020 2020  trics)))..      
+00004fa0: 2020 0d0a 2020 2020 2020 2020 6966 206c    ..        if l
+00004fb0: 656e 2873 656c 662e 6461 7461 7365 742e  en(self.dataset.
+00004fc0: 685f 7061 7261 6d73 5b27 7465 7374 5f70  h_params['test_p
+00004fd0: 6174 6873 275d 2920 3e20 303a 0d0a 2020  aths']) > 0:..  
+00004fe0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00004ff0: 2222 225c 6e0d 0a20 2020 2020 2020 2020  """\n..         
+00005000: 2020 2020 2054 6573 7420 5065 7266 6f72       Test Perfor
+00005010: 6d61 6e63 653a 200d 0a20 2020 2020 2020  mance: ..       
+00005020: 2020 2020 2020 204c 6f73 733a 207b 3a2e         Loss: {:.
+00005030: 3466 7d20 2b2f 2d20 7b3a 2e34 667d 2e0d  4f} +/- {:.4f}..
+00005040: 0a20 2020 2020 2020 2020 2020 2020 204d  .              M
+00005050: 6574 7269 633a 207b 3a2e 3466 7d20 2b2f  etric: {:.4f} +/
+00005060: 2d20 7b3a 2e34 667d 2222 220d 0a20 2020  - {:.4f}"""..   
+00005070: 2020 2020 2020 2020 2020 202e 666f 726d             .form
+00005080: 6174 286e 702e 6d65 616e 2873 656c 662e  at(np.mean(self.
+00005090: 6376 5f74 6573 745f 6c6f 7373 6573 292c  cv_test_losses),
+000050a0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+000050b0: 2020 2020 2020 2020 206e 702e 7374 6428           np.std(
+000050c0: 7365 6c66 2e63 765f 7465 7374 5f6c 6f73  self.cv_test_los
+000050d0: 7365 7329 2c0d 0a20 2020 2020 2020 2020  ses),..         
+000050e0: 2020 2020 2020 2020 2020 2020 206e 702e               np.
+000050f0: 6d65 616e 2873 656c 662e 6376 5f74 6573  mean(self.cv_tes
+00005100: 745f 6d65 7472 6963 7329 2c20 0d0a 2020  t_metrics), ..  
 00005110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005140: 2020 6d69 6e5f 6465 6c74 613d 3165 2d36    min_delta=1e-6
-00005150: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00005160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005180: 2020 2020 2020 2020 2070 6174 6965 6e63           patienc
-00005190: 653d 3130 2c0d 0a20 2020 2020 2020 2020  e=10,..         
-000051a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000051b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000051c0: 2020 2020 2020 2020 2020 2020 2072 6573               res
-000051d0: 746f 7265 5f62 6573 745f 7765 6967 6874  tore_best_weight
-000051e0: 733d 5472 7565 290d 0a20 2020 2020 2020  s=True)..       
-000051f0: 2073 656c 662e 7261 7465 203d 2030 0d0a   self.rate = 0..
-00005200: 2020 2020 2020 2020 7365 6c66 2e73 7065          self.spe
-00005210: 6373 5b22 6c31 5f6c 616d 6264 6122 5d20  cs["l1_lambda"] 
-00005220: 2a3d 2069 6e63 7265 6173 655f 7265 6775  *= increase_regu
-00005230: 6c61 7269 7a61 7469 6f6e 0d0a 2020 2020  larization..    
-00005240: 2020 2020 7365 6c66 2e73 7065 6373 5b22      self.specs["
-00005250: 6c32 5f6c 616d 6264 6122 5d20 2a3d 2069  l2_lambda"] *= i
-00005260: 6e63 7265 6173 655f 7265 6775 6c61 7269  ncrease_regulari
-00005270: 7a61 7469 6f6e 0d0a 2020 2020 2020 2020  zation..        
-00005280: 7072 696e 7428 2750 7275 6e69 6e67 2077  print('Pruning w
-00005290: 6569 6768 7473 2729 0d0a 2020 2020 2020  eights')..      
-000052a0: 2020 7365 6c66 2e74 5f68 6973 745f 7020    self.t_hist_p 
-000052b0: 3d20 7365 6c66 2e6b 6d2e 6669 7428 7365  = self.km.fit(se
-000052c0: 6c66 2e64 6174 6173 6574 2e74 7261 696e  lf.dataset.train
-000052d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00005120: 2020 2020 6e70 2e73 7464 2873 656c 662e      np.std(self.
+00005130: 6376 5f74 6573 745f 6d65 7472 6963 7329  cv_test_metrics)
+00005140: 2929 0d0a 2020 2020 2020 2020 0d0a 2020  ))..        ..  
+00005150: 2020 2020 2020 7365 6c66 2e6d 6574 612e        self.meta.
+00005160: 7472 6169 6e5f 7061 7261 6d73 2e75 7064  train_params.upd
+00005170: 6174 6528 7b22 7472 6169 6e65 6422 3a54  ate({"trained":T
+00005180: 7275 657d 290d 0a20 2020 2020 2020 2073  rue})..        s
+00005190: 656c 662e 7570 6461 7465 5f6c 6f67 2872  elf.update_log(r
+000051a0: 6d73 3d72 6d73 2c20 7072 6566 6978 3d6d  ms=rms, prefix=m
+000051b0: 6f64 6529 2020 2020 0d0a 2020 2020 2020  ode)    ..      
+000051c0: 2020 2372 6574 7572 6e20 7365 6c66 2e63    #return self.c
+000051d0: 765f 6c6f 7373 6573 2c20 7365 6c66 2e63  v_losses, self.c
+000051e0: 765f 6d65 7472 6963 730d 0a0d 0a0d 0a20  v_metrics...... 
+000051f0: 2020 2064 6566 2070 7275 6e65 5f77 6569     def prune_wei
+00005200: 6768 7473 2873 656c 662c 2069 6e63 7265  ghts(self, incre
+00005210: 6173 655f 7265 6775 6c61 7269 7a61 7469  ase_regularizati
+00005220: 6f6e 3d33 2e29 3a0d 0a20 2020 2020 2020  on=3.):..       
+00005230: 2073 746f 705f 6561 726c 7920 3d20 7466   stop_early = tf
+00005240: 2e6b 6572 6173 2e63 616c 6c62 6163 6b73  .keras.callbacks
+00005250: 2e45 6172 6c79 5374 6f70 7069 6e67 286d  .EarlyStopping(m
+00005260: 6f6e 6974 6f72 3d27 7661 6c5f 6c6f 7373  onitor='val_loss
+00005270: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
+00005280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000052a0: 2020 2020 2020 2020 2020 6d69 6e5f 6465            min_de
+000052b0: 6c74 613d 3165 2d36 2c0d 0a20 2020 2020  lta=1e-6,..     
+000052c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000052d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000052e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000052f0: 2020 7661 6c69 6461 7469 6f6e 5f64 6174    validation_dat
-00005300: 613d 7365 6c66 2e64 6174 6173 6574 2e76  a=self.dataset.v
-00005310: 616c 2c0d 0a20 2020 2020 2020 2020 2020  al,..           
+000052f0: 2070 6174 6965 6e63 653d 3130 2c0d 0a20   patience=10,.. 
+00005300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005310: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00005320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005330: 2020 2020 6570 6f63 6873 3d33 302c 2073      epochs=30, s
-00005340: 7465 7073 5f70 6572 5f65 706f 6368 3d73  teps_per_epoch=s
-00005350: 656c 662e 6d65 7461 2e74 7261 696e 5f70  elf.meta.train_p
-00005360: 6172 616d 735b 2765 7661 6c5f 7374 6570  arams['eval_step
-00005370: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
-00005380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005390: 2020 2020 7368 7566 666c 653d 5472 7565      shuffle=True
-000053a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000053b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000053c0: 2020 7661 6c69 6461 7469 6f6e 5f73 7465    validation_ste
-000053d0: 7073 3d73 656c 662e 6461 7461 7365 742e  ps=self.dataset.
-000053e0: 7661 6c69 6461 7469 6f6e 5f73 7465 7073  validation_steps
-000053f0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00005400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005410: 2020 6361 6c6c 6261 636b 733d 5b73 746f    callbacks=[sto
-00005420: 705f 6561 726c 795d 2c20 7665 7262 6f73  p_early], verbos
-00005430: 653d 3229 0d0a 0d0a 2020 2020 6465 6620  e=2)....    def 
-00005440: 7368 7566 666c 655f 7765 6967 6874 7328  shuffle_weights(
-00005450: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-00005460: 7072 696e 7428 2252 652d 7368 7566 666c  print("Re-shuffl
-00005470: 696e 6720 7765 6967 6874 7320 6265 7477  ing weights betw
-00005480: 6565 6e20 666f 6c64 7322 290d 0a20 2020  een folds")..   
-00005490: 2020 2020 2077 6569 6768 7473 203d 2073       weights = s
-000054a0: 656c 662e 6b6d 2e67 6574 5f77 6569 6768  elf.km.get_weigh
-000054b0: 7473 2829 0d0a 2020 2020 2020 2020 7765  ts()..        we
-000054c0: 6967 6874 7320 3d20 5b6e 702e 7261 6e64  ights = [np.rand
-000054d0: 6f6d 2e70 6572 6d75 7461 7469 6f6e 2877  om.permutation(w
-000054e0: 2e66 6c61 7429 2e72 6573 6861 7065 2877  .flat).reshape(w
-000054f0: 2e73 6861 7065 2920 666f 7220 7720 696e  .shape) for w in
-00005500: 2077 6569 6768 7473 5d0d 0a20 2020 2020   weights]..     
-00005510: 2020 2073 656c 662e 6b6d 2e73 6574 5f77     self.km.set_w
-00005520: 6569 6768 7473 2877 6569 6768 7473 290d  eights(weights).
-00005530: 0a0d 0a0d 0a20 2020 2023 2064 6566 2072  .....    # def r
-00005540: 6569 6e69 7469 616c 697a 655f 7765 6967  einitialize_weig
-00005550: 6874 7328 7365 6c66 293a 0d0a 2020 2020  hts(self):..    
-00005560: 2320 2020 2020 7365 7373 696f 6e20 3d20  #     session = 
-00005570: 4b2e 6765 745f 7365 7373 696f 6e28 290d  K.get_session().
-00005580: 0a20 2020 2023 2020 2020 2070 7269 6e74  .    #     print
-00005590: 2822 5265 2d69 6e69 7469 616c 697a 696e  ("Re-initializin
-000055a0: 6720 7765 6967 6874 7322 290d 0a20 2020  g weights")..   
-000055b0: 2023 2020 2020 2066 6f72 206c 6179 6572   #     for layer
-000055c0: 2069 6e20 7365 6c66 2e6b 6d2e 6c61 7965   in self.km.laye
-000055d0: 7273 3a20 0d0a 2020 2020 2320 2020 2020  rs: ..    #     
-000055e0: 2020 2020 6966 2068 6173 6174 7472 286c      if hasattr(l
-000055f0: 6179 6572 2c20 276b 6572 6e65 6c5f 696e  ayer, 'kernel_in
-00005600: 6974 6961 6c69 7a65 7227 293a 0d0a 2020  itializer'):..  
-00005610: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00005620: 6c61 7965 722e 6b65 726e 656c 2e69 6e69  layer.kernel.ini
-00005630: 7469 616c 697a 6572 2e72 756e 2873 6573  tializer.run(ses
-00005640: 7369 6f6e 3d73 6573 7369 6f6e 290d 0a20  sion=session).. 
-00005650: 2020 2023 2020 2020 2020 2020 2069 6620     #         if 
-00005660: 6861 7361 7474 7228 6c61 7965 722c 2027  hasattr(layer, '
-00005670: 6269 6173 5f69 6e69 7469 616c 697a 6572  bias_initializer
-00005680: 2729 3a0d 0a20 2020 2023 2020 2020 2020  '):..    #      
-00005690: 2020 2020 2020 206c 6179 6572 2e62 6961         layer.bia
-000056a0: 732e 696e 6974 6961 6c69 7a65 722e 7275  s.initializer.ru
-000056b0: 6e28 7365 7373 696f 6e3d 7365 7373 696f  n(session=sessio
-000056c0: 6e29 0d0a 2020 2020 2020 2020 2020 2020  n)..            
-000056d0: 2020 2020 0d0a 0d0a 2020 2020 6465 6620      ....    def 
-000056e0: 706c 6f74 5f68 6973 7428 7365 6c66 293a  plot_hist(self):
-000056f0: 0d0a 2020 2020 2020 2020 2222 2250 6c6f  ..        """Plo
-00005700: 7420 6c6f 7373 2068 6973 746f 7279 2064  t loss history d
-00005710: 7572 696e 6720 7472 6169 6e69 6e67 2e22  uring training."
-00005720: 2222 0d0a 2020 2020 2020 2020 706c 742e  ""..        plt.
-00005730: 706c 6f74 2873 656c 662e 745f 6869 7374  plot(self.t_hist
-00005740: 2e68 6973 746f 7279 5b27 6c6f 7373 275d  .history['loss']
-00005750: 290d 0a20 2020 2020 2020 2070 6c74 2e70  )..        plt.p
-00005760: 6c6f 7428 7365 6c66 2e74 5f68 6973 742e  lot(self.t_hist.
-00005770: 6869 7374 6f72 795b 2776 616c 5f6c 6f73  history['val_los
-00005780: 7327 5d29 0d0a 2020 2020 2020 2020 706c  s'])..        pl
-00005790: 742e 7469 746c 6528 276d 6f64 656c 206c  t.title('model l
-000057a0: 6f73 7327 290d 0a20 2020 2020 2020 2070  oss')..        p
-000057b0: 6c74 2e79 6c61 6265 6c28 276c 6f73 7327  lt.ylabel('loss'
-000057c0: 290d 0a20 2020 2020 2020 2070 6c74 2e78  )..        plt.x
-000057d0: 6c61 6265 6c28 2765 706f 6368 2729 0d0a  label('epoch')..
-000057e0: 2020 2020 2020 2020 706c 742e 6c65 6765          plt.lege
-000057f0: 6e64 285b 2774 7261 696e 272c 2027 7661  nd(['train', 'va
-00005800: 6c69 6461 7469 6f6e 275d 2c20 6c6f 633d  lidation'], loc=
-00005810: 2775 7070 6572 206c 6566 7427 290d 0a20  'upper left').. 
-00005820: 2020 2020 2020 2070 6c74 2e73 686f 7728         plt.show(
-00005830: 290d 0a0d 0a20 2020 2064 6566 205f 636f  )....    def _co
-00005840: 6e66 7573 696f 6e5f 6d61 7472 6978 2873  nfusion_matrix(s
-00005850: 656c 662c 2079 5f74 7275 652c 2079 5f70  elf, y_true, y_p
-00005860: 7265 6429 3a0d 0a20 2020 2020 2020 2022  red):..        "
-00005870: 2222 436f 6d70 7574 6520 756e 6e6f 726d  ""Compute unnorm
-00005880: 616c 697a 6577 6420 636f 6e66 7573 696f  alizewd confusio
-00005890: 6e20 6d61 7472 6978 2222 220d 0a20 2020  n matrix"""..   
-000058a0: 2020 2020 2079 5f70 203d 205f 6f6e 6568       y_p = _oneh
-000058b0: 6f74 286e 702e 6172 676d 6178 2879 5f70  ot(np.argmax(y_p
-000058c0: 7265 642c 3129 2c20 6e5f 636c 6173 7365  red,1), n_classe
-000058d0: 733d 7365 6c66 2e79 5f73 6861 7065 5b2d  s=self.y_shape[-
-000058e0: 315d 290d 0a20 2020 2020 2020 2063 6d20  1])..        cm 
-000058f0: 3d20 6e70 2e64 6f74 2879 5f70 2e54 2c20  = np.dot(y_p.T, 
-00005900: 795f 7472 7565 290d 0a20 2020 2020 2020  y_true)..       
-00005910: 2072 6574 7572 6e20 636d 0d0a 2020 2020   return cm..    
-00005920: 0d0a 2020 2020 6465 6620 7570 6461 7465  ..    def update
-00005930: 5f72 6573 756c 7473 2873 656c 6629 3a0d  _results(self):.
-00005940: 0a20 2020 2020 2020 2072 6573 756c 7473  .        results
-00005950: 203d 2064 6963 7428 290d 0a20 2020 2020   = dict()..     
-00005960: 2020 2072 6573 756c 7473 5b27 765f 6d65     results['v_me
-00005970: 7472 6963 275d 203d 206e 702e 6d65 616e  tric'] = np.mean
-00005980: 2873 656c 662e 6376 5f6d 6574 7269 6373  (self.cv_metrics
-00005990: 290d 0a20 2020 2020 2020 2072 6573 756c  )..        resul
-000059a0: 7473 5b27 765f 6c6f 7373 275d 203d 206e  ts['v_loss'] = n
-000059b0: 702e 6d65 616e 2873 656c 662e 6376 5f6c  p.mean(self.cv_l
-000059c0: 6f73 7365 7329 0d0a 2020 2020 2020 2020  osses)..        
-000059d0: 7265 7375 6c74 735b 2763 765f 6d65 7472  results['cv_metr
-000059e0: 6963 7327 5d20 3d20 7365 6c66 2e63 765f  ics'] = self.cv_
-000059f0: 6d65 7472 6963 730d 0a20 2020 2020 2020  metrics..       
-00005a00: 2072 6573 756c 7473 5b27 6376 5f6c 6f73   results['cv_los
-00005a10: 7365 7327 5d20 3d20 7365 6c66 2e63 765f  ses'] = self.cv_
-00005a20: 6c6f 7373 6573 0d0a 2020 2020 2020 2020  losses..        
-00005a30: 0d0a 2020 2020 2020 2020 7472 5f6c 6f73  ..        tr_los
-00005a40: 732c 2074 725f 6d65 7472 6963 203d 2073  s, tr_metric = s
-00005a50: 656c 662e 6576 616c 7561 7465 2873 656c  elf.evaluate(sel
-00005a60: 662e 6461 7461 7365 742e 7472 6169 6e29  f.dataset.train)
-00005a70: 0d0a 2020 2020 2020 2020 7265 7375 6c74  ..        result
-00005a80: 735b 2774 725f 6d65 7472 6963 275d 203d  s['tr_metric'] =
-00005a90: 2074 725f 6d65 7472 6963 0d0a 2020 2020   tr_metric..    
-00005aa0: 2020 2020 7265 7375 6c74 735b 2774 725f      results['tr_
-00005ab0: 6c6f 7373 275d 203d 2074 725f 6c6f 7373  loss'] = tr_loss
-00005ac0: 0d0a 0d0a 0d0a 2020 2020 2020 2020 6966  ......        if
-00005ad0: 206c 656e 2873 656c 662e 6461 7461 7365   len(self.datase
-00005ae0: 742e 685f 7061 7261 6d73 5b27 7465 7374  t.h_params['test
-00005af0: 5f70 6174 6873 275d 2920 3e20 303a 0d0a  _paths']) > 0:..
-00005b00: 2020 2020 2020 2020 2020 2020 745f 6c6f              t_lo
-00005b10: 7373 203d 206e 702e 6d65 616e 2873 656c  ss = np.mean(sel
-00005b20: 662e 6376 5f74 6573 745f 6c6f 7373 6573  f.cv_test_losses
-00005b30: 290d 0a20 2020 2020 2020 2020 2020 2074  )..            t
-00005b40: 5f6d 6574 7269 6320 3d20 6e70 2e6d 6561  _metric = np.mea
-00005b50: 6e28 7365 6c66 2e63 765f 7465 7374 5f6d  n(self.cv_test_m
-00005b60: 6574 7269 6373 290d 0a20 2020 2020 2020  etrics)..       
-00005b70: 2020 2020 2069 6620 7365 6c66 2e64 6174       if self.dat
-00005b80: 6173 6574 2e68 5f70 6172 616d 735b 2774  aset.h_params['t
-00005b90: 6172 6765 745f 7479 7065 275d 203d 3d20  arget_type'] == 
-00005ba0: 2766 6c6f 6174 273a 0d0a 2020 2020 2020  'float':..      
-00005bb0: 2020 2020 2020 2020 2020 795f 7472 7565            y_true
-00005bc0: 2c20 795f 7072 6564 203d 2073 656c 662e  , y_pred = self.
-00005bd0: 7072 6564 6963 7428 7365 6c66 2e64 6174  predict(self.dat
-00005be0: 6173 6574 2e68 5f70 6172 616d 735b 2774  aset.h_params['t
-00005bf0: 6573 745f 7061 7468 7327 5d29 0d0a 2020  est_paths'])..  
-00005c00: 2020 2020 2020 2020 2020 2020 2020 726d                rm
-00005c10: 735f 7465 7374 203d 2072 6567 7265 7373  s_test = regress
-00005c20: 696f 6e5f 6d65 7472 6963 7328 795f 7472  ion_metrics(y_tr
-00005c30: 7565 2c20 795f 7072 6564 290d 0a20 2020  ue, y_pred)..   
-00005c40: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00005c50: 6e74 2822 5465 7374 2073 6574 3a20 436f  nt("Test set: Co
-00005c60: 7272 203d 222c 2072 6d73 5f74 6573 745b  rr =", rms_test[
-00005c70: 2763 6327 5d2c 2022 5232 203d 222c 2072  'cc'], "R2 =", r
-00005c80: 6d73 5f74 6573 745b 2772 3227 5d29 0d0a  ms_test['r2'])..
-00005c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005ca0: 7265 7375 6c74 732e 7570 6461 7465 287b  results.update({
-00005cb0: 2774 6573 745f 272b 6b3a 7620 666f 7220  'test_'+k:v for 
-00005cc0: 6b2c 7620 696e 2072 6d73 5f74 6573 742e  k,v in rms_test.
-00005cd0: 6974 656d 7328 297d 290d 0a20 2020 2020  items()})..     
-00005ce0: 2020 2020 2020 2072 6573 756c 7473 5b27         results['
-00005cf0: 7465 7374 5f6d 6574 7269 6327 5d20 3d20  test_metric'] = 
-00005d00: 745f 6d65 7472 6963 0d0a 2020 2020 2020  t_metric..      
-00005d10: 2020 2020 2020 7265 7375 6c74 735b 2774        results['t
-00005d20: 6573 745f 6c6f 7373 275d 203d 2074 5f6c  est_loss'] = t_l
-00005d30: 6f73 730d 0a20 2020 2020 2020 2020 2020  oss..           
-00005d40: 2072 6573 756c 7473 5b27 7465 7374 5f6d   results['test_m
-00005d50: 6574 7269 6373 275d 203d 2073 656c 662e  etrics'] = self.
-00005d60: 6376 5f74 6573 745f 6d65 7472 6963 730d  cv_test_metrics.
-00005d70: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00005d80: 756c 7473 5b27 7465 7374 5f6c 6f73 7365  ults['test_losse
-00005d90: 7327 5d20 3d20 7365 6c66 2e63 765f 7465  s'] = self.cv_te
-00005da0: 7374 5f6c 6f73 7365 730d 0a0d 0a20 2020  st_losses....   
-00005db0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00005dc0: 2020 2020 2020 2020 7265 7375 6c74 735b          results[
-00005dd0: 2774 6573 745f 6d65 7472 6963 275d 203d  'test_metric'] =
-00005de0: 2022 4e41 220d 0a20 2020 2020 2020 2020   "NA"..         
-00005df0: 2020 2072 6573 756c 7473 5b27 7465 7374     results['test
-00005e00: 5f6c 6f73 7327 5d20 3d20 224e 4122 0d0a  _loss'] = "NA"..
-00005e10: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00005e20: 6c74 735b 2774 6573 745f 6d65 7472 6963  lts['test_metric
-00005e30: 7327 5d20 3d20 224e 4122 0d0a 2020 2020  s'] = "NA"..    
-00005e40: 2020 2020 2020 2020 7265 7375 6c74 735b          results[
-00005e50: 2774 6573 745f 6c6f 7373 6573 275d 203d  'test_losses'] =
-00005e60: 2022 4e41 220d 0a20 2020 2020 2020 200d   "NA"..        .
-00005e70: 0a20 2020 2020 2020 2072 6573 756c 7473  .        results
-00005e80: 5b27 636d 275d 203d 2073 656c 662e 636d  ['cm'] = self.cm
-00005e90: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-00005ea0: 2020 2020 7365 6c66 2e6d 6574 612e 7570      self.meta.up
-00005eb0: 6461 7465 2872 6573 756c 7473 3d72 6573  date(results=res
-00005ec0: 756c 7473 290d 0a20 2020 2020 2020 200d  ults)..        .
-00005ed0: 0a20 2020 2064 6566 2075 7064 6174 655f  .    def update_
-00005ee0: 6c6f 6728 7365 6c66 2c20 726d 733d 4e6f  log(self, rms=No
-00005ef0: 6e65 2c20 7072 6566 6978 3d27 2729 3a0d  ne, prefix=''):.
-00005f00: 0a20 2020 2020 2020 2022 2222 4c6f 6773  .        """Logs
-00005f10: 2065 7870 6572 696d 656e 7420 746f 2073   experiment to s
-00005f20: 656c 662e 6d6f 6465 6c5f 7061 7468 202b  elf.model_path +
-00005f30: 2073 656c 662e 7363 6f70 6520 2b20 275f   self.scope + '_
-00005f40: 6c6f 672e 6373 7627 2e0d 0a0d 0a20 2020  log.csv'.....   
-00005f50: 2020 2020 2049 6620 7468 6520 6669 6c65       If the file
-00005f60: 2065 7869 7374 732c 2061 7070 656e 6473   exists, appends
-00005f70: 2061 206c 696e 6520 746f 2074 6865 2065   a line to the e
-00005f80: 7869 7374 696e 6720 6669 6c65 2e0d 0a20  xisting file... 
-00005f90: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
-00005fa0: 2020 2020 7361 7665 7061 7468 203d 206f      savepath = o
-00005fb0: 732e 7061 7468 2e6a 6f69 6e28 7365 6c66  s.path.join(self
-00005fc0: 2e6d 6f64 656c 5f70 6174 682c 2073 656c  .model_path, sel
-00005fd0: 662e 7363 6f70 6520 2b20 275f 6c6f 672e  f.scope + '_log.
-00005fe0: 6373 7627 290d 0a20 2020 2020 2020 2061  csv')..        a
-00005ff0: 7070 656e 6469 6e67 203d 206f 732e 7061  ppending = os.pa
-00006000: 7468 2e65 7869 7374 7328 7361 7665 7061  th.exists(savepa
-00006010: 7468 290d 0a20 2020 2020 2020 2073 656c  th)..        sel
-00006020: 662e 7570 6461 7465 5f72 6573 756c 7473  f.update_results
-00006030: 2829 0d0a 0d0a 2020 2020 2020 2020 6c6f  ()....        lo
-00006040: 6720 3d20 6469 6374 2829 0d0a 2020 2020  g = dict()..    
-00006050: 2020 2020 6966 2072 6d73 3a0d 0a20 2020      if rms:..   
-00006060: 2020 2020 2020 2020 206c 6f67 2e75 7064           log.upd
-00006070: 6174 6528 7b70 7265 6669 782b 6b3a 7620  ate({prefix+k:v 
-00006080: 666f 7220 6b2c 7620 696e 2072 6d73 2e69  for k,v in rms.i
-00006090: 7465 6d73 2829 7d29 0d0a 0d0a 2020 2020  tems()})....    
-000060a0: 2020 2020 2364 6174 6173 6574 2069 6e66      #dataset inf
-000060b0: 6f0d 0a20 2020 2020 2020 2064 6174 615f  o..        data_
-000060c0: 6469 6374 203d 2073 656c 662e 6d65 7461  dict = self.meta
-000060d0: 2e64 6174 612e 636f 7079 2829 0d0a 2020  .data.copy()..  
-000060e0: 2020 2020 2020 5f20 3d20 6461 7461 5f64        _ = data_d
-000060f0: 6963 742e 706f 7028 2766 6f6c 6473 2729  ict.pop('folds')
-00006100: 0d0a 2020 2020 2020 2020 5f20 3d20 6461  ..        _ = da
-00006110: 7461 5f64 6963 742e 706f 7028 2774 6573  ta_dict.pop('tes
-00006120: 745f 666f 6c64 2729 0d0a 2020 2020 2020  t_fold')..      
-00006130: 2020 5f20 3d20 6461 7461 5f64 6963 742e    _ = data_dict.
-00006140: 706f 7028 2774 7261 696e 5f70 6174 6873  pop('train_paths
-00006150: 2729 0d0a 2020 2020 2020 2020 5f20 3d20  ')..        _ = 
-00006160: 6461 7461 5f64 6963 742e 706f 7028 2774  data_dict.pop('t
-00006170: 6573 745f 7061 7468 7327 290d 0a20 2020  est_paths')..   
-00006180: 2020 2020 206c 6f67 5b27 6461 7461 5f69       log['data_i
-00006190: 6427 5d20 3d20 6461 7461 5f64 6963 742e  d'] = data_dict.
-000061a0: 706f 7028 2764 6174 615f 6964 2729 0d0a  pop('data_id')..
-000061b0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-000061c0: 2020 2372 6573 756c 7473 2069 6e66 6f0d    #results info.
-000061d0: 0a20 2020 2020 2020 2072 6573 756c 7473  .        results
-000061e0: 5f64 6963 7420 3d20 7365 6c66 2e6d 6574  _dict = self.met
-000061f0: 612e 7265 7375 6c74 732e 636f 7079 2829  a.results.copy()
-00006200: 0d0a 2020 2020 2020 2020 6c6f 675b 2774  ..        log['t
-00006210: 7261 696e 206d 6574 7269 6327 5d20 3d20  rain metric'] = 
-00006220: 7265 7375 6c74 735f 6469 6374 2e70 6f70  results_dict.pop
-00006230: 2827 7472 5f6d 6574 7269 6327 290d 0a20  ('tr_metric').. 
-00006240: 2020 2020 2020 206c 6f67 5b27 7661 6c69         log['vali
-00006250: 6461 7469 6f6e 206d 6574 7269 6327 5d20  dation metric'] 
-00006260: 3d20 7265 7375 6c74 735f 6469 6374 2e70  = results_dict.p
-00006270: 6f70 2827 765f 6d65 7472 6963 2729 0d0a  op('v_metric')..
-00006280: 2020 2020 2020 2020 6c6f 675b 2774 6573          log['tes
-00006290: 7420 6d65 7472 6963 275d 203d 2020 7265  t metric'] =  re
-000062a0: 7375 6c74 735f 6469 6374 2e70 6f70 2827  sults_dict.pop('
-000062b0: 7465 7374 5f6d 6574 7269 6327 290d 0a20  test_metric').. 
-000062c0: 2020 2020 2020 206c 6f67 5b27 7472 6169         log['trai
-000062d0: 6e20 6c6f 7373 275d 203d 2072 6573 756c  n loss'] = resul
-000062e0: 7473 5f64 6963 742e 706f 7028 2774 725f  ts_dict.pop('tr_
-000062f0: 6c6f 7373 2729 0d0a 2020 2020 2020 2020  loss')..        
-00006300: 6c6f 675b 2776 616c 6964 6174 696f 6e20  log['validation 
-00006310: 6c6f 7373 275d 203d 2072 6573 756c 7473  loss'] = results
-00006320: 5f64 6963 742e 706f 7028 2776 5f6c 6f73  _dict.pop('v_los
-00006330: 7327 290d 0a20 2020 2020 2020 206c 6f67  s')..        log
-00006340: 5b27 7465 7374 206c 6f73 7327 5d20 3d20  ['test loss'] = 
-00006350: 2072 6573 756c 7473 5f64 6963 742e 706f   results_dict.po
-00006360: 7028 2774 6573 745f 6c6f 7373 2729 0d0a  p('test_loss')..
-00006370: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00006380: 2020 0d0a 2020 2020 2020 2020 2366 6f72    ..        #for
-00006390: 6d61 7420 7370 6563 733a 2061 7263 6869  mat specs: archi
-000063a0: 7465 6374 7572 6520 616e 6420 7265 6775  tecture and regu
-000063b0: 6c61 7269 7a61 7469 6f6e 0d0a 2020 2020  larization..    
-000063c0: 2020 2020 7370 6563 735f 6469 6374 203d      specs_dict =
-000063d0: 2073 656c 662e 6d65 7461 2e6d 6f64 656c   self.meta.model
-000063e0: 5f73 7065 6373 2e63 6f70 7928 290d 0a20  _specs.copy().. 
-000063f0: 2020 2020 2020 2073 7065 6373 5f64 6963         specs_dic
-00006400: 745b 276c 315f 7363 6f70 6527 5d20 3d20  t['l1_scope'] = 
-00006410: 272d 272e 6a6f 696e 2873 656c 662e 6d65  '-'.join(self.me
-00006420: 7461 2e6d 6f64 656c 5f73 7065 6373 5b27  ta.model_specs['
-00006430: 6c31 5f73 636f 7065 275d 290d 0a20 2020  l1_scope'])..   
-00006440: 2020 2020 2073 7065 6373 5f64 6963 745b       specs_dict[
-00006450: 276c 325f 7363 6f70 6527 5d20 3d20 272d  'l2_scope'] = '-
-00006460: 272e 6a6f 696e 2873 656c 662e 6d65 7461  '.join(self.meta
-00006470: 2e6d 6f64 656c 5f73 7065 6373 5b27 6c32  .model_specs['l2
-00006480: 5f73 636f 7065 275d 290d 0a20 2020 2020  _scope'])..     
-00006490: 2020 2073 7065 6373 5f64 6963 745b 2775     specs_dict['u
-000064a0: 6e69 746e 6f72 6d5f 7363 6f70 6527 5d20  nitnorm_scope'] 
-000064b0: 3d20 272d 272e 6a6f 696e 2873 656c 662e  = '-'.join(self.
-000064c0: 6d65 7461 2e6d 6f64 656c 5f73 7065 6373  meta.model_specs
-000064d0: 5b27 756e 6974 6e6f 726d 5f73 636f 7065  ['unitnorm_scope
-000064e0: 275d 290d 0a20 2020 2020 2020 205f 203d  '])..        _ =
-000064f0: 2073 7065 6373 5f64 6963 742e 706f 7028   specs_dict.pop(
-00006500: 276d 6f64 656c 5f70 6174 6827 290d 0a20  'model_path').. 
-00006510: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00006520: 616e 6365 2873 7065 6373 5f64 6963 745b  ance(specs_dict[
-00006530: 276e 6f6e 6c69 6e27 5d2c 2043 616c 6c61  'nonlin'], Calla
-00006540: 626c 6529 3a0d 0a20 2020 2020 2020 2020  ble):..         
-00006550: 2020 2073 7065 6373 5f64 6963 745b 276e     specs_dict['n
-00006560: 6f6e 6c69 6e27 5d20 3d20 7370 6563 735f  onlin'] = specs_
-00006570: 6469 6374 5b27 6e6f 6e6c 696e 275d 2e5f  dict['nonlin']._
-00006580: 5f6e 616d 655f 5f0d 0a20 2020 2020 2020  _name__..       
-00006590: 200d 0a20 2020 2020 2020 206c 6f67 2e75   ..        log.u
-000065a0: 7064 6174 6528 7370 6563 735f 6469 6374  pdate(specs_dict
-000065b0: 290d 0a20 2020 2020 2020 2023 7472 6169  )..        #trai
-000065c0: 6e69 6e67 2070 6172 616d 7465 7273 0d0a  ning paramters..
-000065d0: 2020 2020 2020 2020 6c6f 672e 7570 6461          log.upda
-000065e0: 7465 2873 656c 662e 6d65 7461 2e74 7261  te(self.meta.tra
-000065f0: 696e 5f70 6172 616d 7329 0d0a 2020 2020  in_params)..    
-00006600: 2020 2020 6c6f 672e 7570 6461 7465 2864      log.update(d
-00006610: 6174 615f 6469 6374 290d 0a20 2020 2020  ata_dict)..     
-00006620: 2020 206c 6f67 2e75 7064 6174 6528 7265     log.update(re
-00006630: 7375 6c74 735f 6469 6374 290d 0a20 2020  sults_dict)..   
-00006640: 2020 2020 200d 0a20 2020 2020 2020 200d       ..        .
-00006650: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
-00006660: 672e 7570 6461 7465 286c 6f67 290d 0a0d  g.update(log)...
-00006670: 0a20 2020 2020 2020 2077 6974 6820 6f70  .        with op
-00006680: 656e 2873 6176 6570 6174 682c 2027 612b  en(savepath, 'a+
-00006690: 272c 206e 6577 6c69 6e65 3d27 2729 2061  ', newline='') a
-000066a0: 7320 6373 765f 6669 6c65 3a0d 0a20 2020  s csv_file:..   
-000066b0: 2020 2020 2020 2020 2077 7269 7465 7220           writer 
-000066c0: 3d20 6373 762e 4469 6374 5772 6974 6572  = csv.DictWriter
-000066d0: 2863 7376 5f66 696c 652c 2066 6965 6c64  (csv_file, field
-000066e0: 6e61 6d65 733d 7365 6c66 2e6c 6f67 2e6b  names=self.log.k
-000066f0: 6579 7328 2929 0d0a 2020 2020 2020 2020  eys())..        
-00006700: 2020 2020 6966 206e 6f74 2061 7070 656e      if not appen
-00006710: 6469 6e67 3a0d 0a20 2020 2020 2020 2020  ding:..         
-00006720: 2020 2020 2020 2077 7269 7465 722e 7772         writer.wr
-00006730: 6974 6568 6561 6465 7228 290d 0a20 2020  iteheader()..   
-00006740: 2020 2020 2020 2020 2077 7269 7465 722e           writer.
-00006750: 7772 6974 6572 6f77 2873 656c 662e 6c6f  writerow(self.lo
-00006760: 6729 0d0a 2020 2020 2020 2020 2020 2020  g)..            
-00006770: 7072 696e 7428 2253 6176 696e 6720 7570  print("Saving up
-00006780: 6461 7465 6420 6c6f 6720 746f 3a20 222c  dated log to: ",
-00006790: 2020 7361 7665 7061 7468 290d 0a0d 0a20    savepath).... 
-000067a0: 2020 2064 6566 2073 6176 6528 7365 6c66     def save(self
-000067b0: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
-000067c0: 0a20 2020 2020 2020 2053 6176 6573 2074  .        Saves t
-000067d0: 6865 206d 6f64 656c 2061 6e64 2028 6f70  he model and (op
-000067e0: 7469 6f6e 616c 6c79 2c20 7061 7474 6572  tionally, patter
-000067f0: 6e73 2c20 636f 6e66 7573 696f 6e20 6d61  ns, confusion ma
-00006800: 7472 6963 6573 290d 0a20 2020 2020 2020  trices)..       
-00006810: 2022 2222 0d0a 2020 2020 2020 2020 0d0a   """..        ..
-00006820: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
-00006830: 6174 655f 7265 7375 6c74 7328 290d 0a20  ate_results().. 
-00006840: 2020 2020 2020 2077 6569 6768 7473 203d         weights =
-00006850: 207b 6b3a 206e 702e 7374 6163 6b28 7365   {k: np.stack(se
-00006860: 6c66 2e63 765f 7765 6967 6874 735b 6b5d  lf.cv_weights[k]
-00006870: 2c20 2d31 2920 666f 7220 6b20 696e 2073  , -1) for k in s
-00006880: 656c 662e 6376 5f77 6569 6768 7473 2e6b  elf.cv_weights.k
-00006890: 6579 7328 297d 0d0a 2020 2020 2020 2020  eys()}..        
-000068a0: 2355 7064 6174 6520 616e 6420 7361 7665  #Update and save
-000068b0: 206d 6574 6120 6669 6c65 0d0a 2020 2020   meta file..    
-000068c0: 2020 2020 7365 6c66 2e6d 6574 612e 7570      self.meta.up
-000068d0: 6461 7465 2864 6174 613d 7365 6c66 2e64  date(data=self.d
-000068e0: 6174 6173 6574 2e68 5f70 6172 616d 732c  ataset.h_params,
-000068f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00006900: 2020 2020 2020 2020 2020 206d 6f64 656c             model
-00006910: 5f73 7065 6373 3d73 656c 662e 7370 6563  _specs=self.spec
-00006920: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
-00006930: 2020 2020 2020 2020 2020 2020 2070 6174               pat
-00006940: 7465 726e 733d 7365 6c66 2e63 765f 7061  terns=self.cv_pa
-00006950: 7474 6572 6e73 2c0d 0a20 2020 2020 2020  tterns,..       
-00006960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006970: 2020 7765 6967 6874 733d 7765 6967 6874    weights=weight
-00006980: 7329 0d0a 2020 2020 2020 2020 2373 656c  s)..        #sel
-00006990: 662e 6d65 7461 2e73 6176 6528 290d 0a20  f.meta.save().. 
-000069a0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-000069b0: 2023 206d 6f64 656c 5f6e 616d 6520 3d20   # model_name = 
-000069c0: 225f 222e 6a6f 696e 285b 7365 6c66 2e73  "_".join([self.s
-000069d0: 636f 7065 2c0d 0a20 2020 2020 2020 2023  cope,..        #
-000069e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000069f0: 2020 2020 2020 2020 7365 6c66 2e64 6174          self.dat
-00006a00: 6173 6574 2e68 5f70 6172 616d 735b 2764  aset.h_params['d
-00006a10: 6174 615f 6964 275d 5d29 0d0a 2020 2020  ata_id']])..    
-00006a20: 2020 2020 2373 656c 662e 7370 6563 735b      #self.specs[
-00006a30: 276d 6f64 656c 5f6e 616d 6527 5d20 3d20  'model_name'] = 
-00006a40: 6d6f 6465 6c5f 6e61 6d65 0d0a 0d0a 2020  model_name....  
-00006a50: 2020 2020 2020 2373 6176 6520 7468 6520        #save the 
-00006a60: 6d6f 6465 6c0d 0a20 2020 2020 2020 2073  model..        s
-00006a70: 656c 662e 6b6d 2e73 6176 6528 6f73 2e70  elf.km.save(os.p
-00006a80: 6174 682e 6a6f 696e 2873 656c 662e 6d6f  ath.join(self.mo
-00006a90: 6465 6c5f 7061 7468 2c20 7365 6c66 2e6d  del_path, self.m
-00006aa0: 6f64 656c 5f6e 616d 6520 2b20 272e 6835  odel_name + '.h5
-00006ab0: 2729 290d 0a20 2020 2020 2020 200d 0a0d  '))..        ...
-00006ac0: 0a20 2020 2020 2020 2023 2023 5361 7665  .        # #Save
-00006ad0: 2072 6573 756c 7473 2066 726f 6d20 6d75   results from mu
-00006ae0: 6c74 6970 6c65 2066 6f6c 6473 0d0a 2020  ltiple folds..  
-00006af0: 2020 2020 2020 2320 6966 2068 6173 6174        # if hasat
-00006b00: 7472 2873 656c 662c 2027 6376 5f70 6174  tr(self, 'cv_pat
-00006b10: 7465 726e 7327 293a 0d0a 2020 2020 2020  terns'):..      
-00006b20: 2020 2320 2020 2020 2369 6620 6861 7361    #     #if hasa
-00006b30: 7474 7228 7365 6c66 2c20 2763 765f 7061  ttr(self, 'cv_pa
-00006b40: 7474 6572 6e73 2729 3a0d 0a20 2020 2020  tterns'):..     
-00006b50: 2020 2023 2020 2020 2070 7269 6e74 2822     #     print("
-00006b60: 5361 7669 6e67 2070 6174 7465 726e 7320  Saving patterns 
-00006b70: 746f 3a20 2220 2b20 7365 6c66 2e6d 6f64  to: " + self.mod
-00006b80: 656c 5f70 6174 6820 2b20 7365 6c66 2e6d  el_path + self.m
-00006b90: 6f64 656c 5f6e 616d 6520 2b20 225c 5c6d  odel_name + "\\m
-00006ba0: 6e65 666c 6f77 5f70 6174 7465 726e 732e  neflow_patterns.
-00006bb0: 6e70 7a22 2029 0d0a 2020 2020 2020 2020  npz" )..        
-00006bc0: 2320 2020 2020 6e70 2e73 6176 657a 2873  #     np.savez(s
-00006bd0: 656c 662e 6d6f 6465 6c5f 7061 7468 202b  elf.model_path +
-00006be0: 2073 656c 662e 6d6f 6465 6c5f 6e61 6d65   self.model_name
-00006bf0: 202b 2022 5c5c 6d6e 6566 6c6f 775f 7061   + "\\mneflow_pa
-00006c00: 7474 6572 6e73 2e6e 707a 222c 0d0a 2020  tterns.npz",..  
-00006c10: 2020 2020 2020 2320 2020 2020 2020 2020        #         
-00006c20: 2020 2020 2063 765f 7061 7474 6572 6e73       cv_patterns
-00006c30: 3d73 656c 662e 6376 5f70 6174 7465 726e  =self.cv_pattern
-00006c40: 732c 0d0a 2020 2020 2020 2020 2320 2020  s,..        #   
-00006c50: 2020 2020 2020 2020 2020 2073 7065 6373             specs
-00006c60: 3d73 656c 662e 7370 6563 732c 0d0a 2020  =self.specs,..  
-00006c70: 2020 2020 2020 2320 2020 2020 2020 2020        #         
-00006c80: 2020 2020 206d 6574 613d 7365 6c66 2e64       meta=self.d
-00006c90: 6174 6173 6574 2e68 5f70 6172 616d 732c  ataset.h_params,
-00006ca0: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
-00006cb0: 2020 2020 2020 2020 206c 6f67 3d73 656c           log=sel
-00006cc0: 662e 6c6f 672c 0d0a 2020 2020 2020 2020  f.log,..        
-00006cd0: 2320 2020 2020 2020 2020 2020 2020 2063  #              c
-00006ce0: 6d3d 7365 6c66 2e63 6d2c 0d0a 2020 2020  m=self.cm,..    
-00006cf0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-00006d00: 2020 2029 0d0a 0d0a 2020 2020 2020 2020     )....        
-00006d10: 2355 7064 6174 6520 6d65 7461 6461 7461  #Update metadata
-00006d20: 2077 6974 6820 7370 6563 7320 616e 6420   with specs and 
-00006d30: 6e65 7720 7365 6c66 2e64 6174 6173 6574  new self.dataset
-00006d40: 206f 7074 696f 6e73 0d0a 2020 2020 2020   options..      
-00006d50: 2020 2346 6f72 204c 4643 4e4e 2073 6176    #For LFCNN sav
-00006d60: 6520 7061 7474 6572 6e73 0d0a 0d0a 2020  e patterns....  
-00006d70: 2020 2320 6465 6620 7265 7374 6f72 6528    # def restore(
-00006d80: 7365 6c66 2c20 6d65 7461 293a 0d0a 2020  self, meta):..  
-00006d90: 2020 2320 2020 2020 2354 4f44 4f3a 2074    #     #TODO: t
-00006da0: 616b 6520 7061 7468 2c20 7363 6f70 652c  ake path, scope,
-00006db0: 2061 6e64 2064 6174 615f 6964 2061 7320   and data_id as 
-00006dc0: 696e 7075 7473 2e0d 0a20 2020 2023 2020  inputs...    #  
-00006dd0: 2020 2023 544f 444f 3a20 6275 696c 6420     #TODO: build 
-00006de0: 6461 7461 7365 7420 6672 6f6d 206d 6574  dataset from met
-00006df0: 6164 6174 610d 0a20 2020 2023 2020 2020  adata..    #    
-00006e00: 2023 544f 444f 3a20 696e 6974 6961 6c69   #TODO: initiali
-00006e10: 7a65 2066 726f 6d20 7370 6563 730d 0a0d  ze from specs...
-00006e20: 0a20 2020 2023 2020 2020 2073 656c 662e  .    #     self.
-00006e30: 6d6f 6465 6c5f 6e61 6d65 203d 2022 5f22  model_name = "_"
-00006e40: 2e6a 6f69 6e28 5b73 656c 662e 7363 6f70  .join([self.scop
-00006e50: 652c 0d0a 2020 2020 2320 2020 2020 2020  e,..    #       
-00006e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006e70: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-00006e80: 6174 6173 6574 2e68 5f70 6172 616d 735b  ataset.h_params[
-00006e90: 2764 6174 615f 6964 275d 5d29 0d0a 2020  'data_id']])..  
-00006ea0: 2020 2320 2020 2020 7365 6c66 2e6b 6d20    #     self.km 
-00006eb0: 203d 2074 662e 6b65 7261 732e 6d6f 6465   = tf.keras.mode
-00006ec0: 6c73 2e6c 6f61 645f 6d6f 6465 6c28 7365  ls.load_model(se
-00006ed0: 6c66 2e6d 6f64 656c 5f70 6174 6820 2b20  lf.model_path + 
-00006ee0: 7365 6c66 2e6d 6f64 656c 5f6e 616d 6529  self.model_name)
-00006ef0: 0d0a 2020 2020 2320 2020 2020 2374 7279  ..    #     #try
-00006f00: 3a0d 0a0d 0a20 2020 2023 2020 2020 2069  :....    #     i
-00006f10: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
-00006f20: 2873 656c 662e 6d6f 6465 6c5f 7061 7468  (self.model_path
-00006f30: 202b 2073 656c 662e 6d6f 6465 6c5f 6e61   + self.model_na
-00006f40: 6d65 202b 2022 5c5c 6d6e 6566 6c6f 775f  me + "\\mneflow_
-00006f50: 7061 7474 6572 6e73 2e6e 707a 2229 3a0d  patterns.npz"):.
-00006f60: 0a20 2020 2023 2020 2020 2020 2020 2070  .    #         p
-00006f70: 7269 6e74 2822 5265 7374 6f72 696e 6720  rint("Restoring 
-00006f80: 6672 6f6d 3a22 202b 2073 656c 662e 6d6f  from:" + self.mo
-00006f90: 6465 6c5f 7061 7468 202b 2073 656c 662e  del_path + self.
-00006fa0: 6d6f 6465 6c5f 6e61 6d65 202b 2022 5c5c  model_name + "\\
-00006fb0: 6d6e 6566 6c6f 775f 7061 7474 6572 6e73  mneflow_patterns
-00006fc0: 2e6e 707a 2220 290d 0a20 2020 2023 2020  .npz" )..    #  
-00006fd0: 2020 2020 2020 2066 203d 206e 702e 6c6f         f = np.lo
-00006fe0: 6164 2873 656c 662e 6d6f 6465 6c5f 7061  ad(self.model_pa
-00006ff0: 7468 202b 2073 656c 662e 6d6f 6465 6c5f  th + self.model_
-00007000: 6e61 6d65 202b 2022 5c5c 6d6e 6566 6c6f  name + "\\mneflo
-00007010: 775f 7061 7474 6572 6e73 2e6e 707a 222c  w_patterns.npz",
-00007020: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
-00007030: 2020 2020 2020 2020 2020 2020 616c 6c6f              allo
-00007040: 775f 7069 636b 6c65 3d54 7275 6529 0d0a  w_pickle=True)..
-00007050: 2020 2020 2320 2020 2020 2020 2020 7365      #         se
-00007060: 6c66 2e63 765f 7061 7474 6572 6e73 203d  lf.cv_patterns =
-00007070: 2066 5b22 6376 5f70 6174 7465 726e 7322   f["cv_patterns"
-00007080: 5d23 2e69 7465 6d28 290d 0a20 2020 2023  ]#.item()..    #
-00007090: 2020 2020 2020 2020 2073 656c 662e 7370           self.sp
-000070a0: 6563 7320 3d20 665b 2273 7065 6373 225d  ecs = f["specs"]
-000070b0: 232e 6974 656d 2829 0d0a 2020 2020 2320  #.item()..    # 
-000070c0: 2020 2020 2020 2020 7365 6c66 2e6d 6574          self.met
-000070d0: 6120 3d20 665b 226d 6574 6122 5d23 2e69  a = f["meta"]#.i
-000070e0: 7465 6d28 290d 0a20 2020 2023 2020 2020  tem()..    #    
-000070f0: 2020 2020 2073 656c 662e 6c6f 6720 3d20       self.log = 
-00007100: 665b 226c 6f67 225d 232e 6974 656d 2829  f["log"]#.item()
-00007110: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
-00007120: 7365 6c66 2e63 6d20 3d20 665b 2263 6d22  self.cm = f["cm"
-00007130: 5d0d 0a0d 0a20 2020 2064 6566 2070 7265  ]....    def pre
-00007140: 6469 6374 5f73 616d 706c 6528 7365 6c66  dict_sample(self
-00007150: 2c20 7829 3a0d 0a20 2020 2020 2020 206e  , x):..        n
-00007160: 5f63 6820 3d20 7365 6c66 2e64 6174 6173  _ch = self.datas
-00007170: 6574 2e68 5f70 6172 616d 735b 276e 5f63  et.h_params['n_c
-00007180: 6827 5d0d 0a20 2020 2020 2020 206e 5f74  h']..        n_t
-00007190: 203d 2073 656c 662e 6461 7461 7365 742e   = self.dataset.
-000071a0: 685f 7061 7261 6d73 5b27 6e5f 7427 5d0d  h_params['n_t'].
-000071b0: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
-000071c0: 782e 7368 6170 655b 2d32 3a5d 203d 3d20  x.shape[-2:] == 
-000071d0: 286e 5f74 2c20 6e5f 6368 292c 2020 2253  (n_t, n_ch),  "S
-000071e0: 6861 7065 206d 6973 6d61 7463 6821 2045  hape mismatch! E
-000071f0: 7870 6563 7465 6420 7b7d 787b 7d2c 205c  xpected {}x{}, \
-00007200: 0d0a 2020 2020 2020 2020 2020 2020 676f  ..            go
-00007210: 7420 7b7d 787b 7d22 2e66 6f72 6d61 7428  t {}x{}".format(
-00007220: 6e5f 742c 206e 5f63 682c 2078 2e73 6861  n_t, n_ch, x.sha
-00007230: 7065 5b2d 325d 2c20 782e 7368 6170 655b  pe[-2], x.shape[
-00007240: 2d31 5d29 0d0a 0d0a 2020 2020 2020 2020  -1])....        
-00007250: 7768 696c 6520 782e 6e64 696d 203c 2034  while x.ndim < 4
-00007260: 3a0d 0a20 2020 2020 2020 2020 2020 2078  :..            x
-00007270: 203d 206e 702e 6578 7061 6e64 5f64 696d   = np.expand_dim
-00007280: 7328 782c 2030 290d 0a0d 0a20 2020 2020  s(x, 0)....     
-00007290: 2020 206f 7574 203d 2073 656c 662e 6b6d     out = self.km
-000072a0: 2e70 7265 6469 6374 2878 290d 0a20 2020  .predict(x)..   
-000072b0: 2020 2020 2069 6620 7365 6c66 2e64 6174       if self.dat
-000072c0: 6173 6574 2e68 5f70 6172 616d 735b 2774  aset.h_params['t
-000072d0: 6172 6765 745f 7479 7065 275d 203d 3d20  arget_type'] == 
-000072e0: 2769 6e74 273a 0d0a 2020 2020 2020 2020  'int':..        
-000072f0: 2020 2020 6f75 7420 3d20 6e70 2e61 7267      out = np.arg
-00007300: 6d61 7828 6f75 742c 202d 3129 0d0a 0d0a  max(out, -1)....
-00007310: 2020 2020 2020 2020 7265 7475 726e 206f          return o
-00007320: 7574 0d0a 0d0a 2020 2020 6465 6620 7072  ut....    def pr
-00007330: 6564 6963 7428 7365 6c66 2c20 6461 7461  edict(self, data
-00007340: 7365 743d 4e6f 6e65 293a 0d0a 2020 2020  set=None):..    
-00007350: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
-00007360: 2052 6574 7572 6e73 0d0a 2020 2020 2020   Returns..      
-00007370: 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020    -------..     
-00007380: 2020 2079 5f74 7275 6520 3a20 6e70 2e61     y_true : np.a
-00007390: 7272 6179 0d0a 2020 2020 2020 2020 2020  rray..          
-000073a0: 2020 2020 2020 6772 6f75 6e64 2074 7275        ground tru
-000073b0: 7468 206c 6162 656c 7320 7461 6b65 6e20  th labels taken 
-000073c0: 6672 6f6d 2074 6865 2064 6174 6173 6574  from the dataset
-000073d0: 0d0a 0d0a 2020 2020 2020 2020 795f 7072  ....        y_pr
-000073e0: 6564 203a 206e 702e 6172 7261 790d 0a20  ed : np.array.. 
-000073f0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00007400: 6f64 656c 2070 7265 6469 6374 696f 6e73  odel predictions
-00007410: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-00007420: 2020 2020 2020 2069 6620 6e6f 7420 6461         if not da
-00007430: 7461 7365 743a 0d0a 2020 2020 2020 2020  taset:..        
-00007440: 2020 2020 7072 696e 7428 224e 6f20 6461      print("No da
-00007450: 7461 7365 7420 7370 6563 6966 6965 6420  taset specified 
-00007460: 7573 696e 6720 7661 6c69 6461 7469 6f6e  using validation
-00007470: 2064 6174 6173 6574 2028 4465 6661 756c   dataset (Defaul
-00007480: 7429 2229 0d0a 2020 2020 2020 2020 2020  t)")..          
-00007490: 2020 6461 7461 7365 7420 3d20 7365 6c66    dataset = self
-000074a0: 2e64 6174 6173 6574 2e76 616c 0d0a 2020  .dataset.val..  
-000074b0: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
-000074c0: 7461 6e63 6528 6461 7461 7365 742c 2073  tance(dataset, s
-000074d0: 7472 2920 6f72 2069 7369 6e73 7461 6e63  tr) or isinstanc
-000074e0: 6528 6461 7461 7365 742c 2028 6c69 7374  e(dataset, (list
-000074f0: 2c20 7475 706c 6529 293a 0d0a 2020 2020  , tuple)):..    
-00007500: 2020 2020 2020 2020 6461 7461 7365 7420          dataset 
-00007510: 3d20 7365 6c66 2e64 6174 6173 6574 2e5f  = self.dataset._
-00007520: 6275 696c 645f 6461 7461 7365 7428 6461  build_dataset(da
-00007530: 7461 7365 742c 0d0a 2020 2020 2020 2020  taset,..        
-00007540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007560: 2020 2020 2020 2020 2073 706c 6974 3d46           split=F
-00007570: 616c 7365 2c0d 0a20 2020 2020 2020 2020  alse,..         
-00007580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000075a0: 2020 2020 2020 2020 7465 7374 5f62 6174          test_bat
-000075b0: 6368 3d4e 6f6e 652c 0d0a 2020 2020 2020  ch=None,..      
-000075c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000075d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000075e0: 2020 2020 2020 2020 2020 2072 6570 6561             repea
-000075f0: 743d 4661 6c73 6529 0d0a 2020 2020 2020  t=False)..      
-00007600: 2020 656c 6966 206e 6f74 2069 7369 6e73    elif not isins
-00007610: 7461 6e63 6528 6461 7461 7365 742c 2074  tance(dataset, t
-00007620: 662e 6461 7461 2e44 6174 6173 6574 293a  f.data.Dataset):
-00007630: 0d0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
-00007640: 696e 7428 2253 7065 6369 6679 2064 6174  int("Specify dat
-00007650: 6173 6574 2229 0d0a 2020 2020 2020 2020  aset")..        
-00007660: 2020 2020 7265 7475 726e 204e 6f6e 652c      return None,
-00007670: 204e 6f6e 650d 0a0d 0a20 2020 2020 2020   None....       
-00007680: 2058 203d 205b 5d0d 0a20 2020 2020 2020   X = []..       
-00007690: 2079 203d 205b 5d0d 0a0d 0a20 2020 2020   y = []....     
-000076a0: 2020 2066 6f72 2072 6f77 2069 6e20 6461     for row in da
-000076b0: 7461 7365 742e 7461 6b65 2831 293a 0d0a  taset.take(1):..
-000076c0: 2020 2020 2020 2020 2020 2020 582e 6170              X.ap
-000076d0: 7065 6e64 2872 6f77 5b30 5d29 0d0a 2020  pend(row[0])..  
-000076e0: 2020 2020 2020 2020 2020 792e 6170 7065            y.appe
-000076f0: 6e64 2872 6f77 5b31 5d29 0d0a 0d0a 2020  nd(row[1])....  
-00007700: 2020 2020 2020 795f 7072 6564 203d 2073        y_pred = s
-00007710: 656c 662e 6b6d 2e70 7265 6469 6374 286e  elf.km.predict(n
-00007720: 702e 636f 6e63 6174 656e 6174 6528 5829  p.concatenate(X)
-00007730: 290d 0a20 2020 2020 2020 2079 5f74 7275  )..        y_tru
-00007740: 6520 3d20 6e70 2e63 6f6e 6361 7465 6e61  e = np.concatena
-00007750: 7465 2879 290d 0a0d 0a20 2020 2020 2020  te(y)....       
-00007760: 2023 795f 7472 7565 203d 2079 5f74 7275   #y_true = y_tru
-00007770: 652e 6e75 6d70 7928 290d 0a20 2020 2020  e.numpy()..     
-00007780: 2020 2072 6574 7572 6e20 795f 7472 7565     return y_true
-00007790: 2c20 795f 7072 6564 0d0a 0d0a 2020 2020  , y_pred....    
-000077a0: 6465 6620 6576 616c 7561 7465 2873 656c  def evaluate(sel
-000077b0: 662c 2064 6174 6173 6574 3d46 616c 7365  f, dataset=False
-000077c0: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
-000077d0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-000077e0: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
-000077f0: 2d0d 0a20 2020 2020 2020 206c 6f73 7365  -..        losse
-00007800: 7320 3a20 6c69 7374 0d0a 2020 2020 2020  s : list..      
-00007810: 2020 2020 2020 2020 2020 6d6f 6465 6c20            model 
-00007820: 6c6f 7373 206f 6e20 6120 7370 6563 6966  loss on a specif
-00007830: 6965 6420 6461 7461 7365 740d 0a0d 0a20  ied dataset.... 
-00007840: 2020 2020 2020 206d 6574 7269 6373 203a         metrics :
-00007850: 206e 702e 6172 7261 790d 0a20 2020 2020   np.array..     
-00007860: 2020 2020 2020 2020 2020 206d 6574 7269             metri
-00007870: 6373 2065 7661 6c75 6174 6564 206f 6e20  cs evaluated on 
-00007880: 6120 7370 6563 6966 6965 6420 6461 7461  a specified data
-00007890: 7365 740d 0a20 2020 2020 2020 2022 2222  set..        """
-000078a0: 0d0a 0d0a 2020 2020 2020 2020 6966 206e  ....        if n
-000078b0: 6f74 2064 6174 6173 6574 3a0d 0a20 2020  ot dataset:..   
-000078c0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-000078d0: 4e6f 2064 6174 6173 6574 2073 7065 6369  No dataset speci
-000078e0: 6669 6564 2075 7369 6e67 2076 616c 6964  fied using valid
-000078f0: 6174 696f 6e20 6461 7461 7365 7420 2844  ation dataset (D
-00007900: 6566 6175 6c74 2922 290d 0a20 2020 2020  efault)")..     
-00007910: 2020 2020 2020 2064 6174 6173 6574 203d         dataset =
-00007920: 2073 656c 662e 6461 7461 7365 742e 7661   self.dataset.va
-00007930: 6c0d 0a20 2020 2020 2020 2065 6c69 6620  l..        elif 
-00007940: 6973 696e 7374 616e 6365 2864 6174 6173  isinstance(datas
-00007950: 6574 2c20 7374 7229 206f 7220 6973 696e  et, str) or isin
-00007960: 7374 616e 6365 2864 6174 6173 6574 2c20  stance(dataset, 
-00007970: 286c 6973 742c 2074 7570 6c65 2929 3a0d  (list, tuple)):.
-00007980: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
-00007990: 6173 6574 203d 2073 656c 662e 6461 7461  aset = self.data
-000079a0: 7365 742e 5f62 7569 6c64 5f64 6174 6173  set._build_datas
-000079b0: 6574 2864 6174 6173 6574 2c0d 0a20 2020  et(dataset,..   
-000079c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000079d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000079e0: 2020 2020 2020 2020 2020 7370 6c69 743d            split=
-000079f0: 4661 6c73 652c 0d0a 2020 2020 2020 2020  False,..        
-00007a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007a20: 2020 2020 2074 6573 745f 6261 7463 683d       test_batch=
-00007a30: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2020  None,..         
-00007a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007a60: 2020 2020 7265 7065 6174 3d54 7275 6529      repeat=True)
-00007a70: 0d0a 2020 2020 2020 2020 656c 6966 206e  ..        elif n
-00007a80: 6f74 2069 7369 6e73 7461 6e63 6528 6461  ot isinstance(da
-00007a90: 7461 7365 742c 2074 662e 6461 7461 2e44  taset, tf.data.D
-00007aa0: 6174 6173 6574 293a 0d0a 2020 2020 2020  ataset):..      
-00007ab0: 2020 2020 2020 7072 696e 7428 2253 7065        print("Spe
-00007ac0: 6369 6679 2064 6174 6173 6574 2229 0d0a  cify dataset")..
-00007ad0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00007ae0: 726e 204e 6f6e 652c 204e 6f6e 650d 0a0d  rn None, None...
-00007af0: 0a20 2020 2020 2020 206c 6f73 7365 732c  .        losses,
-00007b00: 206d 6574 7269 6373 203d 2073 656c 662e   metrics = self.
-00007b10: 6b6d 2e65 7661 6c75 6174 6528 6461 7461  km.evaluate(data
-00007b20: 7365 742c 0d0a 2020 2020 2020 2020 2020  set,..          
+00005330: 2020 2020 2072 6573 746f 7265 5f62 6573       restore_bes
+00005340: 745f 7765 6967 6874 733d 5472 7565 290d  t_weights=True).
+00005350: 0a20 2020 2020 2020 2073 656c 662e 7261  .        self.ra
+00005360: 7465 203d 2030 0d0a 2020 2020 2020 2020  te = 0..        
+00005370: 7365 6c66 2e73 7065 6373 5b22 6c31 5f6c  self.specs["l1_l
+00005380: 616d 6264 6122 5d20 2a3d 2069 6e63 7265  ambda"] *= incre
+00005390: 6173 655f 7265 6775 6c61 7269 7a61 7469  ase_regularizati
+000053a0: 6f6e 0d0a 2020 2020 2020 2020 7365 6c66  on..        self
+000053b0: 2e73 7065 6373 5b22 6c32 5f6c 616d 6264  .specs["l2_lambd
+000053c0: 6122 5d20 2a3d 2069 6e63 7265 6173 655f  a"] *= increase_
+000053d0: 7265 6775 6c61 7269 7a61 7469 6f6e 0d0a  regularization..
+000053e0: 2020 2020 2020 2020 7072 696e 7428 2750          print('P
+000053f0: 7275 6e69 6e67 2077 6569 6768 7473 2729  runing weights')
+00005400: 0d0a 2020 2020 2020 2020 7365 6c66 2e74  ..        self.t
+00005410: 5f68 6973 745f 7020 3d20 7365 6c66 2e6b  _hist_p = self.k
+00005420: 6d2e 6669 7428 7365 6c66 2e64 6174 6173  m.fit(self.datas
+00005430: 6574 2e74 7261 696e 2c0d 0a20 2020 2020  et.train,..     
+00005440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005450: 2020 2020 2020 2020 2020 7661 6c69 6461            valida
+00005460: 7469 6f6e 5f64 6174 613d 7365 6c66 2e64  tion_data=self.d
+00005470: 6174 6173 6574 2e76 616c 2c0d 0a20 2020  ataset.val,..   
+00005480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005490: 2020 2020 2020 2020 2020 2020 6570 6f63              epoc
+000054a0: 6873 3d33 302c 2073 7465 7073 5f70 6572  hs=30, steps_per
+000054b0: 5f65 706f 6368 3d73 656c 662e 6d65 7461  _epoch=self.meta
+000054c0: 2e74 7261 696e 5f70 6172 616d 735b 2765  .train_params['e
+000054d0: 7661 6c5f 7374 6570 275d 2c0d 0a20 2020  val_step'],..   
+000054e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000054f0: 2020 2020 2020 2020 2020 2020 7368 7566              shuf
+00005500: 666c 653d 5472 7565 2c0d 0a20 2020 2020  fle=True,..     
+00005510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005520: 2020 2020 2020 2020 2020 7661 6c69 6461            valida
+00005530: 7469 6f6e 5f73 7465 7073 3d73 656c 662e  tion_steps=self.
+00005540: 6461 7461 7365 742e 7661 6c69 6461 7469  dataset.validati
+00005550: 6f6e 5f73 7465 7073 2c0d 0a20 2020 2020  on_steps,..     
+00005560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005570: 2020 2020 2020 2020 2020 6361 6c6c 6261            callba
+00005580: 636b 733d 5b73 746f 705f 6561 726c 795d  cks=[stop_early]
+00005590: 2c20 7665 7262 6f73 653d 3229 0d0a 0d0a  , verbose=2)....
+000055a0: 2020 2020 6465 6620 7368 7566 666c 655f      def shuffle_
+000055b0: 7765 6967 6874 7328 7365 6c66 293a 0d0a  weights(self):..
+000055c0: 2020 2020 2020 2020 7072 696e 7428 2252          print("R
+000055d0: 652d 7368 7566 666c 696e 6720 7765 6967  e-shuffling weig
+000055e0: 6874 7320 6265 7477 6565 6e20 666f 6c64  hts between fold
+000055f0: 7322 290d 0a20 2020 2020 2020 2077 6569  s")..        wei
+00005600: 6768 7473 203d 2073 656c 662e 6b6d 2e67  ghts = self.km.g
+00005610: 6574 5f77 6569 6768 7473 2829 0d0a 2020  et_weights()..  
+00005620: 2020 2020 2020 7765 6967 6874 7320 3d20        weights = 
+00005630: 5b6e 702e 7261 6e64 6f6d 2e70 6572 6d75  [np.random.permu
+00005640: 7461 7469 6f6e 2877 2e66 6c61 7429 2e72  tation(w.flat).r
+00005650: 6573 6861 7065 2877 2e73 6861 7065 2920  eshape(w.shape) 
+00005660: 666f 7220 7720 696e 2077 6569 6768 7473  for w in weights
+00005670: 5d0d 0a20 2020 2020 2020 2073 656c 662e  ]..        self.
+00005680: 6b6d 2e73 6574 5f77 6569 6768 7473 2877  km.set_weights(w
+00005690: 6569 6768 7473 290d 0a0d 0a0d 0a20 2020  eights)......   
+000056a0: 2023 2064 6566 2072 6569 6e69 7469 616c   # def reinitial
+000056b0: 697a 655f 7765 6967 6874 7328 7365 6c66  ize_weights(self
+000056c0: 293a 0d0a 2020 2020 2320 2020 2020 7365  ):..    #     se
+000056d0: 7373 696f 6e20 3d20 4b2e 6765 745f 7365  ssion = K.get_se
+000056e0: 7373 696f 6e28 290d 0a20 2020 2023 2020  ssion()..    #  
+000056f0: 2020 2070 7269 6e74 2822 5265 2d69 6e69     print("Re-ini
+00005700: 7469 616c 697a 696e 6720 7765 6967 6874  tializing weight
+00005710: 7322 290d 0a20 2020 2023 2020 2020 2066  s")..    #     f
+00005720: 6f72 206c 6179 6572 2069 6e20 7365 6c66  or layer in self
+00005730: 2e6b 6d2e 6c61 7965 7273 3a20 0d0a 2020  .km.layers: ..  
+00005740: 2020 2320 2020 2020 2020 2020 6966 2068    #         if h
+00005750: 6173 6174 7472 286c 6179 6572 2c20 276b  asattr(layer, 'k
+00005760: 6572 6e65 6c5f 696e 6974 6961 6c69 7a65  ernel_initialize
+00005770: 7227 293a 0d0a 2020 2020 2320 2020 2020  r'):..    #     
+00005780: 2020 2020 2020 2020 6c61 7965 722e 6b65          layer.ke
+00005790: 726e 656c 2e69 6e69 7469 616c 697a 6572  rnel.initializer
+000057a0: 2e72 756e 2873 6573 7369 6f6e 3d73 6573  .run(session=ses
+000057b0: 7369 6f6e 290d 0a20 2020 2023 2020 2020  sion)..    #    
+000057c0: 2020 2020 2069 6620 6861 7361 7474 7228       if hasattr(
+000057d0: 6c61 7965 722c 2027 6269 6173 5f69 6e69  layer, 'bias_ini
+000057e0: 7469 616c 697a 6572 2729 3a0d 0a20 2020  tializer'):..   
+000057f0: 2023 2020 2020 2020 2020 2020 2020 206c   #             l
+00005800: 6179 6572 2e62 6961 732e 696e 6974 6961  ayer.bias.initia
+00005810: 6c69 7a65 722e 7275 6e28 7365 7373 696f  lizer.run(sessio
+00005820: 6e3d 7365 7373 696f 6e29 0d0a 2020 2020  n=session)..    
+00005830: 2020 2020 2020 2020 2020 2020 0d0a 0d0a              ....
+00005840: 2020 2020 6465 6620 706c 6f74 5f68 6973      def plot_his
+00005850: 7428 7365 6c66 293a 0d0a 2020 2020 2020  t(self):..      
+00005860: 2020 2222 2250 6c6f 7420 6c6f 7373 2068    """Plot loss h
+00005870: 6973 746f 7279 2064 7572 696e 6720 7472  istory during tr
+00005880: 6169 6e69 6e67 2e22 2222 0d0a 2020 2020  aining."""..    
+00005890: 2020 2020 706c 742e 706c 6f74 2873 656c      plt.plot(sel
+000058a0: 662e 745f 6869 7374 2e68 6973 746f 7279  f.t_hist.history
+000058b0: 5b27 6c6f 7373 275d 290d 0a20 2020 2020  ['loss'])..     
+000058c0: 2020 2070 6c74 2e70 6c6f 7428 7365 6c66     plt.plot(self
+000058d0: 2e74 5f68 6973 742e 6869 7374 6f72 795b  .t_hist.history[
+000058e0: 2776 616c 5f6c 6f73 7327 5d29 0d0a 2020  'val_loss'])..  
+000058f0: 2020 2020 2020 706c 742e 7469 746c 6528        plt.title(
+00005900: 276d 6f64 656c 206c 6f73 7327 290d 0a20  'model loss').. 
+00005910: 2020 2020 2020 2070 6c74 2e79 6c61 6265         plt.ylabe
+00005920: 6c28 276c 6f73 7327 290d 0a20 2020 2020  l('loss')..     
+00005930: 2020 2070 6c74 2e78 6c61 6265 6c28 2765     plt.xlabel('e
+00005940: 706f 6368 2729 0d0a 2020 2020 2020 2020  poch')..        
+00005950: 706c 742e 6c65 6765 6e64 285b 2774 7261  plt.legend(['tra
+00005960: 696e 272c 2027 7661 6c69 6461 7469 6f6e  in', 'validation
+00005970: 275d 2c20 6c6f 633d 2775 7070 6572 206c  '], loc='upper l
+00005980: 6566 7427 290d 0a20 2020 2020 2020 2070  eft')..        p
+00005990: 6c74 2e73 686f 7728 290d 0a0d 0a20 2020  lt.show()....   
+000059a0: 2064 6566 205f 636f 6e66 7573 696f 6e5f   def _confusion_
+000059b0: 6d61 7472 6978 2873 656c 662c 2079 5f74  matrix(self, y_t
+000059c0: 7275 652c 2079 5f70 7265 6429 3a0d 0a20  rue, y_pred):.. 
+000059d0: 2020 2020 2020 2022 2222 436f 6d70 7574         """Comput
+000059e0: 6520 756e 6e6f 726d 616c 697a 6577 6420  e unnormalizewd 
+000059f0: 636f 6e66 7573 696f 6e20 6d61 7472 6978  confusion matrix
+00005a00: 2222 220d 0a20 2020 2020 2020 2079 5f70  """..        y_p
+00005a10: 203d 205f 6f6e 6568 6f74 286e 702e 6172   = _onehot(np.ar
+00005a20: 676d 6178 2879 5f70 7265 642c 3129 2c20  gmax(y_pred,1), 
+00005a30: 6e5f 636c 6173 7365 733d 7365 6c66 2e79  n_classes=self.y
+00005a40: 5f73 6861 7065 5b2d 315d 290d 0a20 2020  _shape[-1])..   
+00005a50: 2020 2020 2063 6d20 3d20 6e70 2e64 6f74       cm = np.dot
+00005a60: 2879 5f70 2e54 2c20 795f 7472 7565 290d  (y_p.T, y_true).
+00005a70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00005a80: 636d 0d0a 2020 2020 0d0a 2020 2020 6465  cm..    ..    de
+00005a90: 6620 7570 6461 7465 5f72 6573 756c 7473  f update_results
+00005aa0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+00005ab0: 2072 6573 756c 7473 203d 2064 6963 7428   results = dict(
+00005ac0: 290d 0a20 2020 2020 2020 2072 6573 756c  )..        resul
+00005ad0: 7473 5b27 765f 6d65 7472 6963 275d 203d  ts['v_metric'] =
+00005ae0: 206e 702e 6d65 616e 2873 656c 662e 6376   np.mean(self.cv
+00005af0: 5f6d 6574 7269 6373 290d 0a20 2020 2020  _metrics)..     
+00005b00: 2020 2072 6573 756c 7473 5b27 765f 6c6f     results['v_lo
+00005b10: 7373 275d 203d 206e 702e 6d65 616e 2873  ss'] = np.mean(s
+00005b20: 656c 662e 6376 5f6c 6f73 7365 7329 0d0a  elf.cv_losses)..
+00005b30: 2020 2020 2020 2020 7265 7375 6c74 735b          results[
+00005b40: 2763 765f 6d65 7472 6963 7327 5d20 3d20  'cv_metrics'] = 
+00005b50: 7365 6c66 2e63 765f 6d65 7472 6963 730d  self.cv_metrics.
+00005b60: 0a20 2020 2020 2020 2072 6573 756c 7473  .        results
+00005b70: 5b27 6376 5f6c 6f73 7365 7327 5d20 3d20  ['cv_losses'] = 
+00005b80: 7365 6c66 2e63 765f 6c6f 7373 6573 0d0a  self.cv_losses..
+00005b90: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00005ba0: 2020 7472 5f6c 6f73 732c 2074 725f 6d65    tr_loss, tr_me
+00005bb0: 7472 6963 203d 2073 656c 662e 6576 616c  tric = self.eval
+00005bc0: 7561 7465 2873 656c 662e 6461 7461 7365  uate(self.datase
+00005bd0: 742e 7472 6169 6e29 0d0a 2020 2020 2020  t.train)..      
+00005be0: 2020 7265 7375 6c74 735b 2774 725f 6d65    results['tr_me
+00005bf0: 7472 6963 275d 203d 2074 725f 6d65 7472  tric'] = tr_metr
+00005c00: 6963 0d0a 2020 2020 2020 2020 7265 7375  ic..        resu
+00005c10: 6c74 735b 2774 725f 6c6f 7373 275d 203d  lts['tr_loss'] =
+00005c20: 2074 725f 6c6f 7373 0d0a 0d0a 0d0a 2020   tr_loss......  
+00005c30: 2020 2020 2020 6966 206c 656e 2873 656c        if len(sel
+00005c40: 662e 6461 7461 7365 742e 685f 7061 7261  f.dataset.h_para
+00005c50: 6d73 5b27 7465 7374 5f70 6174 6873 275d  ms['test_paths']
+00005c60: 2920 3e20 303a 0d0a 2020 2020 2020 2020  ) > 0:..        
+00005c70: 2020 2020 745f 6c6f 7373 203d 206e 702e      t_loss = np.
+00005c80: 6d65 616e 2873 656c 662e 6376 5f74 6573  mean(self.cv_tes
+00005c90: 745f 6c6f 7373 6573 290d 0a20 2020 2020  t_losses)..     
+00005ca0: 2020 2020 2020 2074 5f6d 6574 7269 6320         t_metric 
+00005cb0: 3d20 6e70 2e6d 6561 6e28 7365 6c66 2e63  = np.mean(self.c
+00005cc0: 765f 7465 7374 5f6d 6574 7269 6373 290d  v_test_metrics).
+00005cd0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00005ce0: 7365 6c66 2e64 6174 6173 6574 2e68 5f70  self.dataset.h_p
+00005cf0: 6172 616d 735b 2774 6172 6765 745f 7479  arams['target_ty
+00005d00: 7065 275d 203d 3d20 2766 6c6f 6174 273a  pe'] == 'float':
+00005d10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00005d20: 2020 795f 7472 7565 2c20 795f 7072 6564    y_true, y_pred
+00005d30: 203d 2073 656c 662e 7072 6564 6963 7428   = self.predict(
+00005d40: 7365 6c66 2e64 6174 6173 6574 2e68 5f70  self.dataset.h_p
+00005d50: 6172 616d 735b 2774 6573 745f 7061 7468  arams['test_path
+00005d60: 7327 5d29 0d0a 2020 2020 2020 2020 2020  s'])..          
+00005d70: 2020 2020 2020 726d 735f 7465 7374 203d        rms_test =
+00005d80: 2072 6567 7265 7373 696f 6e5f 6d65 7472   regression_metr
+00005d90: 6963 7328 795f 7472 7565 2c20 795f 7072  ics(y_true, y_pr
+00005da0: 6564 290d 0a20 2020 2020 2020 2020 2020  ed)..           
+00005db0: 2020 2020 2070 7269 6e74 2822 5465 7374       print("Test
+00005dc0: 2073 6574 3a20 436f 7272 203d 222c 2072   set: Corr =", r
+00005dd0: 6d73 5f74 6573 745b 2763 6327 5d2c 2022  ms_test['cc'], "
+00005de0: 5232 203d 222c 2072 6d73 5f74 6573 745b  R2 =", rms_test[
+00005df0: 2772 3227 5d29 0d0a 2020 2020 2020 2020  'r2'])..        
+00005e00: 2020 2020 2020 2020 7265 7375 6c74 732e          results.
+00005e10: 7570 6461 7465 287b 2774 6573 745f 272b  update({'test_'+
+00005e20: 6b3a 7620 666f 7220 6b2c 7620 696e 2072  k:v for k,v in r
+00005e30: 6d73 5f74 6573 742e 6974 656d 7328 297d  ms_test.items()}
+00005e40: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
+00005e50: 6573 756c 7473 5b27 7465 7374 5f6d 6574  esults['test_met
+00005e60: 7269 6327 5d20 3d20 745f 6d65 7472 6963  ric'] = t_metric
+00005e70: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00005e80: 7375 6c74 735b 2774 6573 745f 6c6f 7373  sults['test_loss
+00005e90: 275d 203d 2074 5f6c 6f73 730d 0a20 2020  '] = t_loss..   
+00005ea0: 2020 2020 2020 2020 2072 6573 756c 7473           results
+00005eb0: 5b27 7465 7374 5f6d 6574 7269 6373 275d  ['test_metrics']
+00005ec0: 203d 2073 656c 662e 6376 5f74 6573 745f   = self.cv_test_
+00005ed0: 6d65 7472 6963 730d 0a20 2020 2020 2020  metrics..       
+00005ee0: 2020 2020 2072 6573 756c 7473 5b27 7465       results['te
+00005ef0: 7374 5f6c 6f73 7365 7327 5d20 3d20 7365  st_losses'] = se
+00005f00: 6c66 2e63 765f 7465 7374 5f6c 6f73 7365  lf.cv_test_losse
+00005f10: 730d 0a0d 0a20 2020 2020 2020 2065 6c73  s....        els
+00005f20: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00005f30: 7265 7375 6c74 735b 2774 6573 745f 6d65  results['test_me
+00005f40: 7472 6963 275d 203d 2022 4e41 220d 0a20  tric'] = "NA".. 
+00005f50: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00005f60: 7473 5b27 7465 7374 5f6c 6f73 7327 5d20  ts['test_loss'] 
+00005f70: 3d20 224e 4122 0d0a 2020 2020 2020 2020  = "NA"..        
+00005f80: 2020 2020 7265 7375 6c74 735b 2774 6573      results['tes
+00005f90: 745f 6d65 7472 6963 7327 5d20 3d20 224e  t_metrics'] = "N
+00005fa0: 4122 0d0a 2020 2020 2020 2020 2020 2020  A"..            
+00005fb0: 7265 7375 6c74 735b 2774 6573 745f 6c6f  results['test_lo
+00005fc0: 7373 6573 275d 203d 2022 4e41 220d 0a20  sses'] = "NA".. 
+00005fd0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00005fe0: 2072 6573 756c 7473 5b27 636d 275d 203d   results['cm'] =
+00005ff0: 2073 656c 662e 636d 0d0a 2020 2020 2020   self.cm..      
+00006000: 2020 0d0a 2020 2020 2020 2020 7365 6c66    ..        self
+00006010: 2e6d 6574 612e 7570 6461 7465 2872 6573  .meta.update(res
+00006020: 756c 7473 3d72 6573 756c 7473 290d 0a20  ults=results).. 
+00006030: 2020 2020 2020 200d 0a20 2020 2064 6566         ..    def
+00006040: 2075 7064 6174 655f 6c6f 6728 7365 6c66   update_log(self
+00006050: 2c20 726d 733d 4e6f 6e65 2c20 7072 6566  , rms=None, pref
+00006060: 6978 3d27 2729 3a0d 0a20 2020 2020 2020  ix=''):..       
+00006070: 2022 2222 4c6f 6773 2065 7870 6572 696d   """Logs experim
+00006080: 656e 7420 746f 2073 656c 662e 6d6f 6465  ent to self.mode
+00006090: 6c5f 7061 7468 202b 2073 656c 662e 7363  l_path + self.sc
+000060a0: 6f70 6520 2b20 275f 6c6f 672e 6373 7627  ope + '_log.csv'
+000060b0: 2e0d 0a0d 0a20 2020 2020 2020 2049 6620  .....        If 
+000060c0: 7468 6520 6669 6c65 2065 7869 7374 732c  the file exists,
+000060d0: 2061 7070 656e 6473 2061 206c 696e 6520   appends a line 
+000060e0: 746f 2074 6865 2065 7869 7374 696e 6720  to the existing 
+000060f0: 6669 6c65 2e0d 0a20 2020 2020 2020 2022  file...        "
+00006100: 2222 0d0a 2020 2020 2020 2020 7361 7665  ""..        save
+00006110: 7061 7468 203d 206f 732e 7061 7468 2e6a  path = os.path.j
+00006120: 6f69 6e28 7365 6c66 2e6d 6f64 656c 5f70  oin(self.model_p
+00006130: 6174 682c 2073 656c 662e 7363 6f70 6520  ath, self.scope 
+00006140: 2b20 275f 6c6f 672e 6373 7627 290d 0a20  + '_log.csv').. 
+00006150: 2020 2020 2020 2061 7070 656e 6469 6e67         appending
+00006160: 203d 206f 732e 7061 7468 2e65 7869 7374   = os.path.exist
+00006170: 7328 7361 7665 7061 7468 290d 0a20 2020  s(savepath)..   
+00006180: 2020 2020 2073 656c 662e 7570 6461 7465       self.update
+00006190: 5f72 6573 756c 7473 2829 0d0a 0d0a 2020  _results()....  
+000061a0: 2020 2020 2020 6c6f 6720 3d20 6469 6374        log = dict
+000061b0: 2829 0d0a 2020 2020 2020 2020 6966 2072  ()..        if r
+000061c0: 6d73 3a0d 0a20 2020 2020 2020 2020 2020  ms:..           
+000061d0: 206c 6f67 2e75 7064 6174 6528 7b70 7265   log.update({pre
+000061e0: 6669 782b 6b3a 7620 666f 7220 6b2c 7620  fix+k:v for k,v 
+000061f0: 696e 2072 6d73 2e69 7465 6d73 2829 7d29  in rms.items()})
+00006200: 0d0a 0d0a 2020 2020 2020 2020 2364 6174  ....        #dat
+00006210: 6173 6574 2069 6e66 6f0d 0a20 2020 2020  aset info..     
+00006220: 2020 2064 6174 615f 6469 6374 203d 2073     data_dict = s
+00006230: 656c 662e 6d65 7461 2e64 6174 612e 636f  elf.meta.data.co
+00006240: 7079 2829 0d0a 2020 2020 2020 2020 5f20  py()..        _ 
+00006250: 3d20 6461 7461 5f64 6963 742e 706f 7028  = data_dict.pop(
+00006260: 2766 6f6c 6473 2729 0d0a 2020 2020 2020  'folds')..      
+00006270: 2020 5f20 3d20 6461 7461 5f64 6963 742e    _ = data_dict.
+00006280: 706f 7028 2774 6573 745f 666f 6c64 2729  pop('test_fold')
+00006290: 0d0a 2020 2020 2020 2020 5f20 3d20 6461  ..        _ = da
+000062a0: 7461 5f64 6963 742e 706f 7028 2774 7261  ta_dict.pop('tra
+000062b0: 696e 5f70 6174 6873 2729 0d0a 2020 2020  in_paths')..    
+000062c0: 2020 2020 5f20 3d20 6461 7461 5f64 6963      _ = data_dic
+000062d0: 742e 706f 7028 2774 6573 745f 7061 7468  t.pop('test_path
+000062e0: 7327 290d 0a20 2020 2020 2020 206c 6f67  s')..        log
+000062f0: 5b27 6461 7461 5f69 6427 5d20 3d20 6461  ['data_id'] = da
+00006300: 7461 5f64 6963 742e 706f 7028 2764 6174  ta_dict.pop('dat
+00006310: 615f 6964 2729 0d0a 2020 2020 2020 2020  a_id')..        
+00006320: 0d0a 2020 2020 2020 2020 2372 6573 756c  ..        #resul
+00006330: 7473 2069 6e66 6f0d 0a20 2020 2020 2020  ts info..       
+00006340: 2072 6573 756c 7473 5f64 6963 7420 3d20   results_dict = 
+00006350: 7365 6c66 2e6d 6574 612e 7265 7375 6c74  self.meta.result
+00006360: 732e 636f 7079 2829 0d0a 2020 2020 2020  s.copy()..      
+00006370: 2020 6c6f 675b 2774 7261 696e 206d 6574    log['train met
+00006380: 7269 6327 5d20 3d20 7265 7375 6c74 735f  ric'] = results_
+00006390: 6469 6374 2e70 6f70 2827 7472 5f6d 6574  dict.pop('tr_met
+000063a0: 7269 6327 290d 0a20 2020 2020 2020 206c  ric')..        l
+000063b0: 6f67 5b27 7661 6c69 6461 7469 6f6e 206d  og['validation m
+000063c0: 6574 7269 6327 5d20 3d20 7265 7375 6c74  etric'] = result
+000063d0: 735f 6469 6374 2e70 6f70 2827 765f 6d65  s_dict.pop('v_me
+000063e0: 7472 6963 2729 0d0a 2020 2020 2020 2020  tric')..        
+000063f0: 6c6f 675b 2774 6573 7420 6d65 7472 6963  log['test metric
+00006400: 275d 203d 2020 7265 7375 6c74 735f 6469  '] =  results_di
+00006410: 6374 2e70 6f70 2827 7465 7374 5f6d 6574  ct.pop('test_met
+00006420: 7269 6327 290d 0a20 2020 2020 2020 206c  ric')..        l
+00006430: 6f67 5b27 7472 6169 6e20 6c6f 7373 275d  og['train loss']
+00006440: 203d 2072 6573 756c 7473 5f64 6963 742e   = results_dict.
+00006450: 706f 7028 2774 725f 6c6f 7373 2729 0d0a  pop('tr_loss')..
+00006460: 2020 2020 2020 2020 6c6f 675b 2776 616c          log['val
+00006470: 6964 6174 696f 6e20 6c6f 7373 275d 203d  idation loss'] =
+00006480: 2072 6573 756c 7473 5f64 6963 742e 706f   results_dict.po
+00006490: 7028 2776 5f6c 6f73 7327 290d 0a20 2020  p('v_loss')..   
+000064a0: 2020 2020 206c 6f67 5b27 7465 7374 206c       log['test l
+000064b0: 6f73 7327 5d20 3d20 2072 6573 756c 7473  oss'] =  results
+000064c0: 5f64 6963 742e 706f 7028 2774 6573 745f  _dict.pop('test_
+000064d0: 6c6f 7373 2729 0d0a 2020 2020 2020 2020  loss')..        
+000064e0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+000064f0: 2020 2020 2366 6f72 6d61 7420 7370 6563      #format spec
+00006500: 733a 2061 7263 6869 7465 6374 7572 6520  s: architecture 
+00006510: 616e 6420 7265 6775 6c61 7269 7a61 7469  and regularizati
+00006520: 6f6e 0d0a 2020 2020 2020 2020 7370 6563  on..        spec
+00006530: 735f 6469 6374 203d 2073 656c 662e 6d65  s_dict = self.me
+00006540: 7461 2e6d 6f64 656c 5f73 7065 6373 2e63  ta.model_specs.c
+00006550: 6f70 7928 290d 0a20 2020 2020 2020 2073  opy()..        s
+00006560: 7065 6373 5f64 6963 745b 276c 315f 7363  pecs_dict['l1_sc
+00006570: 6f70 6527 5d20 3d20 272d 272e 6a6f 696e  ope'] = '-'.join
+00006580: 2873 656c 662e 6d65 7461 2e6d 6f64 656c  (self.meta.model
+00006590: 5f73 7065 6373 5b27 6c31 5f73 636f 7065  _specs['l1_scope
+000065a0: 275d 290d 0a20 2020 2020 2020 2073 7065  '])..        spe
+000065b0: 6373 5f64 6963 745b 276c 325f 7363 6f70  cs_dict['l2_scop
+000065c0: 6527 5d20 3d20 272d 272e 6a6f 696e 2873  e'] = '-'.join(s
+000065d0: 656c 662e 6d65 7461 2e6d 6f64 656c 5f73  elf.meta.model_s
+000065e0: 7065 6373 5b27 6c32 5f73 636f 7065 275d  pecs['l2_scope']
+000065f0: 290d 0a20 2020 2020 2020 2073 7065 6373  )..        specs
+00006600: 5f64 6963 745b 2775 6e69 746e 6f72 6d5f  _dict['unitnorm_
+00006610: 7363 6f70 6527 5d20 3d20 272d 272e 6a6f  scope'] = '-'.jo
+00006620: 696e 2873 656c 662e 6d65 7461 2e6d 6f64  in(self.meta.mod
+00006630: 656c 5f73 7065 6373 5b27 756e 6974 6e6f  el_specs['unitno
+00006640: 726d 5f73 636f 7065 275d 290d 0a20 2020  rm_scope'])..   
+00006650: 2020 2020 205f 203d 2073 7065 6373 5f64       _ = specs_d
+00006660: 6963 742e 706f 7028 276d 6f64 656c 5f70  ict.pop('model_p
+00006670: 6174 6827 290d 0a20 2020 2020 2020 2069  ath')..        i
+00006680: 6620 6973 696e 7374 616e 6365 2873 7065  f isinstance(spe
+00006690: 6373 5f64 6963 745b 276e 6f6e 6c69 6e27  cs_dict['nonlin'
+000066a0: 5d2c 2043 616c 6c61 626c 6529 3a0d 0a20  ], Callable):.. 
+000066b0: 2020 2020 2020 2020 2020 2073 7065 6373             specs
+000066c0: 5f64 6963 745b 276e 6f6e 6c69 6e27 5d20  _dict['nonlin'] 
+000066d0: 3d20 7370 6563 735f 6469 6374 5b27 6e6f  = specs_dict['no
+000066e0: 6e6c 696e 275d 2e5f 5f6e 616d 655f 5f0d  nlin'].__name__.
+000066f0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+00006700: 2020 206c 6f67 2e75 7064 6174 6528 7370     log.update(sp
+00006710: 6563 735f 6469 6374 290d 0a20 2020 2020  ecs_dict)..     
+00006720: 2020 2023 7472 6169 6e69 6e67 2070 6172     #training par
+00006730: 616d 7465 7273 0d0a 2020 2020 2020 2020  amters..        
+00006740: 6c6f 672e 7570 6461 7465 2873 656c 662e  log.update(self.
+00006750: 6d65 7461 2e74 7261 696e 5f70 6172 616d  meta.train_param
+00006760: 7329 0d0a 2020 2020 2020 2020 6c6f 672e  s)..        log.
+00006770: 7570 6461 7465 2864 6174 615f 6469 6374  update(data_dict
+00006780: 290d 0a20 2020 2020 2020 206c 6f67 2e75  )..        log.u
+00006790: 7064 6174 6528 7265 7375 6c74 735f 6469  pdate(results_di
+000067a0: 6374 290d 0a20 2020 2020 2020 200d 0a20  ct)..        .. 
+000067b0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+000067c0: 2073 656c 662e 6c6f 672e 7570 6461 7465   self.log.update
+000067d0: 286c 6f67 290d 0a0d 0a20 2020 2020 2020  (log)....       
+000067e0: 2077 6974 6820 6f70 656e 2873 6176 6570   with open(savep
+000067f0: 6174 682c 2027 612b 272c 206e 6577 6c69  ath, 'a+', newli
+00006800: 6e65 3d27 2729 2061 7320 6373 765f 6669  ne='') as csv_fi
+00006810: 6c65 3a0d 0a20 2020 2020 2020 2020 2020  le:..           
+00006820: 2077 7269 7465 7220 3d20 6373 762e 4469   writer = csv.Di
+00006830: 6374 5772 6974 6572 2863 7376 5f66 696c  ctWriter(csv_fil
+00006840: 652c 2066 6965 6c64 6e61 6d65 733d 7365  e, fieldnames=se
+00006850: 6c66 2e6c 6f67 2e6b 6579 7328 2929 0d0a  lf.log.keys())..
+00006860: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00006870: 6f74 2061 7070 656e 6469 6e67 3a0d 0a20  ot appending:.. 
+00006880: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00006890: 7269 7465 722e 7772 6974 6568 6561 6465  riter.writeheade
+000068a0: 7228 290d 0a20 2020 2020 2020 2020 2020  r()..           
+000068b0: 2077 7269 7465 722e 7772 6974 6572 6f77   writer.writerow
+000068c0: 2873 656c 662e 6c6f 6729 0d0a 2020 2020  (self.log)..    
+000068d0: 2020 2020 2020 2020 7072 696e 7428 2253          print("S
+000068e0: 6176 696e 6720 7570 6461 7465 6420 6c6f  aving updated lo
+000068f0: 6720 746f 3a20 222c 2020 7361 7665 7061  g to: ",  savepa
+00006900: 7468 290d 0a0d 0a20 2020 2064 6566 2073  th)....    def s
+00006910: 6176 6528 7365 6c66 293a 0d0a 2020 2020  ave(self):..    
+00006920: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+00006930: 2053 6176 6573 2074 6865 206d 6f64 656c   Saves the model
+00006940: 2061 6e64 2028 6f70 7469 6f6e 616c 6c79   and (optionally
+00006950: 2c20 7061 7474 6572 6e73 2c20 636f 6e66  , patterns, conf
+00006960: 7573 696f 6e20 6d61 7472 6963 6573 290d  usion matrices).
+00006970: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+00006980: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00006990: 7365 6c66 2e75 7064 6174 655f 7265 7375  self.update_resu
+000069a0: 6c74 7328 290d 0a20 2020 2020 2020 2077  lts()..        w
+000069b0: 6569 6768 7473 203d 207b 6b3a 206e 702e  eights = {k: np.
+000069c0: 7374 6163 6b28 7365 6c66 2e63 765f 7765  stack(self.cv_we
+000069d0: 6967 6874 735b 6b5d 2c20 2d31 2920 666f  ights[k], -1) fo
+000069e0: 7220 6b20 696e 2073 656c 662e 6376 5f77  r k in self.cv_w
+000069f0: 6569 6768 7473 2e6b 6579 7328 297d 0d0a  eights.keys()}..
+00006a00: 2020 2020 2020 2020 2355 7064 6174 6520          #Update 
+00006a10: 616e 6420 7361 7665 206d 6574 6120 6669  and save meta fi
+00006a20: 6c65 0d0a 2020 2020 2020 2020 7365 6c66  le..        self
+00006a30: 2e6d 6574 612e 7570 6461 7465 2864 6174  .meta.update(dat
+00006a40: 613d 7365 6c66 2e64 6174 6173 6574 2e68  a=self.dataset.h
+00006a50: 5f70 6172 616d 732c 0d0a 2020 2020 2020  _params,..      
+00006a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006a70: 2020 206d 6f64 656c 5f73 7065 6373 3d73     model_specs=s
+00006a80: 656c 662e 7370 6563 732c 0d0a 2020 2020  elf.specs,..    
+00006a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006aa0: 2020 2020 2070 6174 7465 726e 733d 7365       patterns=se
+00006ab0: 6c66 2e63 765f 7061 7474 6572 6e73 2c0d  lf.cv_patterns,.
+00006ac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006ad0: 2020 2020 2020 2020 2020 7765 6967 6874            weight
+00006ae0: 733d 7765 6967 6874 7329 0d0a 2020 2020  s=weights)..    
+00006af0: 2020 2020 2373 656c 662e 6d65 7461 2e73      #self.meta.s
+00006b00: 6176 6528 290d 0a20 2020 2020 2020 200d  ave()..        .
+00006b10: 0a20 2020 2020 2020 2023 206d 6f64 656c  .        # model
+00006b20: 5f6e 616d 6520 3d20 225f 222e 6a6f 696e  _name = "_".join
+00006b30: 285b 7365 6c66 2e73 636f 7065 2c0d 0a20  ([self.scope,.. 
+00006b40: 2020 2020 2020 2023 2020 2020 2020 2020         #        
+00006b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006b60: 7365 6c66 2e64 6174 6173 6574 2e68 5f70  self.dataset.h_p
+00006b70: 6172 616d 735b 2764 6174 615f 6964 275d  arams['data_id']
+00006b80: 5d29 0d0a 2020 2020 2020 2020 2373 656c  ])..        #sel
+00006b90: 662e 7370 6563 735b 276d 6f64 656c 5f6e  f.specs['model_n
+00006ba0: 616d 6527 5d20 3d20 6d6f 6465 6c5f 6e61  ame'] = model_na
+00006bb0: 6d65 0d0a 0d0a 2020 2020 2020 2020 2373  me....        #s
+00006bc0: 6176 6520 7468 6520 6d6f 6465 6c0d 0a20  ave the model.. 
+00006bd0: 2020 2020 2020 2073 656c 662e 6b6d 2e73         self.km.s
+00006be0: 6176 6528 6f73 2e70 6174 682e 6a6f 696e  ave(os.path.join
+00006bf0: 2873 656c 662e 6d6f 6465 6c5f 7061 7468  (self.model_path
+00006c00: 2c20 7365 6c66 2e6d 6f64 656c 5f6e 616d  , self.model_nam
+00006c10: 6520 2b20 272e 6835 2729 290d 0a20 2020  e + '.h5'))..   
+00006c20: 2020 2020 200d 0a0d 0a20 2020 2020 2020       ....       
+00006c30: 2023 2023 5361 7665 2072 6573 756c 7473   # #Save results
+00006c40: 2066 726f 6d20 6d75 6c74 6970 6c65 2066   from multiple f
+00006c50: 6f6c 6473 0d0a 2020 2020 2020 2020 2320  olds..        # 
+00006c60: 6966 2068 6173 6174 7472 2873 656c 662c  if hasattr(self,
+00006c70: 2027 6376 5f70 6174 7465 726e 7327 293a   'cv_patterns'):
+00006c80: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
+00006c90: 2369 6620 6861 7361 7474 7228 7365 6c66  #if hasattr(self
+00006ca0: 2c20 2763 765f 7061 7474 6572 6e73 2729  , 'cv_patterns')
+00006cb0: 3a0d 0a20 2020 2020 2020 2023 2020 2020  :..        #    
+00006cc0: 2070 7269 6e74 2822 5361 7669 6e67 2070   print("Saving p
+00006cd0: 6174 7465 726e 7320 746f 3a20 2220 2b20  atterns to: " + 
+00006ce0: 7365 6c66 2e6d 6f64 656c 5f70 6174 6820  self.model_path 
+00006cf0: 2b20 7365 6c66 2e6d 6f64 656c 5f6e 616d  + self.model_nam
+00006d00: 6520 2b20 225c 5c6d 6e65 666c 6f77 5f70  e + "\\mneflow_p
+00006d10: 6174 7465 726e 732e 6e70 7a22 2029 0d0a  atterns.npz" )..
+00006d20: 2020 2020 2020 2020 2320 2020 2020 6e70          #     np
+00006d30: 2e73 6176 657a 2873 656c 662e 6d6f 6465  .savez(self.mode
+00006d40: 6c5f 7061 7468 202b 2073 656c 662e 6d6f  l_path + self.mo
+00006d50: 6465 6c5f 6e61 6d65 202b 2022 5c5c 6d6e  del_name + "\\mn
+00006d60: 6566 6c6f 775f 7061 7474 6572 6e73 2e6e  eflow_patterns.n
+00006d70: 707a 222c 0d0a 2020 2020 2020 2020 2320  pz",..        # 
+00006d80: 2020 2020 2020 2020 2020 2020 2063 765f               cv_
+00006d90: 7061 7474 6572 6e73 3d73 656c 662e 6376  patterns=self.cv
+00006da0: 5f70 6174 7465 726e 732c 0d0a 2020 2020  _patterns,..    
+00006db0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00006dc0: 2020 2073 7065 6373 3d73 656c 662e 7370     specs=self.sp
+00006dd0: 6563 732c 0d0a 2020 2020 2020 2020 2320  ecs,..        # 
+00006de0: 2020 2020 2020 2020 2020 2020 206d 6574               met
+00006df0: 613d 7365 6c66 2e64 6174 6173 6574 2e68  a=self.dataset.h
+00006e00: 5f70 6172 616d 732c 0d0a 2020 2020 2020  _params,..      
+00006e10: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00006e20: 206c 6f67 3d73 656c 662e 6c6f 672c 0d0a   log=self.log,..
+00006e30: 2020 2020 2020 2020 2320 2020 2020 2020          #       
+00006e40: 2020 2020 2020 2063 6d3d 7365 6c66 2e63         cm=self.c
+00006e50: 6d2c 0d0a 2020 2020 2020 2020 2320 2020  m,..        #   
+00006e60: 2020 2020 2020 2020 2020 2029 0d0a 0d0a             )....
+00006e70: 2020 2020 2020 2020 2355 7064 6174 6520          #Update 
+00006e80: 6d65 7461 6461 7461 2077 6974 6820 7370  metadata with sp
+00006e90: 6563 7320 616e 6420 6e65 7720 7365 6c66  ecs and new self
+00006ea0: 2e64 6174 6173 6574 206f 7074 696f 6e73  .dataset options
+00006eb0: 0d0a 2020 2020 2020 2020 2346 6f72 204c  ..        #For L
+00006ec0: 4643 4e4e 2073 6176 6520 7061 7474 6572  FCNN save patter
+00006ed0: 6e73 0d0a 0d0a 2020 2020 2320 6465 6620  ns....    # def 
+00006ee0: 7265 7374 6f72 6528 7365 6c66 2c20 6d65  restore(self, me
+00006ef0: 7461 293a 0d0a 2020 2020 2320 2020 2020  ta):..    #     
+00006f00: 2354 4f44 4f3a 2074 616b 6520 7061 7468  #TODO: take path
+00006f10: 2c20 7363 6f70 652c 2061 6e64 2064 6174  , scope, and dat
+00006f20: 615f 6964 2061 7320 696e 7075 7473 2e0d  a_id as inputs..
+00006f30: 0a20 2020 2023 2020 2020 2023 544f 444f  .    #     #TODO
+00006f40: 3a20 6275 696c 6420 6461 7461 7365 7420  : build dataset 
+00006f50: 6672 6f6d 206d 6574 6164 6174 610d 0a20  from metadata.. 
+00006f60: 2020 2023 2020 2020 2023 544f 444f 3a20     #     #TODO: 
+00006f70: 696e 6974 6961 6c69 7a65 2066 726f 6d20  initialize from 
+00006f80: 7370 6563 730d 0a0d 0a20 2020 2023 2020  specs....    #  
+00006f90: 2020 2073 656c 662e 6d6f 6465 6c5f 6e61     self.model_na
+00006fa0: 6d65 203d 2022 5f22 2e6a 6f69 6e28 5b73  me = "_".join([s
+00006fb0: 656c 662e 7363 6f70 652c 0d0a 2020 2020  elf.scope,..    
+00006fc0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+00006fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006fe0: 2020 7365 6c66 2e64 6174 6173 6574 2e68    self.dataset.h
+00006ff0: 5f70 6172 616d 735b 2764 6174 615f 6964  _params['data_id
+00007000: 275d 5d29 0d0a 2020 2020 2320 2020 2020  ']])..    #     
+00007010: 7365 6c66 2e6b 6d20 203d 2074 662e 6b65  self.km  = tf.ke
+00007020: 7261 732e 6d6f 6465 6c73 2e6c 6f61 645f  ras.models.load_
+00007030: 6d6f 6465 6c28 7365 6c66 2e6d 6f64 656c  model(self.model
+00007040: 5f70 6174 6820 2b20 7365 6c66 2e6d 6f64  _path + self.mod
+00007050: 656c 5f6e 616d 6529 0d0a 2020 2020 2320  el_name)..    # 
+00007060: 2020 2020 2374 7279 3a0d 0a0d 0a20 2020      #try:....   
+00007070: 2023 2020 2020 2069 6620 6f73 2e70 6174   #     if os.pat
+00007080: 682e 6578 6973 7473 2873 656c 662e 6d6f  h.exists(self.mo
+00007090: 6465 6c5f 7061 7468 202b 2073 656c 662e  del_path + self.
+000070a0: 6d6f 6465 6c5f 6e61 6d65 202b 2022 5c5c  model_name + "\\
+000070b0: 6d6e 6566 6c6f 775f 7061 7474 6572 6e73  mneflow_patterns
+000070c0: 2e6e 707a 2229 3a0d 0a20 2020 2023 2020  .npz"):..    #  
+000070d0: 2020 2020 2020 2070 7269 6e74 2822 5265         print("Re
+000070e0: 7374 6f72 696e 6720 6672 6f6d 3a22 202b  storing from:" +
+000070f0: 2073 656c 662e 6d6f 6465 6c5f 7061 7468   self.model_path
+00007100: 202b 2073 656c 662e 6d6f 6465 6c5f 6e61   + self.model_na
+00007110: 6d65 202b 2022 5c5c 6d6e 6566 6c6f 775f  me + "\\mneflow_
+00007120: 7061 7474 6572 6e73 2e6e 707a 2220 290d  patterns.npz" ).
+00007130: 0a20 2020 2023 2020 2020 2020 2020 2066  .    #         f
+00007140: 203d 206e 702e 6c6f 6164 2873 656c 662e   = np.load(self.
+00007150: 6d6f 6465 6c5f 7061 7468 202b 2073 656c  model_path + sel
+00007160: 662e 6d6f 6465 6c5f 6e61 6d65 202b 2022  f.model_name + "
+00007170: 5c5c 6d6e 6566 6c6f 775f 7061 7474 6572  \\mneflow_patter
+00007180: 6e73 2e6e 707a 222c 0d0a 2020 2020 2320  ns.npz",..    # 
+00007190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000071a0: 2020 2020 616c 6c6f 775f 7069 636b 6c65      allow_pickle
+000071b0: 3d54 7275 6529 0d0a 2020 2020 2320 2020  =True)..    #   
+000071c0: 2020 2020 2020 7365 6c66 2e63 765f 7061        self.cv_pa
+000071d0: 7474 6572 6e73 203d 2066 5b22 6376 5f70  tterns = f["cv_p
+000071e0: 6174 7465 726e 7322 5d23 2e69 7465 6d28  atterns"]#.item(
+000071f0: 290d 0a20 2020 2023 2020 2020 2020 2020  )..    #        
+00007200: 2073 656c 662e 7370 6563 7320 3d20 665b   self.specs = f[
+00007210: 2273 7065 6373 225d 232e 6974 656d 2829  "specs"]#.item()
+00007220: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
+00007230: 7365 6c66 2e6d 6574 6120 3d20 665b 226d  self.meta = f["m
+00007240: 6574 6122 5d23 2e69 7465 6d28 290d 0a20  eta"]#.item().. 
+00007250: 2020 2023 2020 2020 2020 2020 2073 656c     #         sel
+00007260: 662e 6c6f 6720 3d20 665b 226c 6f67 225d  f.log = f["log"]
+00007270: 232e 6974 656d 2829 0d0a 2020 2020 2320  #.item()..    # 
+00007280: 2020 2020 2020 2020 7365 6c66 2e63 6d20          self.cm 
+00007290: 3d20 665b 2263 6d22 5d0d 0a0d 0a20 2020  = f["cm"]....   
+000072a0: 2064 6566 2070 7265 6469 6374 5f73 616d   def predict_sam
+000072b0: 706c 6528 7365 6c66 2c20 7829 3a0d 0a20  ple(self, x):.. 
+000072c0: 2020 2020 2020 206e 5f63 6820 3d20 7365         n_ch = se
+000072d0: 6c66 2e64 6174 6173 6574 2e68 5f70 6172  lf.dataset.h_par
+000072e0: 616d 735b 276e 5f63 6827 5d0d 0a20 2020  ams['n_ch']..   
+000072f0: 2020 2020 206e 5f74 203d 2073 656c 662e       n_t = self.
+00007300: 6461 7461 7365 742e 685f 7061 7261 6d73  dataset.h_params
+00007310: 5b27 6e5f 7427 5d0d 0a20 2020 2020 2020  ['n_t']..       
+00007320: 2061 7373 6572 7420 782e 7368 6170 655b   assert x.shape[
+00007330: 2d32 3a5d 203d 3d20 286e 5f74 2c20 6e5f  -2:] == (n_t, n_
+00007340: 6368 292c 2020 2253 6861 7065 206d 6973  ch),  "Shape mis
+00007350: 6d61 7463 6821 2045 7870 6563 7465 6420  match! Expected 
+00007360: 7b7d 787b 7d2c 205c 0d0a 2020 2020 2020  {}x{}, \..      
+00007370: 2020 2020 2020 676f 7420 7b7d 787b 7d22        got {}x{}"
+00007380: 2e66 6f72 6d61 7428 6e5f 742c 206e 5f63  .format(n_t, n_c
+00007390: 682c 2078 2e73 6861 7065 5b2d 325d 2c20  h, x.shape[-2], 
+000073a0: 782e 7368 6170 655b 2d31 5d29 0d0a 0d0a  x.shape[-1])....
+000073b0: 2020 2020 2020 2020 7768 696c 6520 782e          while x.
+000073c0: 6e64 696d 203c 2034 3a0d 0a20 2020 2020  ndim < 4:..     
+000073d0: 2020 2020 2020 2078 203d 206e 702e 6578         x = np.ex
+000073e0: 7061 6e64 5f64 696d 7328 782c 2030 290d  pand_dims(x, 0).
+000073f0: 0a0d 0a20 2020 2020 2020 206f 7574 203d  ...        out =
+00007400: 2073 656c 662e 6b6d 2e70 7265 6469 6374   self.km.predict
+00007410: 2878 290d 0a20 2020 2020 2020 2069 6620  (x)..        if 
+00007420: 7365 6c66 2e64 6174 6173 6574 2e68 5f70  self.dataset.h_p
+00007430: 6172 616d 735b 2774 6172 6765 745f 7479  arams['target_ty
+00007440: 7065 275d 203d 3d20 2769 6e74 273a 0d0a  pe'] == 'int':..
+00007450: 2020 2020 2020 2020 2020 2020 6f75 7420              out 
+00007460: 3d20 6e70 2e61 7267 6d61 7828 6f75 742c  = np.argmax(out,
+00007470: 202d 3129 0d0a 0d0a 2020 2020 2020 2020   -1)....        
+00007480: 7265 7475 726e 206f 7574 0d0a 0d0a 2020  return out....  
+00007490: 2020 6465 6620 7072 6564 6963 7428 7365    def predict(se
+000074a0: 6c66 2c20 6461 7461 7365 743d 4e6f 6e65  lf, dataset=None
+000074b0: 293a 0d0a 2020 2020 2020 2020 2222 220d  ):..        """.
+000074c0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+000074d0: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
+000074e0: 2d0d 0a20 2020 2020 2020 2079 5f74 7275  -..        y_tru
+000074f0: 6520 3a20 6e70 2e61 7272 6179 0d0a 2020  e : np.array..  
+00007500: 2020 2020 2020 2020 2020 2020 2020 6772                gr
+00007510: 6f75 6e64 2074 7275 7468 206c 6162 656c  ound truth label
+00007520: 7320 7461 6b65 6e20 6672 6f6d 2074 6865  s taken from the
+00007530: 2064 6174 6173 6574 0d0a 0d0a 2020 2020   dataset....    
+00007540: 2020 2020 795f 7072 6564 203a 206e 702e      y_pred : np.
+00007550: 6172 7261 790d 0a20 2020 2020 2020 2020  array..         
+00007560: 2020 2020 2020 206d 6f64 656c 2070 7265         model pre
+00007570: 6469 6374 696f 6e73 0d0a 2020 2020 2020  dictions..      
+00007580: 2020 2222 220d 0a20 2020 2020 2020 2069    """..        i
+00007590: 6620 6e6f 7420 6461 7461 7365 743a 0d0a  f not dataset:..
+000075a0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+000075b0: 7428 224e 6f20 6461 7461 7365 7420 7370  t("No dataset sp
+000075c0: 6563 6966 6965 6420 7573 696e 6720 7661  ecified using va
+000075d0: 6c69 6461 7469 6f6e 2064 6174 6173 6574  lidation dataset
+000075e0: 2028 4465 6661 756c 7429 2229 0d0a 2020   (Default)")..  
+000075f0: 2020 2020 2020 2020 2020 6461 7461 7365            datase
+00007600: 7420 3d20 7365 6c66 2e64 6174 6173 6574  t = self.dataset
+00007610: 2e76 616c 0d0a 2020 2020 2020 2020 656c  .val..        el
+00007620: 6966 2069 7369 6e73 7461 6e63 6528 6461  if isinstance(da
+00007630: 7461 7365 742c 2073 7472 2920 6f72 2069  taset, str) or i
+00007640: 7369 6e73 7461 6e63 6528 6461 7461 7365  sinstance(datase
+00007650: 742c 2028 6c69 7374 2c20 7475 706c 6529  t, (list, tuple)
+00007660: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00007670: 6461 7461 7365 7420 3d20 7365 6c66 2e64  dataset = self.d
+00007680: 6174 6173 6574 2e5f 6275 696c 645f 6461  ataset._build_da
+00007690: 7461 7365 7428 6461 7461 7365 742c 0d0a  taset(dataset,..
+000076a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000076b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000076c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000076d0: 2073 706c 6974 3d46 616c 7365 2c0d 0a20   split=False,.. 
+000076e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000076f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007710: 7465 7374 5f62 6174 6368 3d4e 6f6e 652c  test_batch=None,
+00007720: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00007730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007750: 2020 2072 6570 6561 743d 4661 6c73 6529     repeat=False)
+00007760: 0d0a 2020 2020 2020 2020 656c 6966 206e  ..        elif n
+00007770: 6f74 2069 7369 6e73 7461 6e63 6528 6461  ot isinstance(da
+00007780: 7461 7365 742c 2074 662e 6461 7461 2e44  taset, tf.data.D
+00007790: 6174 6173 6574 293a 0d0a 2020 2020 2020  ataset):..      
+000077a0: 2020 2020 2020 7072 696e 7428 2253 7065        print("Spe
+000077b0: 6369 6679 2064 6174 6173 6574 2229 0d0a  cify dataset")..
+000077c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000077d0: 726e 204e 6f6e 652c 204e 6f6e 650d 0a0d  rn None, None...
+000077e0: 0a20 2020 2020 2020 2058 203d 205b 5d0d  .        X = [].
+000077f0: 0a20 2020 2020 2020 2079 203d 205b 5d0d  .        y = [].
+00007800: 0a0d 0a20 2020 2020 2020 2066 6f72 2072  ...        for r
+00007810: 6f77 2069 6e20 6461 7461 7365 742e 7461  ow in dataset.ta
+00007820: 6b65 2831 293a 0d0a 2020 2020 2020 2020  ke(1):..        
+00007830: 2020 2020 582e 6170 7065 6e64 2872 6f77      X.append(row
+00007840: 5b30 5d29 0d0a 2020 2020 2020 2020 2020  [0])..          
+00007850: 2020 792e 6170 7065 6e64 2872 6f77 5b31    y.append(row[1
+00007860: 5d29 0d0a 0d0a 2020 2020 2020 2020 795f  ])....        y_
+00007870: 7072 6564 203d 2073 656c 662e 6b6d 2e70  pred = self.km.p
+00007880: 7265 6469 6374 286e 702e 636f 6e63 6174  redict(np.concat
+00007890: 656e 6174 6528 5829 290d 0a20 2020 2020  enate(X))..     
+000078a0: 2020 2079 5f74 7275 6520 3d20 6e70 2e63     y_true = np.c
+000078b0: 6f6e 6361 7465 6e61 7465 2879 290d 0a0d  oncatenate(y)...
+000078c0: 0a20 2020 2020 2020 2023 795f 7472 7565  .        #y_true
+000078d0: 203d 2079 5f74 7275 652e 6e75 6d70 7928   = y_true.numpy(
+000078e0: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+000078f0: 6e20 795f 7472 7565 2c20 795f 7072 6564  n y_true, y_pred
+00007900: 0d0a 0d0a 2020 2020 6465 6620 6576 616c  ....    def eval
+00007910: 7561 7465 2873 656c 662c 2064 6174 6173  uate(self, datas
+00007920: 6574 3d46 616c 7365 293a 0d0a 2020 2020  et=False):..    
+00007930: 2020 2020 2222 220d 0a20 2020 2020 2020      """..       
+00007940: 2052 6574 7572 6e73 0d0a 2020 2020 2020   Returns..      
+00007950: 2020 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020    -------..     
+00007960: 2020 206c 6f73 7365 7320 3a20 6c69 7374     losses : list
+00007970: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00007980: 2020 6d6f 6465 6c20 6c6f 7373 206f 6e20    model loss on 
+00007990: 6120 7370 6563 6966 6965 6420 6461 7461  a specified data
+000079a0: 7365 740d 0a0d 0a20 2020 2020 2020 206d  set....        m
+000079b0: 6574 7269 6373 203a 206e 702e 6172 7261  etrics : np.arra
+000079c0: 790d 0a20 2020 2020 2020 2020 2020 2020  y..             
+000079d0: 2020 206d 6574 7269 6373 2065 7661 6c75     metrics evalu
+000079e0: 6174 6564 206f 6e20 6120 7370 6563 6966  ated on a specif
+000079f0: 6965 6420 6461 7461 7365 740d 0a20 2020  ied dataset..   
+00007a00: 2020 2020 2022 2222 0d0a 0d0a 2020 2020       """....    
+00007a10: 2020 2020 6966 206e 6f74 2064 6174 6173      if not datas
+00007a20: 6574 3a0d 0a20 2020 2020 2020 2020 2020  et:..           
+00007a30: 2070 7269 6e74 2822 4e6f 2064 6174 6173   print("No datas
+00007a40: 6574 2073 7065 6369 6669 6564 2075 7369  et specified usi
+00007a50: 6e67 2076 616c 6964 6174 696f 6e20 6461  ng validation da
+00007a60: 7461 7365 7420 2844 6566 6175 6c74 2922  taset (Default)"
+00007a70: 290d 0a20 2020 2020 2020 2020 2020 2064  )..            d
+00007a80: 6174 6173 6574 203d 2073 656c 662e 6461  ataset = self.da
+00007a90: 7461 7365 742e 7661 6c0d 0a20 2020 2020  taset.val..     
+00007aa0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
+00007ab0: 6365 2864 6174 6173 6574 2c20 7374 7229  ce(dataset, str)
+00007ac0: 206f 7220 6973 696e 7374 616e 6365 2864   or isinstance(d
+00007ad0: 6174 6173 6574 2c20 286c 6973 742c 2074  ataset, (list, t
+00007ae0: 7570 6c65 2929 3a0d 0a20 2020 2020 2020  uple)):..       
+00007af0: 2020 2020 2064 6174 6173 6574 203d 2073       dataset = s
+00007b00: 656c 662e 6461 7461 7365 742e 5f62 7569  elf.dataset._bui
+00007b10: 6c64 5f64 6174 6173 6574 2864 6174 6173  ld_dataset(datas
+00007b20: 6574 2c0d 0a20 2020 2020 2020 2020 2020  et,..           
 00007b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00007b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007b50: 2073 7465 7073 3d73 656c 662e 6461 7461   steps=self.data
-00007b60: 7365 742e 7661 6c69 6461 7469 6f6e 5f73  set.validation_s
-00007b70: 7465 7073 2c0d 0a20 2020 2020 2020 2020  teps,..         
-00007b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007ba0: 2020 7665 7262 6f73 653d 3029 0d0a 2020    verbose=0)..  
-00007bb0: 2020 2020 2020 7265 7475 726e 2020 6c6f        return  lo
-00007bc0: 7373 6573 2c20 6d65 7472 6963 730d 0a0d  sses, metrics...
-00007bd0: 0a0d 0a0d 0a0d 0a0d 0a63 6c61 7373 204c  .........class L
-00007be0: 4643 4e4e 2842 6173 654d 6f64 656c 293a  FCNN(BaseModel):
-00007bf0: 0d0a 2020 2020 2222 224c 462d 434e 4e2e  ..    """LF-CNN.
-00007c00: 2049 6e63 6c75 6465 7320 6261 7369 6320   Includes basic 
-00007c10: 7061 7261 6d65 7465 7220 696e 7465 7270  parameter interp
-00007c20: 7265 7461 7469 6f6e 206f 7074 696f 6e73  retation options
-00007c30: 2e0d 0a0d 0a20 2020 2046 6f72 2064 6574  .....    For det
-00007c40: 6169 6c73 2073 6565 205b 315d 2e0d 0a20  ails see [1]... 
-00007c50: 2020 2052 6566 6572 656e 6365 730d 0a20     References.. 
-00007c60: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20     ----------.. 
-00007c70: 2020 2020 2020 205b 315d 2049 2e20 5a75         [1] I. Zu
-00007c80: 6261 7265 762c 2065 7420 616c 2e2c 2041  barev, et al., A
-00007c90: 6461 7074 6976 6520 6e65 7572 616c 206e  daptive neural n
-00007ca0: 6574 776f 726b 2063 6c61 7373 6966 6965  etwork classifie
-00007cb0: 7220 666f 720d 0a20 2020 2020 2020 2064  r for..        d
-00007cc0: 6563 6f64 696e 6720 4d45 4720 7369 676e  ecoding MEG sign
-00007cd0: 616c 732e 204e 6575 726f 696d 6167 652e  als. Neuroimage.
-00007ce0: 2028 3230 3139 2920 4d61 7920 343b 3139   (2019) May 4;19
-00007cf0: 373a 3432 352d 3433 340d 0a20 2020 2022  7:425-434..    "
-00007d00: 2222 0d0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
-00007d10: 6974 5f5f 2873 656c 662c 206d 6574 612c  it__(self, meta,
-00007d20: 2064 6174 6173 6574 3d4e 6f6e 6529 3a0d   dataset=None):.
-00007d30: 0a20 2020 2020 2020 2022 2222 0d0a 0d0a  .        """....
-00007d40: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
-00007d50: 7273 0d0a 2020 2020 2020 2020 2d2d 2d2d  rs..        ----
-00007d60: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
-00007d70: 4461 7461 7365 7420 3a20 6d6e 6566 6c6f  Dataset : mneflo
-00007d80: 772e 4461 7461 7365 740d 0a0d 0a20 2020  w.Dataset....   
-00007d90: 2020 2020 2073 7065 6373 203a 2064 6963       specs : dic
-00007da0: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
-00007db0: 2020 2064 6963 7469 6f6e 6172 7920 6f66     dictionary of
-00007dc0: 206d 6f64 656c 2068 7970 6572 7061 7261   model hyperpara
-00007dd0: 6d65 7465 7273 207b 0d0a 0d0a 2020 2020  meters {....    
-00007de0: 2020 2020 6e5f 6c61 7465 6e74 203a 2069      n_latent : i
-00007df0: 6e74 0d0a 2020 2020 2020 2020 2020 2020  nt..            
-00007e00: 4e75 6d62 6572 206f 6620 6c61 7465 6e74  Number of latent
-00007e10: 2063 6f6d 706f 6e65 6e74 732e 0d0a 2020   components...  
-00007e20: 2020 2020 2020 2020 2020 4465 6661 756c            Defaul
-00007e30: 7473 2074 6f20 3332 2e0d 0a0d 0a20 2020  ts to 32.....   
-00007e40: 2020 2020 206e 6f6e 6c69 6e20 3a20 6361       nonlin : ca
-00007e50: 6c6c 6162 6c65 0d0a 2020 2020 2020 2020  llable..        
-00007e60: 2020 2020 4163 7469 7661 7469 6f6e 2066      Activation f
-00007e70: 756e 6374 696f 6e20 6f66 2074 6865 2074  unction of the t
-00007e80: 656d 706f 7261 6c20 636f 6e76 6f6c 7574  emporal convolut
-00007e90: 696f 6e20 6c61 7965 722e 0d0a 2020 2020  ion layer...    
-00007ea0: 2020 2020 2020 2020 4465 6661 756c 7473          Defaults
-00007eb0: 2074 6f20 7466 2e6e 6e2e 7265 6c75 0d0a   to tf.nn.relu..
-00007ec0: 0d0a 2020 2020 2020 2020 6669 6c74 6572  ..        filter
-00007ed0: 5f6c 656e 6774 6820 3a20 696e 740d 0a20  _length : int.. 
-00007ee0: 2020 2020 2020 2020 2020 204c 656e 6774             Lengt
-00007ef0: 6820 6f66 2073 7061 7469 6f2d 7465 6d70  h of spatio-temp
-00007f00: 6f72 616c 206b 6572 6e65 6c73 2069 6e20  oral kernels in 
-00007f10: 7468 6520 7465 6d70 6f72 616c 0d0a 2020  the temporal..  
-00007f20: 2020 2020 2020 2020 2020 636f 6e76 6f6c            convol
-00007f30: 7574 696f 6e20 6c61 7965 722e 2044 6566  ution layer. Def
-00007f40: 6175 6c74 7320 746f 2037 2e0d 0a0d 0a20  aults to 7..... 
-00007f50: 2020 2020 2020 2070 6f6f 6c69 6e67 203a         pooling :
-00007f60: 2069 6e74 0d0a 2020 2020 2020 2020 2020   int..          
-00007f70: 2020 506f 6f6c 696e 6720 6661 6374 6f72    Pooling factor
-00007f80: 206f 6620 7468 6520 6d61 7820 706f 6f6c   of the max pool
-00007f90: 696e 6720 6c61 7965 722e 2044 6566 6175  ing layer. Defau
-00007fa0: 6c74 7320 746f 2032 0d0a 0d0a 2020 2020  lts to 2....    
-00007fb0: 2020 2020 706f 6f6c 5f74 7970 6520 3a20      pool_type : 
-00007fc0: 7374 7220 7b27 6176 6727 2c20 276d 6178  str {'avg', 'max
-00007fd0: 277d 0d0a 2020 2020 2020 2020 2020 2020  '}..            
-00007fe0: 5479 7065 206f 6620 706f 6f6c 696e 6720  Type of pooling 
-00007ff0: 6f70 6572 6174 696f 6e2e 2044 6566 6175  operation. Defau
-00008000: 6c74 7320 746f 2027 6d61 7827 2e0d 0a0d  lts to 'max'....
-00008010: 0a20 2020 2020 2020 2070 6164 6469 6e67  .        padding
-00008020: 203a 2073 7472 207b 2753 414d 4527 2c20   : str {'SAME', 
-00008030: 2746 554c 4c27 2c20 2756 414c 4944 277d  'FULL', 'VALID'}
-00008040: 0d0a 2020 2020 2020 2020 2020 2020 436f  ..            Co
-00008050: 6e76 6f6c 7574 696f 6e20 7061 6464 696e  nvolution paddin
-00008060: 672e 2044 6566 6175 6c74 7320 746f 2027  g. Defaults to '
-00008070: 5341 4d45 272e 7d0d 0a0d 0a20 2020 2020  SAME'.}....     
-00008080: 2020 2073 7472 6964 6520 3a20 696e 740d     stride : int.
-00008090: 0a20 2020 2020 2020 2053 7472 6964 6520  .        Stride 
-000080a0: 6f66 2074 6865 206d 6178 2070 6f6f 6c69  of the max pooli
-000080b0: 6e67 206c 6179 6572 2e20 4465 6661 756c  ng layer. Defaul
-000080c0: 7473 2074 6f20 312e 0d0a 2020 2020 2020  ts to 1...      
-000080d0: 2020 2222 220d 0a20 2020 2020 2020 2073    """..        s
-000080e0: 656c 662e 7363 6f70 6520 3d20 276c 6663  elf.scope = 'lfc
-000080f0: 6e6e 270d 0a20 2020 2020 2020 2023 7370  nn'..        #sp
-00008100: 6563 7320 3d20 6d65 7461 2e6d 6f64 656c  ecs = meta.model
-00008110: 5f73 7065 6373 0d0a 2020 2020 2020 2020  _specs..        
-00008120: 6d65 7461 2e6d 6f64 656c 5f73 7065 6373  meta.model_specs
-00008130: 2e73 6574 6465 6661 756c 7428 2766 696c  .setdefault('fil
-00008140: 7465 725f 6c65 6e67 7468 272c 2037 290d  ter_length', 7).
-00008150: 0a20 2020 2020 2020 206d 6574 612e 6d6f  .        meta.mo
-00008160: 6465 6c5f 7370 6563 732e 7365 7464 6566  del_specs.setdef
-00008170: 6175 6c74 2827 6e5f 6c61 7465 6e74 272c  ault('n_latent',
-00008180: 2033 3229 0d0a 2020 2020 2020 2020 6d65   32)..        me
-00008190: 7461 2e6d 6f64 656c 5f73 7065 6373 2e73  ta.model_specs.s
-000081a0: 6574 6465 6661 756c 7428 2770 6f6f 6c69  etdefault('pooli
-000081b0: 6e67 272c 2032 290d 0a20 2020 2020 2020  ng', 2)..       
-000081c0: 206d 6574 612e 6d6f 6465 6c5f 7370 6563   meta.model_spec
-000081d0: 732e 7365 7464 6566 6175 6c74 2827 7374  s.setdefault('st
-000081e0: 7269 6465 272c 2032 290d 0a20 2020 2020  ride', 2)..     
-000081f0: 2020 206d 6574 612e 6d6f 6465 6c5f 7370     meta.model_sp
-00008200: 6563 732e 7365 7464 6566 6175 6c74 2827  ecs.setdefault('
-00008210: 7061 6464 696e 6727 2c20 2753 414d 4527  padding', 'SAME'
-00008220: 290d 0a20 2020 2020 2020 206d 6574 612e  )..        meta.
-00008230: 6d6f 6465 6c5f 7370 6563 732e 7365 7464  model_specs.setd
-00008240: 6566 6175 6c74 2827 706f 6f6c 5f74 7970  efault('pool_typ
-00008250: 6527 2c20 276d 6178 2729 0d0a 2020 2020  e', 'max')..    
-00008260: 2020 2020 6d65 7461 2e6d 6f64 656c 5f73      meta.model_s
-00008270: 7065 6373 2e73 6574 6465 6661 756c 7428  pecs.setdefault(
-00008280: 276e 6f6e 6c69 6e27 2c20 7466 2e6e 6e2e  'nonlin', tf.nn.
-00008290: 7265 6c75 290d 0a20 2020 2020 2020 206d  relu)..        m
-000082a0: 6574 612e 6d6f 6465 6c5f 7370 6563 732e  eta.model_specs.
-000082b0: 7365 7464 6566 6175 6c74 2827 6c31 5f6c  setdefault('l1_l
-000082c0: 616d 6264 6127 2c20 3365 2d34 290d 0a20  ambda', 3e-4).. 
-000082d0: 2020 2020 2020 206d 6574 612e 6d6f 6465         meta.mode
-000082e0: 6c5f 7370 6563 732e 7365 7464 6566 6175  l_specs.setdefau
-000082f0: 6c74 2827 6c32 5f6c 616d 6264 6127 2c20  lt('l2_lambda', 
-00008300: 302e 290d 0a20 2020 2020 2020 206d 6574  0.)..        met
-00008310: 612e 6d6f 6465 6c5f 7370 6563 732e 7365  a.model_specs.se
-00008320: 7464 6566 6175 6c74 2827 6c31 5f73 636f  tdefault('l1_sco
-00008330: 7065 272c 205b 2766 6327 2c20 2764 656d  pe', ['fc', 'dem
-00008340: 6978 272c 2027 6c66 5f63 6f6e 7627 5d29  ix', 'lf_conv'])
-00008350: 0d0a 2020 2020 2020 2020 6d65 7461 2e6d  ..        meta.m
-00008360: 6f64 656c 5f73 7065 6373 2e73 6574 6465  odel_specs.setde
-00008370: 6661 756c 7428 276c 325f 7363 6f70 6527  fault('l2_scope'
-00008380: 2c20 5b5d 290d 0a20 2020 2020 2020 206d  , [])..        m
-00008390: 6574 612e 6d6f 6465 6c5f 7370 6563 732e  eta.model_specs.
-000083a0: 7365 7464 6566 6175 6c74 2827 756e 6974  setdefault('unit
-000083b0: 6e6f 726d 5f73 636f 7065 272c 205b 5d29  norm_scope', [])
-000083c0: 0d0a 2020 2020 2020 2020 6d65 7461 2e6d  ..        meta.m
-000083d0: 6f64 656c 5f73 7065 6373 5b27 7363 6f70  odel_specs['scop
-000083e0: 6527 5d20 3d20 7365 6c66 2e73 636f 7065  e'] = self.scope
-000083f0: 0d0a 2020 2020 2020 2020 2373 7065 6373  ..        #specs
-00008400: 2e73 6574 6465 6661 756c 7428 276d 6f64  .setdefault('mod
-00008410: 656c 5f70 6174 6827 2c20 2073 656c 662e  el_path',  self.
-00008420: 6461 7461 7365 742e 685f 7061 7261 6d73  dataset.h_params
-00008430: 5b27 7361 7665 5f70 6174 6827 5d29 0d0a  ['save_path'])..
-00008440: 2020 2020 2020 2020 7375 7065 7228 4c46          super(LF
-00008450: 434e 4e2c 2073 656c 6629 2e5f 5f69 6e69  CNN, self).__ini
-00008460: 745f 5f28 6d65 7461 2c20 6461 7461 7365  t__(meta, datase
-00008470: 7429 0d0a 0d0a 0d0a 0d0a 2020 2020 6465  t)........    de
-00008480: 6620 6275 696c 645f 6772 6170 6828 7365  f build_graph(se
-00008490: 6c66 293a 0d0a 2020 2020 2020 2020 2222  lf):..        ""
-000084a0: 2242 7569 6c64 2063 6f6d 7075 7461 7469  "Build computati
-000084b0: 6f6e 616c 2067 7261 7068 2075 7369 6e67  onal graph using
-000084c0: 2064 6566 696e 6564 2070 6c61 6365 686f   defined placeho
-000084d0: 6c64 6572 2060 7365 6c66 2e58 600d 0a20  lder `self.X`.. 
-000084e0: 2020 2020 2020 2061 7320 696e 7075 742e         as input.
-000084f0: 0d0a 0d0a 2020 2020 2020 2020 5265 7475  ....        Retu
-00008500: 726e 730d 0a20 2020 2020 2020 202d 2d2d  rns..        ---
-00008510: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 2079  -----..        y
-00008520: 5f70 7265 6420 3a20 7466 2e54 656e 736f  _pred : tf.Tenso
-00008530: 720d 0a20 2020 2020 2020 2020 2020 204f  r..            O
-00008540: 7574 7075 7420 6f66 2074 6865 2066 6f72  utput of the for
-00008550: 7761 7264 2070 6173 7320 6f66 2074 6865  ward pass of the
-00008560: 2063 6f6d 7075 7461 7469 6f6e 616c 2067   computational g
-00008570: 7261 7068 2e0d 0a20 2020 2020 2020 2020  raph...         
-00008580: 2020 2050 7265 6469 6374 696f 6e20 6f66     Prediction of
-00008590: 2074 6865 2074 6172 6765 7420 7661 7269   the target vari
-000085a0: 6162 6c65 2e0d 0a20 2020 2020 2020 2022  able...        "
-000085b0: 2222 0d0a 2020 2020 2020 2020 7365 6c66  ""..        self
-000085c0: 2e64 6d78 203d 2044 654d 6978 696e 6728  .dmx = DeMixing(
-000085d0: 7369 7a65 3d73 656c 662e 7370 6563 735b  size=self.specs[
-000085e0: 276e 5f6c 6174 656e 7427 5d2c 206e 6f6e  'n_latent'], non
-000085f0: 6c69 6e3d 7466 2e69 6465 6e74 6974 792c  lin=tf.identity,
-00008600: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00008610: 2020 2020 2020 2020 2020 2020 2020 6178                ax
-00008620: 6973 3d33 2c20 7370 6563 733d 7365 6c66  is=3, specs=self
-00008630: 2e73 7065 6373 290d 0a20 2020 2020 2020  .specs)..       
-00008640: 2073 656c 662e 646d 785f 6f75 7420 3d20   self.dmx_out = 
-00008650: 7365 6c66 2e64 6d78 2873 656c 662e 696e  self.dmx(self.in
-00008660: 7075 7473 290d 0a0d 0a20 2020 2020 2020  puts)....       
-00008670: 2073 656c 662e 7463 6f6e 7620 3d20 4c46   self.tconv = LF
-00008680: 5443 6f6e 7628 7369 7a65 3d73 656c 662e  TConv(size=self.
-00008690: 7370 6563 735b 276e 5f6c 6174 656e 7427  specs['n_latent'
-000086a0: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-000086b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000086c0: 206e 6f6e 6c69 6e3d 7365 6c66 2e73 7065   nonlin=self.spe
-000086d0: 6373 5b27 6e6f 6e6c 696e 275d 2c0d 0a20  cs['nonlin'],.. 
-000086e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000086f0: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
-00008700: 6572 5f6c 656e 6774 683d 7365 6c66 2e73  er_length=self.s
-00008710: 7065 6373 5b27 6669 6c74 6572 5f6c 656e  pecs['filter_len
-00008720: 6774 6827 5d2c 0d0a 2020 2020 2020 2020  gth'],..        
-00008730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008740: 2020 2020 2070 6164 6469 6e67 3d73 656c       padding=sel
-00008750: 662e 7370 6563 735b 2770 6164 6469 6e67  f.specs['padding
-00008760: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
+00007b50: 2020 7370 6c69 743d 4661 6c73 652c 0d0a    split=False,..
+00007b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007b80: 2020 2020 2020 2020 2020 2020 2074 6573               tes
+00007b90: 745f 6261 7463 683d 4e6f 6e65 2c0d 0a20  t_batch=None,.. 
+00007ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007bc0: 2020 2020 2020 2020 2020 2020 7265 7065              repe
+00007bd0: 6174 3d54 7275 6529 0d0a 2020 2020 2020  at=True)..      
+00007be0: 2020 656c 6966 206e 6f74 2069 7369 6e73    elif not isins
+00007bf0: 7461 6e63 6528 6461 7461 7365 742c 2074  tance(dataset, t
+00007c00: 662e 6461 7461 2e44 6174 6173 6574 293a  f.data.Dataset):
+00007c10: 0d0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
+00007c20: 696e 7428 2253 7065 6369 6679 2064 6174  int("Specify dat
+00007c30: 6173 6574 2229 0d0a 2020 2020 2020 2020  aset")..        
+00007c40: 2020 2020 7265 7475 726e 204e 6f6e 652c      return None,
+00007c50: 204e 6f6e 650d 0a0d 0a20 2020 2020 2020   None....       
+00007c60: 206c 6f73 7365 732c 206d 6574 7269 6373   losses, metrics
+00007c70: 203d 2073 656c 662e 6b6d 2e65 7661 6c75   = self.km.evalu
+00007c80: 6174 6528 6461 7461 7365 742c 0d0a 2020  ate(dataset,..  
+00007c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007cb0: 2020 2020 2020 2020 2073 7465 7073 3d73           steps=s
+00007cc0: 656c 662e 6461 7461 7365 742e 7661 6c69  elf.dataset.vali
+00007cd0: 6461 7469 6f6e 5f73 7465 7073 2c0d 0a20  dation_steps,.. 
+00007ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007d00: 2020 2020 2020 2020 2020 7665 7262 6f73            verbos
+00007d10: 653d 3029 0d0a 2020 2020 2020 2020 7265  e=0)..        re
+00007d20: 7475 726e 2020 6c6f 7373 6573 2c20 6d65  turn  losses, me
+00007d30: 7472 6963 730d 0a0d 0a0d 0a0d 0a0d 0a0d  trics...........
+00007d40: 0a63 6c61 7373 204c 4643 4e4e 2842 6173  .class LFCNN(Bas
+00007d50: 654d 6f64 656c 293a 0d0a 2020 2020 2222  eModel):..    ""
+00007d60: 224c 462d 434e 4e2e 2049 6e63 6c75 6465  "LF-CNN. Include
+00007d70: 7320 6261 7369 6320 7061 7261 6d65 7465  s basic paramete
+00007d80: 7220 696e 7465 7270 7265 7461 7469 6f6e  r interpretation
+00007d90: 206f 7074 696f 6e73 2e0d 0a0d 0a20 2020   options.....   
+00007da0: 2046 6f72 2064 6574 6169 6c73 2073 6565   For details see
+00007db0: 205b 315d 2e0d 0a20 2020 2052 6566 6572   [1]...    Refer
+00007dc0: 656e 6365 730d 0a20 2020 202d 2d2d 2d2d  ences..    -----
+00007dd0: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 205b  -----..        [
+00007de0: 315d 2049 2e20 5a75 6261 7265 762c 2065  1] I. Zubarev, e
+00007df0: 7420 616c 2e2c 2041 6461 7074 6976 6520  t al., Adaptive 
+00007e00: 6e65 7572 616c 206e 6574 776f 726b 2063  neural network c
+00007e10: 6c61 7373 6966 6965 7220 666f 720d 0a20  lassifier for.. 
+00007e20: 2020 2020 2020 2064 6563 6f64 696e 6720         decoding 
+00007e30: 4d45 4720 7369 676e 616c 732e 204e 6575  MEG signals. Neu
+00007e40: 726f 696d 6167 652e 2028 3230 3139 2920  roimage. (2019) 
+00007e50: 4d61 7920 343b 3139 373a 3432 352d 3433  May 4;197:425-43
+00007e60: 340d 0a20 2020 2022 2222 0d0a 2020 2020  4..    """..    
+00007e70: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+00007e80: 662c 206d 6574 612c 2064 6174 6173 6574  f, meta, dataset
+00007e90: 3d4e 6f6e 6529 3a0d 0a20 2020 2020 2020  =None):..       
+00007ea0: 2022 2222 0d0a 0d0a 2020 2020 2020 2020   """....        
+00007eb0: 5061 7261 6d65 7465 7273 0d0a 2020 2020  Parameters..    
+00007ec0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a      ----------..
+00007ed0: 2020 2020 2020 2020 4461 7461 7365 7420          Dataset 
+00007ee0: 3a20 6d6e 6566 6c6f 772e 4461 7461 7365  : mneflow.Datase
+00007ef0: 740d 0a0d 0a20 2020 2020 2020 2073 7065  t....        spe
+00007f00: 6373 203a 2064 6963 740d 0a20 2020 2020  cs : dict..     
+00007f10: 2020 2020 2020 2020 2020 2064 6963 7469             dicti
+00007f20: 6f6e 6172 7920 6f66 206d 6f64 656c 2068  onary of model h
+00007f30: 7970 6572 7061 7261 6d65 7465 7273 207b  yperparameters {
+00007f40: 0d0a 0d0a 2020 2020 2020 2020 6e5f 6c61  ....        n_la
+00007f50: 7465 6e74 203a 2069 6e74 0d0a 2020 2020  tent : int..    
+00007f60: 2020 2020 2020 2020 4e75 6d62 6572 206f          Number o
+00007f70: 6620 6c61 7465 6e74 2063 6f6d 706f 6e65  f latent compone
+00007f80: 6e74 732e 0d0a 2020 2020 2020 2020 2020  nts...          
+00007f90: 2020 4465 6661 756c 7473 2074 6f20 3332    Defaults to 32
+00007fa0: 2e0d 0a0d 0a20 2020 2020 2020 206e 6f6e  .....        non
+00007fb0: 6c69 6e20 3a20 6361 6c6c 6162 6c65 0d0a  lin : callable..
+00007fc0: 2020 2020 2020 2020 2020 2020 4163 7469              Acti
+00007fd0: 7661 7469 6f6e 2066 756e 6374 696f 6e20  vation function 
+00007fe0: 6f66 2074 6865 2074 656d 706f 7261 6c20  of the temporal 
+00007ff0: 636f 6e76 6f6c 7574 696f 6e20 6c61 7965  convolution laye
+00008000: 722e 0d0a 2020 2020 2020 2020 2020 2020  r...            
+00008010: 4465 6661 756c 7473 2074 6f20 7466 2e6e  Defaults to tf.n
+00008020: 6e2e 7265 6c75 0d0a 0d0a 2020 2020 2020  n.relu....      
+00008030: 2020 6669 6c74 6572 5f6c 656e 6774 6820    filter_length 
+00008040: 3a20 696e 740d 0a20 2020 2020 2020 2020  : int..         
+00008050: 2020 204c 656e 6774 6820 6f66 2073 7061     Length of spa
+00008060: 7469 6f2d 7465 6d70 6f72 616c 206b 6572  tio-temporal ker
+00008070: 6e65 6c73 2069 6e20 7468 6520 7465 6d70  nels in the temp
+00008080: 6f72 616c 0d0a 2020 2020 2020 2020 2020  oral..          
+00008090: 2020 636f 6e76 6f6c 7574 696f 6e20 6c61    convolution la
+000080a0: 7965 722e 2044 6566 6175 6c74 7320 746f  yer. Defaults to
+000080b0: 2037 2e0d 0a0d 0a20 2020 2020 2020 2070   7.....        p
+000080c0: 6f6f 6c69 6e67 203a 2069 6e74 0d0a 2020  ooling : int..  
+000080d0: 2020 2020 2020 2020 2020 506f 6f6c 696e            Poolin
+000080e0: 6720 6661 6374 6f72 206f 6620 7468 6520  g factor of the 
+000080f0: 6d61 7820 706f 6f6c 696e 6720 6c61 7965  max pooling laye
+00008100: 722e 2044 6566 6175 6c74 7320 746f 2032  r. Defaults to 2
+00008110: 0d0a 0d0a 2020 2020 2020 2020 706f 6f6c  ....        pool
+00008120: 5f74 7970 6520 3a20 7374 7220 7b27 6176  _type : str {'av
+00008130: 6727 2c20 276d 6178 277d 0d0a 2020 2020  g', 'max'}..    
+00008140: 2020 2020 2020 2020 5479 7065 206f 6620          Type of 
+00008150: 706f 6f6c 696e 6720 6f70 6572 6174 696f  pooling operatio
+00008160: 6e2e 2044 6566 6175 6c74 7320 746f 2027  n. Defaults to '
+00008170: 6d61 7827 2e0d 0a0d 0a20 2020 2020 2020  max'.....       
+00008180: 2070 6164 6469 6e67 203a 2073 7472 207b   padding : str {
+00008190: 2753 414d 4527 2c20 2746 554c 4c27 2c20  'SAME', 'FULL', 
+000081a0: 2756 414c 4944 277d 0d0a 2020 2020 2020  'VALID'}..      
+000081b0: 2020 2020 2020 436f 6e76 6f6c 7574 696f        Convolutio
+000081c0: 6e20 7061 6464 696e 672e 2044 6566 6175  n padding. Defau
+000081d0: 6c74 7320 746f 2027 5341 4d45 272e 7d0d  lts to 'SAME'.}.
+000081e0: 0a0d 0a20 2020 2020 2020 2073 7472 6964  ...        strid
+000081f0: 6520 3a20 696e 740d 0a20 2020 2020 2020  e : int..       
+00008200: 2053 7472 6964 6520 6f66 2074 6865 206d   Stride of the m
+00008210: 6178 2070 6f6f 6c69 6e67 206c 6179 6572  ax pooling layer
+00008220: 2e20 4465 6661 756c 7473 2074 6f20 312e  . Defaults to 1.
+00008230: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+00008240: 2020 2020 2020 2073 656c 662e 7363 6f70         self.scop
+00008250: 6520 3d20 276c 6663 6e6e 270d 0a20 2020  e = 'lfcnn'..   
+00008260: 2020 2020 2023 7370 6563 7320 3d20 6d65       #specs = me
+00008270: 7461 2e6d 6f64 656c 5f73 7065 6373 0d0a  ta.model_specs..
+00008280: 2020 2020 2020 2020 6d65 7461 2e6d 6f64          meta.mod
+00008290: 656c 5f73 7065 6373 2e73 6574 6465 6661  el_specs.setdefa
+000082a0: 756c 7428 2766 696c 7465 725f 6c65 6e67  ult('filter_leng
+000082b0: 7468 272c 2037 290d 0a20 2020 2020 2020  th', 7)..       
+000082c0: 206d 6574 612e 6d6f 6465 6c5f 7370 6563   meta.model_spec
+000082d0: 732e 7365 7464 6566 6175 6c74 2827 6e5f  s.setdefault('n_
+000082e0: 6c61 7465 6e74 272c 2033 3229 0d0a 2020  latent', 32)..  
+000082f0: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
+00008300: 5f73 7065 6373 2e73 6574 6465 6661 756c  _specs.setdefaul
+00008310: 7428 2770 6f6f 6c69 6e67 272c 2032 290d  t('pooling', 2).
+00008320: 0a20 2020 2020 2020 206d 6574 612e 6d6f  .        meta.mo
+00008330: 6465 6c5f 7370 6563 732e 7365 7464 6566  del_specs.setdef
+00008340: 6175 6c74 2827 7374 7269 6465 272c 2032  ault('stride', 2
+00008350: 290d 0a20 2020 2020 2020 206d 6574 612e  )..        meta.
+00008360: 6d6f 6465 6c5f 7370 6563 732e 7365 7464  model_specs.setd
+00008370: 6566 6175 6c74 2827 7061 6464 696e 6727  efault('padding'
+00008380: 2c20 2753 414d 4527 290d 0a20 2020 2020  , 'SAME')..     
+00008390: 2020 206d 6574 612e 6d6f 6465 6c5f 7370     meta.model_sp
+000083a0: 6563 732e 7365 7464 6566 6175 6c74 2827  ecs.setdefault('
+000083b0: 706f 6f6c 5f74 7970 6527 2c20 276d 6178  pool_type', 'max
+000083c0: 2729 0d0a 2020 2020 2020 2020 6d65 7461  ')..        meta
+000083d0: 2e6d 6f64 656c 5f73 7065 6373 2e73 6574  .model_specs.set
+000083e0: 6465 6661 756c 7428 276e 6f6e 6c69 6e27  default('nonlin'
+000083f0: 2c20 7466 2e6e 6e2e 7265 6c75 290d 0a20  , tf.nn.relu).. 
+00008400: 2020 2020 2020 206d 6574 612e 6d6f 6465         meta.mode
+00008410: 6c5f 7370 6563 732e 7365 7464 6566 6175  l_specs.setdefau
+00008420: 6c74 2827 6c31 5f6c 616d 6264 6127 2c20  lt('l1_lambda', 
+00008430: 3365 2d34 290d 0a20 2020 2020 2020 206d  3e-4)..        m
+00008440: 6574 612e 6d6f 6465 6c5f 7370 6563 732e  eta.model_specs.
+00008450: 7365 7464 6566 6175 6c74 2827 6c32 5f6c  setdefault('l2_l
+00008460: 616d 6264 6127 2c20 302e 290d 0a20 2020  ambda', 0.)..   
+00008470: 2020 2020 206d 6574 612e 6d6f 6465 6c5f       meta.model_
+00008480: 7370 6563 732e 7365 7464 6566 6175 6c74  specs.setdefault
+00008490: 2827 6c31 5f73 636f 7065 272c 205b 2766  ('l1_scope', ['f
+000084a0: 6327 2c20 2764 656d 6978 272c 2027 6c66  c', 'demix', 'lf
+000084b0: 5f63 6f6e 7627 5d29 0d0a 2020 2020 2020  _conv'])..      
+000084c0: 2020 6d65 7461 2e6d 6f64 656c 5f73 7065    meta.model_spe
+000084d0: 6373 2e73 6574 6465 6661 756c 7428 276c  cs.setdefault('l
+000084e0: 325f 7363 6f70 6527 2c20 5b5d 290d 0a20  2_scope', []).. 
+000084f0: 2020 2020 2020 206d 6574 612e 6d6f 6465         meta.mode
+00008500: 6c5f 7370 6563 732e 7365 7464 6566 6175  l_specs.setdefau
+00008510: 6c74 2827 756e 6974 6e6f 726d 5f73 636f  lt('unitnorm_sco
+00008520: 7065 272c 205b 5d29 0d0a 2020 2020 2020  pe', [])..      
+00008530: 2020 6d65 7461 2e6d 6f64 656c 5f73 7065    meta.model_spe
+00008540: 6373 5b27 7363 6f70 6527 5d20 3d20 7365  cs['scope'] = se
+00008550: 6c66 2e73 636f 7065 0d0a 2020 2020 2020  lf.scope..      
+00008560: 2020 2373 7065 6373 2e73 6574 6465 6661    #specs.setdefa
+00008570: 756c 7428 276d 6f64 656c 5f70 6174 6827  ult('model_path'
+00008580: 2c20 2073 656c 662e 6461 7461 7365 742e  ,  self.dataset.
+00008590: 685f 7061 7261 6d73 5b27 7361 7665 5f70  h_params['save_p
+000085a0: 6174 6827 5d29 0d0a 2020 2020 2020 2020  ath'])..        
+000085b0: 7375 7065 7228 4c46 434e 4e2c 2073 656c  super(LFCNN, sel
+000085c0: 6629 2e5f 5f69 6e69 745f 5f28 6d65 7461  f).__init__(meta
+000085d0: 2c20 6461 7461 7365 7429 0d0a 0d0a 0d0a  , dataset)......
+000085e0: 0d0a 2020 2020 6465 6620 6275 696c 645f  ..    def build_
+000085f0: 6772 6170 6828 7365 6c66 293a 0d0a 2020  graph(self):..  
+00008600: 2020 2020 2020 2222 2242 7569 6c64 2063        """Build c
+00008610: 6f6d 7075 7461 7469 6f6e 616c 2067 7261  omputational gra
+00008620: 7068 2075 7369 6e67 2064 6566 696e 6564  ph using defined
+00008630: 2070 6c61 6365 686f 6c64 6572 2060 7365   placeholder `se
+00008640: 6c66 2e58 600d 0a20 2020 2020 2020 2061  lf.X`..        a
+00008650: 7320 696e 7075 742e 0d0a 0d0a 2020 2020  s input.....    
+00008660: 2020 2020 5265 7475 726e 730d 0a20 2020      Returns..   
+00008670: 2020 2020 202d 2d2d 2d2d 2d2d 2d0d 0a20       --------.. 
+00008680: 2020 2020 2020 2079 5f70 7265 6420 3a20         y_pred : 
+00008690: 7466 2e54 656e 736f 720d 0a20 2020 2020  tf.Tensor..     
+000086a0: 2020 2020 2020 204f 7574 7075 7420 6f66         Output of
+000086b0: 2074 6865 2066 6f72 7761 7264 2070 6173   the forward pas
+000086c0: 7320 6f66 2074 6865 2063 6f6d 7075 7461  s of the computa
+000086d0: 7469 6f6e 616c 2067 7261 7068 2e0d 0a20  tional graph... 
+000086e0: 2020 2020 2020 2020 2020 2050 7265 6469             Predi
+000086f0: 6374 696f 6e20 6f66 2074 6865 2074 6172  ction of the tar
+00008700: 6765 7420 7661 7269 6162 6c65 2e0d 0a20  get variable... 
+00008710: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00008720: 2020 2020 7365 6c66 2e64 6d78 203d 2044      self.dmx = D
+00008730: 654d 6978 696e 6728 7369 7a65 3d73 656c  eMixing(size=sel
+00008740: 662e 7370 6563 735b 276e 5f6c 6174 656e  f.specs['n_laten
+00008750: 7427 5d2c 206e 6f6e 6c69 6e3d 7466 2e69  t'], nonlin=tf.i
+00008760: 6465 6e74 6974 792c 0d0a 2020 2020 2020  dentity,..      
 00008770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008780: 2020 7370 6563 733d 7365 6c66 2e73 7065    specs=self.spe
-00008790: 6373 0d0a 2020 2020 2020 2020 2020 2020  cs..            
-000087a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000087b0: 2029 0d0a 2020 2020 2020 2020 7365 6c66   )..        self
-000087c0: 2e74 636f 6e76 5f6f 7574 203d 2073 656c  .tconv_out = sel
-000087d0: 662e 7463 6f6e 7628 7365 6c66 2e64 6d78  f.tconv(self.dmx
-000087e0: 5f6f 7574 290d 0a0d 0a20 2020 2020 2020  _out)....       
-000087f0: 2073 656c 662e 706f 6f6c 203d 2054 656d   self.pool = Tem
-00008800: 7050 6f6f 6c69 6e67 2870 6f6f 6c69 6e67  pPooling(pooling
-00008810: 3d73 656c 662e 7370 6563 735b 2770 6f6f  =self.specs['poo
-00008820: 6c69 6e67 275d 2c0d 0a20 2020 2020 2020  ling'],..       
-00008830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008840: 2020 2020 2020 2020 2020 2070 6f6f 6c5f             pool_
-00008850: 7479 7065 3d73 656c 662e 7370 6563 735b  type=self.specs[
-00008860: 2770 6f6f 6c5f 7479 7065 275d 2c0d 0a20  'pool_type'],.. 
-00008870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008890: 2073 7472 6964 653d 7365 6c66 2e73 7065   stride=self.spe
-000088a0: 6373 5b27 7374 7269 6465 275d 2c0d 0a20  cs['stride'],.. 
-000088b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000088c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000088d0: 2070 6164 6469 6e67 3d27 5341 4d45 272c   padding='SAME',
-000088e0: 2373 656c 662e 7370 6563 735b 2770 6164  #self.specs['pad
-000088f0: 6469 6e67 275d 0d0a 2020 2020 2020 2020  ding']..        
+00008780: 2020 2020 2020 6178 6973 3d33 2c20 7370        axis=3, sp
+00008790: 6563 733d 7365 6c66 2e73 7065 6373 290d  ecs=self.specs).
+000087a0: 0a20 2020 2020 2020 2073 656c 662e 646d  .        self.dm
+000087b0: 785f 6f75 7420 3d20 7365 6c66 2e64 6d78  x_out = self.dmx
+000087c0: 2873 656c 662e 696e 7075 7473 290d 0a0d  (self.inputs)...
+000087d0: 0a20 2020 2020 2020 2073 656c 662e 7463  .        self.tc
+000087e0: 6f6e 7620 3d20 4c46 5443 6f6e 7628 7369  onv = LFTConv(si
+000087f0: 7a65 3d73 656c 662e 7370 6563 735b 276e  ze=self.specs['n
+00008800: 5f6c 6174 656e 7427 5d2c 0d0a 2020 2020  _latent'],..    
+00008810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008820: 2020 2020 2020 2020 206e 6f6e 6c69 6e3d           nonlin=
+00008830: 7365 6c66 2e73 7065 6373 5b27 6e6f 6e6c  self.specs['nonl
+00008840: 696e 275d 2c0d 0a20 2020 2020 2020 2020  in'],..         
+00008850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008860: 2020 2020 6669 6c74 6572 5f6c 656e 6774      filter_lengt
+00008870: 683d 7365 6c66 2e73 7065 6373 5b27 6669  h=self.specs['fi
+00008880: 6c74 6572 5f6c 656e 6774 6827 5d2c 0d0a  lter_length'],..
+00008890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000088a0: 2020 2020 2020 2020 2020 2020 2070 6164               pad
+000088b0: 6469 6e67 3d73 656c 662e 7370 6563 735b  ding=self.specs[
+000088c0: 2770 6164 6469 6e67 275d 2c0d 0a20 2020  'padding'],..   
+000088d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000088e0: 2020 2020 2020 2020 2020 7370 6563 733d            specs=
+000088f0: 7365 6c66 2e73 7065 6373 0d0a 2020 2020  self.specs..    
 00008900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008910: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-00008920: 2020 2020 2073 656c 662e 706f 6f6c 6564       self.pooled
-00008930: 203d 2073 656c 662e 706f 6f6c 2873 656c   = self.pool(sel
-00008940: 662e 7463 6f6e 765f 6f75 7429 0d0a 0d0a  f.tconv_out)....
-00008950: 2020 2020 2020 2020 7365 6c66 2e64 726f          self.dro
-00008960: 706f 7574 203d 2044 726f 706f 7574 2873  pout = Dropout(s
-00008970: 656c 662e 7370 6563 735b 2764 726f 706f  elf.specs['dropo
-00008980: 7574 275d 2c0d 0a20 2020 2020 2020 2020  ut'],..         
-00008990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000089a0: 206e 6f69 7365 5f73 6861 7065 3d4e 6f6e   noise_shape=Non
-000089b0: 6529 2873 656c 662e 706f 6f6c 6564 290d  e)(self.pooled).
-000089c0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-000089d0: 6669 6e5f 6663 203d 2046 756c 6c79 436f  fin_fc = FullyCo
-000089e0: 6e6e 6563 7465 6428 7369 7a65 3d73 656c  nnected(size=sel
-000089f0: 662e 6f75 745f 6469 6d2c 206e 6f6e 6c69  f.out_dim, nonli
-00008a00: 6e3d 7466 2e69 6465 6e74 6974 792c 0d0a  n=tf.identity,..
-00008a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008a20: 2020 2020 2020 2020 2020 2020 7370 6563              spec
-00008a30: 733d 7365 6c66 2e73 7065 6373 290d 0a0d  s=self.specs)...
-00008a40: 0a20 2020 2020 2020 2079 5f70 7265 6420  .        y_pred 
-00008a50: 3d20 7365 6c66 2e66 696e 5f66 6328 7365  = self.fin_fc(se
-00008a60: 6c66 2e64 726f 706f 7574 290d 0a0d 0a20  lf.dropout).... 
-00008a70: 2020 2020 2020 2072 6574 7572 6e20 795f         return y_
-00008a80: 7072 6564 0d0a 0d0a 2020 2020 6465 6620  pred....    def 
-00008a90: 6275 696c 645f 656e 636f 6465 7228 7365  build_encoder(se
-00008aa0: 6c66 293a 0d0a 2020 2020 2020 2020 2222  lf):..        ""
-00008ab0: 2242 7569 6c64 2063 6f6d 7075 7461 7469  "Build computati
-00008ac0: 6f6e 616c 2067 7261 7068 2066 6f72 2061  onal graph for a
-00008ad0: 6e20 696e 7465 7270 7265 7461 626c 6520  n interpretable 
-00008ae0: 4765 6e65 7261 746f 720d 0a0d 0a20 2020  Generator....   
-00008af0: 2020 2020 2052 6574 7572 6e73 0d0a 2020       Returns..  
-00008b00: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0d0a        --------..
-00008b10: 2020 2020 2020 2020 795f 7072 6564 203a          y_pred :
-00008b20: 2074 662e 5465 6e73 6f72 0d0a 2020 2020   tf.Tensor..    
-00008b30: 2020 2020 2020 2020 4f75 7470 7574 206f          Output o
-00008b40: 6620 7468 6520 666f 7277 6172 6420 7061  f the forward pa
-00008b50: 7373 206f 6620 7468 6520 636f 6d70 7574  ss of the comput
-00008b60: 6174 696f 6e61 6c20 6772 6170 682e 0d0a  ational graph...
-00008b70: 2020 2020 2020 2020 2020 2020 5072 6564              Pred
-00008b80: 6963 7469 6f6e 206f 6620 7468 6520 7461  iction of the ta
-00008b90: 7267 6574 2076 6172 6961 626c 652e 0d0a  rget variable...
-00008ba0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-00008bb0: 2020 2020 2073 656c 662e 6b6d 2e74 7261       self.km.tra
-00008bc0: 696e 6162 6c65 203d 2046 616c 7365 0d0a  inable = False..
-00008bd0: 2020 2020 2020 2020 7072 696e 7428 2246          print("F
-00008be0: 7265 657a 696e 6720 7468 6520 6465 636f  reezing the deco
-00008bf0: 6465 7222 290d 0a20 2020 2020 2020 2023  der")..        #
-00008c00: 2828 726f 7773 202d 2031 2920 2a20 7374  ((rows - 1) * st
-00008c10: 7269 6465 735b 305d 202b 206b 6572 6e65  rides[0] + kerne
-00008c20: 6c5f 7369 7a65 5b30 5d20 2d20 3220 2a20  l_size[0] - 2 * 
-00008c30: 7061 6464 696e 675b 305d 202b 206f 7574  padding[0] + out
-00008c40: 7075 745f 7061 6464 696e 675b 305d 290d  put_padding[0]).
-00008c50: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00008c60: 2e64 6174 6173 6574 2e68 5f70 6172 616d  .dataset.h_param
-00008c70: 735b 276e 5f74 275d 2573 656c 662e 7370  s['n_t']%self.sp
-00008c80: 6563 735b 2773 7472 6964 6527 5d20 3d3d  ecs['stride'] ==
-00008c90: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
-00008ca0: 2070 6164 6469 6e67 3d4e 6f6e 650d 0a20   padding=None.. 
-00008cb0: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
-00008cc0: 2e64 6174 6173 6574 2e68 5f70 6172 616d  .dataset.h_param
-00008cd0: 735b 276e 5f74 275d 2573 656c 662e 7370  s['n_t']%self.sp
-00008ce0: 6563 735b 2773 7472 6964 6527 5d20 2d20  ecs['stride'] - 
-00008cf0: 3120 3e20 303a 0d0a 2020 2020 2020 2020  1 > 0:..        
-00008d00: 2020 2020 7061 6464 696e 6720 3d20 2873      padding = (s
-00008d10: 656c 662e 6461 7461 7365 742e 685f 7061  elf.dataset.h_pa
-00008d20: 7261 6d73 5b27 6e5f 7427 5d25 7365 6c66  rams['n_t']%self
-00008d30: 2e73 7065 6373 5b27 7374 7269 6465 275d  .specs['stride']
-00008d40: 202d 2031 2c20 3029 0d0a 2020 2020 2020   - 1, 0)..      
-00008d50: 2020 656c 7365 203a 0d0a 2020 2020 2020    else :..      
-00008d60: 2020 2020 2020 7061 6464 696e 6720 3d20        padding = 
-00008d70: 2828 7365 6c66 2e64 6174 6173 6574 2e68  ((self.dataset.h
-00008d80: 5f70 6172 616d 735b 276e 5f74 275d 202d  _params['n_t'] -
-00008d90: 2031 2925 7365 6c66 2e73 7065 6373 5b27   1)%self.specs['
-00008da0: 7374 7269 6465 275d 202c 2030 290d 0a0d  stride'] , 0)...
-00008db0: 0a0d 0a20 2020 2020 2020 2070 7269 6e74  ...        print
-00008dc0: 2870 6164 6469 6e67 290d 0a0d 0a0d 0a20  (padding)...... 
-00008dd0: 2020 2020 2020 2023 7374 6172 7420 7769         #start wi
-00008de0: 7468 2074 6865 206f 7574 7075 7420 6f66  th the output of
-00008df0: 2064 6563 6f64 6572 0d0a 2020 2020 2020   decoder..      
-00008e00: 2020 2365 6c66 2e65 6e63 5f69 6e70 7574    #elf.enc_input
-00008e10: 7320 3d20 6c61 7965 7273 2e49 6e70 7574  s = layers.Input
-00008e20: 2873 656c 662e 795f 7368 6170 6529 0d0a  (self.y_shape)..
-00008e30: 2020 2020 2020 2020 7365 6c66 2e65 6e63          self.enc
-00008e40: 5f66 6320 3d20 4675 6c6c 7943 6f6e 6e65  _fc = FullyConne
-00008e50: 6374 6564 2873 697a 653d 7365 6c66 2e66  cted(size=self.f
-00008e60: 696e 5f66 632e 772e 7368 6170 655b 305d  in_fc.w.shape[0]
-00008e70: 2c20 6e6f 6e6c 696e 3d74 662e 6964 656e  , nonlin=tf.iden
-00008e80: 7469 7479 2c0d 0a20 2020 2020 2020 2020  tity,..         
-00008e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ea0: 2020 2073 7065 6373 3d73 656c 662e 7370     specs=self.sp
-00008eb0: 6563 7329 0d0a 2020 2020 2020 2020 656e  ecs)..        en
-00008ec0: 635f 7463 6f6e 765f 6163 7469 7661 7469  c_tconv_activati
-00008ed0: 6f6e 7320 3d20 2073 656c 662e 656e 635f  ons =  self.enc_
-00008ee0: 6663 2873 656c 662e 795f 7072 6564 290d  fc(self.y_pred).
-00008ef0: 0a20 2020 2020 2020 2065 6e63 5f74 636f  .        enc_tco
-00008f00: 6e76 5f61 6374 6976 6174 696f 6e73 5f72  nv_activations_r
-00008f10: 203d 2074 662e 7265 7368 6170 6528 656e   = tf.reshape(en
-00008f20: 635f 7463 6f6e 765f 6163 7469 7661 7469  c_tconv_activati
-00008f30: 6f6e 732c 0d0a 2020 2020 2020 2020 2020  ons,..          
-00008f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f60: 2020 205b 2d31 2c20 312c 2073 656c 662e     [-1, 1, self.
-00008f70: 706f 6f6c 6564 2e73 6861 7065 5b2d 325d  pooled.shape[-2]
-00008f80: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00008f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008fb0: 7365 6c66 2e73 7065 6373 5b27 6e5f 6c61  self.specs['n_la
-00008fc0: 7465 6e74 275d 5d29 0d0a 2020 2020 2020  tent']])..      
-00008fd0: 2020 7072 696e 7428 656e 635f 7463 6f6e    print(enc_tcon
-00008fe0: 765f 6163 7469 7661 7469 6f6e 735f 722e  v_activations_r.
-00008ff0: 7368 6170 6529 0d0a 2020 2020 2020 2020  shape)..        
-00009000: 656e 635f 6472 6f70 6f75 7420 3d20 4472  enc_dropout = Dr
-00009010: 6f70 6f75 7428 7365 6c66 2e73 7065 6373  opout(self.specs
-00009020: 5b27 6472 6f70 6f75 7427 5d2c 0d0a 2020  ['dropout'],..  
-00009030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009040: 2020 2020 2020 2020 6e6f 6973 655f 7368          noise_sh
-00009050: 6170 653d 4e6f 6e65 2928 656e 635f 7463  ape=None)(enc_tc
-00009060: 6f6e 765f 6163 7469 7661 7469 6f6e 735f  onv_activations_
-00009070: 7229 0d0a 2020 2020 2020 2020 2375 706f  r)..        #upo
-00009080: 6f6c 2061 6e64 2061 7070 6c79 2074 7261  ol and apply tra
-00009090: 6e73 706f 7365 6420 6465 7074 6877 6973  nsposed depthwis
-000090a0: 6520 636f 6e76 6f6c 7574 696f 6e0d 0a20  e convolution.. 
-000090b0: 2020 2020 2020 2023 2073 656c 662e 656e         # self.en
-000090c0: 635f 7463 6f6e 765f 7472 616e 7320 3d20  c_tconv_trans = 
-000090d0: 4c46 5443 6f6e 7654 7261 6e73 706f 7365  LFTConvTranspose
-000090e0: 3128 6669 6c74 6572 733d 7365 6c66 2e74  1(filters=self.t
-000090f0: 636f 6e76 2e66 696c 7465 7273 2c0d 0a20  conv.filters,.. 
-00009100: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-00009110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009120: 2020 2020 2020 2020 2020 2020 6b65 726e              kern
-00009130: 656c 5f73 697a 653d 2073 656c 662e 7370  el_size= self.sp
-00009140: 6563 735b 2766 696c 7465 725f 6c65 6e67  ecs['filter_leng
-00009150: 7468 275d 2c0d 0a20 2020 2020 2020 2023  th'],..        #
-00009160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009180: 2020 2020 7374 7269 6465 3d73 656c 662e      stride=self.
-00009190: 7370 6563 735b 2773 7472 6964 6527 5d2c  specs['stride'],
-000091a0: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
-000091b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000091c0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-000091d0: 7574 7075 745f 7061 6464 696e 673d 6e5f  utput_padding=n_
-000091e0: 7061 6464 696e 6729 0d0a 2020 2020 2020  padding)..      
-000091f0: 2020 236e 5f70 6164 6469 6e67 0d0a 2020    #n_padding..  
-00009200: 2020 2020 2020 7365 6c66 2e65 6e63 5f74        self.enc_t
-00009210: 636f 6e76 5f74 7261 6e73 3d74 662e 6b65  conv_trans=tf.ke
-00009220: 7261 732e 6c61 7965 7273 2e43 6f6e 7632  ras.layers.Conv2
-00009230: 4454 7261 6e73 706f 7365 280d 0a20 2020  DTranspose(..   
-00009240: 2020 2020 2020 2020 2066 696c 7465 7273           filters
-00009250: 3d31 2c0d 0a20 2020 2020 2020 2020 2020  =1,..           
-00009260: 206b 6572 6e65 6c5f 7369 7a65 3d28 7365   kernel_size=(se
-00009270: 6c66 2e73 7065 6373 5b27 6669 6c74 6572  lf.specs['filter
-00009280: 5f6c 656e 6774 6827 5d2c 2073 656c 662e  _length'], self.
-00009290: 7370 6563 735b 276e 5f6c 6174 656e 7427  specs['n_latent'
-000092a0: 5d29 2c0d 0a20 2020 2020 2020 2020 2020  ]),..           
-000092b0: 2073 7472 6964 6573 3d28 7365 6c66 2e73   strides=(self.s
-000092c0: 7065 6373 5b27 7374 7269 6465 275d 2c20  pecs['stride'], 
-000092d0: 3129 2c0d 0a20 2020 2020 2020 2020 2020  1),..           
-000092e0: 2070 6164 6469 6e67 3d27 7361 6d65 272c   padding='same',
-000092f0: 0d0a 2020 2020 2020 2020 2020 2020 6f75  ..            ou
-00009300: 7470 7574 5f70 6164 6469 6e67 3d70 6164  tput_padding=pad
-00009310: 6469 6e67 2c0d 0a20 2020 2020 2020 2020  ding,..         
-00009320: 2020 2064 6174 615f 666f 726d 6174 3d27     data_format='
-00009330: 6368 616e 6e65 6c73 5f66 6972 7374 272c  channels_first',
-00009340: 0d0a 2020 2020 2020 2020 2020 2020 6469  ..            di
-00009350: 6c61 7469 6f6e 5f72 6174 653d 2831 2c20  lation_rate=(1, 
-00009360: 3129 2c0d 0a20 2020 2020 2020 2020 2020  1),..           
-00009370: 2061 6374 6976 6174 696f 6e3d 4e6f 6e65   activation=None
-00009380: 2c0d 0a20 2020 2020 2020 2020 2020 2075  ,..            u
-00009390: 7365 5f62 6961 733d 4661 6c73 652c 0d0a  se_bias=False,..
-000093a0: 2020 2020 2020 2020 2020 2020 6b65 726e              kern
-000093b0: 656c 5f69 6e69 7469 616c 697a 6572 3d27  el_initializer='
-000093c0: 676c 6f72 6f74 5f75 6e69 666f 726d 272c  glorot_uniform',
-000093d0: 0d0a 2020 2020 2020 2020 2020 2020 6269  ..            bi
-000093e0: 6173 5f69 6e69 7469 616c 697a 6572 3d27  as_initializer='
-000093f0: 7a65 726f 7327 2c0d 0a20 2020 2020 2020  zeros',..       
-00009400: 2020 2020 206b 6572 6e65 6c5f 7265 6775       kernel_regu
-00009410: 6c61 7269 7a65 723d 7466 2e6b 6572 6173  larizer=tf.keras
-00009420: 2e72 6567 756c 6172 697a 6572 732e 6c31  .regularizers.l1
-00009430: 2873 656c 662e 7370 6563 735b 276c 315f  (self.specs['l1_
-00009440: 6c61 6d62 6461 275d 292c 0d0a 2020 2020  lambda']),..    
-00009450: 2020 2020 2020 2020 6269 6173 5f72 6567          bias_reg
-00009460: 756c 6172 697a 6572 3d4e 6f6e 652c 0d0a  ularizer=None,..
-00009470: 2020 2020 2020 2020 2020 2020 6163 7469              acti
-00009480: 7669 7479 5f72 6567 756c 6172 697a 6572  vity_regularizer
-00009490: 3d4e 6f6e 652c 0d0a 2020 2020 2020 2020  =None,..        
-000094a0: 2020 2020 6b65 726e 656c 5f63 6f6e 7374      kernel_const
-000094b0: 7261 696e 743d 7466 2e6b 6572 6173 2e63  raint=tf.keras.c
-000094c0: 6f6e 7374 7261 696e 7473 2e55 6e69 744e  onstraints.UnitN
-000094d0: 6f72 6d28 6178 6973 3d30 292c 0d0a 2020  orm(axis=0),..  
-000094e0: 2020 2020 2020 2020 2020 6269 6173 5f63            bias_c
-000094f0: 6f6e 7374 7261 696e 743d 4e6f 6e65 2c0d  onstraint=None,.
-00009500: 0a20 2020 2020 2020 2029 0d0a 0d0a 0d0a  .        )......
-00009510: 2020 2020 2020 2020 656e 635f 6465 636f          enc_deco
-00009520: 6e76 203d 2073 656c 662e 656e 635f 7463  nv = self.enc_tc
-00009530: 6f6e 765f 7472 616e 7328 656e 635f 6472  onv_trans(enc_dr
-00009540: 6f70 6f75 7429 0d0a 2020 2020 2020 2020  opout)..        
-00009550: 2365 6e63 5f64 6563 6f6e 7620 3d20 7466  #enc_deconv = tf
-00009560: 2e74 7261 6e73 706f 7365 2865 6e63 5f64  .transpose(enc_d
-00009570: 6563 6f6e 762c 2070 6572 6d3d 5b30 2c33  econv, perm=[0,3
-00009580: 2c31 2c32 5d29 0d0a 2020 2020 2020 2020  ,1,2])..        
-00009590: 7072 696e 7428 2245 6e63 5f64 6563 6f6e  print("Enc_decon
-000095a0: 763a 222c 2065 6e63 5f64 6563 6f6e 762e  v:", enc_deconv.
-000095b0: 7368 6170 6529 0d0a 0d0a 2020 2020 2020  shape)....      
-000095c0: 2020 7365 6c66 2e64 655f 646d 7820 3d20    self.de_dmx = 
-000095d0: 4465 4d69 7869 6e67 2873 697a 653d 7365  DeMixing(size=se
-000095e0: 6c66 2e64 6174 6173 6574 2e68 5f70 6172  lf.dataset.h_par
-000095f0: 616d 735b 276e 5f63 6827 5d2c 206e 6f6e  ams['n_ch'], non
-00009600: 6c69 6e3d 7466 2e69 6465 6e74 6974 792c  lin=tf.identity,
-00009610: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00009620: 2020 2020 2020 2020 2020 2020 2020 6178                ax
-00009630: 6973 3d33 2c20 7370 6563 733d 7365 6c66  is=3, specs=self
-00009640: 2e73 7065 6373 290d 0a0d 0a20 2020 2020  .specs)....     
-00009650: 2020 2073 656c 662e 585f 7072 6564 203d     self.X_pred =
-00009660: 2073 656c 662e 6465 5f64 6d78 2865 6e63   self.de_dmx(enc
-00009670: 5f64 6563 6f6e 7629 0d0a 2020 2020 2020  _deconv)..      
-00009680: 2020 7072 696e 7428 7365 6c66 2e58 5f70    print(self.X_p
-00009690: 7265 642e 7368 6170 6529 0d0a 2020 2020  red.shape)..    
-000096a0: 2020 2020 7365 6c66 2e6b 6d5f 656e 6320      self.km_enc 
-000096b0: 3d20 7466 2e6b 6572 6173 2e4d 6f64 656c  = tf.keras.Model
-000096c0: 2869 6e70 7574 733d 7365 6c66 2e69 6e70  (inputs=self.inp
-000096d0: 7574 732c 206f 7574 7075 7473 3d73 656c  uts, outputs=sel
-000096e0: 662e 585f 7072 6564 290d 0a0d 0a20 2020  f.X_pred)....   
-000096f0: 2020 2020 2073 656c 662e 6d65 7461 2e74       self.meta.t
-00009700: 7261 696e 5f70 6172 616d 735b 2765 6e63  rain_params['enc
-00009710: 5f6c 6f73 7327 5d20 3d20 5b74 662e 6b65  _loss'] = [tf.ke
-00009720: 7261 732e 6c6f 7373 6573 2e4d 4145 5d23  ras.losses.MAE]#
-00009730: 7466 2e72 6564 7563 655f 6d65 616e 2828  tf.reduce_mean((
-00009740: 7365 6c66 2e58 5f70 7265 6420 2d20 7365  self.X_pred - se
-00009750: 6c66 2e69 6e70 7574 7329 2a2a 3229 0d0a  lf.inputs)**2)..
-00009760: 2020 2020 2020 2020 2373 656c 662e 7061          #self.pa
-00009770: 7261 6d73 5b27 656e 635f 6d65 7472 6963  rams['enc_metric
-00009780: 7327 5d20 3d20 7466 2e6b 6572 6173 2e6d  s'] = tf.keras.m
-00009790: 6574 7269 6373 2e52 6f6f 744d 6561 6e53  etrics.RootMeanS
-000097a0: 7175 6172 6564 4572 726f 7228 6e61 6d65  quaredError(name
-000097b0: 3d22 524d 5345 2229 0d0a 0d0a 0d0a 2020  ="RMSE")......  
-000097c0: 2020 2020 2020 2370 7269 6e74 2870 6172        #print(par
-000097d0: 616d 7329 0d0a 2020 2020 2020 2020 7365  ams)..        se
-000097e0: 6c66 2e6b 6d5f 656e 632e 636f 6d70 696c  lf.km_enc.compil
-000097f0: 6528 6f70 7469 6d69 7a65 723d 7466 2e6b  e(optimizer=tf.k
-00009800: 6572 6173 2e6f 7074 696d 697a 6572 732e  eras.optimizers.
-00009810: 6c65 6761 6379 2e41 6461 6d28 292c 0d0a  legacy.Adam(),..
-00009820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009830: 2020 2020 2020 2020 6c6f 7373 3d73 656c          loss=sel
-00009840: 662e 6d65 7461 2e74 7261 696e 5f70 6172  f.meta.train_par
-00009850: 616d 735b 2765 6e63 5f6c 6f73 7327 5d29  ams['enc_loss'])
-00009860: 0d0a 0d0a 2020 2020 6465 6620 636f 6d70  ....    def comp
-00009870: 7574 655f 656e 635f 7061 7474 6572 6e73  ute_enc_patterns
-00009880: 2873 656c 662c 2069 6e70 7574 733d 4e6f  (self, inputs=No
-00009890: 6e65 293a 0d0a 2020 2020 2020 2020 2222  ne):..        ""
-000098a0: 220d 0a0d 0a20 2020 2020 2020 2022 2222  "....        """
-000098b0: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-000098c0: 206e 702e 616e 7928 696e 7075 7473 293a   np.any(inputs):
-000098d0: 0d0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
-000098e0: 696e 7428 2755 7369 6e67 2066 616b 6520  int('Using fake 
-000098f0: 696e 7075 7473 2729 0d0a 2020 2020 2020  inputs')..      
-00009900: 2020 2020 2020 696e 7075 7473 203d 206e        inputs = n
-00009910: 702e 6964 656e 7469 7479 2873 656c 662e  p.identity(self.
-00009920: 6f75 745f 6469 6d29 0d0a 2020 2020 2020  out_dim)..      
-00009930: 2020 706f 6f6c 6564 203d 2074 662e 7265    pooled = tf.re
-00009940: 7368 6170 6528 7365 6c66 2e65 6e63 5f66  shape(self.enc_f
-00009950: 6328 696e 7075 7473 292c 0d0a 2020 2020  c(inputs),..    
-00009960: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-00009970: 2d31 2c0d 0a20 2020 2020 2020 2020 2020  -1,..           
-00009980: 2020 2020 2020 2020 2031 2c0d 0a20 2020           1,..   
+00008910: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+00008920: 2020 2020 7365 6c66 2e74 636f 6e76 5f6f      self.tconv_o
+00008930: 7574 203d 2073 656c 662e 7463 6f6e 7628  ut = self.tconv(
+00008940: 7365 6c66 2e64 6d78 5f6f 7574 290d 0a0d  self.dmx_out)...
+00008950: 0a20 2020 2020 2020 2073 656c 662e 706f  .        self.po
+00008960: 6f6c 203d 2054 656d 7050 6f6f 6c69 6e67  ol = TempPooling
+00008970: 2870 6f6f 6c69 6e67 3d73 656c 662e 7370  (pooling=self.sp
+00008980: 6563 735b 2770 6f6f 6c69 6e67 275d 2c0d  ecs['pooling'],.
+00008990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000089a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000089b0: 2020 2070 6f6f 6c5f 7479 7065 3d73 656c     pool_type=sel
+000089c0: 662e 7370 6563 735b 2770 6f6f 6c5f 7479  f.specs['pool_ty
+000089d0: 7065 275d 2c0d 0a20 2020 2020 2020 2020  pe'],..         
+000089e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000089f0: 2020 2020 2020 2020 2073 7472 6964 653d           stride=
+00008a00: 7365 6c66 2e73 7065 6373 5b27 7374 7269  self.specs['stri
+00008a10: 6465 275d 2c0d 0a20 2020 2020 2020 2020  de'],..         
+00008a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008a30: 2020 2020 2020 2020 2070 6164 6469 6e67           padding
+00008a40: 3d27 5341 4d45 272c 2373 656c 662e 7370  ='SAME',#self.sp
+00008a50: 6563 735b 2770 6164 6469 6e67 275d 0d0a  ecs['padding']..
+00008a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008a80: 2020 290d 0a20 2020 2020 2020 2073 656c    )..        sel
+00008a90: 662e 706f 6f6c 6564 203d 2073 656c 662e  f.pooled = self.
+00008aa0: 706f 6f6c 2873 656c 662e 7463 6f6e 765f  pool(self.tconv_
+00008ab0: 6f75 7429 0d0a 0d0a 2020 2020 2020 2020  out)....        
+00008ac0: 7365 6c66 2e64 726f 706f 7574 203d 2044  self.dropout = D
+00008ad0: 726f 706f 7574 2873 656c 662e 7370 6563  ropout(self.spec
+00008ae0: 735b 2764 726f 706f 7574 275d 2c0d 0a20  s['dropout'],.. 
+00008af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008b00: 2020 2020 2020 2020 206e 6f69 7365 5f73           noise_s
+00008b10: 6861 7065 3d4e 6f6e 6529 2873 656c 662e  hape=None)(self.
+00008b20: 706f 6f6c 6564 290d 0a0d 0a20 2020 2020  pooled)....     
+00008b30: 2020 2073 656c 662e 6669 6e5f 6663 203d     self.fin_fc =
+00008b40: 2046 756c 6c79 436f 6e6e 6563 7465 6428   FullyConnected(
+00008b50: 7369 7a65 3d73 656c 662e 6f75 745f 6469  size=self.out_di
+00008b60: 6d2c 206e 6f6e 6c69 6e3d 7466 2e69 6465  m, nonlin=tf.ide
+00008b70: 6e74 6974 792c 0d0a 2020 2020 2020 2020  ntity,..        
+00008b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008b90: 2020 2020 7370 6563 733d 7365 6c66 2e73      specs=self.s
+00008ba0: 7065 6373 290d 0a0d 0a20 2020 2020 2020  pecs)....       
+00008bb0: 2079 5f70 7265 6420 3d20 7365 6c66 2e66   y_pred = self.f
+00008bc0: 696e 5f66 6328 7365 6c66 2e64 726f 706f  in_fc(self.dropo
+00008bd0: 7574 290d 0a0d 0a20 2020 2020 2020 2072  ut)....        r
+00008be0: 6574 7572 6e20 795f 7072 6564 0d0a 0d0a  eturn y_pred....
+00008bf0: 2020 2020 6465 6620 6275 696c 645f 656e      def build_en
+00008c00: 636f 6465 7228 7365 6c66 293a 0d0a 2020  coder(self):..  
+00008c10: 2020 2020 2020 2222 2242 7569 6c64 2063        """Build c
+00008c20: 6f6d 7075 7461 7469 6f6e 616c 2067 7261  omputational gra
+00008c30: 7068 2066 6f72 2061 6e20 696e 7465 7270  ph for an interp
+00008c40: 7265 7461 626c 6520 4765 6e65 7261 746f  retable Generato
+00008c50: 720d 0a0d 0a20 2020 2020 2020 2052 6574  r....        Ret
+00008c60: 7572 6e73 0d0a 2020 2020 2020 2020 2d2d  urns..        --
+00008c70: 2d2d 2d2d 2d2d 0d0a 2020 2020 2020 2020  ------..        
+00008c80: 795f 7072 6564 203a 2074 662e 5465 6e73  y_pred : tf.Tens
+00008c90: 6f72 0d0a 2020 2020 2020 2020 2020 2020  or..            
+00008ca0: 4f75 7470 7574 206f 6620 7468 6520 666f  Output of the fo
+00008cb0: 7277 6172 6420 7061 7373 206f 6620 7468  rward pass of th
+00008cc0: 6520 636f 6d70 7574 6174 696f 6e61 6c20  e computational 
+00008cd0: 6772 6170 682e 0d0a 2020 2020 2020 2020  graph...        
+00008ce0: 2020 2020 5072 6564 6963 7469 6f6e 206f      Prediction o
+00008cf0: 6620 7468 6520 7461 7267 6574 2076 6172  f the target var
+00008d00: 6961 626c 652e 0d0a 2020 2020 2020 2020  iable...        
+00008d10: 2222 220d 0a20 2020 2020 2020 2073 656c  """..        sel
+00008d20: 662e 6b6d 2e74 7261 696e 6162 6c65 203d  f.km.trainable =
+00008d30: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00008d40: 7072 696e 7428 2246 7265 657a 696e 6720  print("Freezing 
+00008d50: 7468 6520 6465 636f 6465 7222 290d 0a20  the decoder").. 
+00008d60: 2020 2020 2020 2023 2828 726f 7773 202d         #((rows -
+00008d70: 2031 2920 2a20 7374 7269 6465 735b 305d   1) * strides[0]
+00008d80: 202b 206b 6572 6e65 6c5f 7369 7a65 5b30   + kernel_size[0
+00008d90: 5d20 2d20 3220 2a20 7061 6464 696e 675b  ] - 2 * padding[
+00008da0: 305d 202b 206f 7574 7075 745f 7061 6464  0] + output_padd
+00008db0: 696e 675b 305d 290d 0a20 2020 2020 2020  ing[0])..       
+00008dc0: 2069 6620 7365 6c66 2e64 6174 6173 6574   if self.dataset
+00008dd0: 2e68 5f70 6172 616d 735b 276e 5f74 275d  .h_params['n_t']
+00008de0: 2573 656c 662e 7370 6563 735b 2773 7472  %self.specs['str
+00008df0: 6964 6527 5d20 3d3d 2030 3a0d 0a20 2020  ide'] == 0:..   
+00008e00: 2020 2020 2020 2020 2070 6164 6469 6e67           padding
+00008e10: 3d4e 6f6e 650d 0a20 2020 2020 2020 2065  =None..        e
+00008e20: 6c69 6620 7365 6c66 2e64 6174 6173 6574  lif self.dataset
+00008e30: 2e68 5f70 6172 616d 735b 276e 5f74 275d  .h_params['n_t']
+00008e40: 2573 656c 662e 7370 6563 735b 2773 7472  %self.specs['str
+00008e50: 6964 6527 5d20 2d20 3120 3e20 303a 0d0a  ide'] - 1 > 0:..
+00008e60: 2020 2020 2020 2020 2020 2020 7061 6464              padd
+00008e70: 696e 6720 3d20 2873 656c 662e 6461 7461  ing = (self.data
+00008e80: 7365 742e 685f 7061 7261 6d73 5b27 6e5f  set.h_params['n_
+00008e90: 7427 5d25 7365 6c66 2e73 7065 6373 5b27  t']%self.specs['
+00008ea0: 7374 7269 6465 275d 202d 2031 2c20 3029  stride'] - 1, 0)
+00008eb0: 0d0a 2020 2020 2020 2020 656c 7365 203a  ..        else :
+00008ec0: 0d0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
+00008ed0: 6464 696e 6720 3d20 2828 7365 6c66 2e64  dding = ((self.d
+00008ee0: 6174 6173 6574 2e68 5f70 6172 616d 735b  ataset.h_params[
+00008ef0: 276e 5f74 275d 202d 2031 2925 7365 6c66  'n_t'] - 1)%self
+00008f00: 2e73 7065 6373 5b27 7374 7269 6465 275d  .specs['stride']
+00008f10: 202c 2030 290d 0a0d 0a0d 0a20 2020 2020   , 0)......     
+00008f20: 2020 2070 7269 6e74 2870 6164 6469 6e67     print(padding
+00008f30: 290d 0a0d 0a0d 0a20 2020 2020 2020 2023  )......        #
+00008f40: 7374 6172 7420 7769 7468 2074 6865 206f  start with the o
+00008f50: 7574 7075 7420 6f66 2064 6563 6f64 6572  utput of decoder
+00008f60: 0d0a 2020 2020 2020 2020 2365 6c66 2e65  ..        #elf.e
+00008f70: 6e63 5f69 6e70 7574 7320 3d20 6c61 7965  nc_inputs = laye
+00008f80: 7273 2e49 6e70 7574 2873 656c 662e 795f  rs.Input(self.y_
+00008f90: 7368 6170 6529 0d0a 2020 2020 2020 2020  shape)..        
+00008fa0: 7365 6c66 2e65 6e63 5f66 6320 3d20 4675  self.enc_fc = Fu
+00008fb0: 6c6c 7943 6f6e 6e65 6374 6564 2873 697a  llyConnected(siz
+00008fc0: 653d 7365 6c66 2e66 696e 5f66 632e 772e  e=self.fin_fc.w.
+00008fd0: 7368 6170 655b 305d 2c20 6e6f 6e6c 696e  shape[0], nonlin
+00008fe0: 3d74 662e 6964 656e 7469 7479 2c0d 0a20  =tf.identity,.. 
+00008ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009000: 2020 2020 2020 2020 2020 2073 7065 6373             specs
+00009010: 3d73 656c 662e 7370 6563 7329 0d0a 2020  =self.specs)..  
+00009020: 2020 2020 2020 656e 635f 7463 6f6e 765f        enc_tconv_
+00009030: 6163 7469 7661 7469 6f6e 7320 3d20 2073  activations =  s
+00009040: 656c 662e 656e 635f 6663 2873 656c 662e  elf.enc_fc(self.
+00009050: 795f 7072 6564 290d 0a20 2020 2020 2020  y_pred)..       
+00009060: 2065 6e63 5f74 636f 6e76 5f61 6374 6976   enc_tconv_activ
+00009070: 6174 696f 6e73 5f72 203d 2074 662e 7265  ations_r = tf.re
+00009080: 7368 6170 6528 656e 635f 7463 6f6e 765f  shape(enc_tconv_
+00009090: 6163 7469 7661 7469 6f6e 732c 0d0a 2020  activations,..  
+000090a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000090b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000090c0: 2020 2020 2020 2020 2020 205b 2d31 2c20             [-1, 
+000090d0: 312c 2073 656c 662e 706f 6f6c 6564 2e73  1, self.pooled.s
+000090e0: 6861 7065 5b2d 325d 2c0d 0a20 2020 2020  hape[-2],..     
+000090f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009110: 2020 2020 2020 2020 7365 6c66 2e73 7065          self.spe
+00009120: 6373 5b27 6e5f 6c61 7465 6e74 275d 5d29  cs['n_latent']])
+00009130: 0d0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
+00009140: 656e 635f 7463 6f6e 765f 6163 7469 7661  enc_tconv_activa
+00009150: 7469 6f6e 735f 722e 7368 6170 6529 0d0a  tions_r.shape)..
+00009160: 2020 2020 2020 2020 656e 635f 6472 6f70          enc_drop
+00009170: 6f75 7420 3d20 4472 6f70 6f75 7428 7365  out = Dropout(se
+00009180: 6c66 2e73 7065 6373 5b27 6472 6f70 6f75  lf.specs['dropou
+00009190: 7427 5d2c 0d0a 2020 2020 2020 2020 2020  t'],..          
+000091a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000091b0: 6e6f 6973 655f 7368 6170 653d 4e6f 6e65  noise_shape=None
+000091c0: 2928 656e 635f 7463 6f6e 765f 6163 7469  )(enc_tconv_acti
+000091d0: 7661 7469 6f6e 735f 7229 0d0a 2020 2020  vations_r)..    
+000091e0: 2020 2020 2375 706f 6f6c 2061 6e64 2061      #upool and a
+000091f0: 7070 6c79 2074 7261 6e73 706f 7365 6420  pply transposed 
+00009200: 6465 7074 6877 6973 6520 636f 6e76 6f6c  depthwise convol
+00009210: 7574 696f 6e0d 0a20 2020 2020 2020 2023  ution..        #
+00009220: 2073 656c 662e 656e 635f 7463 6f6e 765f   self.enc_tconv_
+00009230: 7472 616e 7320 3d20 4c46 5443 6f6e 7654  trans = LFTConvT
+00009240: 7261 6e73 706f 7365 3128 6669 6c74 6572  ranspose1(filter
+00009250: 733d 7365 6c66 2e74 636f 6e76 2e66 696c  s=self.tconv.fil
+00009260: 7465 7273 2c0d 0a20 2020 2020 2020 2023  ters,..        #
+00009270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009290: 2020 2020 6b65 726e 656c 5f73 697a 653d      kernel_size=
+000092a0: 2073 656c 662e 7370 6563 735b 2766 696c   self.specs['fil
+000092b0: 7465 725f 6c65 6e67 7468 275d 2c0d 0a20  ter_length'],.. 
+000092c0: 2020 2020 2020 2023 2020 2020 2020 2020         #        
+000092d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000092e0: 2020 2020 2020 2020 2020 2020 7374 7269              stri
+000092f0: 6465 3d73 656c 662e 7370 6563 735b 2773  de=self.specs['s
+00009300: 7472 6964 6527 5d2c 0d0a 2020 2020 2020  tride'],..      
+00009310: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+00009320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009330: 2020 2020 2020 206f 7574 7075 745f 7061         output_pa
+00009340: 6464 696e 673d 6e5f 7061 6464 696e 6729  dding=n_padding)
+00009350: 0d0a 2020 2020 2020 2020 236e 5f70 6164  ..        #n_pad
+00009360: 6469 6e67 0d0a 2020 2020 2020 2020 7365  ding..        se
+00009370: 6c66 2e65 6e63 5f74 636f 6e76 5f74 7261  lf.enc_tconv_tra
+00009380: 6e73 3d74 662e 6b65 7261 732e 6c61 7965  ns=tf.keras.laye
+00009390: 7273 2e43 6f6e 7632 4454 7261 6e73 706f  rs.Conv2DTranspo
+000093a0: 7365 280d 0a20 2020 2020 2020 2020 2020  se(..           
+000093b0: 2066 696c 7465 7273 3d31 2c0d 0a20 2020   filters=1,..   
+000093c0: 2020 2020 2020 2020 206b 6572 6e65 6c5f           kernel_
+000093d0: 7369 7a65 3d28 7365 6c66 2e73 7065 6373  size=(self.specs
+000093e0: 5b27 6669 6c74 6572 5f6c 656e 6774 6827  ['filter_length'
+000093f0: 5d2c 2073 656c 662e 7370 6563 735b 276e  ], self.specs['n
+00009400: 5f6c 6174 656e 7427 5d29 2c0d 0a20 2020  _latent']),..   
+00009410: 2020 2020 2020 2020 2073 7472 6964 6573           strides
+00009420: 3d28 7365 6c66 2e73 7065 6373 5b27 7374  =(self.specs['st
+00009430: 7269 6465 275d 2c20 3129 2c0d 0a20 2020  ride'], 1),..   
+00009440: 2020 2020 2020 2020 2070 6164 6469 6e67           padding
+00009450: 3d27 7361 6d65 272c 0d0a 2020 2020 2020  ='same',..      
+00009460: 2020 2020 2020 6f75 7470 7574 5f70 6164        output_pad
+00009470: 6469 6e67 3d70 6164 6469 6e67 2c0d 0a20  ding=padding,.. 
+00009480: 2020 2020 2020 2020 2020 2064 6174 615f             data_
+00009490: 666f 726d 6174 3d27 6368 616e 6e65 6c73  format='channels
+000094a0: 5f66 6972 7374 272c 0d0a 2020 2020 2020  _first',..      
+000094b0: 2020 2020 2020 6469 6c61 7469 6f6e 5f72        dilation_r
+000094c0: 6174 653d 2831 2c20 3129 2c0d 0a20 2020  ate=(1, 1),..   
+000094d0: 2020 2020 2020 2020 2061 6374 6976 6174           activat
+000094e0: 696f 6e3d 4e6f 6e65 2c0d 0a20 2020 2020  ion=None,..     
+000094f0: 2020 2020 2020 2075 7365 5f62 6961 733d         use_bias=
+00009500: 4661 6c73 652c 0d0a 2020 2020 2020 2020  False,..        
+00009510: 2020 2020 6b65 726e 656c 5f69 6e69 7469      kernel_initi
+00009520: 616c 697a 6572 3d27 676c 6f72 6f74 5f75  alizer='glorot_u
+00009530: 6e69 666f 726d 272c 0d0a 2020 2020 2020  niform',..      
+00009540: 2020 2020 2020 6269 6173 5f69 6e69 7469        bias_initi
+00009550: 616c 697a 6572 3d27 7a65 726f 7327 2c0d  alizer='zeros',.
+00009560: 0a20 2020 2020 2020 2020 2020 206b 6572  .            ker
+00009570: 6e65 6c5f 7265 6775 6c61 7269 7a65 723d  nel_regularizer=
+00009580: 7466 2e6b 6572 6173 2e72 6567 756c 6172  tf.keras.regular
+00009590: 697a 6572 732e 6c31 2873 656c 662e 7370  izers.l1(self.sp
+000095a0: 6563 735b 276c 315f 6c61 6d62 6461 275d  ecs['l1_lambda']
+000095b0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+000095c0: 6269 6173 5f72 6567 756c 6172 697a 6572  bias_regularizer
+000095d0: 3d4e 6f6e 652c 0d0a 2020 2020 2020 2020  =None,..        
+000095e0: 2020 2020 6163 7469 7669 7479 5f72 6567      activity_reg
+000095f0: 756c 6172 697a 6572 3d4e 6f6e 652c 0d0a  ularizer=None,..
+00009600: 2020 2020 2020 2020 2020 2020 6b65 726e              kern
+00009610: 656c 5f63 6f6e 7374 7261 696e 743d 7466  el_constraint=tf
+00009620: 2e6b 6572 6173 2e63 6f6e 7374 7261 696e  .keras.constrain
+00009630: 7473 2e55 6e69 744e 6f72 6d28 6178 6973  ts.UnitNorm(axis
+00009640: 3d30 292c 0d0a 2020 2020 2020 2020 2020  =0),..          
+00009650: 2020 6269 6173 5f63 6f6e 7374 7261 696e    bias_constrain
+00009660: 743d 4e6f 6e65 2c0d 0a20 2020 2020 2020  t=None,..       
+00009670: 2029 0d0a 0d0a 0d0a 2020 2020 2020 2020   )......        
+00009680: 656e 635f 6465 636f 6e76 203d 2073 656c  enc_deconv = sel
+00009690: 662e 656e 635f 7463 6f6e 765f 7472 616e  f.enc_tconv_tran
+000096a0: 7328 656e 635f 6472 6f70 6f75 7429 0d0a  s(enc_dropout)..
+000096b0: 2020 2020 2020 2020 2365 6e63 5f64 6563          #enc_dec
+000096c0: 6f6e 7620 3d20 7466 2e74 7261 6e73 706f  onv = tf.transpo
+000096d0: 7365 2865 6e63 5f64 6563 6f6e 762c 2070  se(enc_deconv, p
+000096e0: 6572 6d3d 5b30 2c33 2c31 2c32 5d29 0d0a  erm=[0,3,1,2])..
+000096f0: 2020 2020 2020 2020 7072 696e 7428 2245          print("E
+00009700: 6e63 5f64 6563 6f6e 763a 222c 2065 6e63  nc_deconv:", enc
+00009710: 5f64 6563 6f6e 762e 7368 6170 6529 0d0a  _deconv.shape)..
+00009720: 0d0a 2020 2020 2020 2020 7365 6c66 2e64  ..        self.d
+00009730: 655f 646d 7820 3d20 4465 4d69 7869 6e67  e_dmx = DeMixing
+00009740: 2873 697a 653d 7365 6c66 2e64 6174 6173  (size=self.datas
+00009750: 6574 2e68 5f70 6172 616d 735b 276e 5f63  et.h_params['n_c
+00009760: 6827 5d2c 206e 6f6e 6c69 6e3d 7466 2e69  h'], nonlin=tf.i
+00009770: 6465 6e74 6974 792c 0d0a 2020 2020 2020  dentity,..      
+00009780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009790: 2020 2020 2020 6178 6973 3d33 2c20 7370        axis=3, sp
+000097a0: 6563 733d 7365 6c66 2e73 7065 6373 290d  ecs=self.specs).
+000097b0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+000097c0: 585f 7072 6564 203d 2073 656c 662e 6465  X_pred = self.de
+000097d0: 5f64 6d78 2865 6e63 5f64 6563 6f6e 7629  _dmx(enc_deconv)
+000097e0: 0d0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
+000097f0: 7365 6c66 2e58 5f70 7265 642e 7368 6170  self.X_pred.shap
+00009800: 6529 0d0a 2020 2020 2020 2020 7365 6c66  e)..        self
+00009810: 2e6b 6d5f 656e 6320 3d20 7466 2e6b 6572  .km_enc = tf.ker
+00009820: 6173 2e4d 6f64 656c 2869 6e70 7574 733d  as.Model(inputs=
+00009830: 7365 6c66 2e69 6e70 7574 732c 206f 7574  self.inputs, out
+00009840: 7075 7473 3d73 656c 662e 585f 7072 6564  puts=self.X_pred
+00009850: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
+00009860: 662e 6d65 7461 2e74 7261 696e 5f70 6172  f.meta.train_par
+00009870: 616d 735b 2765 6e63 5f6c 6f73 7327 5d20  ams['enc_loss'] 
+00009880: 3d20 5b74 662e 6b65 7261 732e 6c6f 7373  = [tf.keras.loss
+00009890: 6573 2e4d 4145 5d23 7466 2e72 6564 7563  es.MAE]#tf.reduc
+000098a0: 655f 6d65 616e 2828 7365 6c66 2e58 5f70  e_mean((self.X_p
+000098b0: 7265 6420 2d20 7365 6c66 2e69 6e70 7574  red - self.input
+000098c0: 7329 2a2a 3229 0d0a 2020 2020 2020 2020  s)**2)..        
+000098d0: 2373 656c 662e 7061 7261 6d73 5b27 656e  #self.params['en
+000098e0: 635f 6d65 7472 6963 7327 5d20 3d20 7466  c_metrics'] = tf
+000098f0: 2e6b 6572 6173 2e6d 6574 7269 6373 2e52  .keras.metrics.R
+00009900: 6f6f 744d 6561 6e53 7175 6172 6564 4572  ootMeanSquaredEr
+00009910: 726f 7228 6e61 6d65 3d22 524d 5345 2229  ror(name="RMSE")
+00009920: 0d0a 0d0a 0d0a 2020 2020 2020 2020 2370  ......        #p
+00009930: 7269 6e74 2870 6172 616d 7329 0d0a 2020  rint(params)..  
+00009940: 2020 2020 2020 7365 6c66 2e6b 6d5f 656e        self.km_en
+00009950: 632e 636f 6d70 696c 6528 6f70 7469 6d69  c.compile(optimi
+00009960: 7a65 723d 7466 2e6b 6572 6173 2e6f 7074  zer=tf.keras.opt
+00009970: 696d 697a 6572 732e 6c65 6761 6379 2e41  imizers.legacy.A
+00009980: 6461 6d28 292c 0d0a 2020 2020 2020 2020  dam(),..        
 00009990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000099a0: 2073 656c 662e 706f 6f6c 6564 2e73 6861   self.pooled.sha
-000099b0: 7065 5b2d 325d 2c0d 0a20 2020 2020 2020  pe[-2],..       
-000099c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000099d0: 662e 7370 6563 735b 276e 5f6c 6174 656e  f.specs['n_laten
-000099e0: 7427 5d5d 290d 0a20 2020 2020 2020 2075  t']])..        u
-000099f0: 6e70 6f6f 6c65 645f 7766 7320 3d20 7365  npooled_wfs = se
-00009a00: 6c66 2e65 6e63 5f74 636f 6e76 5f74 7261  lf.enc_tconv_tra
-00009a10: 6e73 2870 6f6f 6c65 6429 0d0a 2020 2020  ns(pooled)..    
-00009a20: 2020 2020 7061 7474 6572 6e73 203d 2073      patterns = s
-00009a30: 656c 662e 6465 5f64 6d78 2875 6e70 6f6f  elf.de_dmx(unpoo
-00009a40: 6c65 645f 7766 7329 0d0a 0d0a 2020 2020  led_wfs)....    
-00009a50: 2020 2020 7265 7475 726e 206e 702e 7371      return np.sq
-00009a60: 7565 657a 6528 7061 7474 6572 6e73 2920  ueeze(patterns) 
-00009a70: 232c 2075 6e70 6f6f 6c65 645f 7766 730d  #, unpooled_wfs.
-00009a80: 0a0d 0a20 2020 2064 6566 2074 7261 696e  ...    def train
-00009a90: 5f65 6e63 6f64 6572 2873 656c 662c 206e  _encoder(self, n
-00009aa0: 5f65 706f 6368 732c 2065 7661 6c5f 7374  _epochs, eval_st
-00009ab0: 6570 3d4e 6f6e 652c 206d 696e 5f64 656c  ep=None, min_del
-00009ac0: 7461 3d31 652d 362c 0d0a 2020 2020 2020  ta=1e-6,..      
-00009ad0: 2020 2020 2020 2020 6561 726c 795f 7374          early_st
-00009ae0: 6f70 7069 6e67 3d33 2c20 636f 6c6c 6563  opping=3, collec
-00009af0: 745f 7061 7474 6572 6e73 3d46 616c 7365  t_patterns=False
-00009b00: 293a 0d0a 2020 2020 2020 2020 6461 7461  ):..        data
-00009b10: 7365 745f 7472 6169 6e20 3d20 7365 6c66  set_train = self
-00009b20: 2e64 6174 6173 6574 2e74 7261 696e 2e6d  .dataset.train.m
-00009b30: 6170 286c 616d 6264 6120 782c 2079 203a  ap(lambda x, y :
-00009b40: 2028 782c 2078 2929 0d0a 2020 2020 2020   (x, x))..      
-00009b50: 2020 6461 7461 7365 745f 7661 6c20 3d20    dataset_val = 
-00009b60: 7365 6c66 2e64 6174 6173 6574 2e76 616c  self.dataset.val
-00009b70: 2e6d 6170 286c 616d 6264 6120 782c 2079  .map(lambda x, y
-00009b80: 203a 2028 782c 2078 2929 0d0a 2020 2020   : (x, x))..    
-00009b90: 2020 2020 7374 6f70 5f65 6172 6c79 203d      stop_early =
-00009ba0: 2074 662e 6b65 7261 732e 6361 6c6c 6261   tf.keras.callba
-00009bb0: 636b 732e 4561 726c 7953 746f 7070 696e  cks.EarlyStoppin
-00009bc0: 6728 6d6f 6e69 746f 723d 2776 616c 5f6c  g(monitor='val_l
-00009bd0: 6f73 7327 2c0d 0a20 2020 2020 2020 2020  oss',..         
-00009be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c00: 2020 2020 2020 2020 2020 2020 206d 696e               min
-00009c10: 5f64 656c 7461 3d6d 696e 5f64 656c 7461  _delta=min_delta
-00009c20: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00009c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c50: 2020 2020 2020 2020 2070 6174 6965 6e63           patienc
-00009c60: 653d 6561 726c 795f 7374 6f70 7069 6e67  e=early_stopping
-00009c70: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00009c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ca0: 2020 2020 2020 2020 2072 6573 746f 7265           restore
-00009cb0: 5f62 6573 745f 7765 6967 6874 733d 5472  _best_weights=Tr
-00009cc0: 7565 290d 0a20 2020 2020 2020 2073 656c  ue)..        sel
-00009cd0: 662e 745f 6869 7374 203d 2073 656c 662e  f.t_hist = self.
-00009ce0: 6b6d 5f65 6e63 2e66 6974 2864 6174 6173  km_enc.fit(datas
-00009cf0: 6574 5f74 7261 696e 2c0d 0a20 2020 2020  et_train,..     
-00009d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d10: 2020 2020 2020 2020 2020 2020 2020 7661                va
-00009d20: 6c69 6461 7469 6f6e 5f64 6174 613d 6461  lidation_data=da
-00009d30: 7461 7365 745f 7661 6c2c 0d0a 2020 2020  taset_val,..    
+000099a0: 6c6f 7373 3d73 656c 662e 6d65 7461 2e74  loss=self.meta.t
+000099b0: 7261 696e 5f70 6172 616d 735b 2765 6e63  rain_params['enc
+000099c0: 5f6c 6f73 7327 5d29 0d0a 0d0a 2020 2020  _loss'])....    
+000099d0: 6465 6620 636f 6d70 7574 655f 656e 635f  def compute_enc_
+000099e0: 7061 7474 6572 6e73 2873 656c 662c 2069  patterns(self, i
+000099f0: 6e70 7574 733d 4e6f 6e65 293a 0d0a 2020  nputs=None):..  
+00009a00: 2020 2020 2020 2222 220d 0a0d 0a20 2020        """....   
+00009a10: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
+00009a20: 2020 6966 206e 6f74 206e 702e 616e 7928    if not np.any(
+00009a30: 696e 7075 7473 293a 0d0a 2020 2020 2020  inputs):..      
+00009a40: 2020 2020 2020 7072 696e 7428 2755 7369        print('Usi
+00009a50: 6e67 2066 616b 6520 696e 7075 7473 2729  ng fake inputs')
+00009a60: 0d0a 2020 2020 2020 2020 2020 2020 696e  ..            in
+00009a70: 7075 7473 203d 206e 702e 6964 656e 7469  puts = np.identi
+00009a80: 7479 2873 656c 662e 6f75 745f 6469 6d29  ty(self.out_dim)
+00009a90: 0d0a 2020 2020 2020 2020 706f 6f6c 6564  ..        pooled
+00009aa0: 203d 2074 662e 7265 7368 6170 6528 7365   = tf.reshape(se
+00009ab0: 6c66 2e65 6e63 5f66 6328 696e 7075 7473  lf.enc_fc(inputs
+00009ac0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+00009ad0: 2020 2020 2020 205b 2d31 2c0d 0a20 2020         [-1,..   
+00009ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009af0: 2031 2c0d 0a20 2020 2020 2020 2020 2020   1,..           
+00009b00: 2020 2020 2020 2020 2073 656c 662e 706f           self.po
+00009b10: 6f6c 6564 2e73 6861 7065 5b2d 325d 2c0d  oled.shape[-2],.
+00009b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009b30: 2020 2020 2073 656c 662e 7370 6563 735b       self.specs[
+00009b40: 276e 5f6c 6174 656e 7427 5d5d 290d 0a20  'n_latent']]).. 
+00009b50: 2020 2020 2020 2075 6e70 6f6f 6c65 645f         unpooled_
+00009b60: 7766 7320 3d20 7365 6c66 2e65 6e63 5f74  wfs = self.enc_t
+00009b70: 636f 6e76 5f74 7261 6e73 2870 6f6f 6c65  conv_trans(poole
+00009b80: 6429 0d0a 2020 2020 2020 2020 7061 7474  d)..        patt
+00009b90: 6572 6e73 203d 2073 656c 662e 6465 5f64  erns = self.de_d
+00009ba0: 6d78 2875 6e70 6f6f 6c65 645f 7766 7329  mx(unpooled_wfs)
+00009bb0: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
+00009bc0: 726e 206e 702e 7371 7565 657a 6528 7061  rn np.squeeze(pa
+00009bd0: 7474 6572 6e73 2920 232c 2075 6e70 6f6f  tterns) #, unpoo
+00009be0: 6c65 645f 7766 730d 0a0d 0a20 2020 2064  led_wfs....    d
+00009bf0: 6566 2074 7261 696e 5f65 6e63 6f64 6572  ef train_encoder
+00009c00: 2873 656c 662c 206e 5f65 706f 6368 732c  (self, n_epochs,
+00009c10: 2065 7661 6c5f 7374 6570 3d4e 6f6e 652c   eval_step=None,
+00009c20: 206d 696e 5f64 656c 7461 3d31 652d 362c   min_delta=1e-6,
+00009c30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00009c40: 6561 726c 795f 7374 6f70 7069 6e67 3d33  early_stopping=3
+00009c50: 2c20 636f 6c6c 6563 745f 7061 7474 6572  , collect_patter
+00009c60: 6e73 3d46 616c 7365 293a 0d0a 2020 2020  ns=False):..    
+00009c70: 2020 2020 6461 7461 7365 745f 7472 6169      dataset_trai
+00009c80: 6e20 3d20 7365 6c66 2e64 6174 6173 6574  n = self.dataset
+00009c90: 2e74 7261 696e 2e6d 6170 286c 616d 6264  .train.map(lambd
+00009ca0: 6120 782c 2079 203a 2028 782c 2078 2929  a x, y : (x, x))
+00009cb0: 0d0a 2020 2020 2020 2020 6461 7461 7365  ..        datase
+00009cc0: 745f 7661 6c20 3d20 7365 6c66 2e64 6174  t_val = self.dat
+00009cd0: 6173 6574 2e76 616c 2e6d 6170 286c 616d  aset.val.map(lam
+00009ce0: 6264 6120 782c 2079 203a 2028 782c 2078  bda x, y : (x, x
+00009cf0: 2929 0d0a 2020 2020 2020 2020 7374 6f70  ))..        stop
+00009d00: 5f65 6172 6c79 203d 2074 662e 6b65 7261  _early = tf.kera
+00009d10: 732e 6361 6c6c 6261 636b 732e 4561 726c  s.callbacks.Earl
+00009d20: 7953 746f 7070 696e 6728 6d6f 6e69 746f  yStopping(monito
+00009d30: 723d 2776 616c 5f6c 6f73 7327 2c0d 0a20  r='val_loss',.. 
 00009d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d50: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00009d60: 706f 6368 733d 6e5f 6570 6f63 6873 2c20  pochs=n_epochs, 
-00009d70: 7374 6570 735f 7065 725f 6570 6f63 683d  steps_per_epoch=
-00009d80: 6576 616c 5f73 7465 702c 0d0a 2020 2020  eval_step,..    
+00009d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009d70: 2020 2020 206d 696e 5f64 656c 7461 3d6d       min_delta=m
+00009d80: 696e 5f64 656c 7461 2c0d 0a20 2020 2020  in_delta,..     
 00009d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009da0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00009db0: 6875 6666 6c65 3d54 7275 652c 0d0a 2020  huffle=True,..  
-00009dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009de0: 2076 616c 6964 6174 696f 6e5f 7374 6570   validation_step
-00009df0: 733d 7365 6c66 2e64 6174 6173 6574 2e76  s=self.dataset.v
-00009e00: 616c 6964 6174 696f 6e5f 7374 6570 732c  alidation_steps,
-00009e10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00009e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e30: 2020 2020 2063 616c 6c62 6163 6b73 3d5b       callbacks=[
-00009e40: 7374 6f70 5f65 6172 6c79 5d2c 2076 6572  stop_early], ver
-00009e50: 626f 7365 3d32 2c0d 0a20 2020 2020 2020  bose=2,..       
-00009e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e70: 2020 2020 2020 2020 2020 2020 2363 6c61              #cla
-00009e80: 7373 5f77 6569 6768 743d 636c 6173 735f  ss_weight=class_
-00009e90: 7765 6967 6874 730d 0a20 2020 2020 2020  weights..       
-00009ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009eb0: 2020 2020 2020 2020 2020 2020 290d 0a0d              )...
-00009ec0: 0a20 2020 2064 6566 2067 6574 5f63 6f6e  .    def get_con
-00009ed0: 6669 6728 7365 6c66 293a 0d0a 2020 2020  fig(self):..    
-00009ee0: 2020 2020 2020 2020 2320 446f 206e 6f74          # Do not
-00009ef0: 2063 616c 6c20 7375 7065 722e 6765 745f   call super.get_
-00009f00: 636f 6e66 6967 210d 0a20 2020 2020 2020  config!..       
-00009f10: 2020 2020 2023 2054 6869 7320 6761 7665       # This gave
-00009f20: 2061 6e20 6572 726f 7220 666f 7220 6d65   an error for me
-00009f30: 2e0d 0a20 2020 2020 2020 2020 2020 2063  ...            c
-00009f40: 6f6e 6669 6720 3d20 7b0d 0a20 2020 2020  onfig = {..     
-00009f50: 2020 2020 2020 2020 2020 2022 646d 7822             "dmx"
-00009f60: 3a20 7365 6c66 2e64 6d78 2c0d 0a20 2020  : self.dmx,..   
-00009f70: 2020 2020 2020 2020 2020 2020 2022 646d               "dm
-00009f80: 785f 6f75 7422 3a20 7365 6c66 2e64 6d78  x_out": self.dmx
-00009f90: 5f6f 7574 2c0d 0a20 2020 2020 2020 2020  _out,..         
-00009fa0: 2020 2020 2020 2022 746f 636e 7622 3a20         "tocnv": 
-00009fb0: 7365 6c66 2e74 636f 6e76 2c0d 0a20 2020  self.tconv,..   
-00009fc0: 2020 2020 2020 2020 2020 2020 2022 7463               "tc
-00009fd0: 6f6e 765f 6f75 7422 3a20 7365 6c66 2e74  onv_out": self.t
-00009fe0: 636f 6e76 5f6f 7574 2c0d 0a20 2020 2020  conv_out,..     
-00009ff0: 2020 2020 2020 2020 2020 2022 706f 6f6c             "pool
-0000a000: 223a 2073 656c 662e 706f 6f6c 2c0d 0a20  ": self.pool,.. 
-0000a010: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000a020: 706f 6f6c 6564 223a 2073 656c 662e 706f  pooled": self.po
-0000a030: 6f6c 6564 2c0d 0a20 2020 2020 2020 2020  oled,..         
-0000a040: 2020 2020 2020 2022 6472 6f70 6f75 7422         "dropout"
-0000a050: 3a20 7365 6c66 2e64 726f 706f 7574 2c0d  : self.dropout,.
-0000a060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a070: 2022 6669 6e5f 6663 223a 2073 656c 662e   "fin_fc": self.
-0000a080: 6669 6e5f 6663 0d0a 2020 2020 2020 2020  fin_fc..        
-0000a090: 2020 2020 7d0d 0a20 2020 2020 2020 2020      }..         
-0000a0a0: 2020 2072 6574 7572 6e20 636f 6e66 6967     return config
-0000a0b0: 0d0a 0d0a 2020 2020 6465 6620 5f67 6574  ....    def _get
-0000a0c0: 5f63 6c61 7373 5f63 6f6e 6469 7469 6f6e  _class_condition
-0000a0d0: 616c 5f73 7061 7469 616c 5f63 6f76 6172  al_spatial_covar
-0000a0e0: 6961 6e63 6528 7365 6c66 2c20 582c 2079  iance(self, X, y
-0000a0f0: 293a 0d0a 2020 2020 2020 2020 2222 2243  ):..        """C
-0000a100: 6f6d 7075 7465 2073 7061 7469 616c 2063  ompute spatial c
-0000a110: 6c61 7373 2d63 6f6e 6469 7469 6f6e 616c  lass-conditional
-0000a120: 2063 6f76 6172 6961 6e63 6520 6d61 7472   covariance matr
-0000a130: 6978 2066 726f 6d20 7468 6520 6461 7461  ix from the data
-0000a140: 7365 740d 0a0d 0a20 2020 2020 2020 2050  set....        P
-0000a150: 6172 616d 6574 6572 733a 0d0a 2020 2020  arameters:..    
-0000a160: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d0d      -----------.
-0000a170: 0a20 2020 2020 2020 2064 6174 6173 6574  .        dataset
-0000a180: 203a 2074 662e 6461 7461 2e44 6174 6173   : tf.data.Datas
-0000a190: 6574 0d0a 0d0a 2020 2020 2020 2020 5265  et....        Re
-0000a1a0: 7475 726e 7320 3a20 6463 6f76 205b 795f  turns : dcov [y_
-0000a1b0: 7368 6170 652c 206e 5f63 682c 206e 5f63  shape, n_ch, n_c
-0000a1c0: 685d 0d0a 0d0a 2020 2020 2020 2020 2222  h]....        ""
-0000a1d0: 220d 0a20 2020 2020 2020 2023 544f 444f  "..        #TODO
-0000a1e0: 3a20 4669 7820 7265 6772 6573 7369 6f6e  : Fix regression
-0000a1f0: 2063 6173 650d 0a20 2020 2020 2020 2064   case..        d
-0000a200: 636f 7673 203d 205b 5d0d 0a20 2020 2020  covs = []..     
-0000a210: 2020 2064 636f 7673 5f6e 203d 205b 5d0d     dcovs_n = [].
-0000a220: 0a20 2020 2020 2020 2066 6f72 2063 6c61  .        for cla
-0000a230: 7373 5f79 2069 6e20 7261 6e67 6528 7365  ss_y in range(se
-0000a240: 6c66 2e6f 7574 5f64 696d 293a 0d0a 2020  lf.out_dim):..  
-0000a250: 2020 2020 2020 2020 2020 636c 6173 735f            class_
-0000a260: 696e 6420 3d20 7466 2e73 7175 6565 7a65  ind = tf.squeeze
-0000a270: 2874 662e 7768 6572 6528 7466 2e61 7267  (tf.where(tf.arg
-0000a280: 6d61 7828 792c 2031 293d 3d63 6c61 7373  max(y, 1)==class
-0000a290: 5f79 2929 235b 305d 0d0a 2020 2020 2020  _y))#[0]..      
-0000a2a0: 2020 2020 2020 7873 203d 206e 702e 7371        xs = np.sq
-0000a2b0: 7565 657a 6528 582e 6e75 6d70 7928 295b  ueeze(X.numpy()[
-0000a2c0: 636c 6173 735f 696e 642c 202e 2e2e 5d29  class_ind, ...])
-0000a2d0: 0d0a 2020 2020 2020 2020 2020 2020 2378  ..            #x
-0000a2e0: 7320 2d3d 206e 702e 6d65 616e 2878 732c  s -= np.mean(xs,
-0000a2f0: 2061 7869 733d 2d32 2c20 6b65 6570 6469   axis=-2, keepdi
-0000a300: 6d73 3d54 7275 6529 0d0a 2020 2020 2020  ms=True)..      
-0000a310: 2020 2020 2020 6464 6f66 5f73 203d 2078        ddof_s = x
-0000a320: 732e 7368 6170 655b 305d 2a73 656c 662e  s.shape[0]*self.
-0000a330: 6461 7461 7365 742e 685f 7061 7261 6d73  dataset.h_params
-0000a340: 5b27 6e5f 7427 5d20 2d20 310d 0a20 2020  ['n_t'] - 1..   
-0000a350: 2020 2020 2020 2020 2063 6f76 5f73 203d           cov_s =
-0000a360: 206e 702e 6569 6e73 756d 2827 696a 6b2c   np.einsum('ijk,
-0000a370: 2069 6a6c 202d 3e20 6b6c 272c 2078 732c   ijl -> kl', xs,
-0000a380: 2078 7329 202f 2064 646f 665f 730d 0a0d   xs) / ddof_s...
-0000a390: 0a20 2020 2020 2020 2020 2020 2061 6e74  .            ant
-0000a3a0: 695f 636c 6173 735f 696e 6420 3d20 7466  i_class_ind = tf
-0000a3b0: 2e73 7175 6565 7a65 2874 662e 7768 6572  .squeeze(tf.wher
-0000a3c0: 6528 7466 2e61 7267 6d61 7828 792c 2031  e(tf.argmax(y, 1
-0000a3d0: 2921 3d63 6c61 7373 5f79 2929 235b 305d  )!=class_y))#[0]
-0000a3e0: 0d0a 2020 2020 2020 2020 2020 2020 786e  ..            xn
-0000a3f0: 203d 206e 702e 7371 7565 657a 6528 582e   = np.squeeze(X.
-0000a400: 6e75 6d70 7928 295b 616e 7469 5f63 6c61  numpy()[anti_cla
-0000a410: 7373 5f69 6e64 2c20 2e2e 2e5d 290d 0a20  ss_ind, ...]).. 
-0000a420: 2020 2020 2020 2020 2020 2064 646f 665f             ddof_
-0000a430: 6e20 3d20 786e 2e73 6861 7065 5b30 5d2a  n = xn.shape[0]*
-0000a440: 7365 6c66 2e64 6174 6173 6574 2e68 5f70  self.dataset.h_p
-0000a450: 6172 616d 735b 276e 5f74 275d 202d 2031  arams['n_t'] - 1
-0000a460: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
-0000a470: 765f 6e20 3d20 6e70 2e65 696e 7375 6d28  v_n = np.einsum(
-0000a480: 2769 6a6b 2c20 696a 6c20 2d3e 206b 6c27  'ijk, ijl -> kl'
-0000a490: 2c20 786e 2c20 786e 2920 2f20 6464 6f66  , xn, xn) / ddof
-0000a4a0: 5f6e 0d0a 0d0a 2020 2020 2020 2020 2020  _n....          
-0000a4b0: 2020 6463 6f76 732e 6170 7065 6e64 2863    dcovs.append(c
-0000a4c0: 6f76 5f73 2920 2320 202d 2063 6f76 5f6e  ov_s) #  - cov_n
-0000a4d0: 0d0a 2020 2020 2020 2020 2020 2020 6463  ..            dc
-0000a4e0: 6f76 735f 6e2e 6170 7065 6e64 2863 6f76  ovs_n.append(cov
-0000a4f0: 5f6e 290d 0a20 2020 2020 2020 2072 6574  _n)..        ret
-0000a500: 7572 6e20 6e70 2e61 7272 6179 2864 636f  urn np.array(dco
-0000a510: 7673 292c 206e 702e 6172 7261 7928 6463  vs), np.array(dc
-0000a520: 6f76 735f 6e29 0d0a 0d0a 0d0a 2020 2020  ovs_n)......    
-0000a530: 6465 6620 7061 7474 6572 6e73 5f63 6f76  def patterns_cov
-0000a540: 5f78 7828 7365 6c66 2c20 792c 2077 6569  _xx(self, y, wei
-0000a550: 6768 7473 2c20 6163 7469 7661 7469 6f6e  ghts, activation
-0000a560: 732c 2064 636f 7629 3a0d 0a20 2020 2020  s, dcov):..     
-0000a570: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-0000a580: 5820 2d20 5b69 2c2e 2e2e 2c6d 5d0d 0a20  X - [i,...,m].. 
-0000a590: 2020 2020 2020 2079 202d 205b 692c 2e2e         y - [i,..
-0000a5a0: 2e2c 6a5d 202d 2075 7365 6420 666f 7220  .,j] - used for 
-0000a5b0: 636f 765b 795d 0d0a 2020 2020 2020 2020  cov[y]..        
-0000a5c0: 7720 2d20 5b6b 2c2e 2e2e 2c6a 5d0d 0a20  w - [k,...,j].. 
-0000a5d0: 2020 2020 2020 2053 7820 2d20 5b6b 2c2e         Sx - [k,.
-0000a5e0: 2e2e 2c6d 6a5d 2222 220d 0a20 2020 2020  ..,mj]"""..     
-0000a5f0: 2020 2078 5f73 6861 7065 203d 206c 6973     x_shape = lis
-0000a600: 7428 6163 7469 7661 7469 6f6e 735b 2774  t(activations['t
-0000a610: 636f 6e76 275d 2e73 6861 7065 290d 0a20  conv'].shape).. 
-0000a620: 2020 2020 2020 2079 5f73 6861 7065 203d         y_shape =
-0000a630: 206c 6973 7428 792e 7368 6170 6529 0d0a   list(y.shape)..
-0000a640: 2020 2020 2020 2020 236f 7574 5f73 6861          #out_sha
-0000a650: 7065 203d 2078 5f73 6861 7065 5b31 3a5d  pe = x_shape[1:]
-0000a660: 202b 2079 5f73 6861 7065 5b31 3a5d 0d0a   + y_shape[1:]..
-0000a670: 2020 2020 2020 2020 2370 7269 6e74 2878          #print(x
-0000a680: 5f73 6861 7065 2c20 795f 7368 6170 652c  _shape, y_shape,
-0000a690: 2077 6569 6768 7473 5b27 6f75 745f 7765   weights['out_we
-0000a6a0: 6967 6874 7327 5d2e 7368 6170 6529 0d0a  ights'].shape)..
-0000a6b0: 2020 2020 2020 2020 6464 6f66 203d 2061          ddof = a
-0000a6c0: 6374 6976 6174 696f 6e73 5b27 7463 6f6e  ctivations['tcon
-0000a6d0: 7627 5d2e 7368 6170 655b 305d 202d 2031  v'].shape[0] - 1
-0000a6e0: 0d0a 2020 2020 2020 2020 5820 3d20 6e70  ..        X = np
-0000a6f0: 2e72 6573 6861 7065 2861 6374 6976 6174  .reshape(activat
-0000a700: 696f 6e73 5b27 7463 6f6e 7627 5d2c 205b  ions['tconv'], [
-0000a710: 6163 7469 7661 7469 6f6e 735b 2774 636f  activations['tco
-0000a720: 6e76 275d 2e73 6861 7065 5b30 5d2c 202d  nv'].shape[0], -
-0000a730: 315d 290d 0a20 2020 2020 2020 2079 203d  1])..        y =
-0000a740: 206e 702e 7265 7368 6170 6528 792c 205b   np.reshape(y, [
-0000a750: 792e 7368 6170 655b 305d 2c20 2d31 5d29  y.shape[0], -1])
-0000a760: 0d0a 0d0a 2020 2020 2020 2020 7720 3d20  ....        w = 
-0000a770: 6e70 2e72 6573 6861 7065 2877 6569 6768  np.reshape(weigh
-0000a780: 7473 5b27 6f75 745f 7765 6967 6874 7327  ts['out_weights'
-0000a790: 5d2c 205b 2d31 2c20 7765 6967 6874 735b  ], [-1, weights[
-0000a7a0: 276f 7574 5f77 6569 6768 7473 275d 2e73  'out_weights'].s
-0000a7b0: 6861 7065 5b2d 315d 5d29 0d0a 2020 2020  hape[-1]])..    
-0000a7c0: 2020 2020 6173 7365 7274 2858 2e73 6861      assert(X.sha
-0000a7d0: 7065 5b2d 315d 203d 3d20 772e 7368 6170  pe[-1] == w.shap
-0000a7e0: 655b 305d 292c 2027 5368 6170 6520 6d69  e[0]), 'Shape mi
-0000a7f0: 736d 6174 6368 2058 3a7b 7d20 773a 7b7d  smatch X:{} w:{}
-0000a800: 272e 666f 726d 6174 2858 2e73 6861 7065  '.format(X.shape
-0000a810: 2c20 772e 7368 6170 6529 0d0a 2020 2020  , w.shape)..    
-0000a820: 2020 2020 6173 7365 7274 2879 2e73 6861      assert(y.sha
-0000a830: 7065 5b2d 315d 203d 3d20 772e 7368 6170  pe[-1] == w.shap
-0000a840: 655b 315d 292c 2027 5368 6170 6520 6d69  e[1]), 'Shape mi
-0000a850: 736d 6174 6368 2079 3a7b 7d20 773a 7b7d  smatch y:{} w:{}
-0000a860: 272e 666f 726d 6174 2879 2e73 6861 7065  '.format(y.shape
-0000a870: 2c20 772e 7368 6170 6529 0d0a 2020 2020  , w.shape)..    
-0000a880: 2020 2020 5820 3d20 5820 2d20 582e 6d65      X = X - X.me
-0000a890: 616e 2830 2c20 6b65 6570 6469 6d73 3d54  an(0, keepdims=T
-0000a8a0: 7275 6529 0d0a 2020 2020 2020 2020 636f  rue)..        co
-0000a8b0: 765f 7878 203d 206e 702e 6569 6e73 756d  v_xx = np.einsum
-0000a8c0: 2827 696b 202c 696a 202d 3e20 6b6a 2027  ('ik ,ij -> kj '
-0000a8d0: 2c20 582c 2058 2920 2f20 6464 6f66 0d0a  , X, X) / ddof..
-0000a8e0: 0d0a 2020 2020 2020 2020 2363 6f6d 7075  ..        #compu
-0000a8f0: 7465 2069 6e76 6572 7365 2063 6f76 6172  te inverse covar
-0000a900: 6961 6e63 6520 6f66 2074 6865 206f 7574  iance of the out
-0000a910: 7075 740d 0a20 2020 2020 2020 2063 6f76  put..        cov
-0000a920: 5f79 7920 3d20 6e70 2e65 696e 7375 6d28  _yy = np.einsum(
-0000a930: 2769 6a2c 2069 6b20 2d3e 206a 6b27 2c20  'ij, ik -> jk', 
-0000a940: 792c 2079 2920 2f20 6464 6f66 0d0a 2020  y, y) / ddof..  
-0000a950: 2020 2020 2020 7072 6563 5f79 7920 3d20        prec_yy = 
-0000a960: 7466 2e6c 696e 616c 672e 7069 6e76 2863  tf.linalg.pinv(c
-0000a970: 6f76 5f79 7929 0d0a 0d0a 2020 2020 2020  ov_yy)....      
-0000a980: 2020 2363 6f6d 7075 7465 2064 6972 6563    #compute direc
-0000a990: 7469 6f6e 7320 6f66 2053 783a 2061 203d  tions of Sx: a =
-0000a9a0: 2063 6f76 5f78 792a 2863 6f76 5f79 7929   cov_xy*(cov_yy)
-0000a9b0: 2a2a 2d31 0d0a 2020 2020 2020 2020 615f  **-1..        a_
-0000a9c0: 6f75 7420 3d20 6e70 2e65 696e 7375 6d28  out = np.einsum(
-0000a9d0: 2769 692c 2069 6a2c 206a 6a20 2d3e 2069  'ii, ij, jj -> i
-0000a9e0: 6a27 2c20 636f 765f 7878 2c20 772c 2070  j', cov_xx, w, p
-0000a9f0: 7265 635f 7979 290d 0a0d 0a20 2020 2020  rec_yy)....     
-0000aa00: 2020 2023 2041 2e2a 770d 0a20 2020 2020     # A.*w..     
-0000aa10: 2020 2023 6177 203d 2061 5f6f 7574 202a     #aw = a_out *
-0000aa20: 2077 2023 7368 6170 6520 3d20 5b2e 2e2e   w #shape = [...
-0000aa30: 5d0d 0a20 2020 2020 2020 2023 2061 6374  ]..        # act
-0000aa40: 6976 6174 696f 6e20 6f66 2074 636f 6e76  ivation of tconv
-0000aa50: 2062 7920 6561 6368 2073 6967 6e61 6c20   by each signal 
-0000aa60: 636f 6d70 6f6e 656e 7420 6f66 2065 6163  component of eac
-0000aa70: 6820 7361 6d70 6c65 0d0a 2020 2020 2020  h sample..      
-0000aa80: 2020 5378 203d 206e 702e 6569 6e73 756d    Sx = np.einsum
-0000aa90: 2827 696c 2c20 696c 2c20 6a69 202d 3e20  ('il, il, ji -> 
-0000aaa0: 6a69 6c27 2c20 615f 6f75 742c 2077 2c20  jil', a_out, w, 
-0000aab0: 5829 0d0a 2020 2020 2020 2020 5378 203d  X)..        Sx =
-0000aac0: 206e 702e 7265 7368 6170 6528 5378 2c20   np.reshape(Sx, 
-0000aad0: 5b2d 312c 2078 5f73 6861 7065 5b2d 315d  [-1, x_shape[-1]
-0000aae0: 2c20 795f 7368 6170 655b 2d31 5d5d 290d  , y_shape[-1]]).
-0000aaf0: 0a20 2020 2020 2020 2053 7820 3d20 5378  .        Sx = Sx
-0000ab00: 202d 2053 782e 6d65 616e 2831 2c20 6b65   - Sx.mean(1, ke
-0000ab10: 6570 6469 6d73 3d54 7275 6529 0d0a 2020  epdims=True)..  
-0000ab20: 2020 2020 2020 6464 6f66 203d 2053 782e        ddof = Sx.
-0000ab30: 7368 6170 655b 305d 202d 2031 0d0a 2020  shape[0] - 1..  
-0000ab40: 2020 2020 2020 636f 765f 7378 203d 206e        cov_sx = n
-0000ab50: 702e 6569 6e73 756d 2827 696a 6b2c 2069  p.einsum('ijk, i
-0000ab60: 6c6b 202d 3e20 6a6c 6b27 2c20 5378 2c20  lk -> jlk', Sx, 
-0000ab70: 5378 2920 2f20 6464 6f66 0d0a 0d0a 2020  Sx) / ddof....  
-0000ab80: 2020 2020 2020 7061 7474 6572 6e73 203d        patterns =
-0000ab90: 205b 5d0d 0a20 2020 2020 2020 2023 6463   []..        #dc
-0000aba0: 203d 2064 636f 765b 2769 6e70 7574 5f73   = dcov['input_s
-0000abb0: 7061 7469 616c 275d 0d0a 2020 2020 2020  patial']..      
-0000abc0: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
-0000abd0: 2879 2e73 6861 7065 5b2d 315d 293a 0d0a  (y.shape[-1]):..
-0000abe0: 2020 2020 2020 2020 2020 2020 7072 6563              prec
-0000abf0: 5f73 7820 3d20 6e70 2e6c 696e 616c 672e  _sx = np.linalg.
-0000ac00: 7069 6e76 2863 6f76 5f73 785b 2e2e 2e2c  pinv(cov_sx[...,
-0000ac10: 695d 290d 0a20 2020 2020 2020 2020 2020  i])..           
-0000ac20: 2064 6320 3d20 6463 6f76 5b27 636c 6173   dc = dcov['clas
-0000ac30: 735f 636f 6e64 6974 696f 6e61 6c27 5d5b  s_conditional'][
-0000ac40: 695d 0d0a 2020 2020 2020 2020 2020 2020  i]..            
-0000ac50: 7061 7474 6572 6e73 2e61 7070 656e 6428  patterns.append(
-0000ac60: 6e70 2e65 696e 7375 6d28 2768 692c 2069  np.einsum('hi, i
-0000ac70: 6a2c 206a 6b20 2d3e 2068 272c 0d0a 2020  j, jk -> h',..  
-0000ac80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ac90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aca0: 2020 2020 6463 2c20 7765 6967 6874 735b      dc, weights[
-0000acb0: 2764 6d78 275d 2c20 7072 6563 5f73 7829  'dmx'], prec_sx)
-0000acc0: 290d 0a20 2020 2020 2020 2070 6174 7465  )..        patte
-0000acd0: 726e 7320 3d20 6e70 2e73 7461 636b 2870  rns = np.stack(p
-0000ace0: 6174 7465 726e 732c 202d 3129 0d0a 2020  atterns, -1)..  
-0000acf0: 2020 2020 2020 7265 7475 726e 2070 6174        return pat
-0000ad00: 7465 726e 730d 0a0d 0a0d 0a20 2020 2064  terns......    d
-0000ad10: 6566 2070 6174 7465 726e 735f 636f 765f  ef patterns_cov_
-0000ad20: 7879 5f68 6174 2873 656c 662c 2058 2c20  xy_hat(self, X, 
-0000ad30: 792c 2061 6374 6976 6174 696f 6e73 2c20  y, activations, 
-0000ad40: 7765 6967 6874 7329 3a0d 0a20 2020 2020  weights):..     
-0000ad50: 2020 2053 785f 7463 6f6e 7620 3d20 7365     Sx_tconv = se
-0000ad60: 6c66 2e62 6163 6b70 726f 705f 6663 2861  lf.backprop_fc(a
-0000ad70: 6374 6976 6174 696f 6e73 5b27 7463 6f6e  ctivations['tcon
-0000ad80: 7627 5d2c 0d0a 2020 2020 2020 2020 2020  v'],..          
-0000ad90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ada0: 2020 2020 2020 2020 2020 6163 7469 7661            activa
-0000adb0: 7469 6f6e 735b 2766 6327 5d2c 0d0a 2020  tions['fc'],..  
-0000adc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000add0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ade0: 2020 792c 0d0a 2020 2020 2020 2020 2020    y,..          
+00009da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009dc0: 2070 6174 6965 6e63 653d 6561 726c 795f   patience=early_
+00009dd0: 7374 6f70 7069 6e67 2c0d 0a20 2020 2020  stopping,..     
+00009de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009e10: 2072 6573 746f 7265 5f62 6573 745f 7765   restore_best_we
+00009e20: 6967 6874 733d 5472 7565 290d 0a20 2020  ights=True)..   
+00009e30: 2020 2020 2073 656c 662e 745f 6869 7374       self.t_hist
+00009e40: 203d 2073 656c 662e 6b6d 5f65 6e63 2e66   = self.km_enc.f
+00009e50: 6974 2864 6174 6173 6574 5f74 7261 696e  it(dataset_train
+00009e60: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00009e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009e80: 2020 2020 2020 7661 6c69 6461 7469 6f6e        validation
+00009e90: 5f64 6174 613d 6461 7461 7365 745f 7661  _data=dataset_va
+00009ea0: 6c2c 0d0a 2020 2020 2020 2020 2020 2020  l,..            
+00009eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ec0: 2020 2020 2020 2065 706f 6368 733d 6e5f         epochs=n_
+00009ed0: 6570 6f63 6873 2c20 7374 6570 735f 7065  epochs, steps_pe
+00009ee0: 725f 6570 6f63 683d 6576 616c 5f73 7465  r_epoch=eval_ste
+00009ef0: 702c 0d0a 2020 2020 2020 2020 2020 2020  p,..            
+00009f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009f10: 2020 2020 2020 2073 6875 6666 6c65 3d54         shuffle=T
+00009f20: 7275 652c 0d0a 2020 2020 2020 2020 2020  rue,..          
+00009f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009f40: 2020 2020 2020 2020 2076 616c 6964 6174           validat
+00009f50: 696f 6e5f 7374 6570 733d 7365 6c66 2e64  ion_steps=self.d
+00009f60: 6174 6173 6574 2e76 616c 6964 6174 696f  ataset.validatio
+00009f70: 6e5f 7374 6570 732c 0d0a 2020 2020 2020  n_steps,..      
+00009f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009f90: 2020 2020 2020 2020 2020 2020 2063 616c               cal
+00009fa0: 6c62 6163 6b73 3d5b 7374 6f70 5f65 6172  lbacks=[stop_ear
+00009fb0: 6c79 5d2c 2076 6572 626f 7365 3d32 2c0d  ly], verbose=2,.
+00009fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009fe0: 2020 2020 2363 6c61 7373 5f77 6569 6768      #class_weigh
+00009ff0: 743d 636c 6173 735f 7765 6967 6874 730d  t=class_weights.
+0000a000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a020: 2020 2020 290d 0a0d 0a20 2020 2064 6566      )....    def
+0000a030: 2067 6574 5f63 6f6e 6669 6728 7365 6c66   get_config(self
+0000a040: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0000a050: 2320 446f 206e 6f74 2063 616c 6c20 7375  # Do not call su
+0000a060: 7065 722e 6765 745f 636f 6e66 6967 210d  per.get_config!.
+0000a070: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
+0000a080: 6869 7320 6761 7665 2061 6e20 6572 726f  his gave an erro
+0000a090: 7220 666f 7220 6d65 2e0d 0a20 2020 2020  r for me...     
+0000a0a0: 2020 2020 2020 2063 6f6e 6669 6720 3d20         config = 
+0000a0b0: 7b0d 0a20 2020 2020 2020 2020 2020 2020  {..             
+0000a0c0: 2020 2022 646d 7822 3a20 7365 6c66 2e64     "dmx": self.d
+0000a0d0: 6d78 2c0d 0a20 2020 2020 2020 2020 2020  mx,..           
+0000a0e0: 2020 2020 2022 646d 785f 6f75 7422 3a20       "dmx_out": 
+0000a0f0: 7365 6c66 2e64 6d78 5f6f 7574 2c0d 0a20  self.dmx_out,.. 
+0000a100: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000a110: 746f 636e 7622 3a20 7365 6c66 2e74 636f  tocnv": self.tco
+0000a120: 6e76 2c0d 0a20 2020 2020 2020 2020 2020  nv,..           
+0000a130: 2020 2020 2022 7463 6f6e 765f 6f75 7422       "tconv_out"
+0000a140: 3a20 7365 6c66 2e74 636f 6e76 5f6f 7574  : self.tconv_out
+0000a150: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000a160: 2020 2022 706f 6f6c 223a 2073 656c 662e     "pool": self.
+0000a170: 706f 6f6c 2c0d 0a20 2020 2020 2020 2020  pool,..         
+0000a180: 2020 2020 2020 2022 706f 6f6c 6564 223a         "pooled":
+0000a190: 2073 656c 662e 706f 6f6c 6564 2c0d 0a20   self.pooled,.. 
+0000a1a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000a1b0: 6472 6f70 6f75 7422 3a20 7365 6c66 2e64  dropout": self.d
+0000a1c0: 726f 706f 7574 2c0d 0a20 2020 2020 2020  ropout,..       
+0000a1d0: 2020 2020 2020 2020 2022 6669 6e5f 6663           "fin_fc
+0000a1e0: 223a 2073 656c 662e 6669 6e5f 6663 0d0a  ": self.fin_fc..
+0000a1f0: 2020 2020 2020 2020 2020 2020 7d0d 0a20              }.. 
+0000a200: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000a210: 6e20 636f 6e66 6967 0d0a 0d0a 2020 2020  n config....    
+0000a220: 6465 6620 5f67 6574 5f63 6c61 7373 5f63  def _get_class_c
+0000a230: 6f6e 6469 7469 6f6e 616c 5f73 7061 7469  onditional_spati
+0000a240: 616c 5f63 6f76 6172 6961 6e63 6528 7365  al_covariance(se
+0000a250: 6c66 2c20 582c 2079 293a 0d0a 2020 2020  lf, X, y):..    
+0000a260: 2020 2020 2222 2243 6f6d 7075 7465 2073      """Compute s
+0000a270: 7061 7469 616c 2063 6c61 7373 2d63 6f6e  patial class-con
+0000a280: 6469 7469 6f6e 616c 2063 6f76 6172 6961  ditional covaria
+0000a290: 6e63 6520 6d61 7472 6978 2066 726f 6d20  nce matrix from 
+0000a2a0: 7468 6520 6461 7461 7365 740d 0a0d 0a20  the dataset.... 
+0000a2b0: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+0000a2c0: 733a 0d0a 2020 2020 2020 2020 2d2d 2d2d  s:..        ----
+0000a2d0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020 2020  -------..       
+0000a2e0: 2064 6174 6173 6574 203a 2074 662e 6461   dataset : tf.da
+0000a2f0: 7461 2e44 6174 6173 6574 0d0a 0d0a 2020  ta.Dataset....  
+0000a300: 2020 2020 2020 5265 7475 726e 7320 3a20        Returns : 
+0000a310: 6463 6f76 205b 795f 7368 6170 652c 206e  dcov [y_shape, n
+0000a320: 5f63 682c 206e 5f63 685d 0d0a 0d0a 2020  _ch, n_ch]....  
+0000a330: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
+0000a340: 2020 2023 544f 444f 3a20 4669 7820 7265     #TODO: Fix re
+0000a350: 6772 6573 7369 6f6e 2063 6173 650d 0a20  gression case.. 
+0000a360: 2020 2020 2020 2064 636f 7673 203d 205b         dcovs = [
+0000a370: 5d0d 0a20 2020 2020 2020 2064 636f 7673  ]..        dcovs
+0000a380: 5f6e 203d 205b 5d0d 0a20 2020 2020 2020  _n = []..       
+0000a390: 2066 6f72 2063 6c61 7373 5f79 2069 6e20   for class_y in 
+0000a3a0: 7261 6e67 6528 7365 6c66 2e6f 7574 5f64  range(self.out_d
+0000a3b0: 696d 293a 0d0a 2020 2020 2020 2020 2020  im):..          
+0000a3c0: 2020 636c 6173 735f 696e 6420 3d20 7466    class_ind = tf
+0000a3d0: 2e73 7175 6565 7a65 2874 662e 7768 6572  .squeeze(tf.wher
+0000a3e0: 6528 7466 2e61 7267 6d61 7828 792c 2031  e(tf.argmax(y, 1
+0000a3f0: 293d 3d63 6c61 7373 5f79 2929 235b 305d  )==class_y))#[0]
+0000a400: 0d0a 2020 2020 2020 2020 2020 2020 7873  ..            xs
+0000a410: 203d 206e 702e 7371 7565 657a 6528 582e   = np.squeeze(X.
+0000a420: 6e75 6d70 7928 295b 636c 6173 735f 696e  numpy()[class_in
+0000a430: 642c 202e 2e2e 5d29 0d0a 2020 2020 2020  d, ...])..      
+0000a440: 2020 2020 2020 2378 7320 2d3d 206e 702e        #xs -= np.
+0000a450: 6d65 616e 2878 732c 2061 7869 733d 2d32  mean(xs, axis=-2
+0000a460: 2c20 6b65 6570 6469 6d73 3d54 7275 6529  , keepdims=True)
+0000a470: 0d0a 2020 2020 2020 2020 2020 2020 6464  ..            dd
+0000a480: 6f66 5f73 203d 2078 732e 7368 6170 655b  of_s = xs.shape[
+0000a490: 305d 2a73 656c 662e 6461 7461 7365 742e  0]*self.dataset.
+0000a4a0: 685f 7061 7261 6d73 5b27 6e5f 7427 5d20  h_params['n_t'] 
+0000a4b0: 2d20 310d 0a20 2020 2020 2020 2020 2020  - 1..           
+0000a4c0: 2063 6f76 5f73 203d 206e 702e 6569 6e73   cov_s = np.eins
+0000a4d0: 756d 2827 696a 6b2c 2069 6a6c 202d 3e20  um('ijk, ijl -> 
+0000a4e0: 6b6c 272c 2078 732c 2078 7329 202f 2064  kl', xs, xs) / d
+0000a4f0: 646f 665f 730d 0a0d 0a20 2020 2020 2020  dof_s....       
+0000a500: 2020 2020 2061 6e74 695f 636c 6173 735f       anti_class_
+0000a510: 696e 6420 3d20 7466 2e73 7175 6565 7a65  ind = tf.squeeze
+0000a520: 2874 662e 7768 6572 6528 7466 2e61 7267  (tf.where(tf.arg
+0000a530: 6d61 7828 792c 2031 2921 3d63 6c61 7373  max(y, 1)!=class
+0000a540: 5f79 2929 235b 305d 0d0a 2020 2020 2020  _y))#[0]..      
+0000a550: 2020 2020 2020 786e 203d 206e 702e 7371        xn = np.sq
+0000a560: 7565 657a 6528 582e 6e75 6d70 7928 295b  ueeze(X.numpy()[
+0000a570: 616e 7469 5f63 6c61 7373 5f69 6e64 2c20  anti_class_ind, 
+0000a580: 2e2e 2e5d 290d 0a20 2020 2020 2020 2020  ...])..         
+0000a590: 2020 2064 646f 665f 6e20 3d20 786e 2e73     ddof_n = xn.s
+0000a5a0: 6861 7065 5b30 5d2a 7365 6c66 2e64 6174  hape[0]*self.dat
+0000a5b0: 6173 6574 2e68 5f70 6172 616d 735b 276e  aset.h_params['n
+0000a5c0: 5f74 275d 202d 2031 0d0a 2020 2020 2020  _t'] - 1..      
+0000a5d0: 2020 2020 2020 636f 765f 6e20 3d20 6e70        cov_n = np
+0000a5e0: 2e65 696e 7375 6d28 2769 6a6b 2c20 696a  .einsum('ijk, ij
+0000a5f0: 6c20 2d3e 206b 6c27 2c20 786e 2c20 786e  l -> kl', xn, xn
+0000a600: 2920 2f20 6464 6f66 5f6e 0d0a 0d0a 2020  ) / ddof_n....  
+0000a610: 2020 2020 2020 2020 2020 6463 6f76 732e            dcovs.
+0000a620: 6170 7065 6e64 2863 6f76 5f73 2920 2320  append(cov_s) # 
+0000a630: 202d 2063 6f76 5f6e 0d0a 2020 2020 2020   - cov_n..      
+0000a640: 2020 2020 2020 6463 6f76 735f 6e2e 6170        dcovs_n.ap
+0000a650: 7065 6e64 2863 6f76 5f6e 290d 0a20 2020  pend(cov_n)..   
+0000a660: 2020 2020 2072 6574 7572 6e20 6e70 2e61       return np.a
+0000a670: 7272 6179 2864 636f 7673 292c 206e 702e  rray(dcovs), np.
+0000a680: 6172 7261 7928 6463 6f76 735f 6e29 0d0a  array(dcovs_n)..
+0000a690: 0d0a 0d0a 2020 2020 6465 6620 7061 7474  ....    def patt
+0000a6a0: 6572 6e73 5f63 6f76 5f78 7828 7365 6c66  erns_cov_xx(self
+0000a6b0: 2c20 792c 2077 6569 6768 7473 2c20 6163  , y, weights, ac
+0000a6c0: 7469 7661 7469 6f6e 732c 2064 636f 7629  tivations, dcov)
+0000a6d0: 3a0d 0a20 2020 2020 2020 2022 2222 0d0a  :..        """..
+0000a6e0: 2020 2020 2020 2020 5820 2d20 5b69 2c2e          X - [i,.
+0000a6f0: 2e2e 2c6d 5d0d 0a20 2020 2020 2020 2079  ..,m]..        y
+0000a700: 202d 205b 692c 2e2e 2e2c 6a5d 202d 2075   - [i,...,j] - u
+0000a710: 7365 6420 666f 7220 636f 765b 795d 0d0a  sed for cov[y]..
+0000a720: 2020 2020 2020 2020 7720 2d20 5b6b 2c2e          w - [k,.
+0000a730: 2e2e 2c6a 5d0d 0a20 2020 2020 2020 2053  ..,j]..        S
+0000a740: 7820 2d20 5b6b 2c2e 2e2e 2c6d 6a5d 2222  x - [k,...,mj]""
+0000a750: 220d 0a20 2020 2020 2020 2078 5f73 6861  "..        x_sha
+0000a760: 7065 203d 206c 6973 7428 6163 7469 7661  pe = list(activa
+0000a770: 7469 6f6e 735b 2774 636f 6e76 275d 2e73  tions['tconv'].s
+0000a780: 6861 7065 290d 0a20 2020 2020 2020 2079  hape)..        y
+0000a790: 5f73 6861 7065 203d 206c 6973 7428 792e  _shape = list(y.
+0000a7a0: 7368 6170 6529 0d0a 2020 2020 2020 2020  shape)..        
+0000a7b0: 236f 7574 5f73 6861 7065 203d 2078 5f73  #out_shape = x_s
+0000a7c0: 6861 7065 5b31 3a5d 202b 2079 5f73 6861  hape[1:] + y_sha
+0000a7d0: 7065 5b31 3a5d 0d0a 2020 2020 2020 2020  pe[1:]..        
+0000a7e0: 2370 7269 6e74 2878 5f73 6861 7065 2c20  #print(x_shape, 
+0000a7f0: 795f 7368 6170 652c 2077 6569 6768 7473  y_shape, weights
+0000a800: 5b27 6f75 745f 7765 6967 6874 7327 5d2e  ['out_weights'].
+0000a810: 7368 6170 6529 0d0a 2020 2020 2020 2020  shape)..        
+0000a820: 6464 6f66 203d 2061 6374 6976 6174 696f  ddof = activatio
+0000a830: 6e73 5b27 7463 6f6e 7627 5d2e 7368 6170  ns['tconv'].shap
+0000a840: 655b 305d 202d 2031 0d0a 2020 2020 2020  e[0] - 1..      
+0000a850: 2020 5820 3d20 6e70 2e72 6573 6861 7065    X = np.reshape
+0000a860: 2861 6374 6976 6174 696f 6e73 5b27 7463  (activations['tc
+0000a870: 6f6e 7627 5d2c 205b 6163 7469 7661 7469  onv'], [activati
+0000a880: 6f6e 735b 2774 636f 6e76 275d 2e73 6861  ons['tconv'].sha
+0000a890: 7065 5b30 5d2c 202d 315d 290d 0a20 2020  pe[0], -1])..   
+0000a8a0: 2020 2020 2079 203d 206e 702e 7265 7368       y = np.resh
+0000a8b0: 6170 6528 792c 205b 792e 7368 6170 655b  ape(y, [y.shape[
+0000a8c0: 305d 2c20 2d31 5d29 0d0a 0d0a 2020 2020  0], -1])....    
+0000a8d0: 2020 2020 7720 3d20 6e70 2e72 6573 6861      w = np.resha
+0000a8e0: 7065 2877 6569 6768 7473 5b27 6f75 745f  pe(weights['out_
+0000a8f0: 7765 6967 6874 7327 5d2c 205b 2d31 2c20  weights'], [-1, 
+0000a900: 7765 6967 6874 735b 276f 7574 5f77 6569  weights['out_wei
+0000a910: 6768 7473 275d 2e73 6861 7065 5b2d 315d  ghts'].shape[-1]
+0000a920: 5d29 0d0a 2020 2020 2020 2020 6173 7365  ])..        asse
+0000a930: 7274 2858 2e73 6861 7065 5b2d 315d 203d  rt(X.shape[-1] =
+0000a940: 3d20 772e 7368 6170 655b 305d 292c 2027  = w.shape[0]), '
+0000a950: 5368 6170 6520 6d69 736d 6174 6368 2058  Shape mismatch X
+0000a960: 3a7b 7d20 773a 7b7d 272e 666f 726d 6174  :{} w:{}'.format
+0000a970: 2858 2e73 6861 7065 2c20 772e 7368 6170  (X.shape, w.shap
+0000a980: 6529 0d0a 2020 2020 2020 2020 6173 7365  e)..        asse
+0000a990: 7274 2879 2e73 6861 7065 5b2d 315d 203d  rt(y.shape[-1] =
+0000a9a0: 3d20 772e 7368 6170 655b 315d 292c 2027  = w.shape[1]), '
+0000a9b0: 5368 6170 6520 6d69 736d 6174 6368 2079  Shape mismatch y
+0000a9c0: 3a7b 7d20 773a 7b7d 272e 666f 726d 6174  :{} w:{}'.format
+0000a9d0: 2879 2e73 6861 7065 2c20 772e 7368 6170  (y.shape, w.shap
+0000a9e0: 6529 0d0a 2020 2020 2020 2020 5820 3d20  e)..        X = 
+0000a9f0: 5820 2d20 582e 6d65 616e 2830 2c20 6b65  X - X.mean(0, ke
+0000aa00: 6570 6469 6d73 3d54 7275 6529 0d0a 2020  epdims=True)..  
+0000aa10: 2020 2020 2020 636f 765f 7878 203d 206e        cov_xx = n
+0000aa20: 702e 6569 6e73 756d 2827 696b 202c 696a  p.einsum('ik ,ij
+0000aa30: 202d 3e20 6b6a 2027 2c20 582c 2058 2920   -> kj ', X, X) 
+0000aa40: 2f20 6464 6f66 0d0a 0d0a 2020 2020 2020  / ddof....      
+0000aa50: 2020 2363 6f6d 7075 7465 2069 6e76 6572    #compute inver
+0000aa60: 7365 2063 6f76 6172 6961 6e63 6520 6f66  se covariance of
+0000aa70: 2074 6865 206f 7574 7075 740d 0a20 2020   the output..   
+0000aa80: 2020 2020 2063 6f76 5f79 7920 3d20 6e70       cov_yy = np
+0000aa90: 2e65 696e 7375 6d28 2769 6a2c 2069 6b20  .einsum('ij, ik 
+0000aaa0: 2d3e 206a 6b27 2c20 792c 2079 2920 2f20  -> jk', y, y) / 
+0000aab0: 6464 6f66 0d0a 2020 2020 2020 2020 7072  ddof..        pr
+0000aac0: 6563 5f79 7920 3d20 7466 2e6c 696e 616c  ec_yy = tf.linal
+0000aad0: 672e 7069 6e76 2863 6f76 5f79 7929 0d0a  g.pinv(cov_yy)..
+0000aae0: 0d0a 2020 2020 2020 2020 2363 6f6d 7075  ..        #compu
+0000aaf0: 7465 2064 6972 6563 7469 6f6e 7320 6f66  te directions of
+0000ab00: 2053 783a 2061 203d 2063 6f76 5f78 792a   Sx: a = cov_xy*
+0000ab10: 2863 6f76 5f79 7929 2a2a 2d31 0d0a 2020  (cov_yy)**-1..  
+0000ab20: 2020 2020 2020 615f 6f75 7420 3d20 6e70        a_out = np
+0000ab30: 2e65 696e 7375 6d28 2769 692c 2069 6a2c  .einsum('ii, ij,
+0000ab40: 206a 6a20 2d3e 2069 6a27 2c20 636f 765f   jj -> ij', cov_
+0000ab50: 7878 2c20 772c 2070 7265 635f 7979 290d  xx, w, prec_yy).
+0000ab60: 0a0d 0a20 2020 2020 2020 2023 2041 2e2a  ...        # A.*
+0000ab70: 770d 0a20 2020 2020 2020 2023 6177 203d  w..        #aw =
+0000ab80: 2061 5f6f 7574 202a 2077 2023 7368 6170   a_out * w #shap
+0000ab90: 6520 3d20 5b2e 2e2e 5d0d 0a20 2020 2020  e = [...]..     
+0000aba0: 2020 2023 2061 6374 6976 6174 696f 6e20     # activation 
+0000abb0: 6f66 2074 636f 6e76 2062 7920 6561 6368  of tconv by each
+0000abc0: 2073 6967 6e61 6c20 636f 6d70 6f6e 656e   signal componen
+0000abd0: 7420 6f66 2065 6163 6820 7361 6d70 6c65  t of each sample
+0000abe0: 0d0a 2020 2020 2020 2020 5378 203d 206e  ..        Sx = n
+0000abf0: 702e 6569 6e73 756d 2827 696c 2c20 696c  p.einsum('il, il
+0000ac00: 2c20 6a69 202d 3e20 6a69 6c27 2c20 615f  , ji -> jil', a_
+0000ac10: 6f75 742c 2077 2c20 5829 0d0a 2020 2020  out, w, X)..    
+0000ac20: 2020 2020 5378 203d 206e 702e 7265 7368      Sx = np.resh
+0000ac30: 6170 6528 5378 2c20 5b2d 312c 2078 5f73  ape(Sx, [-1, x_s
+0000ac40: 6861 7065 5b2d 315d 2c20 795f 7368 6170  hape[-1], y_shap
+0000ac50: 655b 2d31 5d5d 290d 0a20 2020 2020 2020  e[-1]])..       
+0000ac60: 2053 7820 3d20 5378 202d 2053 782e 6d65   Sx = Sx - Sx.me
+0000ac70: 616e 2831 2c20 6b65 6570 6469 6d73 3d54  an(1, keepdims=T
+0000ac80: 7275 6529 0d0a 2020 2020 2020 2020 6464  rue)..        dd
+0000ac90: 6f66 203d 2053 782e 7368 6170 655b 305d  of = Sx.shape[0]
+0000aca0: 202d 2031 0d0a 2020 2020 2020 2020 636f   - 1..        co
+0000acb0: 765f 7378 203d 206e 702e 6569 6e73 756d  v_sx = np.einsum
+0000acc0: 2827 696a 6b2c 2069 6c6b 202d 3e20 6a6c  ('ijk, ilk -> jl
+0000acd0: 6b27 2c20 5378 2c20 5378 2920 2f20 6464  k', Sx, Sx) / dd
+0000ace0: 6f66 0d0a 0d0a 2020 2020 2020 2020 7061  of....        pa
+0000acf0: 7474 6572 6e73 203d 205b 5d0d 0a20 2020  tterns = []..   
+0000ad00: 2020 2020 2023 6463 203d 2064 636f 765b       #dc = dcov[
+0000ad10: 2769 6e70 7574 5f73 7061 7469 616c 275d  'input_spatial']
+0000ad20: 0d0a 2020 2020 2020 2020 666f 7220 6920  ..        for i 
+0000ad30: 696e 2072 616e 6765 2879 2e73 6861 7065  in range(y.shape
+0000ad40: 5b2d 315d 293a 0d0a 2020 2020 2020 2020  [-1]):..        
+0000ad50: 2020 2020 7072 6563 5f73 7820 3d20 6e70      prec_sx = np
+0000ad60: 2e6c 696e 616c 672e 7069 6e76 2863 6f76  .linalg.pinv(cov
+0000ad70: 5f73 785b 2e2e 2e2c 695d 290d 0a20 2020  _sx[...,i])..   
+0000ad80: 2020 2020 2020 2020 2064 6320 3d20 6463           dc = dc
+0000ad90: 6f76 5b27 636c 6173 735f 636f 6e64 6974  ov['class_condit
+0000ada0: 696f 6e61 6c27 5d5b 695d 0d0a 2020 2020  ional'][i]..    
+0000adb0: 2020 2020 2020 2020 7061 7474 6572 6e73          patterns
+0000adc0: 2e61 7070 656e 6428 6e70 2e65 696e 7375  .append(np.einsu
+0000add0: 6d28 2768 692c 2069 6a2c 206a 6b20 2d3e  m('hi, ij, jk ->
+0000ade0: 2068 272c 0d0a 2020 2020 2020 2020 2020   h',..          
 0000adf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae00: 2020 2020 2020 2020 2020 7765 6967 6874            weight
-0000ae10: 735b 276f 7574 5f77 6569 6768 7473 275d  s['out_weights']
-0000ae20: 290d 0a20 2020 2020 2020 2053 785f 646d  )..        Sx_dm
-0000ae30: 7820 3d20 7365 6c66 2e62 6163 6b70 726f  x = self.backpro
-0000ae40: 705f 636f 7678 7928 582c 0d0a 2020 2020  p_covxy(X,..    
-0000ae50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae70: 6163 7469 7661 7469 6f6e 735b 2764 6d78  activations['dmx
-0000ae80: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
-0000ae90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aea0: 2020 2020 2020 2020 2053 785f 7463 6f6e           Sx_tcon
-0000aeb0: 762c 0d0a 2020 2020 2020 2020 2020 2020  v,..            
-0000aec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aed0: 2020 2020 2020 2020 7765 6967 6874 735b          weights[
-0000aee0: 2764 6d78 275d 290d 0a20 2020 2020 2020  'dmx'])..       
-0000aef0: 2072 6574 7572 6e20 5378 5f74 636f 6e76   return Sx_tconv
-0000af00: 2c20 5378 5f64 6d78 0d0a 0d0a 0d0a 2020  , Sx_dmx......  
-0000af10: 2020 6465 6620 6261 636b 7072 6f70 5f66    def backprop_f
-0000af20: 6328 7365 6c66 2c20 582c 2079 5f68 6174  c(self, X, y_hat
-0000af30: 2c20 792c 2077 293a 0d0a 2020 2020 2020  , y, w):..      
-0000af40: 2020 2222 220d 0a20 2020 2020 2020 2058    """..        X
-0000af50: 202d 205b 692c 2e2e 2e2c 6d5d 0d0a 2020   - [i,...,m]..  
-0000af60: 2020 2020 2020 7920 2d20 5b69 2c2e 2e2e        y - [i,...
-0000af70: 2c6a 5d0d 0a20 2020 2020 2020 2077 202d  ,j]..        w -
-0000af80: 205b 6b2c 2e2e 2e2c 6a5d 0d0a 2020 2020   [k,...,j]..    
-0000af90: 2020 2020 5378 202d 205b 6b2c 2e2e 2e2c      Sx - [k,...,
-0000afa0: 6d6a 5d22 2222 0d0a 2020 2020 2020 2020  mj]"""..        
-0000afb0: 785f 7368 6170 6520 3d20 6c69 7374 2858  x_shape = list(X
-0000afc0: 2e73 6861 7065 290d 0a20 2020 2020 2020  .shape)..       
-0000afd0: 2079 5f73 6861 7065 203d 206c 6973 7428   y_shape = list(
-0000afe0: 795f 6861 742e 7368 6170 6529 0d0a 2020  y_hat.shape)..  
-0000aff0: 2020 2020 2020 236f 7574 5f73 6861 7065        #out_shape
-0000b000: 203d 2078 5f73 6861 7065 5b31 3a5d 202b   = x_shape[1:] +
-0000b010: 2079 5f73 6861 7065 5b31 3a5d 0d0a 2020   y_shape[1:]..  
-0000b020: 2020 2020 2020 2370 7269 6e74 2878 5f73        #print(x_s
-0000b030: 6861 7065 2c20 795f 7368 6170 652c 2077  hape, y_shape, w
-0000b040: 2e73 6861 7065 290d 0a20 2020 2020 2020  .shape)..       
-0000b050: 2064 646f 6620 3d20 582e 7368 6170 655b   ddof = X.shape[
-0000b060: 305d 202d 2031 0d0a 2020 2020 2020 2020  0] - 1..        
-0000b070: 5820 3d20 6e70 2e72 6573 6861 7065 2858  X = np.reshape(X
-0000b080: 2c20 5b58 2e73 6861 7065 5b30 5d2c 202d  , [X.shape[0], -
-0000b090: 315d 290d 0a20 2020 2020 2020 2079 203d  1])..        y =
-0000b0a0: 206e 702e 7265 7368 6170 6528 792c 205b   np.reshape(y, [
-0000b0b0: 792e 7368 6170 655b 305d 2c20 2d31 5d29  y.shape[0], -1])
-0000b0c0: 0d0a 2020 2020 2020 2020 795f 6861 7420  ..        y_hat 
-0000b0d0: 3d20 6e70 2e72 6573 6861 7065 2879 5f68  = np.reshape(y_h
-0000b0e0: 6174 2c20 5b79 5f68 6174 2e73 6861 7065  at, [y_hat.shape
-0000b0f0: 5b30 5d2c 202d 315d 290d 0a20 2020 2020  [0], -1])..     
-0000b100: 2020 2077 203d 206e 702e 7265 7368 6170     w = np.reshap
-0000b110: 6528 772c 205b 2d31 2c20 772e 7368 6170  e(w, [-1, w.shap
-0000b120: 655b 2d31 5d5d 290d 0a0d 0a20 2020 2020  e[-1]])....     
-0000b130: 2020 2061 7373 6572 7428 582e 7368 6170     assert(X.shap
-0000b140: 655b 2d31 5d20 3d3d 2077 2e73 6861 7065  e[-1] == w.shape
-0000b150: 5b30 5d29 2c20 2753 6861 7065 206d 6973  [0]), 'Shape mis
-0000b160: 6d61 7463 6820 583a 7b7d 2077 3a7b 7d27  match X:{} w:{}'
-0000b170: 2e66 6f72 6d61 7428 582e 7368 6165 702c  .format(X.shaep,
-0000b180: 2077 2e73 6861 7065 290d 0a20 2020 2020   w.shape)..     
-0000b190: 2020 2061 7373 6572 7428 795f 6861 742e     assert(y_hat.
-0000b1a0: 7368 6170 655b 2d31 5d20 3d3d 2077 2e73  shape[-1] == w.s
-0000b1b0: 6861 7065 5b31 5d29 2c20 2753 6861 7065  hape[1]), 'Shape
-0000b1c0: 206d 6973 6d61 7463 6820 793a 7b7d 2077   mismatch y:{} w
-0000b1d0: 3a7b 7d27 2e66 6f72 6d61 7428 795f 6861  :{}'.format(y_ha
-0000b1e0: 742e 7368 6170 652c 2077 2e73 6861 7065  t.shape, w.shape
-0000b1f0: 290d 0a20 2020 2020 2020 2058 203d 2058  )..        X = X
-0000b200: 202d 2058 2e6d 6561 6e28 302c 206b 6565   - X.mean(0, kee
-0000b210: 7064 696d 733d 5472 7565 290d 0a20 2020  pdims=True)..   
-0000b220: 2020 2020 2079 5f68 6174 203d 2079 5f68       y_hat = y_h
-0000b230: 6174 202d 2079 5f68 6174 2e6d 6561 6e28  at - y_hat.mean(
-0000b240: 302c 206b 6565 7064 696d 733d 5472 7565  0, keepdims=True
-0000b250: 290d 0a20 2020 2020 2020 2079 203d 2079  )..        y = y
-0000b260: 202d 2079 2e6d 6561 6e28 302c 206b 6565   - y.mean(0, kee
-0000b270: 7064 696d 733d 5472 7565 290d 0a20 2020  pdims=True)..   
-0000b280: 2020 2020 2063 6f76 5f78 7920 3d20 6e70       cov_xy = np
-0000b290: 2e65 696e 7375 6d28 2769 6b20 2c69 6a20  .einsum('ik ,ij 
-0000b2a0: 2d3e 206b 6a20 272c 2058 2c20 795f 6861  -> kj ', X, y_ha
-0000b2b0: 7429 202f 2064 646f 660d 0a20 2020 2020  t) / ddof..     
-0000b2c0: 2020 2023 636f 765f 7879 203d 206e 702e     #cov_xy = np.
-0000b2d0: 636f 7628 582c 2079 290d 0a0d 0a0d 0a20  cov(X, y)...... 
-0000b2e0: 2020 2020 2020 2023 636f 6d70 7574 6520         #compute 
-0000b2f0: 696e 7665 7273 6520 636f 7661 7269 616e  inverse covarian
-0000b300: 6365 206f 6620 7468 6520 6f75 7470 7574  ce of the output
-0000b310: 0d0a 2020 2020 2020 2020 2363 6f76 5f79  ..        #cov_y
-0000b320: 7920 3d20 6e70 2e65 696e 7375 6d28 2769  y = np.einsum('i
-0000b330: 6a2c 2069 6b20 2d3e 206a 6b27 2c20 795f  j, ik -> jk', y_
-0000b340: 6861 742c 2079 5f68 6174 2920 2f20 6464  hat, y_hat) / dd
-0000b350: 6f66 0d0a 2020 2020 2020 2020 636f 765f  of..        cov_
-0000b360: 7979 203d 206e 702e 6569 6e73 756d 2827  yy = np.einsum('
-0000b370: 696a 2c20 696b 202d 3e20 6a6b 272c 2079  ij, ik -> jk', y
-0000b380: 2c20 7929 202f 2064 646f 660d 0a20 2020  , y) / ddof..   
-0000b390: 2020 2020 2070 7265 635f 7979 203d 2074       prec_yy = t
-0000b3a0: 662e 6c69 6e61 6c67 2e69 6e76 2863 6f76  f.linalg.inv(cov
-0000b3b0: 5f79 7929 0d0a 0d0a 2020 2020 2020 2020  _yy)....        
-0000b3c0: 2363 6f6d 7075 7465 2064 6972 6563 7469  #compute directi
-0000b3d0: 6f6e 7320 6f66 2053 783a 2061 203d 2063  ons of Sx: a = c
-0000b3e0: 6f76 5f78 792a 2863 6f76 5f79 7929 2a2a  ov_xy*(cov_yy)**
-0000b3f0: 2d31 0d0a 2020 2020 2020 2020 615f 6f75  -1..        a_ou
-0000b400: 7420 3d20 6e70 2e65 696e 7375 6d28 276a  t = np.einsum('j
-0000b410: 6b2c 206b 6c20 2d3e 206a 6c27 2c20 636f  k, kl -> jl', co
-0000b420: 765f 7879 2c20 7072 6563 5f79 7929 2023  v_xy, prec_yy) #
-0000b430: 7368 6170 6520 3d20 5b6e 5f74 5f70 6f6f  shape = [n_t_poo
-0000b440: 6c65 642c 206e 5f6c 6174 656e 742c 206e  led, n_latent, n
-0000b450: 5f63 6c61 7373 6573 5d0d 0a0d 0a20 2020  _classes]....   
-0000b460: 2020 2020 2023 2041 2e2a 770d 0a20 2020       # A.*w..   
-0000b470: 2020 2020 2023 6177 203d 2061 5f6f 7574       #aw = a_out
-0000b480: 202a 2077 2023 7368 6170 6520 3d20 5b2e   * w #shape = [.
-0000b490: 2e2e 5d0d 0a20 2020 2020 2020 2023 2061  ..]..        # a
-0000b4a0: 6374 6976 6174 696f 6e20 6f66 2074 636f  ctivation of tco
-0000b4b0: 6e76 2062 7920 6561 6368 2073 6967 6e61  nv by each signa
-0000b4c0: 6c20 636f 6d70 6f6e 656e 7420 6f66 2065  l component of e
-0000b4d0: 6163 6820 7361 6d70 6c65 0d0a 2020 2020  ach sample..    
-0000b4e0: 2020 2020 2353 7820 3d20 6e70 2e65 696e      #Sx = np.ein
-0000b4f0: 7375 6d28 2769 6c2c 206b 6c20 2d3e 2069  sum('il, kl -> i
-0000b500: 6b27 2c20 795f 6861 742c 2061 7729 2023  k', y_hat, aw) #
-0000b510: 7368 6170 6520 3d20 5b6e 5f62 6174 6368  shape = [n_batch
-0000b520: 2c20 2e2e 2e5d 0d0a 2020 2020 2020 2020  , ...]..        
-0000b530: 5378 203d 206e 702e 6569 6e73 756d 2827  Sx = np.einsum('
-0000b540: 696c 2c20 696c 2c20 6a69 202d 3e20 6a69  il, il, ji -> ji
-0000b550: 6c27 2c20 615f 6f75 742c 2077 2c20 5829  l', a_out, w, X)
-0000b560: 0d0a 2020 2020 2020 2020 5378 203d 206e  ..        Sx = n
-0000b570: 702e 7371 7565 657a 6528 6e70 2e72 6573  p.squeeze(np.res
-0000b580: 6861 7065 2853 782c 2078 5f73 6861 7065  hape(Sx, x_shape
-0000b590: 202b 2079 5f73 6861 7065 5b31 3a5d 2929   + y_shape[1:]))
-0000b5a0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0000b5b0: 2053 780d 0a0d 0a20 2020 2064 6566 2062   Sx....    def b
-0000b5c0: 6163 6b70 726f 705f 636f 7678 7928 7365  ackprop_covxy(se
-0000b5d0: 6c66 2c20 582c 2048 782c 2053 782c 2077  lf, X, Hx, Sx, w
-0000b5e0: 293a 0d0a 2020 2020 2020 2020 7864 6d78  ):..        xdmx
-0000b5f0: 203d 206e 702e 7265 7368 6170 6528 4878   = np.reshape(Hx
-0000b600: 2c20 5b2d 312c 2048 782e 7368 6170 655b  , [-1, Hx.shape[
-0000b610: 2d31 5d5d 290d 0a20 2020 2020 2020 2078  -1]])..        x
-0000b620: 646d 7820 3d20 7864 6d78 202d 2078 646d  dmx = xdmx - xdm
-0000b630: 782e 6d65 616e 2830 2c20 6b65 6570 6469  x.mean(0, keepdi
-0000b640: 6d73 3d54 7275 6529 0d0a 2020 2020 2020  ms=True)..      
-0000b650: 2020 7869 6e70 203d 206e 702e 7265 7368    xinp = np.resh
-0000b660: 6170 6528 582c 205b 2d31 2c20 582e 7368  ape(X, [-1, X.sh
-0000b670: 6170 655b 2d31 5d5d 290d 0a20 2020 2020  ape[-1]])..     
-0000b680: 2020 2078 696e 7020 3d20 7869 6e70 202d     xinp = xinp -
-0000b690: 2078 696e 702e 6d65 616e 2830 2c20 6b65   xinp.mean(0, ke
-0000b6a0: 6570 6469 6d73 3d54 7275 6529 0d0a 2020  epdims=True)..  
-0000b6b0: 2020 2020 2020 636f 765f 7879 203d 206e        cov_xy = n
-0000b6c0: 702e 646f 7428 7869 6e70 2e54 2c20 7864  p.dot(xinp.T, xd
-0000b6d0: 6d78 290d 0a20 2020 2020 2020 2070 7269  mx)..        pri
-0000b6e0: 6e74 2822 6177 222c 2063 6f76 5f78 792e  nt("aw", cov_xy.
-0000b6f0: 7368 6170 6529 0d0a 2020 2020 2020 2020  shape)..        
-0000b700: 6177 203d 2063 6f76 5f78 790d 0a20 2020  aw = cov_xy..   
-0000b710: 2020 2020 2073 7820 3d20 6e70 2e72 6573       sx = np.res
-0000b720: 6861 7065 2853 782c 205b 2d31 2c20 5378  hape(Sx, [-1, Sx
-0000b730: 2e73 6861 7065 5b2d 325d 2c20 5378 2e73  .shape[-2], Sx.s
-0000b740: 6861 7065 5b2d 315d 5d29 0d0a 2020 2020  hape[-1]])..    
-0000b750: 2020 2020 7378 203d 2073 7820 2d20 7378      sx = sx - sx
-0000b760: 2e6d 6561 6e28 302c 206b 6565 7064 696d  .mean(0, keepdim
-0000b770: 733d 5472 7565 290d 0a20 2020 2020 2020  s=True)..       
-0000b780: 2064 646f 6620 3d20 7378 2e73 6861 7065   ddof = sx.shape
-0000b790: 5b30 5d20 2d20 310d 0a20 2020 2020 2020  [0] - 1..       
-0000b7a0: 2063 6f76 5f73 7820 3d20 6e70 2e65 696e   cov_sx = np.ein
-0000b7b0: 7375 6d28 2769 6a6b 2c20 696c 6b20 2d3e  sum('ijk, ilk ->
-0000b7c0: 206b 6a6c 272c 2073 782c 7378 2920 2f20   kjl', sx,sx) / 
-0000b7d0: 6464 6f66 0d0a 2020 2020 2020 2020 7072  ddof..        pr
-0000b7e0: 696e 7428 2263 6f76 5f73 783a 222c 2063  int("cov_sx:", c
-0000b7f0: 6f76 5f73 782e 7368 6170 6529 0d0a 2020  ov_sx.shape)..  
-0000b800: 2020 2020 2020 7072 6563 5f79 795f 6861        prec_yy_ha
-0000b810: 7420 3d20 6e70 2e73 7461 636b 285b 6e70  t = np.stack([np
-0000b820: 2e6c 696e 616c 672e 7069 6e76 2873 2920  .linalg.pinv(s) 
-0000b830: 666f 7220 7320 696e 2063 6f76 5f73 785d  for s in cov_sx]
-0000b840: 290d 0a20 2020 2020 2020 2070 7269 6e74  )..        print
-0000b850: 2877 2e73 6861 7065 2c20 7072 6563 5f79  (w.shape, prec_y
-0000b860: 795f 6861 742e 7368 6170 6529 0d0a 2020  y_hat.shape)..  
-0000b870: 2020 2020 2020 7777 203d 206e 702e 6569        ww = np.ei
-0000b880: 6e73 756d 2827 696a 2c20 6a6c 6b20 2d3e  nsum('ij, jlk ->
-0000b890: 2069 6b6c 272c 2077 2c20 7072 6563 5f79   ikl', w, prec_y
-0000b8a0: 795f 6861 7429 0d0a 2020 2020 2020 2020  y_hat)..        
-0000b8b0: 7072 696e 7428 636f 765f 7879 2e73 6861  print(cov_xy.sha
-0000b8c0: 7065 2c20 7777 2e73 6861 7065 290d 0a20  pe, ww.shape).. 
-0000b8d0: 2020 2020 2020 2061 203d 206e 702e 6569         a = np.ei
-0000b8e0: 6e73 756d 2827 696a 2c20 696a 6b20 2d3e  nsum('ij, ijk ->
-0000b8f0: 2069 6b27 2c20 636f 765f 7879 2c20 7777   ik', cov_xy, ww
-0000b900: 290d 0a0d 0a20 2020 2020 2020 2072 6574  )....        ret
-0000b910: 7572 6e20 610d 0a0d 0a20 2020 2020 2020  urn a....       
-0000b920: 2023 2070 7269 6e74 2863 6f76 5f78 792e   # print(cov_xy.
-0000b930: 7368 6170 6529 0d0a 2020 2020 2020 2020  shape)..        
-0000b940: 2320 7061 7474 6572 6e73 203d 205b 5d0d  # patterns = [].
-0000b950: 0a20 2020 2020 2020 2023 2066 6f72 2063  .        # for c
-0000b960: 6c61 7373 5f79 2069 6e20 7261 6e67 6528  lass_y in range(
-0000b970: 5378 2e73 6861 7065 5b2d 315d 293a 0d0a  Sx.shape[-1]):..
-0000b980: 2020 2020 2020 2020 2320 2020 2020 7378          #     sx
-0000b990: 203d 206e 702e 7265 7368 6170 6528 5378   = np.reshape(Sx
-0000b9a0: 2c20 5b2d 312c 2053 782e 7368 6170 655b  , [-1, Sx.shape[
-0000b9b0: 2d32 5d2c 2053 782e 7368 6170 655b 2d31  -2], Sx.shape[-1
-0000b9c0: 5d5d 290d 0a20 2020 2020 2020 2023 2020  ]])..        #  
-0000b9d0: 2020 2073 7820 2d3d 2073 782e 6d65 616e     sx -= sx.mean
-0000b9e0: 2830 2c20 6b65 6570 6469 6d73 3d54 7275  (0, keepdims=Tru
-0000b9f0: 6529 0d0a 2020 2020 2020 2020 2320 2020  e)..        #   
-0000ba00: 2020 7072 6563 5f73 7820 3d20 6e70 2e6c    prec_sx = np.l
-0000ba10: 696e 616c 672e 696e 7628 6e70 2e64 6f74  inalg.inv(np.dot
-0000ba20: 2873 782e 542c 2073 7829 290d 0a0d 0a20  (sx.T, sx)).... 
-0000ba30: 2020 2020 2020 2023 2020 2020 2061 7720         #     aw 
-0000ba40: 3d20 6e70 2e64 6f74 2863 6f76 5f78 792c  = np.dot(cov_xy,
-0000ba50: 2070 7265 635f 7378 2920 2a20 770d 0a20   prec_sx) * w.. 
-0000ba60: 2020 2020 2020 2023 2020 2020 2023 636f         #     #co
-0000ba70: 6d70 6f6e 656e 745f 6163 7469 7661 7469  mponent_activati
-0000ba80: 6f6e 7320 3d20 6e70 2e64 6f74 2861 772c  ons = np.dot(aw,
-0000ba90: 2070 7265 635f 7378 290d 0a20 2020 2020   prec_sx)..     
-0000baa0: 2020 2023 2020 2020 2070 6174 7465 726e     #     pattern
-0000bab0: 732e 6170 7065 6e64 2861 772e 7375 6d28  s.append(aw.sum(
-0000bac0: 2d31 2929 0d0a 0d0a 2020 2020 2020 2020  -1))....        
-0000bad0: 2320 7265 7475 726e 206e 702e 7374 6163  # return np.stac
-0000bae0: 6b28 7061 7474 6572 6e73 2c20 3129 0d0a  k(patterns, 1)..
-0000baf0: 0d0a 2020 2020 2320 6465 6620 6261 636b  ..    # def back
-0000bb00: 7072 6f70 5f64 6d78 2873 656c 662c 2058  prop_dmx(self, X
-0000bb10: 2c20 795f 6861 742c 2079 2c20 7729 3a0d  , y_hat, y, w):.
-0000bb20: 0a20 2020 2023 2020 2020 2078 5f73 6861  .    #     x_sha
-0000bb30: 7065 203d 206c 6973 7428 582e 7368 6170  pe = list(X.shap
-0000bb40: 6529 0d0a 2020 2020 2320 2020 2020 795f  e)..    #     y_
-0000bb50: 7368 6170 6520 3d20 6c69 7374 2879 5f68  shape = list(y_h
-0000bb60: 6174 2e73 6861 7065 290d 0a20 2020 2023  at.shape)..    #
-0000bb70: 2020 2020 206b 203d 2079 2e73 6861 7065       k = y.shape
-0000bb80: 5b2d 315d 0d0a 2020 2020 2320 2020 2020  [-1]..    #     
-0000bb90: 795f 6861 7420 3d20 6e70 2e72 6573 6861  y_hat = np.resha
-0000bba0: 7065 2879 5f68 6174 2c20 5b79 5f68 6174  pe(y_hat, [y_hat
-0000bbb0: 2e73 6861 7065 5b30 5d2c 202d 315d 290d  .shape[0], -1]).
-0000bbc0: 0a20 2020 2023 2020 2020 2023 6f75 745f  .    #     #out_
-0000bbd0: 7368 6170 6520 3d20 785f 7368 6170 655b  shape = x_shape[
-0000bbe0: 313a 5d20 2b20 795f 7368 6170 655b 313a  1:] + y_shape[1:
-0000bbf0: 5d0d 0a20 2020 2023 2020 2020 2023 7072  ]..    #     #pr
-0000bc00: 696e 7428 785f 7368 6170 652c 2079 5f73  int(x_shape, y_s
-0000bc10: 6861 7065 2c20 772e 7368 6170 6529 0d0a  hape, w.shape)..
-0000bc20: 2020 2020 2320 2020 2020 6464 6f66 5f78      #     ddof_x
-0000bc30: 7920 3d20 6e70 2e70 726f 6428 785f 7368  y = np.prod(x_sh
-0000bc40: 6170 655b 3a33 5d29 202d 2031 0d0a 2020  ape[:3]) - 1..  
-0000bc50: 2020 2320 2020 2020 6464 6f66 5f79 7920    #     ddof_yy 
-0000bc60: 3d20 6e70 2e70 726f 6428 795f 7368 6170  = np.prod(y_shap
-0000bc70: 655b 3a33 5d29 202d 2031 0d0a 0d0a 2020  e[:3]) - 1....  
-0000bc80: 2020 2320 2020 2020 636f 765f 7879 203d    #     cov_xy =
-0000bc90: 206e 702e 6569 6e73 756d 2827 696a 6b6c   np.einsum('ijkl
-0000bca0: 2c20 696a 6d6e 202d 3e20 6c6e 6d27 2c20  , ijmn -> lnm', 
-0000bcb0: 582c 2079 5f68 6174 2920 2f20 6464 6f66  X, y_hat) / ddof
-0000bcc0: 5f78 7920 2373 6861 7065 203d 205b 6e5f  _xy #shape = [n_
-0000bcd0: 6368 2c20 6e5f 6c61 746e 6574 2c20 6e5f  ch, n_latnet, n_
-0000bce0: 6269 6e73 5d0d 0a20 2020 2023 2020 2020  bins]..    #    
-0000bcf0: 2063 6f76 5f79 7920 3d20 6e70 2e65 696e   cov_yy = np.ein
-0000bd00: 7375 6d28 2769 6a6b 6c2c 2069 6a6b 6d20  sum('ijkl, ijkm 
-0000bd10: 2d3e 206b 6c6d 272c 2079 5f68 6174 2c20  -> klm', y_hat, 
-0000bd20: 795f 6861 7429 202f 2064 646f 665f 7979  y_hat) / ddof_yy
-0000bd30: 0d0a 2020 2020 2320 2020 2020 7072 6563  ..    #     prec
-0000bd40: 5f79 7920 3d20 6e70 2e61 7272 6179 285b  _yy = np.array([
-0000bd50: 6e70 2e6c 696e 616c 672e 696e 7628 6376  np.linalg.inv(cv
-0000bd60: 7929 2066 6f72 2063 7679 2069 6e20 636f  y) for cvy in co
-0000bd70: 765f 7979 5d29 0d0a 2020 2020 2320 2020  v_yy])..    #   
-0000bd80: 2020 615f 6f75 7420 3d20 6e70 2e65 696e    a_out = np.ein
-0000bd90: 7375 6d28 276a 6b6d 2c20 6d6b 6c20 2d3e  sum('jkm, mkl ->
-0000bda0: 206a 6c6d 272c 2063 6f76 5f78 792c 2070   jlm', cov_xy, p
-0000bdb0: 7265 635f 7979 290d 0a20 2020 2023 2020  rec_yy)..    #  
-0000bdc0: 2020 2061 7720 3d20 615f 6f75 7420 2a20     aw = a_out * 
-0000bdd0: 775b 2e2e 2e2c 204e 6f6e 655d 0d0a 2020  w[..., None]..  
-0000bde0: 2020 2320 2020 2020 2320 6163 7469 7661    #     # activa
-0000bdf0: 7469 6f6e 206f 6620 7463 6f6e 7620 6279  tion of tconv by
-0000be00: 2065 6163 6820 7369 676e 616c 2063 6f6d   each signal com
-0000be10: 706f 6e65 6e74 206f 6620 6561 6368 2073  ponent of each s
-0000be20: 616d 706c 650d 0a20 2020 2023 2020 2020  ample..    #    
-0000be30: 2053 7820 3d20 6e70 2e65 696e 7375 6d28   Sx = np.einsum(
-0000be40: 2769 6a6b 6c2c 2063 6c6b 202d 3e20 6963  'ijkl, clk -> ic
-0000be50: 6b27 2c20 795f 6861 742c 2061 7729 2023  k', y_hat, aw) #
-0000be60: 7368 6170 6520 3d20 5b6e 5f62 6174 6368  shape = [n_batch
-0000be70: 2c20 2e2e 2e5d 0d0a 0d0a 2020 2020 2320  , ...]....    # 
-0000be80: 2020 2020 7265 7475 726e 2053 780d 0a0d      return Sx...
-0000be90: 0a20 2020 2064 6566 2070 6174 7465 726e  .    def pattern
-0000bea0: 735f 7069 6e76 5f77 2873 656c 662c 2079  s_pinv_w(self, y
-0000beb0: 2c20 7765 6967 6874 732c 2061 6374 6976  , weights, activ
-0000bec0: 6174 696f 6e73 2c20 6463 6f76 293a 0d0a  ations, dcov):..
-0000bed0: 2020 2020 2020 2020 636f 6d62 696e 6564          combined
-0000bee0: 5f74 6f70 6f73 203d 205b 5d0d 0a20 2020  _topos = []..   
-0000bef0: 2020 2020 2070 696e 765f 646d 7820 3d20       pinv_dmx = 
-0000bf00: 6e70 2e6c 696e 616c 672e 7069 6e76 2877  np.linalg.pinv(w
-0000bf10: 6569 6768 7473 5b27 646d 7827 5d29 2e54  eights['dmx']).T
-0000bf20: 236e 702e 646f 7428 7370 6174 6961 6c5f  #np.dot(spatial_
-0000bf30: 6669 6c74 6572 732c 206e 702e 6c69 6e61  filters, np.lina
-0000bf40: 6c67 2e69 6e76 286e 702e 646f 7428 7370  lg.inv(np.dot(sp
-0000bf50: 6174 6961 6c5f 6669 6c74 6572 732e 542c  atial_filters.T,
-0000bf60: 2073 7061 7469 616c 5f66 696c 7465 7273   spatial_filters
-0000bf70: 2929 290d 0a20 2020 2020 2020 2070 696e  )))..        pin
-0000bf80: 765f 7766 6320 3d20 6e70 2e6c 696e 616c  v_wfc = np.linal
-0000bf90: 672e 7069 6e76 2877 6569 6768 7473 5b27  g.pinv(weights['
-0000bfa0: 6f75 745f 775f 666c 6174 275d 292e 5423  out_w_flat']).T#
-0000bfb0: 6e70 2e64 6f74 286f 7574 5f77 5f66 6c61  np.dot(out_w_fla
-0000bfc0: 742c 206e 702e 6c69 6e61 6c67 2e69 6e76  t, np.linalg.inv
-0000bfd0: 286e 702e 646f 7428 6f75 745f 775f 666c  (np.dot(out_w_fl
-0000bfe0: 6174 2e54 2c20 6f75 745f 775f 666c 6174  at.T, out_w_flat
-0000bff0: 2929 290d 0a20 2020 2020 2020 2070 696e  )))..        pin
-0000c000: 765f 7463 6b20 3d20 6e70 2e6c 696e 616c  v_tck = np.linal
-0000c010: 672e 7069 6e76 2877 6569 6768 7473 5b27  g.pinv(weights['
-0000c020: 7463 6f6e 7627 5d29 2e54 2023 6e70 2e64  tconv']).T #np.d
-0000c030: 6f74 2874 636f 6e76 5f6b 6572 6e65 6c73  ot(tconv_kernels
-0000c040: 2c20 6e70 2e6c 696e 616c 672e 696e 7628  , np.linalg.inv(
-0000c050: 6e70 2e64 6f74 2874 636f 6e76 5f6b 6572  np.dot(tconv_ker
-0000c060: 6e65 6c73 2e54 2c20 7463 6f6e 765f 6b65  nels.T, tconv_ke
-0000c070: 726e 656c 7329 2929 0d0a 0d0a 2020 2020  rnels)))....    
-0000c080: 2020 2020 234c 6561 7374 2073 7175 6172      #Least squar
-0000c090: 6520 7369 6e67 616c 2065 7374 696d 6174  e singal estimat
-0000c0a0: 6520 696e 2074 636f 6e76 2067 6976 656e  e in tconv given
-0000c0b0: 2077 6663 2061 6e64 2066 635f 6163 7469   wfc and fc_acti
-0000c0c0: 7661 7469 6f6e 730d 0a20 2020 2020 2020  vations..       
-0000c0d0: 2053 785f 7463 6f6e 7620 3d20 6e70 2e65   Sx_tconv = np.e
-0000c0e0: 696e 7375 6d28 276a 6b2c 2069 6b20 2d3e  insum('jk, ik ->
-0000c0f0: 696a 272c 2070 696e 765f 7766 632c 2061  ij', pinv_wfc, a
-0000c100: 6374 6976 6174 696f 6e73 5b27 6663 275d  ctivations['fc']
-0000c110: 290d 0a20 2020 2020 2020 2053 785f 7463  )..        Sx_tc
-0000c120: 6f6e 7620 3d20 6e70 2e72 6573 6861 7065  onv = np.reshape
-0000c130: 2853 785f 7463 6f6e 762c 2061 6374 6976  (Sx_tconv, activ
-0000c140: 6174 696f 6e73 5b27 7463 6f6e 7627 5d2e  ations['tconv'].
-0000c150: 7368 6170 6529 0d0a 0d0a 2020 2020 2020  shape)....      
-0000c160: 2020 2352 6576 6572 7365 2070 6f6f 6c69    #Reverse pooli
-0000c170: 6e67 2061 6e64 2064 6570 7468 7769 7365  ng and depthwise
-0000c180: 2063 6f6e 766f 6c75 7469 6f6e 2066 6f72   convolution for
-0000c190: 2065 6163 6820 636c 6173 730d 0a20 2020   each class..   
-0000c1a0: 2020 2020 2053 785f 646d 7820 3d20 5b5d       Sx_dmx = []
-0000c1b0: 0d0a 2020 2020 2020 2020 2364 6320 3d20  ..        #dc = 
-0000c1c0: 6463 6f76 5b27 696e 7075 745f 7370 6174  dcov['input_spat
-0000c1d0: 6961 6c27 5d0d 0a20 2020 2020 2020 2023  ial']..        #
-0000c1e0: 6e5f 7061 6464 696e 6720 3d20 7365 6c66  n_padding = self
-0000c1f0: 2e64 6174 6173 6574 2e68 5f70 6172 616d  .dataset.h_param
-0000c200: 735b 276e 5f74 275d 2573 656c 662e 7370  s['n_t']%self.sp
-0000c210: 6563 735b 2773 7472 6964 6527 5d0d 0a20  ecs['stride'].. 
-0000c220: 2020 2020 2020 2066 6f72 2063 6c61 7373         for class
-0000c230: 5f79 2069 6e20 7261 6e67 6528 7365 6c66  _y in range(self
-0000c240: 2e6f 7574 5f64 696d 293a 0d0a 2020 2020  .out_dim):..    
-0000c250: 2020 2020 2020 2020 636c 6173 735f 696e          class_in
-0000c260: 6420 3d20 7466 2e73 7175 6565 7a65 2874  d = tf.squeeze(t
-0000c270: 662e 7768 6572 6528 7466 2e61 7267 6d61  f.where(tf.argma
-0000c280: 7828 792c 2031 293d 3d63 6c61 7373 5f79  x(y, 1)==class_y
-0000c290: 2929 235b 305d 0d0a 2020 2020 2020 2020  ))#[0]..        
-0000c2a0: 2020 2020 5378 6d20 3d20 6e70 2e73 7175      Sxm = np.squ
-0000c2b0: 6565 7a65 2853 785f 7463 6f6e 765b 636c  eeze(Sx_tconv[cl
-0000c2c0: 6173 735f 696e 642c 203a 5d2e 6d65 616e  ass_ind, :].mean
-0000c2d0: 2830 2c20 6b65 6570 6469 6d73 3d54 7275  (0, keepdims=Tru
-0000c2e0: 6529 290d 0a20 2020 2020 2020 2020 2020  e))..           
-0000c2f0: 2053 786d 203d 206e 702e 6174 6c65 6173   Sxm = np.atleas
-0000c300: 745f 3264 2853 786d 290d 0a20 2020 2020  t_2d(Sxm)..     
-0000c310: 2020 2020 2020 2064 6320 3d20 6463 6f76         dc = dcov
-0000c320: 5b27 636c 6173 735f 636f 6e64 6974 696f  ['class_conditio
-0000c330: 6e61 6c27 5d5b 636c 6173 735f 795d 0d0a  nal'][class_y]..
-0000c340: 2020 2020 2020 2020 2020 2020 636f 6d62              comb
-0000c350: 696e 6564 5f74 6f70 6f73 2e61 7070 656e  ined_topos.appen
-0000c360: 6428 6e70 2e65 696e 7375 6d28 2768 692c  d(np.einsum('hi,
-0000c370: 696a 2c74 6a2d 3e68 7427 2c0d 0a20 2020  ij,tj->ht',..   
-0000c380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3a0: 2020 2020 2020 2020 2064 632c 0d0a 2020           dc,..  
-0000c3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c3d0: 2020 2020 2020 2020 2020 7765 6967 6874            weight
-0000c3e0: 735b 2764 6d78 275d 2c0d 0a20 2020 2020  s['dmx'],..     
-0000c3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c410: 2020 2020 2020 2053 786d 2929 0d0a 2020         Sxm))..  
-0000c420: 2020 2020 2020 746f 706f 7320 3d20 6e70        topos = np
-0000c430: 2e73 7461 636b 2863 6f6d 6269 6e65 645f  .stack(combined_
-0000c440: 746f 706f 732c 2031 290d 0a20 2020 2020  topos, 1)..     
-0000c450: 2020 2072 6574 7572 6e20 746f 706f 730d     return topos.
-0000c460: 0a0d 0a0d 0a20 2020 2064 6566 2070 6174  .....    def pat
-0000c470: 7465 726e 735f 7766 635f 6d65 616e 2873  terns_wfc_mean(s
-0000c480: 656c 662c 2079 2c20 7765 6967 6874 732c  elf, y, weights,
-0000c490: 2061 6374 6976 6174 696f 6e73 2c20 6463   activations, dc
-0000c4a0: 6f76 293a 0d0a 2020 2020 2020 2020 636f  ov):..        co
-0000c4b0: 6d62 696e 6564 5f74 6f70 6f73 203d 205b  mbined_topos = [
-0000c4c0: 5d0d 0a20 2020 2020 2020 2023 7573 6573  ]..        #uses
-0000c4d0: 2079 2065 7870 6c69 6369 7465 6c79 2069   y explicitely i
-0000c4e0: 6e73 7465 6164 206f 6620 636f 765b 782c  nstead of cov[x,
-0000c4f0: 795d 0d0a 2020 2020 2020 2020 2361 6363  y]..        #acc
-0000c500: 7572 6174 6520 6275 7420 6861 7320 6c69  urate but has li
-0000c510: 7474 6c65 2074 6f20 646f 2077 6974 6820  ttle to do with 
-0000c520: 7468 6520 6d6f 6465 6c0d 0a20 2020 2020  the model..     
-0000c530: 2020 2023 6463 203d 2064 636f 765b 2769     #dc = dcov['i
-0000c540: 6e70 7574 5f73 7061 7469 616c 275d 0d0a  nput_spatial']..
-0000c550: 2020 2020 2020 2020 666f 7220 636c 6173          for clas
-0000c560: 735f 7920 696e 2072 616e 6765 2873 656c  s_y in range(sel
-0000c570: 662e 6f75 745f 6469 6d29 3a0d 0a20 2020  f.out_dim):..   
-0000c580: 2020 2020 2020 2020 2023 636f 6d70 7574           #comput
-0000c590: 6520 6d65 616e 2061 6374 6976 6174 696f  e mean activatio
-0000c5a0: 6e20 6f66 2066 696e 616c 206c 6179 6572  n of final layer
-0000c5b0: 2066 6f72 2065 6163 6820 636c 6173 730d   for each class.
-0000c5c0: 0a20 2020 2020 2020 2020 2020 2023 544f  .            #TO
-0000c5d0: 444f 3a20 2d3e 2074 6f20 7365 6c66 2e61  DO: -> to self.a
-0000c5e0: 6374 6976 6174 696f 6e73 0d0a 2020 2020  ctivations..    
-0000c5f0: 2020 2020 2020 2020 636c 6173 735f 696e          class_in
-0000c600: 6420 3d20 7466 2e73 7175 6565 7a65 2874  d = tf.squeeze(t
-0000c610: 662e 7768 6572 6528 7466 2e61 7267 6d61  f.where(tf.argma
-0000c620: 7828 792c 2031 293d 3d63 6c61 7373 5f79  x(y, 1)==class_y
-0000c630: 2929 235b 305d 0d0a 2020 2020 2020 2020  ))#[0]..        
-0000c640: 2020 2020 6663 5f62 705f 6f75 7420 3d20      fc_bp_out = 
-0000c650: 286e 702e 646f 7428 6163 7469 7661 7469  (np.dot(activati
-0000c660: 6f6e 735b 2766 6327 5d2e 6e75 6d70 7928  ons['fc'].numpy(
-0000c670: 295b 636c 6173 735f 696e 642c 203a 5d2c  )[class_ind, :],
-0000c680: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000c690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c6a0: 2077 6569 6768 7473 5b27 6f75 745f 775f   weights['out_w_
-0000c6b0: 666c 6174 275d 2e54 2929 2e6d 6561 6e28  flat'].T)).mean(
-0000c6c0: 3029 0d0a 0d0a 2020 2020 2020 2020 2020  0)....          
-0000c6d0: 2020 6663 5f62 705f 6f75 7420 3d20 6663    fc_bp_out = fc
-0000c6e0: 5f62 705f 6f75 742e 7265 7368 6170 6528  _bp_out.reshape(
-0000c6f0: 5b61 6374 6976 6174 696f 6e73 5b27 7463  [activations['tc
-0000c700: 6f6e 7627 5d2e 7368 6170 655b 325d 2c0d  onv'].shape[2],.
-0000c710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c730: 2020 2020 2020 2020 2020 2020 6163 7469              acti
-0000c740: 7661 7469 6f6e 735b 2774 636f 6e76 275d  vations['tconv']
-0000c750: 2e73 6861 7065 5b33 5d5d 2c0d 0a20 2020  .shape[3]],..   
-0000c760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c780: 2020 2020 2020 2020 6f72 6465 723d 2743          order='C
-0000c790: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
-0000c7a0: 6463 203d 2064 636f 765b 2763 6c61 7373  dc = dcov['class
-0000c7b0: 5f63 6f6e 6469 7469 6f6e 616c 275d 5b63  _conditional'][c
-0000c7c0: 6c61 7373 5f79 5d0d 0a20 2020 2020 2020  lass_y]..       
-0000c7d0: 2020 2020 2023 6663 5f62 705f 6f75 7420       #fc_bp_out 
-0000c7e0: 3d20 6e70 2e6d 6178 696d 756d 2866 635f  = np.maximum(fc_
-0000c7f0: 6270 5f6f 7574 2c20 3029 0d0a 2020 2020  bp_out, 0)..    
-0000c800: 2020 2020 2020 2020 636c 6173 735f 7061          class_pa
-0000c810: 7474 6572 6e73 203d 206e 702e 646f 7428  tterns = np.dot(
-0000c820: 6463 2c0d 0a20 2020 2020 2020 2020 2020  dc,..           
-0000c830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c840: 2020 2020 2020 2020 2077 6569 6768 7473           weights
-0000c850: 5b27 646d 7827 5d29 0d0a 2020 2020 2020  ['dmx'])..      
-0000c860: 2020 2020 2020 6370 203d 206e 702e 6569        cp = np.ei
-0000c870: 6e73 756d 2827 636b 2c20 696b 202d 3e20  nsum('ck, ik -> 
-0000c880: 6327 2c20 636c 6173 735f 7061 7474 6572  c', class_patter
-0000c890: 6e73 2c20 6663 5f62 705f 6f75 7429 0d0a  ns, fc_bp_out)..
-0000c8a0: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
-0000c8b0: 6d62 696e 6564 5f74 6f70 6f73 2e61 7070  mbined_topos.app
-0000c8c0: 656e 6428 6370 2920 2320 2b20 7370 6174  end(cp) # + spat
-0000c8d0: 6961 6c5f 6269 6173 6573 5b63 6c61 7373  ial_biases[class
-0000c8e0: 5f79 5d0d 0a0d 0a20 2020 2020 2020 2074  _y]....        t
-0000c8f0: 6f70 6f73 203d 206e 702e 7374 6163 6b28  opos = np.stack(
-0000c900: 636f 6d62 696e 6564 5f74 6f70 6f73 2c20  combined_topos, 
-0000c910: 3129 0d0a 2020 2020 2020 2020 7265 7475  1)..        retu
-0000c920: 726e 2074 6f70 6f73 0d0a 0d0a 0d0a 0d0a  rn topos........
-0000c930: 0d0a 2020 2020 6465 6620 636f 6d70 7574  ..    def comput
-0000c940: 655f 7061 7474 6572 6e73 2873 656c 662c  e_patterns(self,
-0000c950: 2064 6174 615f 7061 7468 3d4e 6f6e 652c   data_path=None,
-0000c960: 2076 6572 626f 7365 3d46 616c 7365 293a   verbose=False):
-0000c970: 0d0a 2020 2020 2020 2020 2222 2243 6f6d  ..        """Com
-0000c980: 7075 7465 7320 7370 6174 6961 6c20 7061  putes spatial pa
-0000c990: 7474 6572 6e73 2066 726f 6d20 6669 6c74  tterns from filt
-0000c9a0: 6572 2077 6569 6768 7473 2e0d 0a20 2020  er weights...   
-0000c9b0: 2020 2020 2052 6571 7569 7265 6420 666f       Required fo
-0000c9c0: 7220 7669 7375 616c 697a 6174 696f 6e2e  r visualization.
-0000c9d0: 0d0a 0d0a 2020 2020 2020 2020 5061 7261  ....        Para
-0000c9e0: 6d65 7465 7273 0d0a 2020 2020 2020 2020  meters..        
-0000c9f0: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
-0000ca00: 2020 2020 6461 7461 5f70 6174 6820 3a20      data_path : 
-0000ca10: 7374 7220 6f72 206c 6973 7420 6f66 2073  str or list of s
-0000ca20: 7472 0d0a 2020 2020 2020 2020 2020 2020  tr..            
-0000ca30: 5061 7468 2074 6f20 5446 5265 636f 7264  Path to TFRecord
-0000ca40: 2066 696c 6573 206f 6e20 7768 6963 6820   files on which 
-0000ca50: 7468 6520 7061 7474 6572 6e73 2061 7265  the patterns are
-0000ca60: 2065 7374 696d 6174 6564 2e0d 0a0d 0a20   estimated..... 
-0000ca70: 2020 2020 2020 206f 7574 7075 7420 3a20         output : 
-0000ca80: 7374 7220 7b27 7061 7474 6572 6e73 2c20  str {'patterns, 
-0000ca90: 2766 696c 7465 7273 272c 2027 6675 6c6c  'filters', 'full
-0000caa0: 5f70 6174 7465 726e 7327 7d0d 0a20 2020  _patterns'}..   
-0000cab0: 2020 2020 2020 2020 2053 7472 696e 6720           String 
-0000cac0: 7370 6563 6966 7969 6e67 2074 6865 206f  specifying the o
-0000cad0: 7574 7075 742e 0d0a 0d0a 2020 2020 2020  utput.....      
-0000cae0: 2020 2020 2020 2766 696c 7465 7273 2720        'filters' 
-0000caf0: 2d20 6578 7472 6163 7473 2077 6569 6768  - extracts weigh
-0000cb00: 7473 206f 6620 7468 6520 7370 6174 6961  ts of the spatia
-0000cb10: 6c20 6669 6c74 6572 730d 0a0d 0a20 2020  l filters....   
-0000cb20: 2020 2020 2020 2020 2027 7061 7474 6572           'patter
-0000cb30: 6e73 2720 2d20 6578 7472 6163 7473 2061  ns' - extracts a
-0000cb40: 6374 6976 6174 696f 6e20 7061 7474 6572  ctivation patter
-0000cb50: 6e73 2c20 6f62 7461 696e 6564 2062 790d  ns, obtained by.
-0000cb60: 0a20 2020 2020 2020 2020 2020 206c 6566  .            lef
-0000cb70: 742d 6d75 6c74 6970 7969 6e67 2074 6865  t-multipying the
-0000cb80: 2073 7061 7469 616c 2066 696c 7465 7220   spatial filter 
-0000cb90: 7765 6967 6874 7320 6279 2074 6865 2028  weights by the (
-0000cba0: 7370 6174 6961 6c29 0d0a 2020 2020 2020  spatial)..      
-0000cbb0: 2020 2020 2020 6461 7461 2063 6f76 6172        data covar
-0000cbc0: 6961 6e63 652e 0d0a 0d0a 2020 2020 2020  iance.....      
-0000cbd0: 2020 2020 2020 2766 756c 6c2d 7061 7474        'full-patt
-0000cbe0: 6572 6e73 2720 2d20 6164 6469 7469 6f6e  erns' - addition
-0000cbf0: 616c 6c79 206d 756c 7469 706c 6965 7320  ally multiplies 
-0000cc00: 6163 7469 7661 7469 6f6e 0d0a 2020 2020  activation..    
-0000cc10: 2020 2020 2020 2020 7061 7474 6572 6e73          patterns
-0000cc20: 2062 7920 7468 6520 7072 6563 6973 696f   by the precisio
-0000cc30: 6e20 2869 6e76 6572 7365 2063 6f76 6172  n (inverse covar
-0000cc40: 6961 6e63 6529 206f 6620 7468 650d 0a20  iance) of the.. 
-0000cc50: 2020 2020 2020 2020 2020 206c 6174 656e             laten
-0000cc60: 7420 736f 7572 6365 730d 0a0d 0a20 2020  t sources....   
-0000cc70: 2020 2020 2052 6574 7572 6e73 0d0a 2020       Returns..  
-0000cc80: 2020 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20        -------.. 
-0000cc90: 2020 2020 2020 2073 656c 662e 7061 7474         self.patt
-0000cca0: 6572 6e73 0d0a 2020 2020 2020 2020 2020  erns..          
-0000ccb0: 2020 7370 6174 6961 6c20 6669 6c74 6572    spatial filter
-0000ccc0: 7320 6f72 2061 6374 6976 6174 696f 6e20  s or activation 
-0000ccd0: 7061 7474 6572 6e73 2c20 6465 7065 6e64  patterns, depend
-0000cce0: 696e 6720 6f6e 2074 6865 0d0a 2020 2020  ing on the..    
-0000ccf0: 2020 2020 2020 2020 7661 6c75 6520 6f66          value of
-0000cd00: 2027 6f75 7470 7574 2720 7061 7261 6d65   'output' parame
-0000cd10: 7465 722e 0d0a 0d0a 2020 2020 2020 2020  ter.....        
-0000cd20: 7365 6c66 2e6c 6174 5f74 6373 0d0a 2020  self.lat_tcs..  
-0000cd30: 2020 2020 2020 2020 2020 7469 6d65 2063            time c
-0000cd40: 6f75 7273 6573 206f 6620 6c61 7465 6e74  ourses of latent
-0000cd50: 2073 6f75 7273 6573 2e0d 0a0d 0a20 2020   sourses.....   
-0000cd60: 2020 2020 2073 656c 662e 6669 6c74 6572       self.filter
-0000cd70: 730d 0a20 2020 2020 2020 2020 2020 2074  s..            t
-0000cd80: 656d 706f 7261 6c20 636f 6e76 6f6c 7574  emporal convolut
-0000cd90: 696f 6e61 6c20 6669 6c74 6572 2063 6f65  ional filter coe
-0000cda0: 6666 6963 6965 6e74 732e 0d0a 0d0a 2020  fficients.....  
-0000cdb0: 2020 2020 2020 7365 6c66 2e6f 7574 5f77        self.out_w
-0000cdc0: 6569 6768 7473 0d0a 2020 2020 2020 2020  eights..        
-0000cdd0: 2020 2020 7765 6967 6874 7320 6f66 2074      weights of t
-0000cde0: 6865 206f 7574 7075 7420 6c61 7965 722e  he output layer.
-0000cdf0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-0000ce00: 2e72 666f 6373 0d0a 2020 2020 2020 2020  .rfocs..        
-0000ce10: 2020 2020 6665 6174 7572 6520 7265 6c65      feature rele
-0000ce20: 7661 6e63 6573 2066 6f72 2074 6865 206f  vances for the o
-0000ce30: 7574 7075 7420 6c61 7965 722e 0d0a 2020  utput layer...  
-0000ce40: 2020 2020 2020 2020 2020 2853 6565 2073            (See s
-0000ce50: 656c 662e 6765 745f 6f75 7470 7574 5f63  elf.get_output_c
-0000ce60: 6f72 7265 6c61 7469 6f6e 7329 0d0a 0d0a  orrelations)....
-0000ce70: 2020 2020 2020 2020 5261 6973 6573 3a0d          Raises:.
-0000ce80: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-0000ce90: 0d0a 2020 2020 2020 2020 2020 2020 4174  ..            At
-0000cea0: 7472 6962 7574 6545 7272 6f72 3a20 4966  tributeError: If
-0000ceb0: 2060 6461 7461 5f70 6174 6860 2069 7320   `data_path` is 
-0000cec0: 6e6f 7420 7370 6563 6966 6965 642e 0d0a  not specified...
-0000ced0: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
-0000cee0: 2020 2020 200d 0a20 2020 2020 2020 2073       ..        s
-0000cef0: 656c 662e 6e66 6674 203d 2031 3238 0d0a  elf.nfft = 128..
-0000cf00: 2020 2020 2020 2020 7061 7474 6572 6e73          patterns
-0000cf10: 5f73 7472 7563 7420 3d20 7b27 7765 6967  _struct = {'weig
-0000cf20: 6874 7327 203a 207b 2764 6d78 273a 5b5d  hts' : {'dmx':[]
-0000cf30: 2c20 2774 636f 6e76 273a 5b5d 2c20 2766  , 'tconv':[], 'f
-0000cf40: 6327 3a5b 5d2c 2027 7463 6f6e 765f 6672  c':[], 'tconv_fr
-0000cf50: 6571 5f72 6573 706f 7365 7327 3a7b 7d7d  eq_resposes':{}}
-0000cf60: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000cf70: 2020 2020 2020 2020 2020 2020 2020 2763                'c
-0000cf80: 636d 7327 203a 207b 2764 6d78 273a 5b5d  cms' : {'dmx':[]
-0000cf90: 2c20 2774 636f 6e76 273a 5b5d 2c20 2766  , 'tconv':[], 'f
-0000cfa0: 6327 3a5b 5d2c 2027 696e 7075 7427 3a5b  c':[], 'input':[
-0000cfb0: 5d2c 2027 646d 785f 7073 6427 3a5b 5d7d  ], 'dmx_psd':[]}
-0000cfc0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000cfd0: 2020 2020 2020 2020 2020 2020 2020 2764                'd
-0000cfe0: 636f 7627 203a 207b 2769 6e70 7574 5f73  cov' : {'input_s
-0000cff0: 7061 7469 616c 273a 5b5d 2c20 2763 6c61  patial':[], 'cla
-0000d000: 7373 5f63 6f6e 6469 7469 6f6e 616c 273a  ss_conditional':
-0000d010: 5b5d 2c0d 0a20 2020 2020 2020 2020 2020  [],..           
-0000d020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d030: 2020 2020 2020 2020 2020 276b 2d31 273a            'k-1':
-0000d040: 5b5d 7d2c 0d0a 2020 2020 2020 2020 2020  []},..          
-0000d050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d060: 2027 7061 7474 6572 6e73 2720 3a20 7b7d   'patterns' : {}
-0000d070: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000d080: 2020 2020 2020 2020 2020 2020 2020 2773                's
-0000d090: 7065 6374 7261 273a 207b 7d2c 0d0a 2020  pectra': {},..  
-0000d0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0b0: 2020 2020 2020 2020 2027 6672 6571 7327           'freqs'
-0000d0c0: 3a20 4e6f 6e65 0d0a 2020 2020 2020 2020  : None..        
+0000ae00: 2020 2020 2020 2020 2020 2020 6463 2c20              dc, 
+0000ae10: 7765 6967 6874 735b 2764 6d78 275d 2c20  weights['dmx'], 
+0000ae20: 7072 6563 5f73 7829 290d 0a20 2020 2020  prec_sx))..     
+0000ae30: 2020 2070 6174 7465 726e 7320 3d20 6e70     patterns = np
+0000ae40: 2e73 7461 636b 2870 6174 7465 726e 732c  .stack(patterns,
+0000ae50: 202d 3129 0d0a 2020 2020 2020 2020 7265   -1)..        re
+0000ae60: 7475 726e 2070 6174 7465 726e 730d 0a0d  turn patterns...
+0000ae70: 0a0d 0a20 2020 2064 6566 2070 6174 7465  ...    def patte
+0000ae80: 726e 735f 636f 765f 7879 5f68 6174 2873  rns_cov_xy_hat(s
+0000ae90: 656c 662c 2058 2c20 792c 2061 6374 6976  elf, X, y, activ
+0000aea0: 6174 696f 6e73 2c20 7765 6967 6874 7329  ations, weights)
+0000aeb0: 3a0d 0a20 2020 2020 2020 2053 785f 7463  :..        Sx_tc
+0000aec0: 6f6e 7620 3d20 7365 6c66 2e62 6163 6b70  onv = self.backp
+0000aed0: 726f 705f 6663 2861 6374 6976 6174 696f  rop_fc(activatio
+0000aee0: 6e73 5b27 7463 6f6e 7627 5d2c 0d0a 2020  ns['tconv'],..  
+0000aef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000af00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000af10: 2020 6163 7469 7661 7469 6f6e 735b 2766    activations['f
+0000af20: 6327 5d2c 0d0a 2020 2020 2020 2020 2020  c'],..          
+0000af30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000af40: 2020 2020 2020 2020 2020 792c 0d0a 2020            y,..  
+0000af50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000af60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000af70: 2020 7765 6967 6874 735b 276f 7574 5f77    weights['out_w
+0000af80: 6569 6768 7473 275d 290d 0a20 2020 2020  eights'])..     
+0000af90: 2020 2053 785f 646d 7820 3d20 7365 6c66     Sx_dmx = self
+0000afa0: 2e62 6163 6b70 726f 705f 636f 7678 7928  .backprop_covxy(
+0000afb0: 582c 0d0a 2020 2020 2020 2020 2020 2020  X,..            
+0000afc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000afd0: 2020 2020 2020 2020 6163 7469 7661 7469          activati
+0000afe0: 6f6e 735b 2764 6d78 275d 2c0d 0a20 2020  ons['dmx'],..   
+0000aff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b010: 2053 785f 7463 6f6e 762c 0d0a 2020 2020   Sx_tconv,..    
+0000b020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b040: 7765 6967 6874 735b 2764 6d78 275d 290d  weights['dmx']).
+0000b050: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000b060: 5378 5f74 636f 6e76 2c20 5378 5f64 6d78  Sx_tconv, Sx_dmx
+0000b070: 0d0a 0d0a 0d0a 2020 2020 6465 6620 6261  ......    def ba
+0000b080: 636b 7072 6f70 5f66 6328 7365 6c66 2c20  ckprop_fc(self, 
+0000b090: 582c 2079 5f68 6174 2c20 792c 2077 293a  X, y_hat, y, w):
+0000b0a0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+0000b0b0: 2020 2020 2020 2058 202d 205b 692c 2e2e         X - [i,..
+0000b0c0: 2e2c 6d5d 0d0a 2020 2020 2020 2020 7920  .,m]..        y 
+0000b0d0: 2d20 5b69 2c2e 2e2e 2c6a 5d0d 0a20 2020  - [i,...,j]..   
+0000b0e0: 2020 2020 2077 202d 205b 6b2c 2e2e 2e2c       w - [k,...,
+0000b0f0: 6a5d 0d0a 2020 2020 2020 2020 5378 202d  j]..        Sx -
+0000b100: 205b 6b2c 2e2e 2e2c 6d6a 5d22 2222 0d0a   [k,...,mj]"""..
+0000b110: 2020 2020 2020 2020 785f 7368 6170 6520          x_shape 
+0000b120: 3d20 6c69 7374 2858 2e73 6861 7065 290d  = list(X.shape).
+0000b130: 0a20 2020 2020 2020 2079 5f73 6861 7065  .        y_shape
+0000b140: 203d 206c 6973 7428 795f 6861 742e 7368   = list(y_hat.sh
+0000b150: 6170 6529 0d0a 2020 2020 2020 2020 236f  ape)..        #o
+0000b160: 7574 5f73 6861 7065 203d 2078 5f73 6861  ut_shape = x_sha
+0000b170: 7065 5b31 3a5d 202b 2079 5f73 6861 7065  pe[1:] + y_shape
+0000b180: 5b31 3a5d 0d0a 2020 2020 2020 2020 2370  [1:]..        #p
+0000b190: 7269 6e74 2878 5f73 6861 7065 2c20 795f  rint(x_shape, y_
+0000b1a0: 7368 6170 652c 2077 2e73 6861 7065 290d  shape, w.shape).
+0000b1b0: 0a20 2020 2020 2020 2064 646f 6620 3d20  .        ddof = 
+0000b1c0: 582e 7368 6170 655b 305d 202d 2031 0d0a  X.shape[0] - 1..
+0000b1d0: 2020 2020 2020 2020 5820 3d20 6e70 2e72          X = np.r
+0000b1e0: 6573 6861 7065 2858 2c20 5b58 2e73 6861  eshape(X, [X.sha
+0000b1f0: 7065 5b30 5d2c 202d 315d 290d 0a20 2020  pe[0], -1])..   
+0000b200: 2020 2020 2079 203d 206e 702e 7265 7368       y = np.resh
+0000b210: 6170 6528 792c 205b 792e 7368 6170 655b  ape(y, [y.shape[
+0000b220: 305d 2c20 2d31 5d29 0d0a 2020 2020 2020  0], -1])..      
+0000b230: 2020 795f 6861 7420 3d20 6e70 2e72 6573    y_hat = np.res
+0000b240: 6861 7065 2879 5f68 6174 2c20 5b79 5f68  hape(y_hat, [y_h
+0000b250: 6174 2e73 6861 7065 5b30 5d2c 202d 315d  at.shape[0], -1]
+0000b260: 290d 0a20 2020 2020 2020 2077 203d 206e  )..        w = n
+0000b270: 702e 7265 7368 6170 6528 772c 205b 2d31  p.reshape(w, [-1
+0000b280: 2c20 772e 7368 6170 655b 2d31 5d5d 290d  , w.shape[-1]]).
+0000b290: 0a0d 0a20 2020 2020 2020 2061 7373 6572  ...        asser
+0000b2a0: 7428 582e 7368 6170 655b 2d31 5d20 3d3d  t(X.shape[-1] ==
+0000b2b0: 2077 2e73 6861 7065 5b30 5d29 2c20 2753   w.shape[0]), 'S
+0000b2c0: 6861 7065 206d 6973 6d61 7463 6820 583a  hape mismatch X:
+0000b2d0: 7b7d 2077 3a7b 7d27 2e66 6f72 6d61 7428  {} w:{}'.format(
+0000b2e0: 582e 7368 6165 702c 2077 2e73 6861 7065  X.shaep, w.shape
+0000b2f0: 290d 0a20 2020 2020 2020 2061 7373 6572  )..        asser
+0000b300: 7428 795f 6861 742e 7368 6170 655b 2d31  t(y_hat.shape[-1
+0000b310: 5d20 3d3d 2077 2e73 6861 7065 5b31 5d29  ] == w.shape[1])
+0000b320: 2c20 2753 6861 7065 206d 6973 6d61 7463  , 'Shape mismatc
+0000b330: 6820 793a 7b7d 2077 3a7b 7d27 2e66 6f72  h y:{} w:{}'.for
+0000b340: 6d61 7428 795f 6861 742e 7368 6170 652c  mat(y_hat.shape,
+0000b350: 2077 2e73 6861 7065 290d 0a20 2020 2020   w.shape)..     
+0000b360: 2020 2058 203d 2058 202d 2058 2e6d 6561     X = X - X.mea
+0000b370: 6e28 302c 206b 6565 7064 696d 733d 5472  n(0, keepdims=Tr
+0000b380: 7565 290d 0a20 2020 2020 2020 2079 5f68  ue)..        y_h
+0000b390: 6174 203d 2079 5f68 6174 202d 2079 5f68  at = y_hat - y_h
+0000b3a0: 6174 2e6d 6561 6e28 302c 206b 6565 7064  at.mean(0, keepd
+0000b3b0: 696d 733d 5472 7565 290d 0a20 2020 2020  ims=True)..     
+0000b3c0: 2020 2079 203d 2079 202d 2079 2e6d 6561     y = y - y.mea
+0000b3d0: 6e28 302c 206b 6565 7064 696d 733d 5472  n(0, keepdims=Tr
+0000b3e0: 7565 290d 0a20 2020 2020 2020 2063 6f76  ue)..        cov
+0000b3f0: 5f78 7920 3d20 6e70 2e65 696e 7375 6d28  _xy = np.einsum(
+0000b400: 2769 6b20 2c69 6a20 2d3e 206b 6a20 272c  'ik ,ij -> kj ',
+0000b410: 2058 2c20 795f 6861 7429 202f 2064 646f   X, y_hat) / ddo
+0000b420: 660d 0a20 2020 2020 2020 2023 636f 765f  f..        #cov_
+0000b430: 7879 203d 206e 702e 636f 7628 582c 2079  xy = np.cov(X, y
+0000b440: 290d 0a0d 0a0d 0a20 2020 2020 2020 2023  )......        #
+0000b450: 636f 6d70 7574 6520 696e 7665 7273 6520  compute inverse 
+0000b460: 636f 7661 7269 616e 6365 206f 6620 7468  covariance of th
+0000b470: 6520 6f75 7470 7574 0d0a 2020 2020 2020  e output..      
+0000b480: 2020 2363 6f76 5f79 7920 3d20 6e70 2e65    #cov_yy = np.e
+0000b490: 696e 7375 6d28 2769 6a2c 2069 6b20 2d3e  insum('ij, ik ->
+0000b4a0: 206a 6b27 2c20 795f 6861 742c 2079 5f68   jk', y_hat, y_h
+0000b4b0: 6174 2920 2f20 6464 6f66 0d0a 2020 2020  at) / ddof..    
+0000b4c0: 2020 2020 636f 765f 7979 203d 206e 702e      cov_yy = np.
+0000b4d0: 6569 6e73 756d 2827 696a 2c20 696b 202d  einsum('ij, ik -
+0000b4e0: 3e20 6a6b 272c 2079 2c20 7929 202f 2064  > jk', y, y) / d
+0000b4f0: 646f 660d 0a20 2020 2020 2020 2070 7265  dof..        pre
+0000b500: 635f 7979 203d 2074 662e 6c69 6e61 6c67  c_yy = tf.linalg
+0000b510: 2e69 6e76 2863 6f76 5f79 7929 0d0a 0d0a  .inv(cov_yy)....
+0000b520: 2020 2020 2020 2020 2363 6f6d 7075 7465          #compute
+0000b530: 2064 6972 6563 7469 6f6e 7320 6f66 2053   directions of S
+0000b540: 783a 2061 203d 2063 6f76 5f78 792a 2863  x: a = cov_xy*(c
+0000b550: 6f76 5f79 7929 2a2a 2d31 0d0a 2020 2020  ov_yy)**-1..    
+0000b560: 2020 2020 615f 6f75 7420 3d20 6e70 2e65      a_out = np.e
+0000b570: 696e 7375 6d28 276a 6b2c 206b 6c20 2d3e  insum('jk, kl ->
+0000b580: 206a 6c27 2c20 636f 765f 7879 2c20 7072   jl', cov_xy, pr
+0000b590: 6563 5f79 7929 2023 7368 6170 6520 3d20  ec_yy) #shape = 
+0000b5a0: 5b6e 5f74 5f70 6f6f 6c65 642c 206e 5f6c  [n_t_pooled, n_l
+0000b5b0: 6174 656e 742c 206e 5f63 6c61 7373 6573  atent, n_classes
+0000b5c0: 5d0d 0a0d 0a20 2020 2020 2020 2023 2041  ]....        # A
+0000b5d0: 2e2a 770d 0a20 2020 2020 2020 2023 6177  .*w..        #aw
+0000b5e0: 203d 2061 5f6f 7574 202a 2077 2023 7368   = a_out * w #sh
+0000b5f0: 6170 6520 3d20 5b2e 2e2e 5d0d 0a20 2020  ape = [...]..   
+0000b600: 2020 2020 2023 2061 6374 6976 6174 696f       # activatio
+0000b610: 6e20 6f66 2074 636f 6e76 2062 7920 6561  n of tconv by ea
+0000b620: 6368 2073 6967 6e61 6c20 636f 6d70 6f6e  ch signal compon
+0000b630: 656e 7420 6f66 2065 6163 6820 7361 6d70  ent of each samp
+0000b640: 6c65 0d0a 2020 2020 2020 2020 2353 7820  le..        #Sx 
+0000b650: 3d20 6e70 2e65 696e 7375 6d28 2769 6c2c  = np.einsum('il,
+0000b660: 206b 6c20 2d3e 2069 6b27 2c20 795f 6861   kl -> ik', y_ha
+0000b670: 742c 2061 7729 2023 7368 6170 6520 3d20  t, aw) #shape = 
+0000b680: 5b6e 5f62 6174 6368 2c20 2e2e 2e5d 0d0a  [n_batch, ...]..
+0000b690: 2020 2020 2020 2020 5378 203d 206e 702e          Sx = np.
+0000b6a0: 6569 6e73 756d 2827 696c 2c20 696c 2c20  einsum('il, il, 
+0000b6b0: 6a69 202d 3e20 6a69 6c27 2c20 615f 6f75  ji -> jil', a_ou
+0000b6c0: 742c 2077 2c20 5829 0d0a 2020 2020 2020  t, w, X)..      
+0000b6d0: 2020 5378 203d 206e 702e 7371 7565 657a    Sx = np.squeez
+0000b6e0: 6528 6e70 2e72 6573 6861 7065 2853 782c  e(np.reshape(Sx,
+0000b6f0: 2078 5f73 6861 7065 202b 2079 5f73 6861   x_shape + y_sha
+0000b700: 7065 5b31 3a5d 2929 0d0a 2020 2020 2020  pe[1:]))..      
+0000b710: 2020 7265 7475 726e 2053 780d 0a0d 0a20    return Sx.... 
+0000b720: 2020 2064 6566 2062 6163 6b70 726f 705f     def backprop_
+0000b730: 636f 7678 7928 7365 6c66 2c20 582c 2048  covxy(self, X, H
+0000b740: 782c 2053 782c 2077 293a 0d0a 2020 2020  x, Sx, w):..    
+0000b750: 2020 2020 7864 6d78 203d 206e 702e 7265      xdmx = np.re
+0000b760: 7368 6170 6528 4878 2c20 5b2d 312c 2048  shape(Hx, [-1, H
+0000b770: 782e 7368 6170 655b 2d31 5d5d 290d 0a20  x.shape[-1]]).. 
+0000b780: 2020 2020 2020 2078 646d 7820 3d20 7864         xdmx = xd
+0000b790: 6d78 202d 2078 646d 782e 6d65 616e 2830  mx - xdmx.mean(0
+0000b7a0: 2c20 6b65 6570 6469 6d73 3d54 7275 6529  , keepdims=True)
+0000b7b0: 0d0a 2020 2020 2020 2020 7869 6e70 203d  ..        xinp =
+0000b7c0: 206e 702e 7265 7368 6170 6528 582c 205b   np.reshape(X, [
+0000b7d0: 2d31 2c20 582e 7368 6170 655b 2d31 5d5d  -1, X.shape[-1]]
+0000b7e0: 290d 0a20 2020 2020 2020 2078 696e 7020  )..        xinp 
+0000b7f0: 3d20 7869 6e70 202d 2078 696e 702e 6d65  = xinp - xinp.me
+0000b800: 616e 2830 2c20 6b65 6570 6469 6d73 3d54  an(0, keepdims=T
+0000b810: 7275 6529 0d0a 2020 2020 2020 2020 636f  rue)..        co
+0000b820: 765f 7879 203d 206e 702e 646f 7428 7869  v_xy = np.dot(xi
+0000b830: 6e70 2e54 2c20 7864 6d78 290d 0a20 2020  np.T, xdmx)..   
+0000b840: 2020 2020 2070 7269 6e74 2822 6177 222c       print("aw",
+0000b850: 2063 6f76 5f78 792e 7368 6170 6529 0d0a   cov_xy.shape)..
+0000b860: 2020 2020 2020 2020 6177 203d 2063 6f76          aw = cov
+0000b870: 5f78 790d 0a20 2020 2020 2020 2073 7820  _xy..        sx 
+0000b880: 3d20 6e70 2e72 6573 6861 7065 2853 782c  = np.reshape(Sx,
+0000b890: 205b 2d31 2c20 5378 2e73 6861 7065 5b2d   [-1, Sx.shape[-
+0000b8a0: 325d 2c20 5378 2e73 6861 7065 5b2d 315d  2], Sx.shape[-1]
+0000b8b0: 5d29 0d0a 2020 2020 2020 2020 7378 203d  ])..        sx =
+0000b8c0: 2073 7820 2d20 7378 2e6d 6561 6e28 302c   sx - sx.mean(0,
+0000b8d0: 206b 6565 7064 696d 733d 5472 7565 290d   keepdims=True).
+0000b8e0: 0a20 2020 2020 2020 2064 646f 6620 3d20  .        ddof = 
+0000b8f0: 7378 2e73 6861 7065 5b30 5d20 2d20 310d  sx.shape[0] - 1.
+0000b900: 0a20 2020 2020 2020 2063 6f76 5f73 7820  .        cov_sx 
+0000b910: 3d20 6e70 2e65 696e 7375 6d28 2769 6a6b  = np.einsum('ijk
+0000b920: 2c20 696c 6b20 2d3e 206b 6a6c 272c 2073  , ilk -> kjl', s
+0000b930: 782c 7378 2920 2f20 6464 6f66 0d0a 2020  x,sx) / ddof..  
+0000b940: 2020 2020 2020 7072 696e 7428 2263 6f76        print("cov
+0000b950: 5f73 783a 222c 2063 6f76 5f73 782e 7368  _sx:", cov_sx.sh
+0000b960: 6170 6529 0d0a 2020 2020 2020 2020 7072  ape)..        pr
+0000b970: 6563 5f79 795f 6861 7420 3d20 6e70 2e73  ec_yy_hat = np.s
+0000b980: 7461 636b 285b 6e70 2e6c 696e 616c 672e  tack([np.linalg.
+0000b990: 7069 6e76 2873 2920 666f 7220 7320 696e  pinv(s) for s in
+0000b9a0: 2063 6f76 5f73 785d 290d 0a20 2020 2020   cov_sx])..     
+0000b9b0: 2020 2070 7269 6e74 2877 2e73 6861 7065     print(w.shape
+0000b9c0: 2c20 7072 6563 5f79 795f 6861 742e 7368  , prec_yy_hat.sh
+0000b9d0: 6170 6529 0d0a 2020 2020 2020 2020 7777  ape)..        ww
+0000b9e0: 203d 206e 702e 6569 6e73 756d 2827 696a   = np.einsum('ij
+0000b9f0: 2c20 6a6c 6b20 2d3e 2069 6b6c 272c 2077  , jlk -> ikl', w
+0000ba00: 2c20 7072 6563 5f79 795f 6861 7429 0d0a  , prec_yy_hat)..
+0000ba10: 2020 2020 2020 2020 7072 696e 7428 636f          print(co
+0000ba20: 765f 7879 2e73 6861 7065 2c20 7777 2e73  v_xy.shape, ww.s
+0000ba30: 6861 7065 290d 0a20 2020 2020 2020 2061  hape)..        a
+0000ba40: 203d 206e 702e 6569 6e73 756d 2827 696a   = np.einsum('ij
+0000ba50: 2c20 696a 6b20 2d3e 2069 6b27 2c20 636f  , ijk -> ik', co
+0000ba60: 765f 7879 2c20 7777 290d 0a0d 0a20 2020  v_xy, ww)....   
+0000ba70: 2020 2020 2072 6574 7572 6e20 610d 0a0d       return a...
+0000ba80: 0a20 2020 2020 2020 2023 2070 7269 6e74  .        # print
+0000ba90: 2863 6f76 5f78 792e 7368 6170 6529 0d0a  (cov_xy.shape)..
+0000baa0: 2020 2020 2020 2020 2320 7061 7474 6572          # patter
+0000bab0: 6e73 203d 205b 5d0d 0a20 2020 2020 2020  ns = []..       
+0000bac0: 2023 2066 6f72 2063 6c61 7373 5f79 2069   # for class_y i
+0000bad0: 6e20 7261 6e67 6528 5378 2e73 6861 7065  n range(Sx.shape
+0000bae0: 5b2d 315d 293a 0d0a 2020 2020 2020 2020  [-1]):..        
+0000baf0: 2320 2020 2020 7378 203d 206e 702e 7265  #     sx = np.re
+0000bb00: 7368 6170 6528 5378 2c20 5b2d 312c 2053  shape(Sx, [-1, S
+0000bb10: 782e 7368 6170 655b 2d32 5d2c 2053 782e  x.shape[-2], Sx.
+0000bb20: 7368 6170 655b 2d31 5d5d 290d 0a20 2020  shape[-1]])..   
+0000bb30: 2020 2020 2023 2020 2020 2073 7820 2d3d       #     sx -=
+0000bb40: 2073 782e 6d65 616e 2830 2c20 6b65 6570   sx.mean(0, keep
+0000bb50: 6469 6d73 3d54 7275 6529 0d0a 2020 2020  dims=True)..    
+0000bb60: 2020 2020 2320 2020 2020 7072 6563 5f73      #     prec_s
+0000bb70: 7820 3d20 6e70 2e6c 696e 616c 672e 696e  x = np.linalg.in
+0000bb80: 7628 6e70 2e64 6f74 2873 782e 542c 2073  v(np.dot(sx.T, s
+0000bb90: 7829 290d 0a0d 0a20 2020 2020 2020 2023  x))....        #
+0000bba0: 2020 2020 2061 7720 3d20 6e70 2e64 6f74       aw = np.dot
+0000bbb0: 2863 6f76 5f78 792c 2070 7265 635f 7378  (cov_xy, prec_sx
+0000bbc0: 2920 2a20 770d 0a20 2020 2020 2020 2023  ) * w..        #
+0000bbd0: 2020 2020 2023 636f 6d70 6f6e 656e 745f       #component_
+0000bbe0: 6163 7469 7661 7469 6f6e 7320 3d20 6e70  activations = np
+0000bbf0: 2e64 6f74 2861 772c 2070 7265 635f 7378  .dot(aw, prec_sx
+0000bc00: 290d 0a20 2020 2020 2020 2023 2020 2020  )..        #    
+0000bc10: 2070 6174 7465 726e 732e 6170 7065 6e64   patterns.append
+0000bc20: 2861 772e 7375 6d28 2d31 2929 0d0a 0d0a  (aw.sum(-1))....
+0000bc30: 2020 2020 2020 2020 2320 7265 7475 726e          # return
+0000bc40: 206e 702e 7374 6163 6b28 7061 7474 6572   np.stack(patter
+0000bc50: 6e73 2c20 3129 0d0a 0d0a 2020 2020 2320  ns, 1)....    # 
+0000bc60: 6465 6620 6261 636b 7072 6f70 5f64 6d78  def backprop_dmx
+0000bc70: 2873 656c 662c 2058 2c20 795f 6861 742c  (self, X, y_hat,
+0000bc80: 2079 2c20 7729 3a0d 0a20 2020 2023 2020   y, w):..    #  
+0000bc90: 2020 2078 5f73 6861 7065 203d 206c 6973     x_shape = lis
+0000bca0: 7428 582e 7368 6170 6529 0d0a 2020 2020  t(X.shape)..    
+0000bcb0: 2320 2020 2020 795f 7368 6170 6520 3d20  #     y_shape = 
+0000bcc0: 6c69 7374 2879 5f68 6174 2e73 6861 7065  list(y_hat.shape
+0000bcd0: 290d 0a20 2020 2023 2020 2020 206b 203d  )..    #     k =
+0000bce0: 2079 2e73 6861 7065 5b2d 315d 0d0a 2020   y.shape[-1]..  
+0000bcf0: 2020 2320 2020 2020 795f 6861 7420 3d20    #     y_hat = 
+0000bd00: 6e70 2e72 6573 6861 7065 2879 5f68 6174  np.reshape(y_hat
+0000bd10: 2c20 5b79 5f68 6174 2e73 6861 7065 5b30  , [y_hat.shape[0
+0000bd20: 5d2c 202d 315d 290d 0a20 2020 2023 2020  ], -1])..    #  
+0000bd30: 2020 2023 6f75 745f 7368 6170 6520 3d20     #out_shape = 
+0000bd40: 785f 7368 6170 655b 313a 5d20 2b20 795f  x_shape[1:] + y_
+0000bd50: 7368 6170 655b 313a 5d0d 0a20 2020 2023  shape[1:]..    #
+0000bd60: 2020 2020 2023 7072 696e 7428 785f 7368       #print(x_sh
+0000bd70: 6170 652c 2079 5f73 6861 7065 2c20 772e  ape, y_shape, w.
+0000bd80: 7368 6170 6529 0d0a 2020 2020 2320 2020  shape)..    #   
+0000bd90: 2020 6464 6f66 5f78 7920 3d20 6e70 2e70    ddof_xy = np.p
+0000bda0: 726f 6428 785f 7368 6170 655b 3a33 5d29  rod(x_shape[:3])
+0000bdb0: 202d 2031 0d0a 2020 2020 2320 2020 2020   - 1..    #     
+0000bdc0: 6464 6f66 5f79 7920 3d20 6e70 2e70 726f  ddof_yy = np.pro
+0000bdd0: 6428 795f 7368 6170 655b 3a33 5d29 202d  d(y_shape[:3]) -
+0000bde0: 2031 0d0a 0d0a 2020 2020 2320 2020 2020   1....    #     
+0000bdf0: 636f 765f 7879 203d 206e 702e 6569 6e73  cov_xy = np.eins
+0000be00: 756d 2827 696a 6b6c 2c20 696a 6d6e 202d  um('ijkl, ijmn -
+0000be10: 3e20 6c6e 6d27 2c20 582c 2079 5f68 6174  > lnm', X, y_hat
+0000be20: 2920 2f20 6464 6f66 5f78 7920 2373 6861  ) / ddof_xy #sha
+0000be30: 7065 203d 205b 6e5f 6368 2c20 6e5f 6c61  pe = [n_ch, n_la
+0000be40: 746e 6574 2c20 6e5f 6269 6e73 5d0d 0a20  tnet, n_bins].. 
+0000be50: 2020 2023 2020 2020 2063 6f76 5f79 7920     #     cov_yy 
+0000be60: 3d20 6e70 2e65 696e 7375 6d28 2769 6a6b  = np.einsum('ijk
+0000be70: 6c2c 2069 6a6b 6d20 2d3e 206b 6c6d 272c  l, ijkm -> klm',
+0000be80: 2079 5f68 6174 2c20 795f 6861 7429 202f   y_hat, y_hat) /
+0000be90: 2064 646f 665f 7979 0d0a 2020 2020 2320   ddof_yy..    # 
+0000bea0: 2020 2020 7072 6563 5f79 7920 3d20 6e70      prec_yy = np
+0000beb0: 2e61 7272 6179 285b 6e70 2e6c 696e 616c  .array([np.linal
+0000bec0: 672e 696e 7628 6376 7929 2066 6f72 2063  g.inv(cvy) for c
+0000bed0: 7679 2069 6e20 636f 765f 7979 5d29 0d0a  vy in cov_yy])..
+0000bee0: 2020 2020 2320 2020 2020 615f 6f75 7420      #     a_out 
+0000bef0: 3d20 6e70 2e65 696e 7375 6d28 276a 6b6d  = np.einsum('jkm
+0000bf00: 2c20 6d6b 6c20 2d3e 206a 6c6d 272c 2063  , mkl -> jlm', c
+0000bf10: 6f76 5f78 792c 2070 7265 635f 7979 290d  ov_xy, prec_yy).
+0000bf20: 0a20 2020 2023 2020 2020 2061 7720 3d20  .    #     aw = 
+0000bf30: 615f 6f75 7420 2a20 775b 2e2e 2e2c 204e  a_out * w[..., N
+0000bf40: 6f6e 655d 0d0a 2020 2020 2320 2020 2020  one]..    #     
+0000bf50: 2320 6163 7469 7661 7469 6f6e 206f 6620  # activation of 
+0000bf60: 7463 6f6e 7620 6279 2065 6163 6820 7369  tconv by each si
+0000bf70: 676e 616c 2063 6f6d 706f 6e65 6e74 206f  gnal component o
+0000bf80: 6620 6561 6368 2073 616d 706c 650d 0a20  f each sample.. 
+0000bf90: 2020 2023 2020 2020 2053 7820 3d20 6e70     #     Sx = np
+0000bfa0: 2e65 696e 7375 6d28 2769 6a6b 6c2c 2063  .einsum('ijkl, c
+0000bfb0: 6c6b 202d 3e20 6963 6b27 2c20 795f 6861  lk -> ick', y_ha
+0000bfc0: 742c 2061 7729 2023 7368 6170 6520 3d20  t, aw) #shape = 
+0000bfd0: 5b6e 5f62 6174 6368 2c20 2e2e 2e5d 0d0a  [n_batch, ...]..
+0000bfe0: 0d0a 2020 2020 2320 2020 2020 7265 7475  ..    #     retu
+0000bff0: 726e 2053 780d 0a0d 0a20 2020 2064 6566  rn Sx....    def
+0000c000: 2070 6174 7465 726e 735f 7069 6e76 5f77   patterns_pinv_w
+0000c010: 2873 656c 662c 2079 2c20 7765 6967 6874  (self, y, weight
+0000c020: 732c 2061 6374 6976 6174 696f 6e73 2c20  s, activations, 
+0000c030: 6463 6f76 293a 0d0a 2020 2020 2020 2020  dcov):..        
+0000c040: 636f 6d62 696e 6564 5f74 6f70 6f73 203d  combined_topos =
+0000c050: 205b 5d0d 0a20 2020 2020 2020 2070 696e   []..        pin
+0000c060: 765f 646d 7820 3d20 6e70 2e6c 696e 616c  v_dmx = np.linal
+0000c070: 672e 7069 6e76 2877 6569 6768 7473 5b27  g.pinv(weights['
+0000c080: 646d 7827 5d29 2e54 236e 702e 646f 7428  dmx']).T#np.dot(
+0000c090: 7370 6174 6961 6c5f 6669 6c74 6572 732c  spatial_filters,
+0000c0a0: 206e 702e 6c69 6e61 6c67 2e69 6e76 286e   np.linalg.inv(n
+0000c0b0: 702e 646f 7428 7370 6174 6961 6c5f 6669  p.dot(spatial_fi
+0000c0c0: 6c74 6572 732e 542c 2073 7061 7469 616c  lters.T, spatial
+0000c0d0: 5f66 696c 7465 7273 2929 290d 0a20 2020  _filters)))..   
+0000c0e0: 2020 2020 2070 696e 765f 7766 6320 3d20       pinv_wfc = 
+0000c0f0: 6e70 2e6c 696e 616c 672e 7069 6e76 2877  np.linalg.pinv(w
+0000c100: 6569 6768 7473 5b27 6f75 745f 775f 666c  eights['out_w_fl
+0000c110: 6174 275d 292e 5423 6e70 2e64 6f74 286f  at']).T#np.dot(o
+0000c120: 7574 5f77 5f66 6c61 742c 206e 702e 6c69  ut_w_flat, np.li
+0000c130: 6e61 6c67 2e69 6e76 286e 702e 646f 7428  nalg.inv(np.dot(
+0000c140: 6f75 745f 775f 666c 6174 2e54 2c20 6f75  out_w_flat.T, ou
+0000c150: 745f 775f 666c 6174 2929 290d 0a20 2020  t_w_flat)))..   
+0000c160: 2020 2020 2070 696e 765f 7463 6b20 3d20       pinv_tck = 
+0000c170: 6e70 2e6c 696e 616c 672e 7069 6e76 2877  np.linalg.pinv(w
+0000c180: 6569 6768 7473 5b27 7463 6f6e 7627 5d29  eights['tconv'])
+0000c190: 2e54 2023 6e70 2e64 6f74 2874 636f 6e76  .T #np.dot(tconv
+0000c1a0: 5f6b 6572 6e65 6c73 2c20 6e70 2e6c 696e  _kernels, np.lin
+0000c1b0: 616c 672e 696e 7628 6e70 2e64 6f74 2874  alg.inv(np.dot(t
+0000c1c0: 636f 6e76 5f6b 6572 6e65 6c73 2e54 2c20  conv_kernels.T, 
+0000c1d0: 7463 6f6e 765f 6b65 726e 656c 7329 2929  tconv_kernels)))
+0000c1e0: 0d0a 0d0a 2020 2020 2020 2020 234c 6561  ....        #Lea
+0000c1f0: 7374 2073 7175 6172 6520 7369 6e67 616c  st square singal
+0000c200: 2065 7374 696d 6174 6520 696e 2074 636f   estimate in tco
+0000c210: 6e76 2067 6976 656e 2077 6663 2061 6e64  nv given wfc and
+0000c220: 2066 635f 6163 7469 7661 7469 6f6e 730d   fc_activations.
+0000c230: 0a20 2020 2020 2020 2053 785f 7463 6f6e  .        Sx_tcon
+0000c240: 7620 3d20 6e70 2e65 696e 7375 6d28 276a  v = np.einsum('j
+0000c250: 6b2c 2069 6b20 2d3e 696a 272c 2070 696e  k, ik ->ij', pin
+0000c260: 765f 7766 632c 2061 6374 6976 6174 696f  v_wfc, activatio
+0000c270: 6e73 5b27 6663 275d 290d 0a20 2020 2020  ns['fc'])..     
+0000c280: 2020 2053 785f 7463 6f6e 7620 3d20 6e70     Sx_tconv = np
+0000c290: 2e72 6573 6861 7065 2853 785f 7463 6f6e  .reshape(Sx_tcon
+0000c2a0: 762c 2061 6374 6976 6174 696f 6e73 5b27  v, activations['
+0000c2b0: 7463 6f6e 7627 5d2e 7368 6170 6529 0d0a  tconv'].shape)..
+0000c2c0: 0d0a 2020 2020 2020 2020 2352 6576 6572  ..        #Rever
+0000c2d0: 7365 2070 6f6f 6c69 6e67 2061 6e64 2064  se pooling and d
+0000c2e0: 6570 7468 7769 7365 2063 6f6e 766f 6c75  epthwise convolu
+0000c2f0: 7469 6f6e 2066 6f72 2065 6163 6820 636c  tion for each cl
+0000c300: 6173 730d 0a20 2020 2020 2020 2053 785f  ass..        Sx_
+0000c310: 646d 7820 3d20 5b5d 0d0a 2020 2020 2020  dmx = []..      
+0000c320: 2020 2364 6320 3d20 6463 6f76 5b27 696e    #dc = dcov['in
+0000c330: 7075 745f 7370 6174 6961 6c27 5d0d 0a20  put_spatial'].. 
+0000c340: 2020 2020 2020 2023 6e5f 7061 6464 696e         #n_paddin
+0000c350: 6720 3d20 7365 6c66 2e64 6174 6173 6574  g = self.dataset
+0000c360: 2e68 5f70 6172 616d 735b 276e 5f74 275d  .h_params['n_t']
+0000c370: 2573 656c 662e 7370 6563 735b 2773 7472  %self.specs['str
+0000c380: 6964 6527 5d0d 0a20 2020 2020 2020 2066  ide']..        f
+0000c390: 6f72 2063 6c61 7373 5f79 2069 6e20 7261  or class_y in ra
+0000c3a0: 6e67 6528 7365 6c66 2e6f 7574 5f64 696d  nge(self.out_dim
+0000c3b0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0000c3c0: 636c 6173 735f 696e 6420 3d20 7466 2e73  class_ind = tf.s
+0000c3d0: 7175 6565 7a65 2874 662e 7768 6572 6528  queeze(tf.where(
+0000c3e0: 7466 2e61 7267 6d61 7828 792c 2031 293d  tf.argmax(y, 1)=
+0000c3f0: 3d63 6c61 7373 5f79 2929 235b 305d 0d0a  =class_y))#[0]..
+0000c400: 2020 2020 2020 2020 2020 2020 5378 6d20              Sxm 
+0000c410: 3d20 6e70 2e73 7175 6565 7a65 2853 785f  = np.squeeze(Sx_
+0000c420: 7463 6f6e 765b 636c 6173 735f 696e 642c  tconv[class_ind,
+0000c430: 203a 5d2e 6d65 616e 2830 2c20 6b65 6570   :].mean(0, keep
+0000c440: 6469 6d73 3d54 7275 6529 290d 0a20 2020  dims=True))..   
+0000c450: 2020 2020 2020 2020 2053 786d 203d 206e           Sxm = n
+0000c460: 702e 6174 6c65 6173 745f 3264 2853 786d  p.atleast_2d(Sxm
+0000c470: 290d 0a20 2020 2020 2020 2020 2020 2064  )..            d
+0000c480: 6320 3d20 6463 6f76 5b27 636c 6173 735f  c = dcov['class_
+0000c490: 636f 6e64 6974 696f 6e61 6c27 5d5b 636c  conditional'][cl
+0000c4a0: 6173 735f 795d 0d0a 2020 2020 2020 2020  ass_y]..        
+0000c4b0: 2020 2020 636f 6d62 696e 6564 5f74 6f70      combined_top
+0000c4c0: 6f73 2e61 7070 656e 6428 6e70 2e65 696e  os.append(np.ein
+0000c4d0: 7375 6d28 2768 692c 696a 2c74 6a2d 3e68  sum('hi,ij,tj->h
+0000c4e0: 7427 2c0d 0a20 2020 2020 2020 2020 2020  t',..           
+0000c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c510: 2064 632c 0d0a 2020 2020 2020 2020 2020   dc,..          
+0000c520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c540: 2020 7765 6967 6874 735b 2764 6d78 275d    weights['dmx']
+0000c550: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000c560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c570: 2020 2020 2020 2020 2020 2020 2020 2053                 S
+0000c580: 786d 2929 0d0a 2020 2020 2020 2020 746f  xm))..        to
+0000c590: 706f 7320 3d20 6e70 2e73 7461 636b 2863  pos = np.stack(c
+0000c5a0: 6f6d 6269 6e65 645f 746f 706f 732c 2031  ombined_topos, 1
+0000c5b0: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+0000c5c0: 6e20 746f 706f 730d 0a0d 0a0d 0a20 2020  n topos......   
+0000c5d0: 2064 6566 2070 6174 7465 726e 735f 7766   def patterns_wf
+0000c5e0: 635f 6d65 616e 2873 656c 662c 2079 2c20  c_mean(self, y, 
+0000c5f0: 7765 6967 6874 732c 2061 6374 6976 6174  weights, activat
+0000c600: 696f 6e73 2c20 6463 6f76 293a 0d0a 2020  ions, dcov):..  
+0000c610: 2020 2020 2020 636f 6d62 696e 6564 5f74        combined_t
+0000c620: 6f70 6f73 203d 205b 5d0d 0a20 2020 2020  opos = []..     
+0000c630: 2020 2023 7573 6573 2079 2065 7870 6c69     #uses y expli
+0000c640: 6369 7465 6c79 2069 6e73 7465 6164 206f  citely instead o
+0000c650: 6620 636f 765b 782c 795d 0d0a 2020 2020  f cov[x,y]..    
+0000c660: 2020 2020 2361 6363 7572 6174 6520 6275      #accurate bu
+0000c670: 7420 6861 7320 6c69 7474 6c65 2074 6f20  t has little to 
+0000c680: 646f 2077 6974 6820 7468 6520 6d6f 6465  do with the mode
+0000c690: 6c0d 0a20 2020 2020 2020 2023 6463 203d  l..        #dc =
+0000c6a0: 2064 636f 765b 2769 6e70 7574 5f73 7061   dcov['input_spa
+0000c6b0: 7469 616c 275d 0d0a 2020 2020 2020 2020  tial']..        
+0000c6c0: 666f 7220 636c 6173 735f 7920 696e 2072  for class_y in r
+0000c6d0: 616e 6765 2873 656c 662e 6f75 745f 6469  ange(self.out_di
+0000c6e0: 6d29 3a0d 0a20 2020 2020 2020 2020 2020  m):..           
+0000c6f0: 2023 636f 6d70 7574 6520 6d65 616e 2061   #compute mean a
+0000c700: 6374 6976 6174 696f 6e20 6f66 2066 696e  ctivation of fin
+0000c710: 616c 206c 6179 6572 2066 6f72 2065 6163  al layer for eac
+0000c720: 6820 636c 6173 730d 0a20 2020 2020 2020  h class..       
+0000c730: 2020 2020 2023 544f 444f 3a20 2d3e 2074       #TODO: -> t
+0000c740: 6f20 7365 6c66 2e61 6374 6976 6174 696f  o self.activatio
+0000c750: 6e73 0d0a 2020 2020 2020 2020 2020 2020  ns..            
+0000c760: 636c 6173 735f 696e 6420 3d20 7466 2e73  class_ind = tf.s
+0000c770: 7175 6565 7a65 2874 662e 7768 6572 6528  queeze(tf.where(
+0000c780: 7466 2e61 7267 6d61 7828 792c 2031 293d  tf.argmax(y, 1)=
+0000c790: 3d63 6c61 7373 5f79 2929 235b 305d 0d0a  =class_y))#[0]..
+0000c7a0: 2020 2020 2020 2020 2020 2020 6663 5f62              fc_b
+0000c7b0: 705f 6f75 7420 3d20 286e 702e 646f 7428  p_out = (np.dot(
+0000c7c0: 6163 7469 7661 7469 6f6e 735b 2766 6327  activations['fc'
+0000c7d0: 5d2e 6e75 6d70 7928 295b 636c 6173 735f  ].numpy()[class_
+0000c7e0: 696e 642c 203a 5d2c 0d0a 2020 2020 2020  ind, :],..      
+0000c7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c800: 2020 2020 2020 2020 2077 6569 6768 7473           weights
+0000c810: 5b27 6f75 745f 775f 666c 6174 275d 2e54  ['out_w_flat'].T
+0000c820: 2929 2e6d 6561 6e28 3029 0d0a 0d0a 2020  )).mean(0)....  
+0000c830: 2020 2020 2020 2020 2020 6663 5f62 705f            fc_bp_
+0000c840: 6f75 7420 3d20 6663 5f62 705f 6f75 742e  out = fc_bp_out.
+0000c850: 7265 7368 6170 6528 5b61 6374 6976 6174  reshape([activat
+0000c860: 696f 6e73 5b27 7463 6f6e 7627 5d2e 7368  ions['tconv'].sh
+0000c870: 6170 655b 325d 2c0d 0a20 2020 2020 2020  ape[2],..       
+0000c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c8a0: 2020 2020 6163 7469 7661 7469 6f6e 735b      activations[
+0000c8b0: 2774 636f 6e76 275d 2e73 6861 7065 5b33  'tconv'].shape[3
+0000c8c0: 5d5d 2c0d 0a20 2020 2020 2020 2020 2020  ]],..           
+0000c8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c8f0: 6f72 6465 723d 2743 2729 0d0a 2020 2020  order='C')..    
+0000c900: 2020 2020 2020 2020 6463 203d 2064 636f          dc = dco
+0000c910: 765b 2763 6c61 7373 5f63 6f6e 6469 7469  v['class_conditi
+0000c920: 6f6e 616c 275d 5b63 6c61 7373 5f79 5d0d  onal'][class_y].
+0000c930: 0a20 2020 2020 2020 2020 2020 2023 6663  .            #fc
+0000c940: 5f62 705f 6f75 7420 3d20 6e70 2e6d 6178  _bp_out = np.max
+0000c950: 696d 756d 2866 635f 6270 5f6f 7574 2c20  imum(fc_bp_out, 
+0000c960: 3029 0d0a 2020 2020 2020 2020 2020 2020  0)..            
+0000c970: 636c 6173 735f 7061 7474 6572 6e73 203d  class_patterns =
+0000c980: 206e 702e 646f 7428 6463 2c0d 0a20 2020   np.dot(dc,..   
+0000c990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c9b0: 2077 6569 6768 7473 5b27 646d 7827 5d29   weights['dmx'])
+0000c9c0: 0d0a 2020 2020 2020 2020 2020 2020 6370  ..            cp
+0000c9d0: 203d 206e 702e 6569 6e73 756d 2827 636b   = np.einsum('ck
+0000c9e0: 2c20 696b 202d 3e20 6327 2c20 636c 6173  , ik -> c', clas
+0000c9f0: 735f 7061 7474 6572 6e73 2c20 6663 5f62  s_patterns, fc_b
+0000ca00: 705f 6f75 7429 0d0a 0d0a 2020 2020 2020  p_out)....      
+0000ca10: 2020 2020 2020 636f 6d62 696e 6564 5f74        combined_t
+0000ca20: 6f70 6f73 2e61 7070 656e 6428 6370 2920  opos.append(cp) 
+0000ca30: 2320 2b20 7370 6174 6961 6c5f 6269 6173  # + spatial_bias
+0000ca40: 6573 5b63 6c61 7373 5f79 5d0d 0a0d 0a20  es[class_y].... 
+0000ca50: 2020 2020 2020 2074 6f70 6f73 203d 206e         topos = n
+0000ca60: 702e 7374 6163 6b28 636f 6d62 696e 6564  p.stack(combined
+0000ca70: 5f74 6f70 6f73 2c20 3129 0d0a 2020 2020  _topos, 1)..    
+0000ca80: 2020 2020 7265 7475 726e 2074 6f70 6f73      return topos
+0000ca90: 0d0a 0d0a 0d0a 0d0a 0d0a 2020 2020 6465  ..........    de
+0000caa0: 6620 636f 6d70 7574 655f 7061 7474 6572  f compute_patter
+0000cab0: 6e73 2873 656c 662c 2064 6174 615f 7061  ns(self, data_pa
+0000cac0: 7468 3d4e 6f6e 652c 2076 6572 626f 7365  th=None, verbose
+0000cad0: 3d46 616c 7365 293a 0d0a 2020 2020 2020  =False):..      
+0000cae0: 2020 2222 2243 6f6d 7075 7465 7320 7370    """Computes sp
+0000caf0: 6174 6961 6c20 7061 7474 6572 6e73 2066  atial patterns f
+0000cb00: 726f 6d20 6669 6c74 6572 2077 6569 6768  rom filter weigh
+0000cb10: 7473 2e0d 0a20 2020 2020 2020 2052 6571  ts...        Req
+0000cb20: 7569 7265 6420 666f 7220 7669 7375 616c  uired for visual
+0000cb30: 697a 6174 696f 6e2e 0d0a 0d0a 2020 2020  ization.....    
+0000cb40: 2020 2020 5061 7261 6d65 7465 7273 0d0a      Parameters..
+0000cb50: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+0000cb60: 2d2d 0d0a 2020 2020 2020 2020 6461 7461  --..        data
+0000cb70: 5f70 6174 6820 3a20 7374 7220 6f72 206c  _path : str or l
+0000cb80: 6973 7420 6f66 2073 7472 0d0a 2020 2020  ist of str..    
+0000cb90: 2020 2020 2020 2020 5061 7468 2074 6f20          Path to 
+0000cba0: 5446 5265 636f 7264 2066 696c 6573 206f  TFRecord files o
+0000cbb0: 6e20 7768 6963 6820 7468 6520 7061 7474  n which the patt
+0000cbc0: 6572 6e73 2061 7265 2065 7374 696d 6174  erns are estimat
+0000cbd0: 6564 2e0d 0a0d 0a20 2020 2020 2020 206f  ed.....        o
+0000cbe0: 7574 7075 7420 3a20 7374 7220 7b27 7061  utput : str {'pa
+0000cbf0: 7474 6572 6e73 2c20 2766 696c 7465 7273  tterns, 'filters
+0000cc00: 272c 2027 6675 6c6c 5f70 6174 7465 726e  ', 'full_pattern
+0000cc10: 7327 7d0d 0a20 2020 2020 2020 2020 2020  s'}..           
+0000cc20: 2053 7472 696e 6720 7370 6563 6966 7969   String specifyi
+0000cc30: 6e67 2074 6865 206f 7574 7075 742e 0d0a  ng the output...
+0000cc40: 0d0a 2020 2020 2020 2020 2020 2020 2766  ..            'f
+0000cc50: 696c 7465 7273 2720 2d20 6578 7472 6163  ilters' - extrac
+0000cc60: 7473 2077 6569 6768 7473 206f 6620 7468  ts weights of th
+0000cc70: 6520 7370 6174 6961 6c20 6669 6c74 6572  e spatial filter
+0000cc80: 730d 0a0d 0a20 2020 2020 2020 2020 2020  s....           
+0000cc90: 2027 7061 7474 6572 6e73 2720 2d20 6578   'patterns' - ex
+0000cca0: 7472 6163 7473 2061 6374 6976 6174 696f  tracts activatio
+0000ccb0: 6e20 7061 7474 6572 6e73 2c20 6f62 7461  n patterns, obta
+0000ccc0: 696e 6564 2062 790d 0a20 2020 2020 2020  ined by..       
+0000ccd0: 2020 2020 206c 6566 742d 6d75 6c74 6970       left-multip
+0000cce0: 7969 6e67 2074 6865 2073 7061 7469 616c  ying the spatial
+0000ccf0: 2066 696c 7465 7220 7765 6967 6874 7320   filter weights 
+0000cd00: 6279 2074 6865 2028 7370 6174 6961 6c29  by the (spatial)
+0000cd10: 0d0a 2020 2020 2020 2020 2020 2020 6461  ..            da
+0000cd20: 7461 2063 6f76 6172 6961 6e63 652e 0d0a  ta covariance...
+0000cd30: 0d0a 2020 2020 2020 2020 2020 2020 2766  ..            'f
+0000cd40: 756c 6c2d 7061 7474 6572 6e73 2720 2d20  ull-patterns' - 
+0000cd50: 6164 6469 7469 6f6e 616c 6c79 206d 756c  additionally mul
+0000cd60: 7469 706c 6965 7320 6163 7469 7661 7469  tiplies activati
+0000cd70: 6f6e 0d0a 2020 2020 2020 2020 2020 2020  on..            
+0000cd80: 7061 7474 6572 6e73 2062 7920 7468 6520  patterns by the 
+0000cd90: 7072 6563 6973 696f 6e20 2869 6e76 6572  precision (inver
+0000cda0: 7365 2063 6f76 6172 6961 6e63 6529 206f  se covariance) o
+0000cdb0: 6620 7468 650d 0a20 2020 2020 2020 2020  f the..         
+0000cdc0: 2020 206c 6174 656e 7420 736f 7572 6365     latent source
+0000cdd0: 730d 0a0d 0a20 2020 2020 2020 2052 6574  s....        Ret
+0000cde0: 7572 6e73 0d0a 2020 2020 2020 2020 2d2d  urns..        --
+0000cdf0: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 2073  -----..        s
+0000ce00: 656c 662e 7061 7474 6572 6e73 0d0a 2020  elf.patterns..  
+0000ce10: 2020 2020 2020 2020 2020 7370 6174 6961            spatia
+0000ce20: 6c20 6669 6c74 6572 7320 6f72 2061 6374  l filters or act
+0000ce30: 6976 6174 696f 6e20 7061 7474 6572 6e73  ivation patterns
+0000ce40: 2c20 6465 7065 6e64 696e 6720 6f6e 2074  , depending on t
+0000ce50: 6865 0d0a 2020 2020 2020 2020 2020 2020  he..            
+0000ce60: 7661 6c75 6520 6f66 2027 6f75 7470 7574  value of 'output
+0000ce70: 2720 7061 7261 6d65 7465 722e 0d0a 0d0a  ' parameter.....
+0000ce80: 2020 2020 2020 2020 7365 6c66 2e6c 6174          self.lat
+0000ce90: 5f74 6373 0d0a 2020 2020 2020 2020 2020  _tcs..          
+0000cea0: 2020 7469 6d65 2063 6f75 7273 6573 206f    time courses o
+0000ceb0: 6620 6c61 7465 6e74 2073 6f75 7273 6573  f latent sourses
+0000cec0: 2e0d 0a0d 0a20 2020 2020 2020 2073 656c  .....        sel
+0000ced0: 662e 6669 6c74 6572 730d 0a20 2020 2020  f.filters..     
+0000cee0: 2020 2020 2020 2074 656d 706f 7261 6c20         temporal 
+0000cef0: 636f 6e76 6f6c 7574 696f 6e61 6c20 6669  convolutional fi
+0000cf00: 6c74 6572 2063 6f65 6666 6963 6965 6e74  lter coefficient
+0000cf10: 732e 0d0a 0d0a 2020 2020 2020 2020 7365  s.....        se
+0000cf20: 6c66 2e6f 7574 5f77 6569 6768 7473 0d0a  lf.out_weights..
+0000cf30: 2020 2020 2020 2020 2020 2020 7765 6967              weig
+0000cf40: 6874 7320 6f66 2074 6865 206f 7574 7075  hts of the outpu
+0000cf50: 7420 6c61 7965 722e 0d0a 0d0a 2020 2020  t layer.....    
+0000cf60: 2020 2020 7365 6c66 2e72 666f 6373 0d0a      self.rfocs..
+0000cf70: 2020 2020 2020 2020 2020 2020 6665 6174              feat
+0000cf80: 7572 6520 7265 6c65 7661 6e63 6573 2066  ure relevances f
+0000cf90: 6f72 2074 6865 206f 7574 7075 7420 6c61  or the output la
+0000cfa0: 7965 722e 0d0a 2020 2020 2020 2020 2020  yer...          
+0000cfb0: 2020 2853 6565 2073 656c 662e 6765 745f    (See self.get_
+0000cfc0: 6f75 7470 7574 5f63 6f72 7265 6c61 7469  output_correlati
+0000cfd0: 6f6e 7329 0d0a 0d0a 2020 2020 2020 2020  ons)....        
+0000cfe0: 5261 6973 6573 3a0d 0a20 2020 2020 2020  Raises:..       
+0000cff0: 202d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020   -------..      
+0000d000: 2020 2020 2020 4174 7472 6962 7574 6545        AttributeE
+0000d010: 7272 6f72 3a20 4966 2060 6461 7461 5f70  rror: If `data_p
+0000d020: 6174 6860 2069 7320 6e6f 7420 7370 6563  ath` is not spec
+0000d030: 6966 6965 642e 0d0a 2020 2020 2020 2020  ified...        
+0000d040: 2222 220d 0a20 2020 2020 2020 200d 0a20  """..        .. 
+0000d050: 2020 2020 2020 2073 656c 662e 6e66 6674         self.nfft
+0000d060: 203d 2031 3238 0d0a 2020 2020 2020 2020   = 128..        
+0000d070: 7061 7474 6572 6e73 5f73 7472 7563 7420  patterns_struct 
+0000d080: 3d20 7b27 7765 6967 6874 7327 203a 207b  = {'weights' : {
+0000d090: 2764 6d78 273a 5b5d 2c20 2774 636f 6e76  'dmx':[], 'tconv
+0000d0a0: 273a 5b5d 2c20 2766 6327 3a5b 5d2c 2027  ':[], 'fc':[], '
+0000d0b0: 7463 6f6e 765f 6672 6571 5f72 6573 706f  tconv_freq_respo
+0000d0c0: 7365 7327 3a7b 7d7d 2c0d 0a20 2020 2020  ses':{}},..     
 0000d0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0e0: 2020 207d 0d0a 2020 2020 2020 2020 0d0a     }..        ..
-0000d0f0: 2020 2020 2020 2020 6966 206e 6f74 2064          if not d
-0000d100: 6174 615f 7061 7468 3a0d 0a20 2020 2020  ata_path:..     
-0000d110: 2020 2020 2020 2070 7269 6e74 2822 436f         print("Co
-0000d120: 6d70 7574 696e 6720 7061 7474 6572 6e73  mputing patterns
-0000d130: 3a20 4e6f 2070 6174 6820 7370 6563 6966  : No path specif
-0000d140: 6965 642c 2075 7369 6e67 2076 616c 6964  ied, using valid
-0000d150: 6174 696f 6e20 6461 7461 7365 7420 2844  ation dataset (D
-0000d160: 6566 6175 6c74 2922 290d 0a20 2020 2020  efault)")..     
-0000d170: 2020 2020 2020 2064 7320 3d20 7365 6c66         ds = self
-0000d180: 2e64 6174 6173 6574 2e76 616c 0d0a 2020  .dataset.val..  
-0000d190: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
-0000d1a0: 7461 6e63 6528 6461 7461 5f70 6174 682c  tance(data_path,
-0000d1b0: 2073 7472 2920 6f72 2069 7369 6e73 7461   str) or isinsta
-0000d1c0: 6e63 6528 6461 7461 5f70 6174 682c 2028  nce(data_path, (
-0000d1d0: 6c69 7374 2c20 7475 706c 6529 293a 0d0a  list, tuple)):..
-0000d1e0: 2020 2020 2020 2020 2020 2020 2354 4f44              #TOD
-0000d1f0: 4f3a 2072 6562 616c 6e63 653f 0d0a 2020  O: rebalnce?..  
-0000d200: 2020 2020 2020 2020 2020 6473 203d 2073            ds = s
-0000d210: 656c 662e 6461 7461 7365 742e 5f62 7569  elf.dataset._bui
-0000d220: 6c64 5f64 6174 6173 6574 2864 6174 615f  ld_dataset(data_
-0000d230: 7061 7468 2c0d 0a20 2020 2020 2020 2020  path,..         
-0000d240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d260: 2020 2020 7370 6c69 743d 4661 6c73 652c      split=False,
-0000d270: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000d280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d290: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000d2a0: 6573 745f 6261 7463 683d 4e6f 6e65 2c0d  est_batch=None,.
-0000d2b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d2d0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000d2e0: 7065 6174 3d54 7275 6529 0d0a 2020 2020  peat=True)..    
-0000d2f0: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
-0000d300: 6e63 6528 6461 7461 5f70 6174 682c 2044  nce(data_path, D
-0000d310: 6174 6173 6574 293a 0d0a 2020 2020 2020  ataset):..      
-0000d320: 2020 2020 2020 6966 2068 6173 6174 7472        if hasattr
-0000d330: 2864 6174 615f 7061 7468 2c20 2774 6573  (data_path, 'tes
-0000d340: 7427 293a 0d0a 2020 2020 2020 2020 2020  t'):..          
-0000d350: 2020 2020 2020 6473 203d 2064 6174 615f        ds = data_
-0000d360: 7061 7468 2e74 6573 740d 0a20 2020 2020  path.test..     
-0000d370: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-0000d380: 2020 2020 2020 2020 2020 2020 2020 6473                ds
-0000d390: 203d 2064 6174 615f 7061 7468 2e76 616c   = data_path.val
-0000d3a0: 0d0a 2020 2020 2020 2020 656c 6966 2069  ..        elif i
-0000d3b0: 7369 6e73 7461 6e63 6528 6461 7461 5f70  sinstance(data_p
-0000d3c0: 6174 682c 2074 662e 6461 7461 2e44 6174  ath, tf.data.Dat
-0000d3d0: 6173 6574 293a 0d0a 2020 2020 2020 2020  aset):..        
-0000d3e0: 2020 2020 6473 203d 2064 6174 615f 7061      ds = data_pa
-0000d3f0: 7468 0d0a 2020 2020 2020 2020 656c 7365  th..        else
-0000d400: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-0000d410: 6169 7365 2041 7474 7269 6275 7465 4572  aise AttributeEr
-0000d420: 726f 7228 2753 7065 6369 6679 2064 6174  ror('Specify dat
-0000d430: 6173 6574 206f 7220 6461 7461 2070 6174  aset or data pat
-0000d440: 682e 2729 0d0a 0d0a 0d0a 2020 2020 2020  h.')......      
-0000d450: 2020 582c 2079 203d 205b 726f 7720 666f    X, y = [row fo
-0000d460: 7220 726f 7720 696e 2064 732e 7461 6b65  r row in ds.take
-0000d470: 2831 295d 5b30 5d0d 0a20 2020 2020 2020  (1)][0]..       
-0000d480: 206e 646f 6620 3d20 582e 7368 6170 655b   ndof = X.shape[
-0000d490: 305d 202a 2073 656c 662e 6461 7461 7365  0] * self.datase
-0000d4a0: 742e 685f 7061 7261 6d73 5b27 6e5f 7427  t.h_params['n_t'
-0000d4b0: 5d20 2d20 310d 0a20 2020 2020 2020 2020  ] - 1..         
-0000d4c0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-0000d4d0: 2023 6765 7420 6c61 7965 7220 6163 7469   #get layer acti
-0000d4e0: 7661 7469 6f6e 730d 0a20 2020 2020 2020  vations..       
-0000d4f0: 2061 6374 6976 6174 696f 6e73 203d 207b   activations = {
-0000d500: 7d0d 0a20 2020 2020 2020 2023 2045 7874  }..        # Ext
-0000d510: 7261 6374 2061 6374 6976 6174 696f 6e73  ract activations
-0000d520: 0d0a 2020 2020 2020 2020 6163 7469 7661  ..        activa
-0000d530: 7469 6f6e 735b 2764 6d78 275d 203d 2073  tions['dmx'] = s
-0000d540: 656c 662e 646d 7828 5829 0d0a 2020 2020  elf.dmx(X)..    
-0000d550: 2020 2020 6163 7469 7661 7469 6f6e 735b      activations[
-0000d560: 2774 636f 6e76 275d 203d 2073 656c 662e  'tconv'] = self.
-0000d570: 706f 6f6c 2873 656c 662e 7463 6f6e 7628  pool(self.tconv(
-0000d580: 6163 7469 7661 7469 6f6e 735b 2764 6d78  activations['dmx
-0000d590: 275d 2929 0d0a 2020 2020 2020 2020 6163  ']))..        ac
-0000d5a0: 7469 7661 7469 6f6e 735b 2766 6327 5d20  tivations['fc'] 
-0000d5b0: 203d 2073 656c 662e 6669 6e5f 6663 2861   = self.fin_fc(a
-0000d5c0: 6374 6976 6174 696f 6e73 5b27 7463 6f6e  ctivations['tcon
-0000d5d0: 7627 5d29 0d0a 2020 2020 2020 2020 6966  v'])..        if
-0000d5e0: 2076 6572 626f 7365 3a0d 0a20 2020 2020   verbose:..     
-0000d5f0: 2020 2020 2020 2070 7269 6e74 2822 2222         print("""
-0000d600: 2241 6374 6976 6174 696f 6e73 3a20 5c6e  "Activations: \n
-0000d610: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000d620: 2020 2020 444d 583a 207b 7d0d 0a20 2020      DMX: {}..   
-0000d630: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-0000d640: 434f 4e56 3a20 7b7d 0d0a 2020 2020 2020  CONV: {}..      
-0000d650: 2020 2020 2020 2020 2020 2020 4643 5f44              FC_D
-0000d660: 454e 5345 3a20 7b7d 2222 222e 666f 726d  ENSE: {}""".form
-0000d670: 6174 280d 0a20 2020 2020 2020 2020 2020  at(..           
-0000d680: 2020 2020 2020 2061 6374 6976 6174 696f         activatio
-0000d690: 6e73 5b27 646d 7827 5d2e 7368 6170 652c  ns['dmx'].shape,
-0000d6a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000d6b0: 2020 2020 6163 7469 7661 7469 6f6e 735b      activations[
-0000d6c0: 2774 636f 6e76 275d 2e73 6861 7065 2c0d  'tconv'].shape,.
-0000d6d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d6e0: 2020 2061 6374 6976 6174 696f 6e73 5b27     activations['
-0000d6f0: 6663 275d 2e73 6861 7065 2929 0d0a 0d0a  fc'].shape))....
-0000d700: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-0000d710: 2020 7765 6967 6874 7320 3d20 7365 6c66    weights = self
-0000d720: 2e67 6574 5f77 6569 6768 7473 2829 0d0a  .get_weights()..
-0000d730: 2020 2020 2020 2020 7370 6563 7472 6120          spectra 
-0000d740: 3d20 7365 6c66 2e67 6574 5f73 7065 6374  = self.get_spect
-0000d750: 7261 2877 6569 6768 7473 3d77 6569 6768  ra(weights=weigh
-0000d760: 7473 2c20 6163 7469 7661 7469 6f6e 733d  ts, activations=
-0000d770: 6163 7469 7661 7469 6f6e 7329 0d0a 2020  activations)..  
-0000d780: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-0000d790: 6966 206e 6f74 2070 6174 7465 726e 735f  if not patterns_
-0000d7a0: 7374 7275 6374 5b27 6672 6571 7327 5d3a  struct['freqs']:
-0000d7b0: 0d0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
-0000d7c0: 7474 6572 6e73 5f73 7472 7563 745b 2766  tterns_struct['f
-0000d7d0: 7265 7173 275d 203d 2073 7065 6374 7261  reqs'] = spectra
-0000d7e0: 5b27 6672 6571 7327 5d0d 0a20 2020 2020  ['freqs']..     
-0000d7f0: 2020 2023 4343 4d73 2061 7265 206d 6561     #CCMs are mea
-0000d800: 6e20 6163 7469 7661 7469 6f6e 7320 6f66  n activations of
-0000d810: 2065 6163 6820 6c61 7965 7220 666f 7220   each layer for 
-0000d820: 6561 6368 2063 6c61 7373 0d0a 0d0a 2020  each class....  
-0000d830: 2020 2020 2020 6463 6f76 203d 207b 7d0d        dcov = {}.
-0000d840: 0a20 2020 2020 2020 2064 636f 765b 2769  .        dcov['i
-0000d850: 6e70 7574 5f73 7061 7469 616c 275d 203d  nput_spatial'] =
-0000d860: 206e 702e 6569 6e73 756d 2827 6869 6a6b   np.einsum('hijk
-0000d870: 2c20 6869 6a6c 202d 3e20 6b6c 272c 2058  , hijl -> kl', X
-0000d880: 2c20 5829 202f 206e 646f 660d 0a20 2020  , X) / ndof..   
-0000d890: 2020 2020 2064 636f 765b 2763 6c61 7373       dcov['class
-0000d8a0: 5f63 6f6e 6469 7469 6f6e 616c 275d 2c20  _conditional'], 
-0000d8b0: 6463 6f76 5b27 6b2d 3127 5d20 203d 2073  dcov['k-1']  = s
-0000d8c0: 656c 662e 5f67 6574 5f63 6c61 7373 5f63  elf._get_class_c
-0000d8d0: 6f6e 6469 7469 6f6e 616c 5f73 7061 7469  onditional_spati
-0000d8e0: 616c 5f63 6f76 6172 6961 6e63 6528 582c  al_covariance(X,
-0000d8f0: 2079 290d 0a0d 0a20 2020 2020 2020 2023   y)....        #
-0000d900: 2354 7275 6520 6576 6f6b 6564 0d0a 2020  #True evoked..  
-0000d910: 2020 2020 2020 6966 2073 656c 662e 6461        if self.da
-0000d920: 7461 7365 742e 685f 7061 7261 6d73 5b27  taset.h_params['
-0000d930: 7461 7267 6574 5f74 7970 6527 5d20 3d3d  target_type'] ==
-0000d940: 2027 666c 6f61 7427 3a0d 0a20 2020 2020   'float':..     
-0000d950: 2020 2020 2020 2073 656c 662e 7472 7565         self.true
-0000d960: 5f65 766f 6b65 645f 6461 7461 203d 2058  _evoked_data = X
-0000d970: 2e6e 756d 7079 2829 2e6d 6561 6e28 3029  .numpy().mean(0)
-0000d980: 0d0a 2020 2020 2020 2020 656c 6966 2073  ..        elif s
-0000d990: 656c 662e 6461 7461 7365 742e 685f 7061  elf.dataset.h_pa
-0000d9a0: 7261 6d73 5b27 7461 7267 6574 5f74 7970  rams['target_typ
-0000d9b0: 6527 5d20 3d3d 2027 696e 7427 3a0d 0a20  e'] == 'int':.. 
-0000d9c0: 2020 2020 2020 2020 2020 2079 5f69 6e74             y_int
-0000d9d0: 203d 206e 702e 6172 676d 6178 2879 2c20   = np.argmax(y, 
-0000d9e0: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
-0000d9f0: 795f 756e 6971 7565 203d 206e 702e 756e  y_unique = np.un
-0000da00: 6971 7565 2879 5f69 6e74 290d 0a20 2020  ique(y_int)..   
-0000da10: 2020 2020 2020 2020 2065 766f 6b65 6473           evokeds
-0000da20: 203d 206e 702e 6172 7261 7928 5b58 2e6e   = np.array([X.n
-0000da30: 756d 7079 2829 5b79 5f69 6e74 203d 3d20  umpy()[y_int == 
-0000da40: 692c 202e 2e2e 5d2e 6d65 616e 2830 290d  i, ...].mean(0).
-0000da50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000da60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000da70: 2066 6f72 2069 2069 6e20 795f 756e 6971   for i in y_uniq
-0000da80: 7565 5d29 0d0a 2020 2020 2020 2020 2020  ue])..          
-0000da90: 2020 7365 6c66 2e74 7275 655f 6576 6f6b    self.true_evok
-0000daa0: 6564 5f64 6174 6120 3d20 6e70 2e73 7175  ed_data = np.squ
-0000dab0: 6565 7a65 2865 766f 6b65 6473 290d 0a0d  eeze(evokeds)...
-0000dac0: 0a0d 0a20 2020 2020 2020 2023 2063 6f6d  ...        # com
-0000dad0: 7075 7465 2074 6865 2065 6666 6563 7420  pute the effect 
-0000dae0: 6f66 2072 656d 6f76 696e 6720 6561 6368  of removing each
-0000daf0: 206c 6174 656e 7420 636f 6d70 6f6e 656e   latent componen
-0000db00: 7420 6f6e 2074 6865 2063 6f73 7420 6675  t on the cost fu
-0000db10: 6e63 7469 6f6e 0d0a 2020 2020 2020 2020  nction..        
-0000db20: 2370 6174 7465 726e 735f 7374 7275 6374  #patterns_struct
-0000db30: 5b27 636f 6d70 7769 7365 5f6c 6f73 7365  ['compwise_losse
-0000db40: 7327 5d20 3d20 7365 6c66 2e63 6f6d 7075  s'] = self.compu
-0000db50: 7465 5f63 6f6d 706f 6e65 6e74 7769 7365  te_componentwise
-0000db60: 5f6c 6f73 7328 582c 2079 2c20 7765 6967  _loss(X, y, weig
-0000db70: 6874 7329 0d0a 0d0a 2020 2020 2020 2020  hts)....        
-0000db80: 2354 4f44 4f3a 2063 6c61 7373 2063 6f6e  #TODO: class con
-0000db90: 6474 6974 696f 6e61 6c20 7761 7665 666f  dtitional wavefo
-0000dba0: 726d 7320 2d3e 2061 6374 6976 6174 696f  rms -> activatio
-0000dbb0: 6e73 0d0a 2020 2020 2020 2020 2373 656c  ns..        #sel
-0000dbc0: 662e 7761 7665 666f 726d 7320 3d20 6e70  f.waveforms = np
-0000dbd0: 2e6d 6561 6e28 6163 7469 7661 7469 6f6e  .mean(activation
-0000dbe0: 735b 2764 6d78 275d 292e 540d 0a20 2020  s['dmx']).T..   
-0000dbf0: 2020 2020 200d 0a0d 0a0d 0a20 2020 2020       ......     
-0000dc00: 2020 2070 6174 7465 726e 735f 7374 7275     patterns_stru
-0000dc10: 6374 5b27 7765 6967 6874 7327 5d20 3d20  ct['weights'] = 
-0000dc20: 7765 6967 6874 730d 0a20 2020 2020 2020  weights..       
-0000dc30: 2070 6174 7465 726e 735f 7374 7275 6374   patterns_struct
-0000dc40: 5b27 7370 6563 7472 6127 5d20 3d20 7370  ['spectra'] = sp
-0000dc50: 6563 7472 610d 0a20 2020 2020 2020 2070  ectra..        p
-0000dc60: 6174 7465 726e 735f 7374 7275 6374 5b27  atterns_struct['
-0000dc70: 6463 6f76 275d 203d 2064 636f 760d 0a20  dcov'] = dcov.. 
-0000dc80: 2020 2020 2020 2070 6174 7465 726e 735f         patterns_
-0000dc90: 7374 7275 6374 5b27 6363 6d73 275d 203d  struct['ccms'] =
-0000dca0: 207b 7d23 6363 6d73 0d0a 2020 2020 2020   {}#ccms..      
-0000dcb0: 2020 2353 785f 7463 6f6e 762c 2053 785f    #Sx_tconv, Sx_
-0000dcc0: 646d 7820 3d20 7365 6c66 2e70 6174 7465  dmx = self.patte
-0000dcd0: 726e 735f 636f 765f 7879 5f68 6174 2858  rns_cov_xy_hat(X
-0000dce0: 2c20 792c 2061 6374 6976 6174 696f 6e73  , y, activations
-0000dcf0: 2c20 7765 6967 6874 7329 0d0a 2020 2020  , weights)..    
-0000dd00: 2020 2020 5378 5f74 636f 6e76 5f63 636d      Sx_tconv_ccm
-0000dd10: 203d 205b 5d0d 0a20 2020 2020 2020 2023   = []..        #
-0000dd20: 5378 5f64 6d78 5f63 636d 203d 205b 5d0d  Sx_dmx_ccm = [].
-0000dd30: 0a20 2020 2020 2020 2053 785f 6663 5f63  .        Sx_fc_c
-0000dd40: 636d 203d 205b 5d0d 0a20 2020 2020 2020  cm = []..       
-0000dd50: 2070 6174 7465 726e 735f 6378 7920 3d20   patterns_cxy = 
-0000dd60: 5b5d 0d0a 2020 2020 2020 2020 2320 666f  []..        # fo
-0000dd70: 7220 636c 6173 735f 7920 696e 2072 616e  r class_y in ran
-0000dd80: 6765 2873 656c 662e 6f75 745f 6469 6d29  ge(self.out_dim)
-0000dd90: 3a0d 0a20 2020 2020 2020 2023 2020 2020  :..        #    
-0000dda0: 2063 6c61 7373 5f69 6e64 203d 2074 662e   class_ind = tf.
-0000ddb0: 7371 7565 657a 6528 7466 2e77 6865 7265  squeeze(tf.where
-0000ddc0: 2874 662e 6172 676d 6178 2879 2c20 3129  (tf.argmax(y, 1)
-0000ddd0: 3d3d 636c 6173 735f 7929 2923 5b30 5d0d  ==class_y))#[0].
-0000dde0: 0a20 2020 2020 2020 2023 2020 2020 2053  .        #     S
-0000ddf0: 785f 7463 6f6e 765f 6363 6d2e 6170 7065  x_tconv_ccm.appe
-0000de00: 6e64 2853 785f 7463 6f6e 765b 636c 6173  nd(Sx_tconv[clas
-0000de10: 735f 696e 642c 202e 2e2e 5d2e 6d65 616e  s_ind, ...].mean
-0000de20: 2830 2929 0d0a 2020 2020 2020 2020 2320  (0))..        # 
-0000de30: 2020 2020 2353 785f 646d 785f 6363 6d2e      #Sx_dmx_ccm.
-0000de40: 6170 7065 6e64 2853 785f 646d 785b 636c  append(Sx_dmx[cl
-0000de50: 6173 735f 696e 642c 202e 2e2e 5d2e 6d65  ass_ind, ...].me
-0000de60: 616e 2830 2c20 6b65 6570 6469 6d73 3d54  an(0, keepdims=T
-0000de70: 7275 6529 290d 0a20 2020 2020 2020 2023  rue))..        #
-0000de80: 2020 2020 2023 6120 3d20 6163 7469 7661       #a = activa
-0000de90: 7469 6f6e 735b 2774 636f 6e76 275d 2e6e  tions['tconv'].n
-0000dea0: 756d 7079 2829 5b63 6c61 7373 5f69 6e64  umpy()[class_ind
-0000deb0: 2c20 2e2e 2e5d 2e6d 6561 6e28 3029 2a77  , ...].mean(0)*w
-0000dec0: 6569 6768 7473 5b27 6f75 745f 7765 6967  eights['out_weig
-0000ded0: 6874 7327 5d5b 4e6f 6e65 2c20 2e2e 2e2c  hts'][None, ...,
-0000dee0: 2063 6c61 7373 5f79 5d0d 0a20 2020 2020   class_y]..     
-0000def0: 2020 2023 2020 2020 2053 785f 6663 5f63     #     Sx_fc_c
-0000df00: 636d 2e61 7070 656e 6428 6163 7469 7661  cm.append(activa
-0000df10: 7469 6f6e 735b 2766 6327 5d2e 6e75 6d70  tions['fc'].nump
-0000df20: 7928 295b 636c 6173 735f 696e 642c 202e  y()[class_ind, .
-0000df30: 2e2e 5d2e 6d65 616e 2830 2c20 6b65 6570  ..].mean(0, keep
-0000df40: 6469 6d73 3d54 7275 6529 290d 0a20 2020  dims=True))..   
-0000df50: 2020 2020 2023 2020 2020 2023 2070 6174       #     # pat
-0000df60: 7465 726e 735f 6378 792e 6170 7065 6e64  terns_cxy.append
-0000df70: 286e 702e 646f 7428 6463 6f76 5b27 636c  (np.dot(dcov['cl
-0000df80: 6173 735f 636f 6e64 6974 696f 6e61 6c27  ass_conditional'
-0000df90: 5d5b 636c 6173 735f 795d 2c0d 0a20 2020  ][class_y],..   
-0000dfa0: 2020 2020 2023 2020 2020 2023 2020 2020       #     #    
-0000dfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfc0: 2020 2020 2020 2020 2020 2020 5378 5f64              Sx_d
-0000dfd0: 6d78 5b63 6c61 7373 5f69 6e64 2c20 2e2e  mx[class_ind, ..
-0000dfe0: 2e5d 2e6d 6561 6e28 3029 2929 0d0a 2020  .].mean(0)))..  
-0000dff0: 2020 2020 2020 2320 2020 2020 2370 6174        #     #pat
-0000e000: 7465 726e 735f 6378 792e 6170 7065 6e64  terns_cxy.append
-0000e010: 286e 702e 646f 7428 6463 6f76 5b27 696e  (np.dot(dcov['in
-0000e020: 7075 745f 7370 6174 6961 6c27 5d2c 0d0a  put_spatial'],..
-0000e030: 2020 2020 2020 2020 2320 2020 2020 2320          #     # 
-0000e040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e050: 2020 2020 2020 2020 2020 2053 785f 646d             Sx_dm
-0000e060: 785b 636c 6173 735f 696e 642c 202e 2e2e  x[class_ind, ...
-0000e070: 5d2e 6d65 616e 2830 2929 290d 0a20 2020  ].mean(0)))..   
-0000e080: 2020 2020 2023 6363 6d73 203d 207b 7d0d       #ccms = {}.
-0000e090: 0a20 2020 2020 2020 2023 6363 6d73 5b27  .        #ccms['
-0000e0a0: 7463 6f6e 7627 5d20 3d20 6e70 2e63 6f6e  tconv'] = np.con
-0000e0b0: 6361 7465 6e61 7465 2853 785f 7463 6f6e  catenate(Sx_tcon
-0000e0c0: 765f 6363 6d2c 2030 290d 0a20 2020 2020  v_ccm, 0)..     
-0000e0d0: 2020 2023 6363 6d73 5b27 646d 7827 5d20     #ccms['dmx'] 
-0000e0e0: 3d20 6e70 2e63 6f6e 6361 7465 6e61 7465  = np.concatenate
-0000e0f0: 2853 785f 646d 785f 6363 6d2c 2030 290d  (Sx_dmx_ccm, 0).
-0000e100: 0a20 2020 2020 2020 2023 6363 6d73 5b27  .        #ccms['
-0000e110: 6663 275d 203d 206e 702e 636f 6e63 6174  fc'] = np.concat
-0000e120: 656e 6174 6528 5378 5f66 635f 6363 6d2c  enate(Sx_fc_ccm,
-0000e130: 2030 290d 0a20 2020 2020 2020 200d 0a20   0)..        .. 
-0000e140: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-0000e150: 200d 0a20 2020 2020 2020 2070 6174 7465   ..        patte
-0000e160: 726e 735f 7374 7275 6374 5b27 7061 7474  rns_struct['patt
-0000e170: 6572 6e73 275d 203d 2073 656c 662e 5f63  erns'] = self._c
-0000e180: 6f6d 7075 7465 5f63 6f6d 6269 6e65 645f  ompute_combined_
-0000e190: 7061 7474 6572 6e73 2879 2c20 7765 6967  patterns(y, weig
-0000e1a0: 6874 732c 2061 6374 6976 6174 696f 6e73  hts, activations
-0000e1b0: 2c20 6463 6f76 290d 0a0d 0a20 2020 2020  , dcov)....     
-0000e1c0: 2020 2023 636f 6d70 7574 6520 7468 6520     #compute the 
-0000e1d0: 6566 6665 6374 206f 6620 7265 6d6f 7669  effect of removi
-0000e1e0: 6e67 2065 6163 6820 6c61 7465 6e74 2063  ng each latent c
-0000e1f0: 6f6d 706f 6e65 6e74 206f 6e20 7468 6520  omponent on the 
-0000e200: 636f 7374 2066 756e 6374 696f 6e0d 0a20  cost function.. 
-0000e210: 2020 2020 2020 2070 6174 7465 726e 735f         patterns_
-0000e220: 7374 7275 6374 5b27 636f 6d70 7769 7365  struct['compwise
-0000e230: 5f6c 6f73 7327 5d20 3d20 7365 6c66 2e63  _loss'] = self.c
-0000e240: 6f6d 7075 7465 5f63 6f6d 706f 6e65 6e74  ompute_component
-0000e250: 7769 7365 5f6c 6f73 7328 582c 2079 2c20  wise_loss(X, y, 
-0000e260: 7765 6967 6874 7329 0d0a 2020 2020 2020  weights)..      
-0000e270: 2020 2363 6f72 7265 6c61 7469 6f6e 206f    #correlation o
-0000e280: 6620 6663 2061 6374 6976 6174 696f 6e73  f fc activations
-0000e290: 2074 6f20 790d 0a20 2020 2020 2020 2070   to y..        p
-0000e2a0: 6174 7465 726e 735f 7374 7275 6374 5b27  atterns_struct['
-0000e2b0: 636f 7272 5f74 6f5f 6f75 7470 7574 275d  corr_to_output']
-0000e2c0: 203d 2073 656c 662e 6765 745f 6f75 7470   = self.get_outp
-0000e2d0: 7574 5f63 6f72 7265 6c61 7469 6f6e 7328  ut_correlations(
-0000e2e0: 6163 7469 7661 7469 6f6e 732c 2079 290d  activations, y).
-0000e2f0: 0a20 2020 2020 2020 2023 7365 6c66 2e6f  .        #self.o
-0000e300: 7574 5f77 6569 6768 7473 203d 2077 6569  ut_weights = wei
-0000e310: 6768 7473 5b27 6f75 745f 7765 6967 6874  ghts['out_weight
-0000e320: 7327 5d0d 0a20 2020 2020 2020 2064 656c  s']..        del
-0000e330: 2058 2c20 6163 7469 7661 7469 6f6e 730d   X, activations.
-0000e340: 0a0d 0a20 2020 2020 2020 2072 6574 7572  ...        retur
-0000e350: 6e20 7061 7474 6572 6e73 5f73 7472 7563  n patterns_struc
-0000e360: 740d 0a20 2020 2020 2020 2023 204f 7468  t..        # Oth
-0000e370: 6572 0d0a 2020 2020 2020 2020 2373 656c  er..        #sel
-0000e380: 662e 795f 7472 7565 203d 206e 702e 7371  f.y_true = np.sq
-0000e390: 7565 657a 6528 792e 6e75 6d70 7928 2929  ueeze(y.numpy())
-0000e3a0: 0d0a 2020 2020 0d0a 2020 2020 6465 6620  ..    ..    def 
-0000e3b0: 5f63 6f6d 7075 7465 5f63 6f6d 6269 6e65  _compute_combine
-0000e3c0: 645f 7061 7474 6572 6e73 2873 656c 662c  d_patterns(self,
-0000e3d0: 2079 2c20 7765 6967 6874 732c 2061 6374   y, weights, act
-0000e3e0: 6976 6174 696f 6e73 2c20 6463 6f76 293a  ivations, dcov):
-0000e3f0: 0d0a 2020 2020 2020 2020 7061 7474 6572  ..        patter
-0000e400: 6e73 203d 207b 7d0d 0a20 2020 2020 2020  ns = {}..       
-0000e410: 2070 6174 7465 726e 735b 2763 6f76 5f78   patterns['cov_x
-0000e420: 7827 5d20 3d20 7365 6c66 2e70 6174 7465  x'] = self.patte
-0000e430: 726e 735f 636f 765f 7878 2879 2c20 7765  rns_cov_xx(y, we
-0000e440: 6967 6874 732c 2061 6374 6976 6174 696f  ights, activatio
-0000e450: 6e73 2c20 6463 6f76 290d 0a0d 0a20 2020  ns, dcov)....   
-0000e460: 2020 2020 2023 5378 5f74 636f 6e76 2c20       #Sx_tconv, 
-0000e470: 5378 5f64 6d78 203d 204e 6f6e 652c 204e  Sx_dmx = None, N
-0000e480: 6f6e 6523 7365 6c66 2e70 6174 7465 726e  one#self.pattern
-0000e490: 735f 636f 765f 7879 5f68 6174 2858 2c20  s_cov_xy_hat(X, 
-0000e4a0: 792c 2061 6374 6976 6174 696f 6e73 2c20  y, activations, 
-0000e4b0: 7765 6967 6874 7329 0d0a 2020 2020 2020  weights)..      
-0000e4c0: 2020 2320 5378 5f74 636f 6e76 5f63 636d    # Sx_tconv_ccm
-0000e4d0: 203d 205b 5d0d 0a20 2020 2020 2020 2023   = []..        #
-0000e4e0: 2023 5378 5f64 6d78 5f63 636d 203d 205b   #Sx_dmx_ccm = [
-0000e4f0: 5d0d 0a20 2020 2020 2020 2023 2053 785f  ]..        # Sx_
-0000e500: 6663 5f63 636d 203d 205b 5d0d 0a20 2020  fc_ccm = []..   
-0000e510: 2020 2020 2023 2070 6174 7465 726e 735f       # patterns_
-0000e520: 6378 7920 3d20 5b5d 0d0a 2020 2020 2020  cxy = []..      
-0000e530: 2020 2320 666f 7220 636c 6173 735f 7920    # for class_y 
-0000e540: 696e 2072 616e 6765 2873 656c 662e 6f75  in range(self.ou
-0000e550: 745f 6469 6d29 3a0d 0a20 2020 2020 2020  t_dim):..       
-0000e560: 2023 2020 2020 2063 6c61 7373 5f69 6e64   #     class_ind
-0000e570: 203d 2074 662e 7371 7565 657a 6528 7466   = tf.squeeze(tf
-0000e580: 2e77 6865 7265 2874 662e 6172 676d 6178  .where(tf.argmax
-0000e590: 2879 2c20 3129 3d3d 636c 6173 735f 7929  (y, 1)==class_y)
-0000e5a0: 2923 5b30 5d0d 0a20 2020 2020 2020 2023  )#[0]..        #
-0000e5b0: 2020 2020 2053 785f 7463 6f6e 765f 6363       Sx_tconv_cc
-0000e5c0: 6d2e 6170 7065 6e64 2853 785f 7463 6f6e  m.append(Sx_tcon
-0000e5d0: 765b 636c 6173 735f 696e 642c 202e 2e2e  v[class_ind, ...
-0000e5e0: 5d2e 6d65 616e 2830 2929 0d0a 2020 2020  ].mean(0))..    
-0000e5f0: 2020 2020 2320 2020 2020 2353 785f 646d      #     #Sx_dm
-0000e600: 785f 6363 6d2e 6170 7065 6e64 2853 785f  x_ccm.append(Sx_
-0000e610: 646d 785b 636c 6173 735f 696e 642c 202e  dmx[class_ind, .
-0000e620: 2e2e 5d2e 6d65 616e 2830 2c20 6b65 6570  ..].mean(0, keep
-0000e630: 6469 6d73 3d54 7275 6529 290d 0a20 2020  dims=True))..   
-0000e640: 2020 2020 2023 2020 2020 2023 6120 3d20       #     #a = 
-0000e650: 6163 7469 7661 7469 6f6e 735b 2774 636f  activations['tco
-0000e660: 6e76 275d 2e6e 756d 7079 2829 5b63 6c61  nv'].numpy()[cla
-0000e670: 7373 5f69 6e64 2c20 2e2e 2e5d 2e6d 6561  ss_ind, ...].mea
-0000e680: 6e28 3029 2a77 6569 6768 7473 5b27 6f75  n(0)*weights['ou
-0000e690: 745f 7765 6967 6874 7327 5d5b 4e6f 6e65  t_weights'][None
-0000e6a0: 2c20 2e2e 2e2c 2063 6c61 7373 5f79 5d0d  , ..., class_y].
-0000e6b0: 0a20 2020 2020 2020 2023 2020 2020 2053  .        #     S
-0000e6c0: 785f 6663 5f63 636d 2e61 7070 656e 6428  x_fc_ccm.append(
-0000e6d0: 6163 7469 7661 7469 6f6e 735b 2766 6327  activations['fc'
-0000e6e0: 5d2e 6e75 6d70 7928 295b 636c 6173 735f  ].numpy()[class_
-0000e6f0: 696e 642c 202e 2e2e 5d2e 6d65 616e 2830  ind, ...].mean(0
-0000e700: 2c20 6b65 6570 6469 6d73 3d54 7275 6529  , keepdims=True)
-0000e710: 290d 0a20 2020 2020 2020 2023 2020 2020  )..        #    
-0000e720: 2023 2070 6174 7465 726e 735f 6378 792e   # patterns_cxy.
-0000e730: 6170 7065 6e64 286e 702e 646f 7428 6463  append(np.dot(dc
-0000e740: 6f76 5b27 636c 6173 735f 636f 6e64 6974  ov['class_condit
-0000e750: 696f 6e61 6c27 5d5b 636c 6173 735f 795d  ional'][class_y]
-0000e760: 2c0d 0a20 2020 2020 2020 2023 2020 2020  ,..        #    
-0000e770: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000e780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e790: 2020 5378 5f64 6d78 5b63 6c61 7373 5f69    Sx_dmx[class_i
-0000e7a0: 6e64 2c20 2e2e 2e5d 2e6d 6561 6e28 3029  nd, ...].mean(0)
-0000e7b0: 2929 0d0a 2020 2020 2020 2020 2320 2020  ))..        #   
-0000e7c0: 2020 2370 6174 7465 726e 735f 6378 792e    #patterns_cxy.
-0000e7d0: 6170 7065 6e64 286e 702e 646f 7428 6463  append(np.dot(dc
-0000e7e0: 6f76 5b27 696e 7075 745f 7370 6174 6961  ov['input_spatia
-0000e7f0: 6c27 5d2c 0d0a 2020 2020 2020 2020 2320  l'],..        # 
-0000e800: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0000e810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e820: 2053 785f 646d 785b 636c 6173 735f 696e   Sx_dmx[class_in
-0000e830: 642c 202e 2e2e 5d2e 6d65 616e 2830 2929  d, ...].mean(0))
-0000e840: 290d 0a20 2020 2020 2020 2023 2063 636d  )..        # ccm
-0000e850: 7320 3d20 7b7d 0d0a 2020 2020 2020 2020  s = {}..        
-0000e860: 2320 6363 6d73 5b27 7463 6f6e 7627 5d20  # ccms['tconv'] 
-0000e870: 3d20 6e70 2e63 6f6e 6361 7465 6e61 7465  = np.concatenate
-0000e880: 2853 785f 7463 6f6e 765f 6363 6d2c 2030  (Sx_tconv_ccm, 0
-0000e890: 290d 0a20 2020 2020 2020 2023 6363 6d73  )..        #ccms
-0000e8a0: 5b27 646d 7827 5d20 3d20 6e70 2e63 6f6e  ['dmx'] = np.con
-0000e8b0: 6361 7465 6e61 7465 2853 785f 646d 785f  catenate(Sx_dmx_
-0000e8c0: 6363 6d2c 2030 290d 0a20 2020 2020 2020  ccm, 0)..       
-0000e8d0: 2023 6363 6d73 5b27 6663 275d 203d 206e   #ccms['fc'] = n
-0000e8e0: 702e 636f 6e63 6174 656e 6174 6528 5378  p.concatenate(Sx
-0000e8f0: 5f66 635f 6363 6d2c 2030 290d 0a0d 0a0d  _fc_ccm, 0).....
-0000e900: 0a20 2020 2020 2020 2023 7061 7474 6572  .        #patter
-0000e910: 6e73 5b27 636f 765f 7879 275d 203d 2053  ns['cov_xy'] = S
-0000e920: 785f 646d 780d 0a20 2020 2020 2020 2070  x_dmx..        p
-0000e930: 6174 7465 726e 735b 2770 696e 765f 7727  atterns['pinv_w'
-0000e940: 5d20 3d20 7365 6c66 2e70 6174 7465 726e  ] = self.pattern
-0000e950: 735f 7069 6e76 5f77 2879 2c20 7765 6967  s_pinv_w(y, weig
-0000e960: 6874 732c 2061 6374 6976 6174 696f 6e73  hts, activations
-0000e970: 2c20 6463 6f76 292e 6d65 616e 282d 3129  , dcov).mean(-1)
-0000e980: 0d0a 0d0a 2020 2020 2020 2020 7061 7474  ....        patt
-0000e990: 6572 6e73 5b27 7766 635f 6d65 616e 275d  erns['wfc_mean']
-0000e9a0: 203d 2073 656c 662e 7061 7474 6572 6e73   = self.patterns
-0000e9b0: 5f77 6663 5f6d 6561 6e28 792c 2077 6569  _wfc_mean(y, wei
-0000e9c0: 6768 7473 2c20 6163 7469 7661 7469 6f6e  ghts, activation
-0000e9d0: 732c 2064 636f 7629 0d0a 2020 2020 2020  s, dcov)..      
-0000e9e0: 2020 7265 7475 726e 2070 6174 7465 726e    return pattern
-0000e9f0: 730d 0a0d 0a20 2020 2064 6566 2063 6f6c  s....    def col
-0000ea00: 6c65 6374 5f70 6174 7465 726e 7328 7365  lect_patterns(se
-0000ea10: 6c66 2c20 666f 6c64 3d30 2c20 6e5f 666f  lf, fold=0, n_fo
-0000ea20: 6c64 733d 312c 206e 5f63 6f6d 703d 312c  lds=1, n_comp=1,
-0000ea30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000ea40: 2020 2020 2020 2020 2020 206d 6574 686f             metho
-0000ea50: 6473 3d5b 2777 6569 6768 7427 2c20 0d0a  ds=['weight', ..
-0000ea60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea80: 2020 2763 6f6d 7077 6973 655f 6c6f 7373    'compwise_loss
-0000ea90: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
-0000eaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eab0: 2020 2020 2020 2777 6569 6768 745f 6e6f        'weight_no
-0000eac0: 726d 272c 200d 0a20 2020 2020 2020 2020  rm', ..         
-0000ead0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eae0: 2020 2020 2020 2020 2023 2761 6273 5f77           #'abs_w
-0000eaf0: 6569 6768 7427 2c20 0d0a 2020 2020 2020  eight', ..      
-0000eb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eb10: 2020 2020 2020 2020 2020 2020 276f 7574              'out
-0000eb20: 7075 745f 636f 7272 270d 0a20 2020 2020  put_corr'..     
-0000eb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eb40: 2020 2020 2020 2020 2020 2020 205d 293a               ]):
-0000eb50: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
-0000eb60: 2020 2020 2020 2043 6f6d 7075 7465 2061         Compute a
-0000eb70: 6e64 2073 746f 7265 2070 6174 7465 726e  nd store pattern
-0000eb80: 7320 6475 7269 6e67 2063 726f 7373 2d76  s during cross-v
-0000eb90: 616c 6964 6174 696f 6e2e 0d0a 0d0a 2020  alidation.....  
-0000eba0: 2020 2020 2020 2222 220d 0a0d 0a20 2020        """....   
-0000ebb0: 2020 2020 2070 6174 7465 726e 735f 7374       patterns_st
-0000ebc0: 7275 6374 203d 2073 656c 662e 636f 6d70  ruct = self.comp
-0000ebd0: 7574 655f 7061 7474 6572 6e73 2829 2020  ute_patterns()  
-0000ebe0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-0000ebf0: 636f 6d62 696e 6564 5f6d 6574 686f 6473  combined_methods
-0000ec00: 203d 206c 6973 7428 7061 7474 6572 6e73   = list(patterns
-0000ec10: 5f73 7472 7563 745b 2770 6174 7465 726e  _struct['pattern
-0000ec20: 7327 5d2e 6b65 7973 2829 290d 0a20 2020  s'].keys())..   
-0000ec30: 2020 2020 206d 6574 686f 6473 202b 3d20       methods += 
-0000ec40: 636f 6d62 696e 6564 5f6d 6574 686f 6473  combined_methods
-0000ec50: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
-0000ec60: 2873 656c 662e 6376 5f70 6174 7465 726e  (self.cv_pattern
-0000ec70: 732e 6974 656d 7328 2929 203d 3d20 3020  s.items()) == 0 
-0000ec80: 6f72 2066 6f6c 643d 3d30 3a0d 0a20 2020  or fold==0:..   
-0000ec90: 2020 2020 2020 2020 206e 5f63 6820 3d20           n_ch = 
-0000eca0: 7365 6c66 2e6d 6574 612e 6461 7461 5b27  self.meta.data['
-0000ecb0: 6e5f 6368 275d 0d0a 2020 2020 2020 2020  n_ch']..        
-0000ecc0: 2020 2020 6e5f 7420 3d20 7061 7474 6572      n_t = patter
-0000ecd0: 6e73 5f73 7472 7563 745b 2777 6569 6768  ns_struct['weigh
-0000ece0: 7473 275d 5b27 6f75 745f 7765 6967 6874  ts']['out_weight
-0000ecf0: 7327 5d2e 7368 6170 655b 305d 0d0a 2020  s'].shape[0]..  
-0000ed00: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-0000ed10: 765f 7061 7474 6572 6e73 203d 2064 6566  v_patterns = def
-0000ed20: 6175 6c74 6469 6374 2864 6963 7429 0d0a  aultdict(dict)..
-0000ed30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000ed40: 2e63 765f 7061 7474 6572 6e73 5b27 6672  .cv_patterns['fr
-0000ed50: 6571 7327 5d20 3d20 7061 7474 6572 6e73  eqs'] = patterns
-0000ed60: 5f73 7472 7563 745b 2766 7265 7173 275d  _struct['freqs']
-0000ed70: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0000ed80: 6c66 2e63 765f 7061 7474 6572 6e73 5b27  lf.cv_patterns['
-0000ed90: 6463 6f76 275d 5b27 696e 7075 745f 7370  dcov']['input_sp
-0000eda0: 6174 6961 6c27 5d20 3d20 6e70 2e7a 6572  atial'] = np.zer
-0000edb0: 6f73 285b 6e5f 6368 2c20 6e5f 6368 2c0d  os([n_ch, n_ch,.
-0000edc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000edd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ede0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000edf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee00: 2020 206e 5f66 6f6c 6473 5d29 0d0a 2020     n_folds])..  
-0000ee10: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-0000ee20: 765f 7061 7474 6572 6e73 5b27 6463 6f76  v_patterns['dcov
-0000ee30: 275d 5b27 636c 6173 735f 636f 6e64 6974  ']['class_condit
-0000ee40: 696f 6e61 6c27 5d20 3d20 6e70 2e7a 6572  ional'] = np.zer
-0000ee50: 6f73 285b 7365 6c66 2e79 5f73 6861 7065  os([self.y_shape
-0000ee60: 5b30 5d2c 0d0a 2020 2020 2020 2020 2020  [0],..          
-0000ee70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eea0: 2020 2020 2020 2020 2020 2020 206e 5f63               n_c
-0000eeb0: 682c 206e 5f63 682c 0d0a 2020 2020 2020  h, n_ch,..      
-0000eec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef00: 206e 5f66 6f6c 6473 5d29 0d0a 2020 2020   n_folds])..    
-0000ef10: 2020 2020 2020 2020 7365 6c66 2e63 765f          self.cv_
-0000ef20: 7061 7474 6572 6e73 5b27 6463 6f76 275d  patterns['dcov']
-0000ef30: 5b27 6b2d 3127 5d20 3d20 6e70 2e7a 6572  ['k-1'] = np.zer
-0000ef40: 6f73 285b 7365 6c66 2e79 5f73 6861 7065  os([self.y_shape
-0000ef50: 5b30 5d2c 0d0a 2020 2020 2020 2020 2020  [0],..          
-0000ef60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef80: 2020 2020 2020 2020 2020 2020 2020 6e5f                n_
-0000ef90: 6368 2c20 6e5f 6368 2c0d 0a20 2020 2020  ch, n_ch,..     
-0000efa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000efb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000efc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000efd0: 2020 206e 5f66 6f6c 6473 5d29 0d0a 2020     n_folds])..  
-0000efe0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-0000eff0: 2020 2020 2020 2020 666f 7220 6d65 7468          for meth
-0000f000: 6f64 2069 6e20 6d65 7468 6f64 733a 0d0a  od in methods:..
-0000f010: 2020 2020 2020 2020 2020 2020 236e 5f66              #n_f
-0000f020: 6f6c 6473 203d 206c 656e 2873 656c 662e  olds = len(self.
-0000f030: 6461 7461 7365 742e 685f 7061 7261 6d73  dataset.h_params
-0000f040: 5b27 666f 6c64 7327 5d5b 305d 290d 0a20  ['folds'][0]).. 
-0000f050: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000f060: 656c 662e 6376 5f70 6174 7465 726e 735b  elf.cv_patterns[
-0000f070: 6d65 7468 6f64 5d5b 2773 7061 7469 616c  method]['spatial
-0000f080: 275d 203d 206e 702e 7a65 726f 7328 5b6e  '] = np.zeros([n
-0000f090: 5f63 682c 0d0a 2020 2020 2020 2020 2020  _ch,..          
-0000f0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d0e0: 2020 2020 2020 2763 636d 7327 203a 207b        'ccms' : {
+0000d0f0: 2764 6d78 273a 5b5d 2c20 2774 636f 6e76  'dmx':[], 'tconv
+0000d100: 273a 5b5d 2c20 2766 6327 3a5b 5d2c 2027  ':[], 'fc':[], '
+0000d110: 696e 7075 7427 3a5b 5d2c 2027 646d 785f  input':[], 'dmx_
+0000d120: 7073 6427 3a5b 5d7d 2c0d 0a20 2020 2020  psd':[]},..     
+0000d130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d140: 2020 2020 2020 2764 636f 7627 203a 207b        'dcov' : {
+0000d150: 2769 6e70 7574 5f73 7061 7469 616c 273a  'input_spatial':
+0000d160: 5b5d 2c20 2763 6c61 7373 5f63 6f6e 6469  [], 'class_condi
+0000d170: 7469 6f6e 616c 273a 5b5d 2c0d 0a20 2020  tional':[],..   
+0000d180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d1a0: 2020 276b 2d31 273a 5b5d 7d2c 0d0a 2020    'k-1':[]},..  
+0000d1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d1c0: 2020 2020 2020 2020 2027 7061 7474 6572           'patter
+0000d1d0: 6e73 2720 3a20 7b7d 2c0d 0a20 2020 2020  ns' : {},..     
+0000d1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d1f0: 2020 2020 2020 2773 7065 6374 7261 273a        'spectra':
+0000d200: 207b 7d2c 0d0a 2020 2020 2020 2020 2020   {},..          
+0000d210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d220: 2027 6672 6571 7327 3a20 4e6f 6e65 0d0a   'freqs': None..
+0000d230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d240: 2020 2020 2020 2020 2020 207d 0d0a 2020             }..  
+0000d250: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+0000d260: 6966 206e 6f74 2064 6174 615f 7061 7468  if not data_path
+0000d270: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
+0000d280: 7269 6e74 2822 436f 6d70 7574 696e 6720  rint("Computing 
+0000d290: 7061 7474 6572 6e73 3a20 4e6f 2070 6174  patterns: No pat
+0000d2a0: 6820 7370 6563 6966 6965 642c 2075 7369  h specified, usi
+0000d2b0: 6e67 2076 616c 6964 6174 696f 6e20 6461  ng validation da
+0000d2c0: 7461 7365 7420 2844 6566 6175 6c74 2922  taset (Default)"
+0000d2d0: 290d 0a20 2020 2020 2020 2020 2020 2064  )..            d
+0000d2e0: 7320 3d20 7365 6c66 2e64 6174 6173 6574  s = self.dataset
+0000d2f0: 2e76 616c 0d0a 2020 2020 2020 2020 656c  .val..        el
+0000d300: 6966 2069 7369 6e73 7461 6e63 6528 6461  if isinstance(da
+0000d310: 7461 5f70 6174 682c 2073 7472 2920 6f72  ta_path, str) or
+0000d320: 2069 7369 6e73 7461 6e63 6528 6461 7461   isinstance(data
+0000d330: 5f70 6174 682c 2028 6c69 7374 2c20 7475  _path, (list, tu
+0000d340: 706c 6529 293a 0d0a 2020 2020 2020 2020  ple)):..        
+0000d350: 2020 2020 2354 4f44 4f3a 2072 6562 616c      #TODO: rebal
+0000d360: 6e63 653f 0d0a 2020 2020 2020 2020 2020  nce?..          
+0000d370: 2020 6473 203d 2073 656c 662e 6461 7461    ds = self.data
+0000d380: 7365 742e 5f62 7569 6c64 5f64 6174 6173  set._build_datas
+0000d390: 6574 2864 6174 615f 7061 7468 2c0d 0a20  et(data_path,.. 
+0000d3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d3c0: 2020 2020 2020 2020 2020 2020 7370 6c69              spli
+0000d3d0: 743d 4661 6c73 652c 0d0a 2020 2020 2020  t=False,..      
+0000d3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d400: 2020 2020 2020 2074 6573 745f 6261 7463         test_batc
+0000d410: 683d 4e6f 6e65 2c0d 0a20 2020 2020 2020  h=None,..       
+0000d420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d440: 2020 2020 2020 7265 7065 6174 3d54 7275        repeat=Tru
+0000d450: 6529 0d0a 2020 2020 2020 2020 656c 6966  e)..        elif
+0000d460: 2069 7369 6e73 7461 6e63 6528 6461 7461   isinstance(data
+0000d470: 5f70 6174 682c 2044 6174 6173 6574 293a  _path, Dataset):
+0000d480: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0000d490: 2068 6173 6174 7472 2864 6174 615f 7061   hasattr(data_pa
+0000d4a0: 7468 2c20 2774 6573 7427 293a 0d0a 2020  th, 'test'):..  
+0000d4b0: 2020 2020 2020 2020 2020 2020 2020 6473                ds
+0000d4c0: 203d 2064 6174 615f 7061 7468 2e74 6573   = data_path.tes
+0000d4d0: 740d 0a20 2020 2020 2020 2020 2020 2065  t..            e
+0000d4e0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+0000d4f0: 2020 2020 2020 6473 203d 2064 6174 615f        ds = data_
+0000d500: 7061 7468 2e76 616c 0d0a 2020 2020 2020  path.val..      
+0000d510: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+0000d520: 6528 6461 7461 5f70 6174 682c 2074 662e  e(data_path, tf.
+0000d530: 6461 7461 2e44 6174 6173 6574 293a 0d0a  data.Dataset):..
+0000d540: 2020 2020 2020 2020 2020 2020 6473 203d              ds =
+0000d550: 2064 6174 615f 7061 7468 0d0a 2020 2020   data_path..    
+0000d560: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0000d570: 2020 2020 2020 2072 6169 7365 2041 7474         raise Att
+0000d580: 7269 6275 7465 4572 726f 7228 2753 7065  ributeError('Spe
+0000d590: 6369 6679 2064 6174 6173 6574 206f 7220  cify dataset or 
+0000d5a0: 6461 7461 2070 6174 682e 2729 0d0a 0d0a  data path.')....
+0000d5b0: 0d0a 2020 2020 2020 2020 582c 2079 203d  ..        X, y =
+0000d5c0: 205b 726f 7720 666f 7220 726f 7720 696e   [row for row in
+0000d5d0: 2064 732e 7461 6b65 2831 295d 5b30 5d0d   ds.take(1)][0].
+0000d5e0: 0a20 2020 2020 2020 206e 646f 6620 3d20  .        ndof = 
+0000d5f0: 582e 7368 6170 655b 305d 202a 2073 656c  X.shape[0] * sel
+0000d600: 662e 6461 7461 7365 742e 685f 7061 7261  f.dataset.h_para
+0000d610: 6d73 5b27 6e5f 7427 5d20 2d20 310d 0a20  ms['n_t'] - 1.. 
+0000d620: 2020 2020 2020 2020 2020 2020 2020 200d                 .
+0000d630: 0a20 2020 2020 2020 2023 6765 7420 6c61  .        #get la
+0000d640: 7965 7220 6163 7469 7661 7469 6f6e 730d  yer activations.
+0000d650: 0a20 2020 2020 2020 2061 6374 6976 6174  .        activat
+0000d660: 696f 6e73 203d 207b 7d0d 0a20 2020 2020  ions = {}..     
+0000d670: 2020 2023 2045 7874 7261 6374 2061 6374     # Extract act
+0000d680: 6976 6174 696f 6e73 0d0a 2020 2020 2020  ivations..      
+0000d690: 2020 6163 7469 7661 7469 6f6e 735b 2764    activations['d
+0000d6a0: 6d78 275d 203d 2073 656c 662e 646d 7828  mx'] = self.dmx(
+0000d6b0: 5829 0d0a 2020 2020 2020 2020 6163 7469  X)..        acti
+0000d6c0: 7661 7469 6f6e 735b 2774 636f 6e76 275d  vations['tconv']
+0000d6d0: 203d 2073 656c 662e 706f 6f6c 2873 656c   = self.pool(sel
+0000d6e0: 662e 7463 6f6e 7628 6163 7469 7661 7469  f.tconv(activati
+0000d6f0: 6f6e 735b 2764 6d78 275d 2929 0d0a 2020  ons['dmx']))..  
+0000d700: 2020 2020 2020 6163 7469 7661 7469 6f6e        activation
+0000d710: 735b 2766 6327 5d20 203d 2073 656c 662e  s['fc']  = self.
+0000d720: 6669 6e5f 6663 2861 6374 6976 6174 696f  fin_fc(activatio
+0000d730: 6e73 5b27 7463 6f6e 7627 5d29 0d0a 2020  ns['tconv'])..  
+0000d740: 2020 2020 2020 6966 2076 6572 626f 7365        if verbose
+0000d750: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
+0000d760: 7269 6e74 2822 2222 2241 6374 6976 6174  rint(""""Activat
+0000d770: 696f 6e73 3a20 5c6e 0d0a 2020 2020 2020  ions: \n..      
+0000d780: 2020 2020 2020 2020 2020 2020 444d 583a              DMX:
+0000d790: 207b 7d0d 0a20 2020 2020 2020 2020 2020   {}..           
+0000d7a0: 2020 2020 2020 2054 434f 4e56 3a20 7b7d         TCONV: {}
+0000d7b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000d7c0: 2020 2020 4643 5f44 454e 5345 3a20 7b7d      FC_DENSE: {}
+0000d7d0: 2222 222e 666f 726d 6174 280d 0a20 2020  """.format(..   
+0000d7e0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000d7f0: 6374 6976 6174 696f 6e73 5b27 646d 7827  ctivations['dmx'
+0000d800: 5d2e 7368 6170 652c 0d0a 2020 2020 2020  ].shape,..      
+0000d810: 2020 2020 2020 2020 2020 2020 6163 7469              acti
+0000d820: 7661 7469 6f6e 735b 2774 636f 6e76 275d  vations['tconv']
+0000d830: 2e73 6861 7065 2c0d 0a20 2020 2020 2020  .shape,..       
+0000d840: 2020 2020 2020 2020 2020 2061 6374 6976             activ
+0000d850: 6174 696f 6e73 5b27 6663 275d 2e73 6861  ations['fc'].sha
+0000d860: 7065 2929 0d0a 0d0a 2020 2020 2020 2020  pe))....        
+0000d870: 0d0a 2020 2020 2020 2020 7765 6967 6874  ..        weight
+0000d880: 7320 3d20 7365 6c66 2e67 6574 5f77 6569  s = self.get_wei
+0000d890: 6768 7473 2829 0d0a 2020 2020 2020 2020  ghts()..        
+0000d8a0: 7370 6563 7472 6120 3d20 7365 6c66 2e67  spectra = self.g
+0000d8b0: 6574 5f73 7065 6374 7261 2877 6569 6768  et_spectra(weigh
+0000d8c0: 7473 3d77 6569 6768 7473 2c20 6163 7469  ts=weights, acti
+0000d8d0: 7661 7469 6f6e 733d 6163 7469 7661 7469  vations=activati
+0000d8e0: 6f6e 7329 0d0a 2020 2020 2020 2020 0d0a  ons)..        ..
+0000d8f0: 2020 2020 2020 2020 6966 206e 6f74 2070          if not p
+0000d900: 6174 7465 726e 735f 7374 7275 6374 5b27  atterns_struct['
+0000d910: 6672 6571 7327 5d3a 0d0a 2020 2020 2020  freqs']:..      
+0000d920: 2020 2020 2020 7061 7474 6572 6e73 5f73        patterns_s
+0000d930: 7472 7563 745b 2766 7265 7173 275d 203d  truct['freqs'] =
+0000d940: 2073 7065 6374 7261 5b27 6672 6571 7327   spectra['freqs'
+0000d950: 5d0d 0a20 2020 2020 2020 2023 4343 4d73  ]..        #CCMs
+0000d960: 2061 7265 206d 6561 6e20 6163 7469 7661   are mean activa
+0000d970: 7469 6f6e 7320 6f66 2065 6163 6820 6c61  tions of each la
+0000d980: 7965 7220 666f 7220 6561 6368 2063 6c61  yer for each cla
+0000d990: 7373 0d0a 0d0a 2020 2020 2020 2020 6463  ss....        dc
+0000d9a0: 6f76 203d 207b 7d0d 0a20 2020 2020 2020  ov = {}..       
+0000d9b0: 2064 636f 765b 2769 6e70 7574 5f73 7061   dcov['input_spa
+0000d9c0: 7469 616c 275d 203d 206e 702e 6569 6e73  tial'] = np.eins
+0000d9d0: 756d 2827 6869 6a6b 2c20 6869 6a6c 202d  um('hijk, hijl -
+0000d9e0: 3e20 6b6c 272c 2058 2c20 5829 202f 206e  > kl', X, X) / n
+0000d9f0: 646f 660d 0a20 2020 2020 2020 2064 636f  dof..        dco
+0000da00: 765b 2763 6c61 7373 5f63 6f6e 6469 7469  v['class_conditi
+0000da10: 6f6e 616c 275d 2c20 6463 6f76 5b27 6b2d  onal'], dcov['k-
+0000da20: 3127 5d20 203d 2073 656c 662e 5f67 6574  1']  = self._get
+0000da30: 5f63 6c61 7373 5f63 6f6e 6469 7469 6f6e  _class_condition
+0000da40: 616c 5f73 7061 7469 616c 5f63 6f76 6172  al_spatial_covar
+0000da50: 6961 6e63 6528 582c 2079 290d 0a0d 0a20  iance(X, y).... 
+0000da60: 2020 2020 2020 2023 2354 7275 6520 6576         ##True ev
+0000da70: 6f6b 6564 0d0a 2020 2020 2020 2020 6966  oked..        if
+0000da80: 2073 656c 662e 6461 7461 7365 742e 685f   self.dataset.h_
+0000da90: 7061 7261 6d73 5b27 7461 7267 6574 5f74  params['target_t
+0000daa0: 7970 6527 5d20 3d3d 2027 666c 6f61 7427  ype'] == 'float'
+0000dab0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+0000dac0: 656c 662e 7472 7565 5f65 766f 6b65 645f  elf.true_evoked_
+0000dad0: 6461 7461 203d 2058 2e6e 756d 7079 2829  data = X.numpy()
+0000dae0: 2e6d 6561 6e28 3029 0d0a 2020 2020 2020  .mean(0)..      
+0000daf0: 2020 656c 6966 2073 656c 662e 6461 7461    elif self.data
+0000db00: 7365 742e 685f 7061 7261 6d73 5b27 7461  set.h_params['ta
+0000db10: 7267 6574 5f74 7970 6527 5d20 3d3d 2027  rget_type'] == '
+0000db20: 696e 7427 3a0d 0a20 2020 2020 2020 2020  int':..         
+0000db30: 2020 2079 5f69 6e74 203d 206e 702e 6172     y_int = np.ar
+0000db40: 676d 6178 2879 2c20 3129 0d0a 2020 2020  gmax(y, 1)..    
+0000db50: 2020 2020 2020 2020 795f 756e 6971 7565          y_unique
+0000db60: 203d 206e 702e 756e 6971 7565 2879 5f69   = np.unique(y_i
+0000db70: 6e74 290d 0a20 2020 2020 2020 2020 2020  nt)..           
+0000db80: 2065 766f 6b65 6473 203d 206e 702e 6172   evokeds = np.ar
+0000db90: 7261 7928 5b58 2e6e 756d 7079 2829 5b79  ray([X.numpy()[y
+0000dba0: 5f69 6e74 203d 3d20 692c 202e 2e2e 5d2e  _int == i, ...].
+0000dbb0: 6d65 616e 2830 290d 0a20 2020 2020 2020  mean(0)..       
+0000dbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dbd0: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
+0000dbe0: 6e20 795f 756e 6971 7565 5d29 0d0a 2020  n y_unique])..  
+0000dbf0: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
+0000dc00: 7275 655f 6576 6f6b 6564 5f64 6174 6120  rue_evoked_data 
+0000dc10: 3d20 6e70 2e73 7175 6565 7a65 2865 766f  = np.squeeze(evo
+0000dc20: 6b65 6473 290d 0a0d 0a0d 0a20 2020 2020  keds)......     
+0000dc30: 2020 2023 2063 6f6d 7075 7465 2074 6865     # compute the
+0000dc40: 2065 6666 6563 7420 6f66 2072 656d 6f76   effect of remov
+0000dc50: 696e 6720 6561 6368 206c 6174 656e 7420  ing each latent 
+0000dc60: 636f 6d70 6f6e 656e 7420 6f6e 2074 6865  component on the
+0000dc70: 2063 6f73 7420 6675 6e63 7469 6f6e 0d0a   cost function..
+0000dc80: 2020 2020 2020 2020 2370 6174 7465 726e          #pattern
+0000dc90: 735f 7374 7275 6374 5b27 636f 6d70 7769  s_struct['compwi
+0000dca0: 7365 5f6c 6f73 7365 7327 5d20 3d20 7365  se_losses'] = se
+0000dcb0: 6c66 2e63 6f6d 7075 7465 5f63 6f6d 706f  lf.compute_compo
+0000dcc0: 6e65 6e74 7769 7365 5f6c 6f73 7328 582c  nentwise_loss(X,
+0000dcd0: 2079 2c20 7765 6967 6874 7329 0d0a 0d0a   y, weights)....
+0000dce0: 2020 2020 2020 2020 2354 4f44 4f3a 2063          #TODO: c
+0000dcf0: 6c61 7373 2063 6f6e 6474 6974 696f 6e61  lass condtitiona
+0000dd00: 6c20 7761 7665 666f 726d 7320 2d3e 2061  l waveforms -> a
+0000dd10: 6374 6976 6174 696f 6e73 0d0a 2020 2020  ctivations..    
+0000dd20: 2020 2020 2373 656c 662e 7761 7665 666f      #self.wavefo
+0000dd30: 726d 7320 3d20 6e70 2e6d 6561 6e28 6163  rms = np.mean(ac
+0000dd40: 7469 7661 7469 6f6e 735b 2764 6d78 275d  tivations['dmx']
+0000dd50: 292e 540d 0a20 2020 2020 2020 200d 0a0d  ).T..        ...
+0000dd60: 0a0d 0a20 2020 2020 2020 2070 6174 7465  ...        patte
+0000dd70: 726e 735f 7374 7275 6374 5b27 7765 6967  rns_struct['weig
+0000dd80: 6874 7327 5d20 3d20 7765 6967 6874 730d  hts'] = weights.
+0000dd90: 0a20 2020 2020 2020 2070 6174 7465 726e  .        pattern
+0000dda0: 735f 7374 7275 6374 5b27 7370 6563 7472  s_struct['spectr
+0000ddb0: 6127 5d20 3d20 7370 6563 7472 610d 0a20  a'] = spectra.. 
+0000ddc0: 2020 2020 2020 2070 6174 7465 726e 735f         patterns_
+0000ddd0: 7374 7275 6374 5b27 6463 6f76 275d 203d  struct['dcov'] =
+0000dde0: 2064 636f 760d 0a20 2020 2020 2020 2070   dcov..        p
+0000ddf0: 6174 7465 726e 735f 7374 7275 6374 5b27  atterns_struct['
+0000de00: 6363 6d73 275d 203d 207b 7d23 6363 6d73  ccms'] = {}#ccms
+0000de10: 0d0a 2020 2020 2020 2020 2353 785f 7463  ..        #Sx_tc
+0000de20: 6f6e 762c 2053 785f 646d 7820 3d20 7365  onv, Sx_dmx = se
+0000de30: 6c66 2e70 6174 7465 726e 735f 636f 765f  lf.patterns_cov_
+0000de40: 7879 5f68 6174 2858 2c20 792c 2061 6374  xy_hat(X, y, act
+0000de50: 6976 6174 696f 6e73 2c20 7765 6967 6874  ivations, weight
+0000de60: 7329 0d0a 2020 2020 2020 2020 5378 5f74  s)..        Sx_t
+0000de70: 636f 6e76 5f63 636d 203d 205b 5d0d 0a20  conv_ccm = [].. 
+0000de80: 2020 2020 2020 2023 5378 5f64 6d78 5f63         #Sx_dmx_c
+0000de90: 636d 203d 205b 5d0d 0a20 2020 2020 2020  cm = []..       
+0000dea0: 2053 785f 6663 5f63 636d 203d 205b 5d0d   Sx_fc_ccm = [].
+0000deb0: 0a20 2020 2020 2020 2070 6174 7465 726e  .        pattern
+0000dec0: 735f 6378 7920 3d20 5b5d 0d0a 2020 2020  s_cxy = []..    
+0000ded0: 2020 2020 2320 666f 7220 636c 6173 735f      # for class_
+0000dee0: 7920 696e 2072 616e 6765 2873 656c 662e  y in range(self.
+0000def0: 6f75 745f 6469 6d29 3a0d 0a20 2020 2020  out_dim):..     
+0000df00: 2020 2023 2020 2020 2063 6c61 7373 5f69     #     class_i
+0000df10: 6e64 203d 2074 662e 7371 7565 657a 6528  nd = tf.squeeze(
+0000df20: 7466 2e77 6865 7265 2874 662e 6172 676d  tf.where(tf.argm
+0000df30: 6178 2879 2c20 3129 3d3d 636c 6173 735f  ax(y, 1)==class_
+0000df40: 7929 2923 5b30 5d0d 0a20 2020 2020 2020  y))#[0]..       
+0000df50: 2023 2020 2020 2053 785f 7463 6f6e 765f   #     Sx_tconv_
+0000df60: 6363 6d2e 6170 7065 6e64 2853 785f 7463  ccm.append(Sx_tc
+0000df70: 6f6e 765b 636c 6173 735f 696e 642c 202e  onv[class_ind, .
+0000df80: 2e2e 5d2e 6d65 616e 2830 2929 0d0a 2020  ..].mean(0))..  
+0000df90: 2020 2020 2020 2320 2020 2020 2353 785f        #     #Sx_
+0000dfa0: 646d 785f 6363 6d2e 6170 7065 6e64 2853  dmx_ccm.append(S
+0000dfb0: 785f 646d 785b 636c 6173 735f 696e 642c  x_dmx[class_ind,
+0000dfc0: 202e 2e2e 5d2e 6d65 616e 2830 2c20 6b65   ...].mean(0, ke
+0000dfd0: 6570 6469 6d73 3d54 7275 6529 290d 0a20  epdims=True)).. 
+0000dfe0: 2020 2020 2020 2023 2020 2020 2023 6120         #     #a 
+0000dff0: 3d20 6163 7469 7661 7469 6f6e 735b 2774  = activations['t
+0000e000: 636f 6e76 275d 2e6e 756d 7079 2829 5b63  conv'].numpy()[c
+0000e010: 6c61 7373 5f69 6e64 2c20 2e2e 2e5d 2e6d  lass_ind, ...].m
+0000e020: 6561 6e28 3029 2a77 6569 6768 7473 5b27  ean(0)*weights['
+0000e030: 6f75 745f 7765 6967 6874 7327 5d5b 4e6f  out_weights'][No
+0000e040: 6e65 2c20 2e2e 2e2c 2063 6c61 7373 5f79  ne, ..., class_y
+0000e050: 5d0d 0a20 2020 2020 2020 2023 2020 2020  ]..        #    
+0000e060: 2053 785f 6663 5f63 636d 2e61 7070 656e   Sx_fc_ccm.appen
+0000e070: 6428 6163 7469 7661 7469 6f6e 735b 2766  d(activations['f
+0000e080: 6327 5d2e 6e75 6d70 7928 295b 636c 6173  c'].numpy()[clas
+0000e090: 735f 696e 642c 202e 2e2e 5d2e 6d65 616e  s_ind, ...].mean
+0000e0a0: 2830 2c20 6b65 6570 6469 6d73 3d54 7275  (0, keepdims=Tru
+0000e0b0: 6529 290d 0a20 2020 2020 2020 2023 2020  e))..        #  
+0000e0c0: 2020 2023 2070 6174 7465 726e 735f 6378     # patterns_cx
+0000e0d0: 792e 6170 7065 6e64 286e 702e 646f 7428  y.append(np.dot(
+0000e0e0: 6463 6f76 5b27 636c 6173 735f 636f 6e64  dcov['class_cond
+0000e0f0: 6974 696f 6e61 6c27 5d5b 636c 6173 735f  itional'][class_
+0000e100: 795d 2c0d 0a20 2020 2020 2020 2023 2020  y],..        #  
+0000e110: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000e120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e130: 2020 2020 5378 5f64 6d78 5b63 6c61 7373      Sx_dmx[class
+0000e140: 5f69 6e64 2c20 2e2e 2e5d 2e6d 6561 6e28  _ind, ...].mean(
+0000e150: 3029 2929 0d0a 2020 2020 2020 2020 2320  0)))..        # 
+0000e160: 2020 2020 2370 6174 7465 726e 735f 6378      #patterns_cx
+0000e170: 792e 6170 7065 6e64 286e 702e 646f 7428  y.append(np.dot(
+0000e180: 6463 6f76 5b27 696e 7075 745f 7370 6174  dcov['input_spat
+0000e190: 6961 6c27 5d2c 0d0a 2020 2020 2020 2020  ial'],..        
+0000e1a0: 2320 2020 2020 2320 2020 2020 2020 2020  #     #         
+0000e1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e1c0: 2020 2053 785f 646d 785b 636c 6173 735f     Sx_dmx[class_
+0000e1d0: 696e 642c 202e 2e2e 5d2e 6d65 616e 2830  ind, ...].mean(0
+0000e1e0: 2929 290d 0a20 2020 2020 2020 2023 6363  )))..        #cc
+0000e1f0: 6d73 203d 207b 7d0d 0a20 2020 2020 2020  ms = {}..       
+0000e200: 2023 6363 6d73 5b27 7463 6f6e 7627 5d20   #ccms['tconv'] 
+0000e210: 3d20 6e70 2e63 6f6e 6361 7465 6e61 7465  = np.concatenate
+0000e220: 2853 785f 7463 6f6e 765f 6363 6d2c 2030  (Sx_tconv_ccm, 0
+0000e230: 290d 0a20 2020 2020 2020 2023 6363 6d73  )..        #ccms
+0000e240: 5b27 646d 7827 5d20 3d20 6e70 2e63 6f6e  ['dmx'] = np.con
+0000e250: 6361 7465 6e61 7465 2853 785f 646d 785f  catenate(Sx_dmx_
+0000e260: 6363 6d2c 2030 290d 0a20 2020 2020 2020  ccm, 0)..       
+0000e270: 2023 6363 6d73 5b27 6663 275d 203d 206e   #ccms['fc'] = n
+0000e280: 702e 636f 6e63 6174 656e 6174 6528 5378  p.concatenate(Sx
+0000e290: 5f66 635f 6363 6d2c 2030 290d 0a20 2020  _fc_ccm, 0)..   
+0000e2a0: 2020 2020 200d 0a20 2020 2020 2020 200d       ..        .
+0000e2b0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+0000e2c0: 2020 2070 6174 7465 726e 735f 7374 7275     patterns_stru
+0000e2d0: 6374 5b27 7061 7474 6572 6e73 275d 203d  ct['patterns'] =
+0000e2e0: 2073 656c 662e 5f63 6f6d 7075 7465 5f63   self._compute_c
+0000e2f0: 6f6d 6269 6e65 645f 7061 7474 6572 6e73  ombined_patterns
+0000e300: 2879 2c20 7765 6967 6874 732c 2061 6374  (y, weights, act
+0000e310: 6976 6174 696f 6e73 2c20 6463 6f76 290d  ivations, dcov).
+0000e320: 0a0d 0a20 2020 2020 2020 2023 636f 6d70  ...        #comp
+0000e330: 7574 6520 7468 6520 6566 6665 6374 206f  ute the effect o
+0000e340: 6620 7265 6d6f 7669 6e67 2065 6163 6820  f removing each 
+0000e350: 6c61 7465 6e74 2063 6f6d 706f 6e65 6e74  latent component
+0000e360: 206f 6e20 7468 6520 636f 7374 2066 756e   on the cost fun
+0000e370: 6374 696f 6e0d 0a20 2020 2020 2020 2070  ction..        p
+0000e380: 6174 7465 726e 735f 7374 7275 6374 5b27  atterns_struct['
+0000e390: 636f 6d70 7769 7365 5f6c 6f73 7327 5d20  compwise_loss'] 
+0000e3a0: 3d20 7365 6c66 2e63 6f6d 7075 7465 5f63  = self.compute_c
+0000e3b0: 6f6d 706f 6e65 6e74 7769 7365 5f6c 6f73  omponentwise_los
+0000e3c0: 7328 582c 2079 2c20 7765 6967 6874 7329  s(X, y, weights)
+0000e3d0: 0d0a 2020 2020 2020 2020 2363 6f72 7265  ..        #corre
+0000e3e0: 6c61 7469 6f6e 206f 6620 6663 2061 6374  lation of fc act
+0000e3f0: 6976 6174 696f 6e73 2074 6f20 790d 0a20  ivations to y.. 
+0000e400: 2020 2020 2020 2070 6174 7465 726e 735f         patterns_
+0000e410: 7374 7275 6374 5b27 636f 7272 5f74 6f5f  struct['corr_to_
+0000e420: 6f75 7470 7574 275d 203d 2073 656c 662e  output'] = self.
+0000e430: 6765 745f 6f75 7470 7574 5f63 6f72 7265  get_output_corre
+0000e440: 6c61 7469 6f6e 7328 6163 7469 7661 7469  lations(activati
+0000e450: 6f6e 732c 2079 290d 0a20 2020 2020 2020  ons, y)..       
+0000e460: 2023 7365 6c66 2e6f 7574 5f77 6569 6768   #self.out_weigh
+0000e470: 7473 203d 2077 6569 6768 7473 5b27 6f75  ts = weights['ou
+0000e480: 745f 7765 6967 6874 7327 5d0d 0a20 2020  t_weights']..   
+0000e490: 2020 2020 2064 656c 2058 2c20 6163 7469       del X, acti
+0000e4a0: 7661 7469 6f6e 730d 0a0d 0a20 2020 2020  vations....     
+0000e4b0: 2020 2072 6574 7572 6e20 7061 7474 6572     return patter
+0000e4c0: 6e73 5f73 7472 7563 740d 0a20 2020 2020  ns_struct..     
+0000e4d0: 2020 2023 204f 7468 6572 0d0a 2020 2020     # Other..    
+0000e4e0: 2020 2020 2373 656c 662e 795f 7472 7565      #self.y_true
+0000e4f0: 203d 206e 702e 7371 7565 657a 6528 792e   = np.squeeze(y.
+0000e500: 6e75 6d70 7928 2929 0d0a 2020 2020 0d0a  numpy())..    ..
+0000e510: 2020 2020 6465 6620 5f63 6f6d 7075 7465      def _compute
+0000e520: 5f63 6f6d 6269 6e65 645f 7061 7474 6572  _combined_patter
+0000e530: 6e73 2873 656c 662c 2079 2c20 7765 6967  ns(self, y, weig
+0000e540: 6874 732c 2061 6374 6976 6174 696f 6e73  hts, activations
+0000e550: 2c20 6463 6f76 293a 0d0a 2020 2020 2020  , dcov):..      
+0000e560: 2020 7061 7474 6572 6e73 203d 207b 7d0d    patterns = {}.
+0000e570: 0a20 2020 2020 2020 2070 6174 7465 726e  .        pattern
+0000e580: 735b 2763 6f76 5f78 7827 5d20 3d20 7365  s['cov_xx'] = se
+0000e590: 6c66 2e70 6174 7465 726e 735f 636f 765f  lf.patterns_cov_
+0000e5a0: 7878 2879 2c20 7765 6967 6874 732c 2061  xx(y, weights, a
+0000e5b0: 6374 6976 6174 696f 6e73 2c20 6463 6f76  ctivations, dcov
+0000e5c0: 290d 0a0d 0a20 2020 2020 2020 2023 5378  )....        #Sx
+0000e5d0: 5f74 636f 6e76 2c20 5378 5f64 6d78 203d  _tconv, Sx_dmx =
+0000e5e0: 204e 6f6e 652c 204e 6f6e 6523 7365 6c66   None, None#self
+0000e5f0: 2e70 6174 7465 726e 735f 636f 765f 7879  .patterns_cov_xy
+0000e600: 5f68 6174 2858 2c20 792c 2061 6374 6976  _hat(X, y, activ
+0000e610: 6174 696f 6e73 2c20 7765 6967 6874 7329  ations, weights)
+0000e620: 0d0a 2020 2020 2020 2020 2320 5378 5f74  ..        # Sx_t
+0000e630: 636f 6e76 5f63 636d 203d 205b 5d0d 0a20  conv_ccm = [].. 
+0000e640: 2020 2020 2020 2023 2023 5378 5f64 6d78         # #Sx_dmx
+0000e650: 5f63 636d 203d 205b 5d0d 0a20 2020 2020  _ccm = []..     
+0000e660: 2020 2023 2053 785f 6663 5f63 636d 203d     # Sx_fc_ccm =
+0000e670: 205b 5d0d 0a20 2020 2020 2020 2023 2070   []..        # p
+0000e680: 6174 7465 726e 735f 6378 7920 3d20 5b5d  atterns_cxy = []
+0000e690: 0d0a 2020 2020 2020 2020 2320 666f 7220  ..        # for 
+0000e6a0: 636c 6173 735f 7920 696e 2072 616e 6765  class_y in range
+0000e6b0: 2873 656c 662e 6f75 745f 6469 6d29 3a0d  (self.out_dim):.
+0000e6c0: 0a20 2020 2020 2020 2023 2020 2020 2063  .        #     c
+0000e6d0: 6c61 7373 5f69 6e64 203d 2074 662e 7371  lass_ind = tf.sq
+0000e6e0: 7565 657a 6528 7466 2e77 6865 7265 2874  ueeze(tf.where(t
+0000e6f0: 662e 6172 676d 6178 2879 2c20 3129 3d3d  f.argmax(y, 1)==
+0000e700: 636c 6173 735f 7929 2923 5b30 5d0d 0a20  class_y))#[0].. 
+0000e710: 2020 2020 2020 2023 2020 2020 2053 785f         #     Sx_
+0000e720: 7463 6f6e 765f 6363 6d2e 6170 7065 6e64  tconv_ccm.append
+0000e730: 2853 785f 7463 6f6e 765b 636c 6173 735f  (Sx_tconv[class_
+0000e740: 696e 642c 202e 2e2e 5d2e 6d65 616e 2830  ind, ...].mean(0
+0000e750: 2929 0d0a 2020 2020 2020 2020 2320 2020  ))..        #   
+0000e760: 2020 2353 785f 646d 785f 6363 6d2e 6170    #Sx_dmx_ccm.ap
+0000e770: 7065 6e64 2853 785f 646d 785b 636c 6173  pend(Sx_dmx[clas
+0000e780: 735f 696e 642c 202e 2e2e 5d2e 6d65 616e  s_ind, ...].mean
+0000e790: 2830 2c20 6b65 6570 6469 6d73 3d54 7275  (0, keepdims=Tru
+0000e7a0: 6529 290d 0a20 2020 2020 2020 2023 2020  e))..        #  
+0000e7b0: 2020 2023 6120 3d20 6163 7469 7661 7469     #a = activati
+0000e7c0: 6f6e 735b 2774 636f 6e76 275d 2e6e 756d  ons['tconv'].num
+0000e7d0: 7079 2829 5b63 6c61 7373 5f69 6e64 2c20  py()[class_ind, 
+0000e7e0: 2e2e 2e5d 2e6d 6561 6e28 3029 2a77 6569  ...].mean(0)*wei
+0000e7f0: 6768 7473 5b27 6f75 745f 7765 6967 6874  ghts['out_weight
+0000e800: 7327 5d5b 4e6f 6e65 2c20 2e2e 2e2c 2063  s'][None, ..., c
+0000e810: 6c61 7373 5f79 5d0d 0a20 2020 2020 2020  lass_y]..       
+0000e820: 2023 2020 2020 2053 785f 6663 5f63 636d   #     Sx_fc_ccm
+0000e830: 2e61 7070 656e 6428 6163 7469 7661 7469  .append(activati
+0000e840: 6f6e 735b 2766 6327 5d2e 6e75 6d70 7928  ons['fc'].numpy(
+0000e850: 295b 636c 6173 735f 696e 642c 202e 2e2e  )[class_ind, ...
+0000e860: 5d2e 6d65 616e 2830 2c20 6b65 6570 6469  ].mean(0, keepdi
+0000e870: 6d73 3d54 7275 6529 290d 0a20 2020 2020  ms=True))..     
+0000e880: 2020 2023 2020 2020 2023 2070 6174 7465     #     # patte
+0000e890: 726e 735f 6378 792e 6170 7065 6e64 286e  rns_cxy.append(n
+0000e8a0: 702e 646f 7428 6463 6f76 5b27 636c 6173  p.dot(dcov['clas
+0000e8b0: 735f 636f 6e64 6974 696f 6e61 6c27 5d5b  s_conditional'][
+0000e8c0: 636c 6173 735f 795d 2c0d 0a20 2020 2020  class_y],..     
+0000e8d0: 2020 2023 2020 2020 2023 2020 2020 2020     #     #      
+0000e8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e8f0: 2020 2020 2020 2020 2020 5378 5f64 6d78            Sx_dmx
+0000e900: 5b63 6c61 7373 5f69 6e64 2c20 2e2e 2e5d  [class_ind, ...]
+0000e910: 2e6d 6561 6e28 3029 2929 0d0a 2020 2020  .mean(0)))..    
+0000e920: 2020 2020 2320 2020 2020 2370 6174 7465      #     #patte
+0000e930: 726e 735f 6378 792e 6170 7065 6e64 286e  rns_cxy.append(n
+0000e940: 702e 646f 7428 6463 6f76 5b27 696e 7075  p.dot(dcov['inpu
+0000e950: 745f 7370 6174 6961 6c27 5d2c 0d0a 2020  t_spatial'],..  
+0000e960: 2020 2020 2020 2320 2020 2020 2320 2020        #     #   
+0000e970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e980: 2020 2020 2020 2020 2053 785f 646d 785b           Sx_dmx[
+0000e990: 636c 6173 735f 696e 642c 202e 2e2e 5d2e  class_ind, ...].
+0000e9a0: 6d65 616e 2830 2929 290d 0a20 2020 2020  mean(0)))..     
+0000e9b0: 2020 2023 2063 636d 7320 3d20 7b7d 0d0a     # ccms = {}..
+0000e9c0: 2020 2020 2020 2020 2320 6363 6d73 5b27          # ccms['
+0000e9d0: 7463 6f6e 7627 5d20 3d20 6e70 2e63 6f6e  tconv'] = np.con
+0000e9e0: 6361 7465 6e61 7465 2853 785f 7463 6f6e  catenate(Sx_tcon
+0000e9f0: 765f 6363 6d2c 2030 290d 0a20 2020 2020  v_ccm, 0)..     
+0000ea00: 2020 2023 6363 6d73 5b27 646d 7827 5d20     #ccms['dmx'] 
+0000ea10: 3d20 6e70 2e63 6f6e 6361 7465 6e61 7465  = np.concatenate
+0000ea20: 2853 785f 646d 785f 6363 6d2c 2030 290d  (Sx_dmx_ccm, 0).
+0000ea30: 0a20 2020 2020 2020 2023 6363 6d73 5b27  .        #ccms['
+0000ea40: 6663 275d 203d 206e 702e 636f 6e63 6174  fc'] = np.concat
+0000ea50: 656e 6174 6528 5378 5f66 635f 6363 6d2c  enate(Sx_fc_ccm,
+0000ea60: 2030 290d 0a0d 0a0d 0a20 2020 2020 2020   0)......       
+0000ea70: 2023 7061 7474 6572 6e73 5b27 636f 765f   #patterns['cov_
+0000ea80: 7879 275d 203d 2053 785f 646d 780d 0a20  xy'] = Sx_dmx.. 
+0000ea90: 2020 2020 2020 2070 6174 7465 726e 735b         patterns[
+0000eaa0: 2770 696e 765f 7727 5d20 3d20 7365 6c66  'pinv_w'] = self
+0000eab0: 2e70 6174 7465 726e 735f 7069 6e76 5f77  .patterns_pinv_w
+0000eac0: 2879 2c20 7765 6967 6874 732c 2061 6374  (y, weights, act
+0000ead0: 6976 6174 696f 6e73 2c20 6463 6f76 292e  ivations, dcov).
+0000eae0: 6d65 616e 282d 3129 0d0a 0d0a 2020 2020  mean(-1)....    
+0000eaf0: 2020 2020 7061 7474 6572 6e73 5b27 7766      patterns['wf
+0000eb00: 635f 6d65 616e 275d 203d 2073 656c 662e  c_mean'] = self.
+0000eb10: 7061 7474 6572 6e73 5f77 6663 5f6d 6561  patterns_wfc_mea
+0000eb20: 6e28 792c 2077 6569 6768 7473 2c20 6163  n(y, weights, ac
+0000eb30: 7469 7661 7469 6f6e 732c 2064 636f 7629  tivations, dcov)
+0000eb40: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0000eb50: 2070 6174 7465 726e 730d 0a0d 0a20 2020   patterns....   
+0000eb60: 2064 6566 2063 6f6c 6c65 6374 5f70 6174   def collect_pat
+0000eb70: 7465 726e 7328 7365 6c66 2c20 666f 6c64  terns(self, fold
+0000eb80: 3d30 2c20 6e5f 666f 6c64 733d 312c 206e  =0, n_folds=1, n
+0000eb90: 5f63 6f6d 703d 312c 0d0a 2020 2020 2020  _comp=1,..      
+0000eba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ebb0: 2020 206d 6574 686f 6473 3d5b 2777 6569     methods=['wei
+0000ebc0: 6768 7427 2c20 0d0a 2020 2020 2020 2020  ght', ..        
+0000ebd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ebe0: 2020 2020 2020 2020 2020 2763 6f6d 7077            'compw
+0000ebf0: 6973 655f 6c6f 7373 272c 0d0a 2020 2020  ise_loss',..    
+0000ec00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec10: 2020 2020 2020 2020 2020 2020 2020 2777                'w
+0000ec20: 6569 6768 745f 6e6f 726d 272c 200d 0a20  eight_norm', .. 
+0000ec30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec50: 2023 2761 6273 5f77 6569 6768 7427 2c20   #'abs_weight', 
+0000ec60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000ec70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec80: 2020 2020 276f 7574 7075 745f 636f 7272      'output_corr
+0000ec90: 270d 0a20 2020 2020 2020 2020 2020 2020  '..             
+0000eca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ecb0: 2020 2020 205d 293a 0d0a 2020 2020 2020       ]):..      
+0000ecc0: 2020 2222 220d 0a20 2020 2020 2020 2043    """..        C
+0000ecd0: 6f6d 7075 7465 2061 6e64 2073 746f 7265  ompute and store
+0000ece0: 2070 6174 7465 726e 7320 6475 7269 6e67   patterns during
+0000ecf0: 2063 726f 7373 2d76 616c 6964 6174 696f   cross-validatio
+0000ed00: 6e2e 0d0a 0d0a 2020 2020 2020 2020 2222  n.....        ""
+0000ed10: 220d 0a0d 0a20 2020 2020 2020 2070 6174  "....        pat
+0000ed20: 7465 726e 735f 7374 7275 6374 203d 2073  terns_struct = s
+0000ed30: 656c 662e 636f 6d70 7574 655f 7061 7474  elf.compute_patt
+0000ed40: 6572 6e73 2829 2020 2020 2020 2020 0d0a  erns()        ..
+0000ed50: 2020 2020 2020 2020 636f 6d62 696e 6564          combined
+0000ed60: 5f6d 6574 686f 6473 203d 206c 6973 7428  _methods = list(
+0000ed70: 7061 7474 6572 6e73 5f73 7472 7563 745b  patterns_struct[
+0000ed80: 2770 6174 7465 726e 7327 5d2e 6b65 7973  'patterns'].keys
+0000ed90: 2829 290d 0a20 2020 2020 2020 206d 6574  ())..        met
+0000eda0: 686f 6473 202b 3d20 636f 6d62 696e 6564  hods += combined
+0000edb0: 5f6d 6574 686f 6473 0d0a 2020 2020 2020  _methods..      
+0000edc0: 2020 6966 206c 656e 2873 656c 662e 6376    if len(self.cv
+0000edd0: 5f70 6174 7465 726e 732e 6974 656d 7328  _patterns.items(
+0000ede0: 2929 203d 3d20 3020 6f72 2066 6f6c 643d  )) == 0 or fold=
+0000edf0: 3d30 3a0d 0a20 2020 2020 2020 2020 2020  =0:..           
+0000ee00: 206e 5f63 6820 3d20 7365 6c66 2e6d 6574   n_ch = self.met
+0000ee10: 612e 6461 7461 5b27 6e5f 6368 275d 0d0a  a.data['n_ch']..
+0000ee20: 2020 2020 2020 2020 2020 2020 6e5f 7420              n_t 
+0000ee30: 3d20 7061 7474 6572 6e73 5f73 7472 7563  = patterns_struc
+0000ee40: 745b 2777 6569 6768 7473 275d 5b27 6f75  t['weights']['ou
+0000ee50: 745f 7765 6967 6874 7327 5d2e 7368 6170  t_weights'].shap
+0000ee60: 655b 305d 0d0a 2020 2020 2020 2020 2020  e[0]..          
+0000ee70: 2020 7365 6c66 2e63 765f 7061 7474 6572    self.cv_patter
+0000ee80: 6e73 203d 2064 6566 6175 6c74 6469 6374  ns = defaultdict
+0000ee90: 2864 6963 7429 0d0a 2020 2020 2020 2020  (dict)..        
+0000eea0: 2020 2020 7365 6c66 2e63 765f 7061 7474      self.cv_patt
+0000eeb0: 6572 6e73 5b27 6672 6571 7327 5d20 3d20  erns['freqs'] = 
+0000eec0: 7061 7474 6572 6e73 5f73 7472 7563 745b  patterns_struct[
+0000eed0: 2766 7265 7173 275d 0d0a 2020 2020 2020  'freqs']..      
+0000eee0: 2020 2020 2020 7365 6c66 2e63 765f 7061        self.cv_pa
+0000eef0: 7474 6572 6e73 5b27 6463 6f76 275d 5b27  tterns['dcov']['
+0000ef00: 696e 7075 745f 7370 6174 6961 6c27 5d20  input_spatial'] 
+0000ef10: 3d20 6e70 2e7a 6572 6f73 285b 6e5f 6368  = np.zeros([n_ch
+0000ef20: 2c20 6e5f 6368 2c0d 0a20 2020 2020 2020  , n_ch,..       
+0000ef30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef60: 2020 2020 2020 2020 2020 206e 5f66 6f6c             n_fol
+0000ef70: 6473 5d29 0d0a 2020 2020 2020 2020 2020  ds])..          
+0000ef80: 2020 7365 6c66 2e63 765f 7061 7474 6572    self.cv_patter
+0000ef90: 6e73 5b27 6463 6f76 275d 5b27 636c 6173  ns['dcov']['clas
+0000efa0: 735f 636f 6e64 6974 696f 6e61 6c27 5d20  s_conditional'] 
+0000efb0: 3d20 6e70 2e7a 6572 6f73 285b 7365 6c66  = np.zeros([self
+0000efc0: 2e79 5f73 6861 7065 5b30 5d2c 0d0a 2020  .y_shape[0],..  
+0000efd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000efe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f010: 2020 2020 206e 5f63 682c 206e 5f63 682c       n_ch, n_ch,
+0000f020: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000f030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f060: 2020 2020 2020 2020 206e 5f66 6f6c 6473           n_folds
+0000f070: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+0000f080: 7365 6c66 2e63 765f 7061 7474 6572 6e73  self.cv_patterns
+0000f090: 5b27 6463 6f76 275d 5b27 6b2d 3127 5d20  ['dcov']['k-1'] 
+0000f0a0: 3d20 6e70 2e7a 6572 6f73 285b 7365 6c66  = np.zeros([self
+0000f0b0: 2e79 5f73 6861 7065 5b30 5d2c 0d0a 2020  .y_shape[0],..  
 0000f0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f0d0: 2020 2020 2020 7365 6c66 2e79 5f73 6861        self.y_sha
-0000f0e0: 7065 5b30 5d2c 0d0a 2020 2020 2020 2020  pe[0],..        
-0000f0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0f0: 2020 2020 2020 6e5f 6368 2c20 6e5f 6368        n_ch, n_ch
+0000f100: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
 0000f110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f120: 2020 2020 2020 2020 6e5f 666f 6c64 735d          n_folds]
-0000f130: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000f140: 2020 2073 656c 662e 6376 5f70 6174 7465     self.cv_patte
-0000f150: 726e 735b 6d65 7468 6f64 5d5b 2774 656d  rns[method]['tem
-0000f160: 706f 7261 6c27 5d20 3d20 6e70 2e7a 6572  poral'] = np.zer
-0000f170: 6f73 285b 7365 6c66 2e6e 6666 742c 0d0a  os([self.nfft,..
-0000f180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f1c0: 2073 656c 662e 795f 7368 6170 655b 305d   self.y_shape[0]
-0000f1d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000f1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f130: 2020 2020 2020 2020 2020 206e 5f66 6f6c             n_fol
+0000f140: 6473 5d29 0d0a 2020 2020 2020 2020 2020  ds])..          
+0000f150: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
+0000f160: 666f 7220 6d65 7468 6f64 2069 6e20 6d65  for method in me
+0000f170: 7468 6f64 733a 0d0a 2020 2020 2020 2020  thods:..        
+0000f180: 2020 2020 236e 5f66 6f6c 6473 203d 206c      #n_folds = l
+0000f190: 656e 2873 656c 662e 6461 7461 7365 742e  en(self.dataset.
+0000f1a0: 685f 7061 7261 6d73 5b27 666f 6c64 7327  h_params['folds'
+0000f1b0: 5d5b 305d 290d 0a20 2020 2020 2020 2020  ][0])..         
+0000f1c0: 2020 2020 2020 2073 656c 662e 6376 5f70         self.cv_p
+0000f1d0: 6174 7465 726e 735b 6d65 7468 6f64 5d5b  atterns[method][
+0000f1e0: 2773 7061 7469 616c 275d 203d 206e 702e  'spatial'] = np.
+0000f1f0: 7a65 726f 7328 5b6e 5f63 682c 0d0a 2020  zeros([n_ch,..  
 0000f200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f210: 2020 2020 6e5f 666f 6c64 735d 290d 0a20      n_folds]).. 
-0000f220: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000f230: 656c 662e 6376 5f70 6174 7465 726e 735b  elf.cv_patterns[
-0000f240: 6d65 7468 6f64 5d5b 2770 7364 7327 5d20  method]['psds'] 
-0000f250: 3d20 6e70 2e7a 6572 6f73 285b 7365 6c66  = np.zeros([self
-0000f260: 2e6e 6666 742c 0d0a 2020 2020 2020 2020  .nfft,..        
+0000f210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f230: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000f240: 6c66 2e79 5f73 6861 7065 5b30 5d2c 0d0a  lf.y_shape[0],..
+0000f250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f260: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000f270: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000f280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f2a0: 2020 2020 2073 656c 662e 795f 7368 6170       self.y_shap
-0000f2b0: 655b 305d 2c0d 0a20 2020 2020 2020 2020  e[0],..         
-0000f2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f2f0: 2020 2020 6e5f 666f 6c64 735d 290d 0a20      n_folds]).. 
-0000f300: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000f310: 656c 662e 6376 5f70 6174 7465 726e 735b  elf.cv_patterns[
-0000f320: 6d65 7468 6f64 5d5b 2766 6561 7475 7265  method]['feature
-0000f330: 5f72 656c 6576 616e 6365 275d 203d 206e  _relevance'] = n
-0000f340: 702e 7a65 726f 7328 5b6e 5f74 2c0d 0a20  p.zeros([n_t,.. 
+0000f290: 6e5f 666f 6c64 735d 290d 0a20 2020 2020  n_folds])..     
+0000f2a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000f2b0: 6376 5f70 6174 7465 726e 735b 6d65 7468  cv_patterns[meth
+0000f2c0: 6f64 5d5b 2774 656d 706f 7261 6c27 5d20  od]['temporal'] 
+0000f2d0: 3d20 6e70 2e7a 6572 6f73 285b 7365 6c66  = np.zeros([self
+0000f2e0: 2e6e 6666 742c 0d0a 2020 2020 2020 2020  .nfft,..        
+0000f2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f320: 2020 2020 2020 2020 2073 656c 662e 795f           self.y_
+0000f330: 7368 6170 655b 305d 2c0d 0a20 2020 2020  shape[0],..     
+0000f340: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000f350: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000f360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f380: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000f390: 2e73 7065 6373 5b27 6e5f 6c61 7465 6e74  .specs['n_latent
-0000f3a0: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
-0000f3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f370: 2020 2020 2020 2020 2020 2020 6e5f 666f              n_fo
+0000f380: 6c64 735d 290d 0a20 2020 2020 2020 2020  lds])..         
+0000f390: 2020 2020 2020 2073 656c 662e 6376 5f70         self.cv_p
+0000f3a0: 6174 7465 726e 735b 6d65 7468 6f64 5d5b  atterns[method][
+0000f3b0: 2770 7364 7327 5d20 3d20 6e70 2e7a 6572  'psds'] = np.zer
+0000f3c0: 6f73 285b 7365 6c66 2e6e 6666 742c 0d0a  os([self.nfft,..
 0000f3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f3e0: 2020 7365 6c66 2e79 5f73 6861 7065 5b30    self.y_shape[0
-0000f3f0: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-0000f400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f400: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000f410: 662e 795f 7368 6170 655b 305d 2c0d 0a20  f.y_shape[0],.. 
 0000f420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f430: 206e 5f66 6f6c 6473 5d29 0d0a 2020 2020   n_folds])..    
-0000f440: 2020 2020 666f 7220 6d65 7468 6f64 2069      for method i
-0000f450: 6e20 6d65 7468 6f64 733a 0d0a 0d0a 2020  n methods:....  
-0000f460: 2020 2020 2020 2020 2020 6966 206d 6574            if met
-0000f470: 686f 6420 6e6f 7420 696e 2063 6f6d 6269  hod not in combi
-0000f480: 6e65 645f 6d65 7468 6f64 733a 0d0a 2020  ned_methods:..  
-0000f490: 2020 2020 2020 2020 2020 2020 2020 2363                #c
-0000f4a0: 6f6c 6c65 6374 2073 7061 7469 616c 2070  ollect spatial p
-0000f4b0: 6174 7465 726e 7320 666f 7220 2777 6569  atterns for 'wei
-0000f4c0: 6768 7427 2073 6f72 7469 6e67 0d0a 2020  ght' sorting..  
-0000f4d0: 2020 2020 2020 2020 2020 2020 2020 746f                to
-0000f4e0: 706f 2c20 7370 6563 7472 612c 2070 7364  po, spectra, psd
-0000f4f0: 7320 3d20 7365 6c66 2e73 696e 676c 655f  s = self.single_
-0000f500: 636f 6d70 6f6e 656e 745f 7061 7474 6572  component_patter
-0000f510: 6e28 7061 7474 6572 6e73 5f73 7472 7563  n(patterns_struc
-0000f520: 742c 0d0a 2020 2020 2020 2020 2020 2020  t,..            
+0000f430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f450: 2020 2020 2020 2020 2020 2020 6e5f 666f              n_fo
+0000f460: 6c64 735d 290d 0a20 2020 2020 2020 2020  lds])..         
+0000f470: 2020 2020 2020 2073 656c 662e 6376 5f70         self.cv_p
+0000f480: 6174 7465 726e 735b 6d65 7468 6f64 5d5b  atterns[method][
+0000f490: 2766 6561 7475 7265 5f72 656c 6576 616e  'feature_relevan
+0000f4a0: 6365 275d 203d 206e 702e 7a65 726f 7328  ce'] = np.zeros(
+0000f4b0: 5b6e 5f74 2c0d 0a20 2020 2020 2020 2020  [n_t,..         
+0000f4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f4f0: 2020 2020 7365 6c66 2e73 7065 6373 5b27      self.specs['
+0000f500: 6e5f 6c61 7465 6e74 275d 2c0d 0a20 2020  n_latent'],..   
+0000f510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f520: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000f530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f560: 2020 2020 2020 2020 736f 7274 696e 673d          sorting=
-0000f570: 6d65 7468 6f64 2c0d 0a20 2020 2020 2020  method,..       
+0000f540: 2020 2020 2020 2020 2020 7365 6c66 2e79            self.y
+0000f550: 5f73 6861 7065 5b30 5d2c 0d0a 2020 2020  _shape[0],..    
+0000f560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f570: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000f580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f5b0: 2020 2020 2020 2020 2020 2020 206e 5f63               n_c
-0000f5c0: 6f6d 703d 6e5f 636f 6d70 290d 0a20 2020  omp=n_comp)..   
-0000f5d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000f5e0: 662e 6376 5f70 6174 7465 726e 735b 6d65  f.cv_patterns[me
-0000f5f0: 7468 6f64 5d5b 2773 7061 7469 616c 275d  thod]['spatial']
-0000f600: 5b3a 2c20 3a2c 2066 6f6c 645d 203d 2074  [:, :, fold] = t
-0000f610: 6f70 6f0d 0a20 2020 2020 2020 2020 2020  opo..           
-0000f620: 2020 2020 2073 656c 662e 6376 5f70 6174       self.cv_pat
-0000f630: 7465 726e 735b 6d65 7468 6f64 5d5b 2774  terns[method]['t
-0000f640: 656d 706f 7261 6c27 5d5b 3a2c 203a 2c20  emporal'][:, :, 
-0000f650: 666f 6c64 5d20 3d20 7370 6563 7472 610d  fold] = spectra.
-0000f660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f670: 2073 656c 662e 6376 5f70 6174 7465 726e   self.cv_pattern
-0000f680: 735b 6d65 7468 6f64 5d5b 2770 7364 7327  s[method]['psds'
-0000f690: 5d5b 3a2c 203a 2c20 666f 6c64 5d20 3d20  ][:, :, fold] = 
-0000f6a0: 7073 6473 0d0a 2020 2020 2020 2020 2020  psds..          
-0000f6b0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-0000f6c0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-0000f6d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000f6e0: 6376 5f70 6174 7465 726e 735b 6d65 7468  cv_patterns[meth
-0000f6f0: 6f64 5d5b 2773 7061 7469 616c 275d 5b3a  od]['spatial'][:
-0000f700: 2c20 3a2c 2066 6f6c 645d 203d 2070 6174  , :, fold] = pat
-0000f710: 7465 726e 735f 7374 7275 6374 5b27 7061  terns_struct['pa
-0000f720: 7474 6572 6e73 275d 5b6d 6574 686f 645d  tterns'][method]
-0000f730: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-0000f740: 2020 2020 7365 6c66 2e63 765f 7061 7474      self.cv_patt
-0000f750: 6572 6e73 5b27 6463 6f76 275d 5b27 696e  erns['dcov']['in
-0000f760: 7075 745f 7370 6174 6961 6c27 5d5b 3a2c  put_spatial'][:,
-0000f770: 203a 2c20 666f 6c64 5d20 3d20 7061 7474   :, fold] = patt
-0000f780: 6572 6e73 5f73 7472 7563 745b 2764 636f  erns_struct['dco
-0000f790: 7627 5d5b 2769 6e70 7574 5f73 7061 7469  v']['input_spati
-0000f7a0: 616c 275d 0d0a 2020 2020 2020 2020 7365  al']..        se
-0000f7b0: 6c66 2e63 765f 7061 7474 6572 6e73 5b27  lf.cv_patterns['
-0000f7c0: 6463 6f76 275d 5b27 636c 6173 735f 636f  dcov']['class_co
-0000f7d0: 6e64 6974 696f 6e61 6c27 5d5b 3a2c 203a  nditional'][:, :
-0000f7e0: 2c20 3a2c 2066 6f6c 645d 203d 2070 6174  , :, fold] = pat
-0000f7f0: 7465 726e 735f 7374 7275 6374 5b27 6463  terns_struct['dc
-0000f800: 6f76 275d 5b27 636c 6173 735f 636f 6e64  ov']['class_cond
-0000f810: 6974 696f 6e61 6c27 5d0d 0a20 2020 2020  itional']..     
-0000f820: 2020 2073 656c 662e 6376 5f70 6174 7465     self.cv_patte
-0000f830: 726e 735b 2763 6f6d 7077 6973 655f 6c6f  rns['compwise_lo
-0000f840: 7373 275d 5b27 6665 6174 7572 655f 7265  ss']['feature_re
-0000f850: 6c65 7661 6e63 6527 5d5b 3a2c 203a 2c20  levance'][:, :, 
-0000f860: 3a2c 2066 6f6c 645d 203d 2070 6174 7465  :, fold] = patte
-0000f870: 726e 735f 7374 7275 6374 5b27 636f 6d70  rns_struct['comp
-0000f880: 7769 7365 5f6c 6f73 7327 5d0d 0a20 2020  wise_loss']..   
-0000f890: 2020 2020 2073 656c 662e 6376 5f70 6174       self.cv_pat
-0000f8a0: 7465 726e 735b 276f 7574 7075 745f 636f  terns['output_co
-0000f8b0: 7272 275d 5b27 6665 6174 7572 655f 7265  rr']['feature_re
-0000f8c0: 6c65 7661 6e63 6527 5d5b 3a2c 203a 2c20  levance'][:, :, 
-0000f8d0: 3a2c 2066 6f6c 645d 203d 2070 6174 7465  :, fold] = patte
-0000f8e0: 726e 735f 7374 7275 6374 5b27 636f 7272  rns_struct['corr
-0000f8f0: 5f74 6f5f 6f75 7470 7574 275d 0d0a 2020  _to_output']..  
-0000f900: 2020 2020 2020 7365 6c66 2e63 765f 7061        self.cv_pa
-0000f910: 7474 6572 6e73 5b27 7765 6967 6874 275d  tterns['weight']
-0000f920: 5b27 6665 6174 7572 655f 7265 6c65 7661  ['feature_releva
-0000f930: 6e63 6527 5d5b 3a2c 203a 2c20 3a2c 2066  nce'][:, :, :, f
-0000f940: 6f6c 645d 203d 2070 6174 7465 726e 735f  old] = patterns_
-0000f950: 7374 7275 6374 5b27 7765 6967 6874 7327  struct['weights'
-0000f960: 5d5b 276f 7574 5f77 6569 6768 7473 275d  ]['out_weights']
-0000f970: 0d0a 2020 2020 2020 2020 5b73 656c 662e  ..        [self.
-0000f980: 6376 5f77 6569 6768 7473 5b6b 5d2e 6170  cv_weights[k].ap
-0000f990: 7065 6e64 2870 6174 7465 726e 735f 7374  pend(patterns_st
-0000f9a0: 7275 6374 5b27 7765 6967 6874 7327 5d5b  ruct['weights'][
-0000f9b0: 6b5d 2920 0d0a 2020 2020 2020 2020 2066  k]) ..         f
-0000f9c0: 6f72 206b 2069 6e20 7061 7474 6572 6e73  or k in patterns
-0000f9d0: 5f73 7472 7563 745b 2777 6569 6768 7473  _struct['weights
-0000f9e0: 275d 2e6b 6579 7328 295d 0d0a 0d0a 2020  '].keys()]....  
-0000f9f0: 2020 6465 6620 6765 745f 7370 6563 7472    def get_spectr
-0000fa00: 6128 7365 6c66 2c20 7765 6967 6874 732c  a(self, weights,
-0000fa10: 2061 6374 6976 6174 696f 6e73 2c20 6e66   activations, nf
-0000fa20: 6674 3d31 3238 293a 0d0a 2020 2020 2020  ft=128):..      
-0000fa30: 2020 2323 5073 6473 2061 6e64 2066 7265    ##Psds and fre
-0000fa40: 7120 7265 7370 6f6e 7365 730d 0a20 2020  q responses..   
-0000fa50: 2020 2020 2023 2020 436f 6d70 7574 6520       #  Compute 
-0000fa60: 6672 6571 7565 6e63 7920 7265 7370 6f6e  frequency respon
-0000fa70: 7365 7320 616e 6420 736f 7572 6365 2073  ses and source s
-0000fa80: 7065 6374 7261 0d0a 2020 2020 2020 2020  pectra..        
-0000fa90: 7265 616c 6820 3d20 5b5d 0d0a 2020 2020  realh = []..    
-0000faa0: 2020 2020 7073 6473 203d 205b 5d0d 0a20      psds = [].. 
-0000fab0: 2020 2020 2020 2066 6f72 2069 2c20 666c         for i, fl
-0000fac0: 7420 696e 2065 6e75 6d65 7261 7465 2877  t in enumerate(w
-0000fad0: 6569 6768 7473 5b27 7463 6f6e 7627 5d2e  eights['tconv'].
-0000fae0: 5429 3a0d 0a20 2020 2020 2020 2020 2020  T):..           
-0000faf0: 2066 6c74 202d 3d20 666c 742e 6d65 616e   flt -= flt.mean
-0000fb00: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-0000fb10: 2366 6c74 202d 3d20 7365 6c66 2e74 5f63  #flt -= self.t_c
-0000fb20: 6f6e 765f 6269 6173 6573 5b69 5d2f 7365  onv_biases[i]/se
-0000fb30: 6c66 2e73 7065 6373 5b27 6669 6c74 6572  lf.specs['filter
-0000fb40: 5f6c 656e 6774 6827 5d0d 0a20 2020 2020  _length']..     
-0000fb50: 2020 2020 2020 206c 7463 203d 2061 6374         ltc = act
-0000fb60: 6976 6174 696f 6e73 5b27 646d 7827 5d5b  ivations['dmx'][
-0000fb70: 3a2c 2030 2c20 3a2c 2069 5d20 2d20 6e70  :, 0, :, i] - np
-0000fb80: 2e6d 6561 6e28 6163 7469 7661 7469 6f6e  .mean(activation
-0000fb90: 735b 2764 6d78 275d 5b3a 2c20 302c 203a  s['dmx'][:, 0, :
-0000fba0: 2c20 695d 2c20 6178 6973 3d31 2c20 6b65  , i], axis=1, ke
-0000fbb0: 6570 6469 6d73 3d54 7275 6529 0d0a 2020  epdims=True)..  
-0000fbc0: 2020 2020 2020 2020 2020 6672 2c20 7073            fr, ps
-0000fbd0: 6420 3d20 7765 6c63 6828 6c74 632c 0d0a  d = welch(ltc,..
-0000fbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fbf0: 2020 2020 2020 2020 2020 2020 6673 3d73              fs=s
-0000fc00: 656c 662e 6461 7461 7365 742e 685f 7061  elf.dataset.h_pa
-0000fc10: 7261 6d73 5b27 6673 275d 2c0d 0a20 2020  rams['fs'],..   
-0000fc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc30: 2020 2020 2020 2020 206e 6666 743d 6e66           nfft=nf
-0000fc40: 6674 202a 2032 2c0d 0a20 2020 2020 2020  ft * 2,..       
-0000fc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc60: 2020 2020 206e 7065 7273 6567 3d6e 6666       nperseg=nff
-0000fc70: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
-0000fc80: 6966 206c 656e 2866 725b 3a2d 315d 2920  if len(fr[:-1]) 
-0000fc90: 3c20 6e66 6674 3a0d 0a20 2020 2020 2020  < nfft:..       
-0000fca0: 2020 2020 2020 2020 206e 6666 7420 3d20           nfft = 
-0000fcb0: 6c65 6e28 6672 5b3a 2d31 5d29 0d0a 0d0a  len(fr[:-1])....
-0000fcc0: 2020 2020 2020 2020 2020 2020 772c 2068              w, h
-0000fcd0: 203d 2066 7265 717a 2866 6c74 2c20 312c   = freqz(flt, 1,
-0000fce0: 2077 6f72 4e3d 6e66 6674 2c20 6673 203d   worN=nfft, fs =
-0000fcf0: 2073 656c 662e 6461 7461 7365 742e 685f   self.dataset.h_
-0000fd00: 7061 7261 6d73 5b27 6673 275d 290d 0a0d  params['fs'])...
-0000fd10: 0a20 2020 2020 2020 2020 2020 2070 7364  .            psd
-0000fd20: 732e 6170 7065 6e64 2870 7364 5b3a 2c20  s.append(psd[:, 
-0000fd30: 3a2d 315d 2e6d 6561 6e28 3029 290d 0a20  :-1].mean(0)).. 
-0000fd40: 2020 2020 2020 2020 2020 2072 6561 6c68             realh
-0000fd50: 2e61 7070 656e 6428 6e70 2e61 6273 2868  .append(np.abs(h
-0000fd60: 2929 0d0a 0d0a 2020 2020 2020 2020 7370  ))....        sp
-0000fd70: 6563 7472 6120 3d20 7b7d 0d0a 2020 2020  ectra = {}..    
-0000fd80: 2020 2020 7370 6563 7472 615b 2766 7265      spectra['fre
-0000fd90: 715f 7265 7370 6f6e 7365 7327 5d20 3d20  q_responses'] = 
-0000fda0: 6e70 2e61 7272 6179 2872 6561 6c68 290d  np.array(realh).
-0000fdb0: 0a20 2020 2020 2020 2073 7065 6374 7261  .        spectra
-0000fdc0: 5b27 7073 6473 275d 203d 206e 702e 6172  ['psds'] = np.ar
-0000fdd0: 7261 7928 7073 6473 290d 0a20 2020 2020  ray(psds)..     
-0000fde0: 2020 2073 7065 6374 7261 5b27 6672 6571     spectra['freq
-0000fdf0: 7327 5d20 3d20 770d 0a20 2020 2020 2020  s'] = w..       
-0000fe00: 2072 6574 7572 6e20 7370 6563 7472 610d   return spectra.
-0000fe10: 0a0d 0a0d 0a0d 0a20 2020 2064 6566 2067  .......    def g
-0000fe20: 6574 5f77 6569 6768 7473 2873 656c 662c  et_weights(self,
-0000fe30: 2076 6572 626f 7365 3d46 616c 7365 293a   verbose=False):
-0000fe40: 0d0a 2020 2020 2020 2020 7765 6967 6874  ..        weight
-0000fe50: 7320 3d20 7b7d 0d0a 2020 2020 2020 2020  s = {}..        
-0000fe60: 2320 4578 7472 6163 7420 7765 6967 6874  # Extract weight
-0000fe70: 730d 0a20 2020 2020 2020 2023 2053 7061  s..        # Spa
-0000fe80: 7469 616c 2065 7874 7261 6374 696f 6e20  tial extraction 
-0000fe90: 6669 7465 7273 0d0a 2020 2020 2020 2020  fiters..        
-0000fea0: 7765 6967 6874 735b 2764 6d78 275d 203d  weights['dmx'] =
-0000feb0: 206e 702e 7371 7565 657a 6528 7365 6c66   np.squeeze(self
-0000fec0: 2e64 6d78 2e77 2e6e 756d 7079 2829 290d  .dmx.w.numpy()).
-0000fed0: 0a20 2020 2020 2020 2077 6569 6768 7473  .        weights
-0000fee0: 5b27 646d 785f 6227 5d20 3d20 7365 6c66  ['dmx_b'] = self
-0000fef0: 2e64 6d78 2e62 5f69 6e2e 6e75 6d70 7928  .dmx.b_in.numpy(
-0000ff00: 290d 0a20 2020 2020 2020 2023 2054 656d  )..        # Tem
-0000ff10: 706f 7261 6c20 6b65 726e 656c 730d 0a20  poral kernels.. 
-0000ff20: 2020 2020 2020 2077 6569 6768 7473 5b27         weights['
-0000ff30: 7463 6f6e 7627 5d20 3d20 6e70 2e73 7175  tconv'] = np.squ
-0000ff40: 6565 7a65 2873 656c 662e 7463 6f6e 762e  eeze(self.tconv.
-0000ff50: 6669 6c74 6572 732e 6e75 6d70 7928 2929  filters.numpy())
-0000ff60: 0d0a 2020 2020 2020 2020 7765 6967 6874  ..        weight
-0000ff70: 735b 2774 636f 6e76 5f62 275d 203d 206e  s['tconv_b'] = n
-0000ff80: 702e 7371 7565 657a 6528 7365 6c66 2e74  p.squeeze(self.t
-0000ff90: 636f 6e76 2e62 2e6e 756d 7079 2829 290d  conv.b.numpy()).
-0000ffa0: 0a20 2020 2020 2020 2023 2046 696e 616c  .        # Final
-0000ffb0: 206c 6179 6572 0d0a 2020 2020 2020 2020   layer..        
-0000ffc0: 7765 6967 6874 735b 276f 7574 5f77 5f66  weights['out_w_f
-0000ffd0: 6c61 7427 5d20 3d20 7365 6c66 2e66 696e  lat'] = self.fin
-0000ffe0: 5f66 632e 772e 6e75 6d70 7928 290d 0a20  _fc.w.numpy().. 
-0000fff0: 2020 2020 2020 2077 6569 6768 7473 5b27         weights['
-00010000: 6f75 745f 7765 6967 6874 7327 5d20 3d20  out_weights'] = 
-00010010: 6e70 2e72 6573 6861 7065 2873 656c 662e  np.reshape(self.
-00010020: 6669 6e5f 6663 2e77 2e6e 756d 7079 2829  fin_fc.w.numpy()
-00010030: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00010040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010050: 2020 2020 5b73 656c 662e 706f 6f6c 6564      [self.pooled
-00010060: 2e73 6861 7065 5b32 5d2c 0d0a 2020 2020  .shape[2],..    
-00010070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010080: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00010090: 6c66 2e64 6d78 2e73 697a 652c 0d0a 2020  lf.dmx.size,..  
-000100a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000100b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000100c0: 7365 6c66 2e6f 7574 5f64 696d 5d2c 0d0a  self.out_dim],..
-000100d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000100e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000100f0: 206f 7264 6572 3d27 4327 290d 0a20 2020   order='C')..   
-00010100: 2020 2020 2077 6569 6768 7473 5b27 6663       weights['fc
-00010110: 5f62 275d 203d 2073 656c 662e 6669 6e5f  _b'] = self.fin_
-00010120: 6663 2e62 2e6e 756d 7079 2829 0d0a 2020  fc.b.numpy()..  
-00010130: 2020 2020 2020 6966 2076 6572 626f 7365        if verbose
-00010140: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
-00010150: 7269 6e74 2822 2222 2257 6569 6768 7473  rint(""""Weights
-00010160: 3a20 5c6e 0d0a 2020 2020 2020 2020 2020  : \n..          
-00010170: 2020 2020 2020 2020 444d 583a 207b 7d0d          DMX: {}.
-00010180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010190: 2020 2054 434f 4e56 3a20 7b7d 0d0a 2020     TCONV: {}..  
+0000f590: 2020 2020 2020 2020 206e 5f66 6f6c 6473           n_folds
+0000f5a0: 5d29 0d0a 2020 2020 2020 2020 666f 7220  ])..        for 
+0000f5b0: 6d65 7468 6f64 2069 6e20 6d65 7468 6f64  method in method
+0000f5c0: 733a 0d0a 0d0a 2020 2020 2020 2020 2020  s:....          
+0000f5d0: 2020 6966 206d 6574 686f 6420 6e6f 7420    if method not 
+0000f5e0: 696e 2063 6f6d 6269 6e65 645f 6d65 7468  in combined_meth
+0000f5f0: 6f64 733a 0d0a 2020 2020 2020 2020 2020  ods:..          
+0000f600: 2020 2020 2020 2363 6f6c 6c65 6374 2073        #collect s
+0000f610: 7061 7469 616c 2070 6174 7465 726e 7320  patial patterns 
+0000f620: 666f 7220 2777 6569 6768 7427 2073 6f72  for 'weight' sor
+0000f630: 7469 6e67 0d0a 2020 2020 2020 2020 2020  ting..          
+0000f640: 2020 2020 2020 746f 706f 2c20 7370 6563        topo, spec
+0000f650: 7472 612c 2070 7364 7320 3d20 7365 6c66  tra, psds = self
+0000f660: 2e73 696e 676c 655f 636f 6d70 6f6e 656e  .single_componen
+0000f670: 745f 7061 7474 6572 6e28 7061 7474 6572  t_pattern(patter
+0000f680: 6e73 5f73 7472 7563 742c 0d0a 2020 2020  ns_struct,..    
+0000f690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f6d0: 736f 7274 696e 673d 6d65 7468 6f64 2c0d  sorting=method,.
+0000f6e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f720: 2020 2020 206e 5f63 6f6d 703d 6e5f 636f       n_comp=n_co
+0000f730: 6d70 290d 0a20 2020 2020 2020 2020 2020  mp)..           
+0000f740: 2020 2020 2073 656c 662e 6376 5f70 6174       self.cv_pat
+0000f750: 7465 726e 735b 6d65 7468 6f64 5d5b 2773  terns[method]['s
+0000f760: 7061 7469 616c 275d 5b3a 2c20 3a2c 2066  patial'][:, :, f
+0000f770: 6f6c 645d 203d 2074 6f70 6f0d 0a20 2020  old] = topo..   
+0000f780: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000f790: 662e 6376 5f70 6174 7465 726e 735b 6d65  f.cv_patterns[me
+0000f7a0: 7468 6f64 5d5b 2774 656d 706f 7261 6c27  thod]['temporal'
+0000f7b0: 5d5b 3a2c 203a 2c20 666f 6c64 5d20 3d20  ][:, :, fold] = 
+0000f7c0: 7370 6563 7472 610d 0a20 2020 2020 2020  spectra..       
+0000f7d0: 2020 2020 2020 2020 2073 656c 662e 6376           self.cv
+0000f7e0: 5f70 6174 7465 726e 735b 6d65 7468 6f64  _patterns[method
+0000f7f0: 5d5b 2770 7364 7327 5d5b 3a2c 203a 2c20  ]['psds'][:, :, 
+0000f800: 666f 6c64 5d20 3d20 7073 6473 0d0a 2020  fold] = psds..  
+0000f810: 2020 2020 2020 2020 2020 2020 2020 0d0a                ..
+0000f820: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0000f830: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000f840: 2020 2073 656c 662e 6376 5f70 6174 7465     self.cv_patte
+0000f850: 726e 735b 6d65 7468 6f64 5d5b 2773 7061  rns[method]['spa
+0000f860: 7469 616c 275d 5b3a 2c20 3a2c 2066 6f6c  tial'][:, :, fol
+0000f870: 645d 203d 2070 6174 7465 726e 735f 7374  d] = patterns_st
+0000f880: 7275 6374 5b27 7061 7474 6572 6e73 275d  ruct['patterns']
+0000f890: 5b6d 6574 686f 645d 0d0a 2020 2020 2020  [method]..      
+0000f8a0: 2020 0d0a 2020 2020 2020 2020 7365 6c66    ..        self
+0000f8b0: 2e63 765f 7061 7474 6572 6e73 5b27 6463  .cv_patterns['dc
+0000f8c0: 6f76 275d 5b27 696e 7075 745f 7370 6174  ov']['input_spat
+0000f8d0: 6961 6c27 5d5b 3a2c 203a 2c20 666f 6c64  ial'][:, :, fold
+0000f8e0: 5d20 3d20 7061 7474 6572 6e73 5f73 7472  ] = patterns_str
+0000f8f0: 7563 745b 2764 636f 7627 5d5b 2769 6e70  uct['dcov']['inp
+0000f900: 7574 5f73 7061 7469 616c 275d 0d0a 2020  ut_spatial']..  
+0000f910: 2020 2020 2020 7365 6c66 2e63 765f 7061        self.cv_pa
+0000f920: 7474 6572 6e73 5b27 6463 6f76 275d 5b27  tterns['dcov']['
+0000f930: 636c 6173 735f 636f 6e64 6974 696f 6e61  class_conditiona
+0000f940: 6c27 5d5b 3a2c 203a 2c20 3a2c 2066 6f6c  l'][:, :, :, fol
+0000f950: 645d 203d 2070 6174 7465 726e 735f 7374  d] = patterns_st
+0000f960: 7275 6374 5b27 6463 6f76 275d 5b27 636c  ruct['dcov']['cl
+0000f970: 6173 735f 636f 6e64 6974 696f 6e61 6c27  ass_conditional'
+0000f980: 5d0d 0a20 2020 2020 2020 2073 656c 662e  ]..        self.
+0000f990: 6376 5f70 6174 7465 726e 735b 2763 6f6d  cv_patterns['com
+0000f9a0: 7077 6973 655f 6c6f 7373 275d 5b27 6665  pwise_loss']['fe
+0000f9b0: 6174 7572 655f 7265 6c65 7661 6e63 6527  ature_relevance'
+0000f9c0: 5d5b 3a2c 203a 2c20 3a2c 2066 6f6c 645d  ][:, :, :, fold]
+0000f9d0: 203d 2070 6174 7465 726e 735f 7374 7275   = patterns_stru
+0000f9e0: 6374 5b27 636f 6d70 7769 7365 5f6c 6f73  ct['compwise_los
+0000f9f0: 7327 5d0d 0a20 2020 2020 2020 2073 656c  s']..        sel
+0000fa00: 662e 6376 5f70 6174 7465 726e 735b 276f  f.cv_patterns['o
+0000fa10: 7574 7075 745f 636f 7272 275d 5b27 6665  utput_corr']['fe
+0000fa20: 6174 7572 655f 7265 6c65 7661 6e63 6527  ature_relevance'
+0000fa30: 5d5b 3a2c 203a 2c20 3a2c 2066 6f6c 645d  ][:, :, :, fold]
+0000fa40: 203d 2070 6174 7465 726e 735f 7374 7275   = patterns_stru
+0000fa50: 6374 5b27 636f 7272 5f74 6f5f 6f75 7470  ct['corr_to_outp
+0000fa60: 7574 275d 0d0a 2020 2020 2020 2020 7365  ut']..        se
+0000fa70: 6c66 2e63 765f 7061 7474 6572 6e73 5b27  lf.cv_patterns['
+0000fa80: 7765 6967 6874 275d 5b27 6665 6174 7572  weight']['featur
+0000fa90: 655f 7265 6c65 7661 6e63 6527 5d5b 3a2c  e_relevance'][:,
+0000faa0: 203a 2c20 3a2c 2066 6f6c 645d 203d 2070   :, :, fold] = p
+0000fab0: 6174 7465 726e 735f 7374 7275 6374 5b27  atterns_struct['
+0000fac0: 7765 6967 6874 7327 5d5b 276f 7574 5f77  weights']['out_w
+0000fad0: 6569 6768 7473 275d 0d0a 2020 2020 2020  eights']..      
+0000fae0: 2020 5b73 656c 662e 6376 5f77 6569 6768    [self.cv_weigh
+0000faf0: 7473 5b6b 5d2e 6170 7065 6e64 2870 6174  ts[k].append(pat
+0000fb00: 7465 726e 735f 7374 7275 6374 5b27 7765  terns_struct['we
+0000fb10: 6967 6874 7327 5d5b 6b5d 2920 0d0a 2020  ights'][k]) ..  
+0000fb20: 2020 2020 2020 2066 6f72 206b 2069 6e20         for k in 
+0000fb30: 7061 7474 6572 6e73 5f73 7472 7563 745b  patterns_struct[
+0000fb40: 2777 6569 6768 7473 275d 2e6b 6579 7328  'weights'].keys(
+0000fb50: 295d 0d0a 0d0a 2020 2020 6465 6620 6765  )]....    def ge
+0000fb60: 745f 7370 6563 7472 6128 7365 6c66 2c20  t_spectra(self, 
+0000fb70: 7765 6967 6874 732c 2061 6374 6976 6174  weights, activat
+0000fb80: 696f 6e73 2c20 6e66 6674 3d31 3238 293a  ions, nfft=128):
+0000fb90: 0d0a 2020 2020 2020 2020 2323 5073 6473  ..        ##Psds
+0000fba0: 2061 6e64 2066 7265 7120 7265 7370 6f6e   and freq respon
+0000fbb0: 7365 730d 0a20 2020 2020 2020 2023 2020  ses..        #  
+0000fbc0: 436f 6d70 7574 6520 6672 6571 7565 6e63  Compute frequenc
+0000fbd0: 7920 7265 7370 6f6e 7365 7320 616e 6420  y responses and 
+0000fbe0: 736f 7572 6365 2073 7065 6374 7261 0d0a  source spectra..
+0000fbf0: 2020 2020 2020 2020 7265 616c 6820 3d20          realh = 
+0000fc00: 5b5d 0d0a 2020 2020 2020 2020 7073 6473  []..        psds
+0000fc10: 203d 205b 5d0d 0a20 2020 2020 2020 2066   = []..        f
+0000fc20: 6f72 2069 2c20 666c 7420 696e 2065 6e75  or i, flt in enu
+0000fc30: 6d65 7261 7465 2877 6569 6768 7473 5b27  merate(weights['
+0000fc40: 7463 6f6e 7627 5d2e 5429 3a0d 0a20 2020  tconv'].T):..   
+0000fc50: 2020 2020 2020 2020 2066 6c74 202d 3d20           flt -= 
+0000fc60: 666c 742e 6d65 616e 2829 0d0a 2020 2020  flt.mean()..    
+0000fc70: 2020 2020 2020 2020 2366 6c74 202d 3d20          #flt -= 
+0000fc80: 7365 6c66 2e74 5f63 6f6e 765f 6269 6173  self.t_conv_bias
+0000fc90: 6573 5b69 5d2f 7365 6c66 2e73 7065 6373  es[i]/self.specs
+0000fca0: 5b27 6669 6c74 6572 5f6c 656e 6774 6827  ['filter_length'
+0000fcb0: 5d0d 0a20 2020 2020 2020 2020 2020 206c  ]..            l
+0000fcc0: 7463 203d 2061 6374 6976 6174 696f 6e73  tc = activations
+0000fcd0: 5b27 646d 7827 5d5b 3a2c 2030 2c20 3a2c  ['dmx'][:, 0, :,
+0000fce0: 2069 5d20 2d20 6e70 2e6d 6561 6e28 6163   i] - np.mean(ac
+0000fcf0: 7469 7661 7469 6f6e 735b 2764 6d78 275d  tivations['dmx']
+0000fd00: 5b3a 2c20 302c 203a 2c20 695d 2c20 6178  [:, 0, :, i], ax
+0000fd10: 6973 3d31 2c20 6b65 6570 6469 6d73 3d54  is=1, keepdims=T
+0000fd20: 7275 6529 0d0a 2020 2020 2020 2020 2020  rue)..          
+0000fd30: 2020 6672 2c20 7073 6420 3d20 7765 6c63    fr, psd = welc
+0000fd40: 6828 6c74 632c 0d0a 2020 2020 2020 2020  h(ltc,..        
+0000fd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd60: 2020 2020 6673 3d73 656c 662e 6461 7461      fs=self.data
+0000fd70: 7365 742e 685f 7061 7261 6d73 5b27 6673  set.h_params['fs
+0000fd80: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
+0000fd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fda0: 206e 6666 743d 6e66 6674 202a 2032 2c0d   nfft=nfft * 2,.
+0000fdb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fdc0: 2020 2020 2020 2020 2020 2020 206e 7065               npe
+0000fdd0: 7273 6567 3d6e 6666 7429 0d0a 2020 2020  rseg=nfft)..    
+0000fde0: 2020 2020 2020 2020 6966 206c 656e 2866          if len(f
+0000fdf0: 725b 3a2d 315d 2920 3c20 6e66 6674 3a0d  r[:-1]) < nfft:.
+0000fe00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fe10: 206e 6666 7420 3d20 6c65 6e28 6672 5b3a   nfft = len(fr[:
+0000fe20: 2d31 5d29 0d0a 0d0a 2020 2020 2020 2020  -1])....        
+0000fe30: 2020 2020 772c 2068 203d 2066 7265 717a      w, h = freqz
+0000fe40: 2866 6c74 2c20 312c 2077 6f72 4e3d 6e66  (flt, 1, worN=nf
+0000fe50: 6674 2c20 6673 203d 2073 656c 662e 6461  ft, fs = self.da
+0000fe60: 7461 7365 742e 685f 7061 7261 6d73 5b27  taset.h_params['
+0000fe70: 6673 275d 290d 0a0d 0a20 2020 2020 2020  fs'])....       
+0000fe80: 2020 2020 2070 7364 732e 6170 7065 6e64       psds.append
+0000fe90: 2870 7364 5b3a 2c20 3a2d 315d 2e6d 6561  (psd[:, :-1].mea
+0000fea0: 6e28 3029 290d 0a20 2020 2020 2020 2020  n(0))..         
+0000feb0: 2020 2072 6561 6c68 2e61 7070 656e 6428     realh.append(
+0000fec0: 6e70 2e61 6273 2868 2929 0d0a 0d0a 2020  np.abs(h))....  
+0000fed0: 2020 2020 2020 7370 6563 7472 6120 3d20        spectra = 
+0000fee0: 7b7d 0d0a 2020 2020 2020 2020 7370 6563  {}..        spec
+0000fef0: 7472 615b 2766 7265 715f 7265 7370 6f6e  tra['freq_respon
+0000ff00: 7365 7327 5d20 3d20 6e70 2e61 7272 6179  ses'] = np.array
+0000ff10: 2872 6561 6c68 290d 0a20 2020 2020 2020  (realh)..       
+0000ff20: 2073 7065 6374 7261 5b27 7073 6473 275d   spectra['psds']
+0000ff30: 203d 206e 702e 6172 7261 7928 7073 6473   = np.array(psds
+0000ff40: 290d 0a20 2020 2020 2020 2073 7065 6374  )..        spect
+0000ff50: 7261 5b27 6672 6571 7327 5d20 3d20 770d  ra['freqs'] = w.
+0000ff60: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000ff70: 7370 6563 7472 610d 0a0d 0a0d 0a0d 0a20  spectra........ 
+0000ff80: 2020 2064 6566 2067 6574 5f77 6569 6768     def get_weigh
+0000ff90: 7473 2873 656c 662c 2076 6572 626f 7365  ts(self, verbose
+0000ffa0: 3d46 616c 7365 293a 0d0a 2020 2020 2020  =False):..      
+0000ffb0: 2020 7765 6967 6874 7320 3d20 7b7d 0d0a    weights = {}..
+0000ffc0: 2020 2020 2020 2020 2320 4578 7472 6163          # Extrac
+0000ffd0: 7420 7765 6967 6874 730d 0a20 2020 2020  t weights..     
+0000ffe0: 2020 2023 2053 7061 7469 616c 2065 7874     # Spatial ext
+0000fff0: 7261 6374 696f 6e20 6669 7465 7273 0d0a  raction fiters..
+00010000: 2020 2020 2020 2020 7765 6967 6874 735b          weights[
+00010010: 2764 6d78 275d 203d 206e 702e 7371 7565  'dmx'] = np.sque
+00010020: 657a 6528 7365 6c66 2e64 6d78 2e77 2e6e  eze(self.dmx.w.n
+00010030: 756d 7079 2829 290d 0a20 2020 2020 2020  umpy())..       
+00010040: 2077 6569 6768 7473 5b27 646d 785f 6227   weights['dmx_b'
+00010050: 5d20 3d20 7365 6c66 2e64 6d78 2e62 5f69  ] = self.dmx.b_i
+00010060: 6e2e 6e75 6d70 7928 290d 0a20 2020 2020  n.numpy()..     
+00010070: 2020 2023 2054 656d 706f 7261 6c20 6b65     # Temporal ke
+00010080: 726e 656c 730d 0a20 2020 2020 2020 2077  rnels..        w
+00010090: 6569 6768 7473 5b27 7463 6f6e 7627 5d20  eights['tconv'] 
+000100a0: 3d20 6e70 2e73 7175 6565 7a65 2873 656c  = np.squeeze(sel
+000100b0: 662e 7463 6f6e 762e 6669 6c74 6572 732e  f.tconv.filters.
+000100c0: 6e75 6d70 7928 2929 0d0a 2020 2020 2020  numpy())..      
+000100d0: 2020 7765 6967 6874 735b 2774 636f 6e76    weights['tconv
+000100e0: 5f62 275d 203d 206e 702e 7371 7565 657a  _b'] = np.squeez
+000100f0: 6528 7365 6c66 2e74 636f 6e76 2e62 2e6e  e(self.tconv.b.n
+00010100: 756d 7079 2829 290d 0a20 2020 2020 2020  umpy())..       
+00010110: 2023 2046 696e 616c 206c 6179 6572 0d0a   # Final layer..
+00010120: 2020 2020 2020 2020 7765 6967 6874 735b          weights[
+00010130: 276f 7574 5f77 5f66 6c61 7427 5d20 3d20  'out_w_flat'] = 
+00010140: 7365 6c66 2e66 696e 5f66 632e 772e 6e75  self.fin_fc.w.nu
+00010150: 6d70 7928 290d 0a20 2020 2020 2020 2077  mpy()..        w
+00010160: 6569 6768 7473 5b27 6f75 745f 7765 6967  eights['out_weig
+00010170: 6874 7327 5d20 3d20 6e70 2e72 6573 6861  hts'] = np.resha
+00010180: 7065 2873 656c 662e 6669 6e5f 6663 2e77  pe(self.fin_fc.w
+00010190: 2e6e 756d 7079 2829 2c0d 0a20 2020 2020  .numpy(),..     
 000101a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000101b0: 4643 5f44 454e 5345 3a20 7b7d 2222 222e  FC_DENSE: {}""".
-000101c0: 666f 726d 6174 2877 6569 6768 7473 5b27  format(weights['
-000101d0: 646d 7827 5d2e 7368 6170 652c 0d0a 2020  dmx'].shape,..  
+000101b0: 2020 2020 2020 2020 2020 2020 5b73 656c              [sel
+000101c0: 662e 706f 6f6c 6564 2e73 6861 7065 5b32  f.pooled.shape[2
+000101d0: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
 000101e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000101f0: 7765 6967 6874 735b 2774 636f 6e76 275d  weights['tconv']
-00010200: 2e73 6861 7065 2c0d 0a20 2020 2020 2020  .shape,..       
-00010210: 2020 2020 2020 2020 2020 2077 6569 6768             weigh
-00010220: 7473 5b27 6f75 745f 7765 6967 6874 7327  ts['out_weights'
-00010230: 5d2e 7368 6170 6529 290d 0a20 2020 2020  ].shape))..     
-00010240: 2020 2072 6574 7572 6e20 7765 6967 6874     return weight
-00010250: 730d 0a0d 0a20 2020 2064 6566 2063 6f6d  s....    def com
-00010260: 7075 7465 5f63 6f6d 706f 6e65 6e74 7769  pute_componentwi
-00010270: 7365 5f6c 6f73 7328 7365 6c66 2c20 582c  se_loss(self, X,
-00010280: 2079 2c20 7765 6967 6874 7329 3a0d 0a0d   y, weights):...
-00010290: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-000102a0: 2020 2020 2020 436f 6d70 7574 6520 636f        Compute co
-000102b0: 6d70 6f6e 656e 7420 7265 6c65 7661 6e63  mponent relevanc
-000102c0: 6573 2062 7920 7265 6375 7273 6976 6520  es by recursive 
-000102d0: 656c 696d 696e 6174 696f 6e0d 0a20 2020  elimination..   
-000102e0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-000102f0: 2020 6d6f 6465 6c5f 7765 6967 6874 7320    model_weights 
-00010300: 3d20 7365 6c66 2e6b 6d2e 6765 745f 7765  = self.km.get_we
-00010310: 6967 6874 7328 290d 0a20 2020 2020 2020  ights()..       
-00010320: 206f 7269 6769 6e61 6c5f 7765 6967 6874   original_weight
-00010330: 7320 3d20 6d6f 6465 6c5f 7765 6967 6874  s = model_weight
-00010340: 732e 636f 7079 2829 0d0a 2020 2020 2020  s.copy()..      
-00010350: 2020 6261 7365 5f6c 6f73 732c 2062 6173    base_loss, bas
-00010360: 655f 7065 7266 6f72 6d61 6e63 6520 3d20  e_performance = 
-00010370: 7365 6c66 2e6b 6d2e 6576 616c 7561 7465  self.km.evaluate
-00010380: 2858 2c20 792c 2076 6572 626f 7365 3d30  (X, y, verbose=0
-00010390: 290d 0a20 2020 2020 2020 2023 2069 6620  )..        # if 
-000103a0: 6c65 6e28 6261 7365 5f70 6572 666f 726d  len(base_perform
-000103b0: 616e 6365 203e 2031 293a 0d0a 2020 2020  ance > 1):..    
-000103c0: 2020 2020 2320 2020 2062 6173 655f 7065      #    base_pe
-000103d0: 7266 6f72 6d61 6e63 6520 3d20 6262 6173  rformance = bbas
-000103e0: 655f 7065 7266 6f72 6d61 6e63 655b 305d  e_performance[0]
-000103f0: 0d0a 2020 2020 2020 2020 6665 6174 7572  ..        featur
-00010400: 655f 7265 6c65 7661 6e63 6573 5f6c 6f73  e_relevances_los
-00010410: 7320 3d20 5b5d 0d0a 2020 2020 2020 2020  s = []..        
-00010420: 6e5f 6f75 745f 7420 3d20 7765 6967 6874  n_out_t = weight
-00010430: 735b 276f 7574 5f77 6569 6768 7473 275d  s['out_weights']
-00010440: 2e73 6861 7065 5b30 5d0d 0a20 2020 2020  .shape[0]..     
-00010450: 2020 206e 5f6f 7574 5f79 203d 2077 6569     n_out_y = wei
-00010460: 6768 7473 5b27 6f75 745f 7765 6967 6874  ghts['out_weight
-00010470: 7327 5d2e 7368 6170 655b 2d31 5d0d 0a20  s'].shape[-1].. 
-00010480: 2020 2020 2020 2023 7a65 726f 7765 6967         #zeroweig
-00010490: 6874 7320 3d20 6e70 2e7a 6572 6f73 2828  hts = np.zeros((
-000104a0: 6e5f 6f75 745f 742c 2929 0d0a 2020 2020  n_out_t,))..    
-000104b0: 2020 2020 6c6f 7373 6573 203d 206e 702e      losses = np.
-000104c0: 7a65 726f 7328 5b6e 5f6f 7574 5f74 2c20  zeros([n_out_t, 
-000104d0: 7365 6c66 2e73 7065 6373 5b27 6e5f 6c61  self.specs['n_la
-000104e0: 7465 6e74 275d 2c20 6e5f 6f75 745f 795d  tent'], n_out_y]
-000104f0: 290d 0a20 2020 2020 2020 2066 6f72 2074  )..        for t
-00010500: 2069 6e20 7261 6e67 6528 6e5f 6f75 745f   in range(n_out_
-00010510: 7429 3a0d 0a20 2020 2020 2020 2020 2020  t):..           
-00010520: 2066 6f72 206a 6a20 696e 2072 616e 6765   for jj in range
-00010530: 286e 5f6f 7574 5f79 293a 0d0a 2020 2020  (n_out_y):..    
-00010540: 2020 2020 2020 2020 2020 2020 2366 6f72              #for
-00010550: 2065 6163 6820 636c 6173 730d 0a20 2020   each class..   
-00010560: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00010570: 2069 2069 6e20 7261 6e67 6528 7365 6c66   i in range(self
-00010580: 2e73 7065 6373 5b22 6e5f 6c61 7465 6e74  .specs["n_latent
-00010590: 225d 293a 0d0a 2020 2020 2020 2020 2020  "]):..          
-000105a0: 2020 2020 2020 2020 2020 2366 6f72 2065            #for e
-000105b0: 6163 6820 636f 6d70 6f6e 656e 740d 0a20  ach component.. 
-000105c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000105d0: 2020 2023 6c6f 7373 5f70 6572 5f63 6f6d     #loss_per_com
-000105e0: 706f 6e65 6e74 203d 205b 5d0d 0a20 2020  ponent = []..   
-000105f0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00010600: 2020 2020 2020 206e 6577 5f77 6569 6768         new_weigh
-00010610: 7473 203d 2077 6569 6768 7473 5b27 6f75  ts = weights['ou
-00010620: 745f 7765 6967 6874 7327 5d2e 636f 7079  t_weights'].copy
-00010630: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00010640: 2020 2020 2020 2020 6e65 775f 6269 6173          new_bias
-00010650: 203d 2077 6569 6768 7473 5b27 6663 5f62   = weights['fc_b
-00010660: 275d 2e63 6f70 7928 290d 0a20 2020 2020  '].copy()..     
-00010670: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00010680: 6577 5f77 6569 6768 7473 5b74 2c20 692c  ew_weights[t, i,
-00010690: 206a 6a5d 203d 2030 0d0a 2020 2020 2020   jj] = 0..      
-000106a0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-000106b0: 775f 6269 6173 5b6a 6a5d 203d 2030 0d0a  w_bias[jj] = 0..
-000106c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000106d0: 2020 2020 6e65 775f 7765 6967 6874 7320      new_weights 
-000106e0: 3d20 6e70 2e72 6573 6861 7065 286e 6577  = np.reshape(new
-000106f0: 5f77 6569 6768 7473 2c20 7765 6967 6874  _weights, weight
-00010700: 735b 276f 7574 5f77 5f66 6c61 7427 5d2e  s['out_w_flat'].
-00010710: 7368 6170 6529 0d0a 2020 2020 2020 2020  shape)..        
-00010720: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-00010730: 6c5f 7765 6967 6874 735b 2d32 5d20 3d20  l_weights[-2] = 
-00010740: 6e65 775f 7765 6967 6874 730d 0a20 2020  new_weights..   
-00010750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010760: 206d 6f64 656c 5f77 6569 6768 7473 5b2d   model_weights[-
-00010770: 315d 203d 206e 6577 5f62 6961 730d 0a20  1] = new_bias.. 
-00010780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010790: 2020 2073 656c 662e 6b6d 2e73 6574 5f77     self.km.set_w
-000107a0: 6569 6768 7473 286d 6f64 656c 5f77 6569  eights(model_wei
-000107b0: 6768 7473 290d 0a20 2020 2020 2020 2020  ghts)..         
-000107c0: 2020 2020 2020 2020 2020 206c 6f73 7320             loss 
-000107d0: 3d20 7365 6c66 2e6b 6d2e 6576 616c 7561  = self.km.evalua
-000107e0: 7465 2858 2c20 792c 2076 6572 626f 7365  te(X, y, verbose
-000107f0: 3d30 295b 305d 0d0a 2020 2020 0d0a 2020  =0)[0]..    ..  
-00010800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010810: 2020 236c 6f73 735f 7065 725f 636f 6d70    #loss_per_comp
-00010820: 6f6e 656e 742e 6170 7065 6e64 2862 6173  onent.append(bas
-00010830: 655f 6c6f 7373 202d 206c 6f73 7329 0d0a  e_loss - loss)..
-00010840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010850: 2020 2020 6c6f 7373 6573 5b74 2c20 692c      losses[t, i,
-00010860: 206a 6a5d 203d 206c 6f73 7320 2d20 6261   jj] = loss - ba
-00010870: 7365 5f6c 6f73 730d 0a20 2020 2020 2020  se_loss..       
-00010880: 2020 2020 2023 6665 6174 7572 655f 7265       #feature_re
-00010890: 6c65 7661 6e63 6573 5f6c 6f73 732e 6170  levances_loss.ap
-000108a0: 7065 6e64 286e 702e 6172 7261 7928 6c6f  pend(np.array(lo
-000108b0: 7373 5f70 6572 5f63 636f 6d70 6f6e 656e  ss_per_ccomponen
-000108c0: 7429 290d 0a20 2020 2020 2020 2023 7072  t))..        #pr
-000108d0: 696e 7428 6c6f 7373 6573 2e73 6861 7065  int(losses.shape
-000108e0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000108f0: 6b6d 2e73 6574 5f77 6569 6768 7473 286f  km.set_weights(o
-00010900: 7269 6769 6e61 6c5f 7765 6967 6874 7329  riginal_weights)
-00010910: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00010920: 206c 6f73 7365 730d 0a0d 0a0d 0a20 2020   losses......   
-00010930: 2064 6566 2067 6574 5f6f 7574 7075 745f   def get_output_
-00010940: 636f 7272 656c 6174 696f 6e73 2873 656c  correlations(sel
-00010950: 662c 2061 6374 6976 6174 696f 6e73 2c20  f, activations, 
-00010960: 795f 7472 7565 293a 0d0a 2020 2020 2020  y_true):..      
-00010970: 2020 2222 2243 6f6d 7075 7465 7320 6120    """Computes a 
-00010980: 7369 6d69 6c61 7269 7479 206d 6574 7269  similarity metri
-00010990: 6320 6265 7477 6565 6e20 6561 6368 206f  c between each o
-000109a0: 6620 7468 6520 6578 7472 6163 7465 640d  f the extracted.
-000109b0: 0a20 2020 2020 2020 2066 6561 7475 7265  .        feature
-000109c0: 7320 616e 6420 7468 6520 7461 7267 6574  s and the target
-000109d0: 2076 6172 6961 626c 652e 0d0a 0d0a 2020   variable.....  
-000109e0: 2020 2020 2020 5468 6520 6d65 7472 6963        The metric
-000109f0: 2069 7320 6120 4d61 6e68 6174 7461 6e20   is a Manhattan 
-00010a00: 6469 7374 616e 6365 2066 6f72 2064 6963  distance for dic
-00010a10: 7265 7465 2074 6172 6765 7473 2c20 616e  rete targets, an
-00010a20: 640d 0a20 2020 2020 2020 2053 7065 6172  d..        Spear
-00010a30: 6d61 6e20 636f 7272 656c 6174 696f 6e20  man correlation 
-00010a40: 666f 7220 636f 6e74 696e 756f 7573 2074  for continuous t
-00010a50: 6172 6765 7473 2e0d 0a20 2020 2020 2020  argets...       
-00010a60: 2022 2222 0d0a 2020 2020 2020 2020 636f   """..        co
-00010a70: 7272 5f74 6f5f 6f75 7470 7574 203d 205b  rr_to_output = [
-00010a80: 5d0d 0a20 2020 2020 2020 2079 5f74 7275  ]..        y_tru
-00010a90: 6520 3d20 795f 7472 7565 2e6e 756d 7079  e = y_true.numpy
-00010aa0: 2829 0d0a 2020 2020 2020 2020 666c 6174  ()..        flat
-00010ab0: 5f66 6561 7473 203d 2061 6374 6976 6174  _feats = activat
-00010ac0: 696f 6e73 5b27 7463 6f6e 7627 5d2e 6e75  ions['tconv'].nu
-00010ad0: 6d70 7928 292e 7265 7368 6170 6528 795f  mpy().reshape(y_
-00010ae0: 7472 7565 2e73 6861 7065 5b30 5d2c 202d  true.shape[0], -
-00010af0: 3129 0d0a 0d0a 2020 2020 2020 2020 0d0a  1)....        ..
-00010b00: 2020 2020 2020 2020 666f 7220 795f 2069          for y_ i
-00010b10: 6e20 795f 7472 7565 2e54 3a0d 0a20 2020  n y_true.T:..   
-00010b20: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00010b30: 2e64 6174 6173 6574 2e68 5f70 6172 616d  .dataset.h_param
-00010b40: 735b 2774 6172 6765 745f 7479 7065 275d  s['target_type']
-00010b50: 2069 6e20 5b27 666c 6f61 7427 2c20 2773   in ['float', 's
-00010b60: 6967 6e61 6c27 5d3a 0d0a 2020 2020 2020  ignal']:..      
-00010b70: 2020 2020 2020 2020 2020 7266 6f63 7320            rfocs 
-00010b80: 3d20 6e70 2e61 7272 6179 285b 7370 6561  = np.array([spea
-00010b90: 726d 616e 7228 795f 2c20 6629 5b30 5d20  rmanr(y_, f)[0] 
-00010ba0: 666f 7220 6620 696e 2066 6c61 745f 6665  for f in flat_fe
-00010bb0: 6174 732e 545d 290d 0a20 2020 2020 2020  ats.T])..       
-00010bc0: 2020 2020 2020 2020 2063 6f72 725f 746f           corr_to
-00010bd0: 5f6f 7574 7075 742e 6170 7065 6e64 2872  _output.append(r
-00010be0: 666f 6373 2e72 6573 6861 7065 2861 6374  focs.reshape(act
-00010bf0: 6976 6174 696f 6e73 5b27 7463 6f6e 7627  ivations['tconv'
-00010c00: 5d2e 7368 6170 655b 313a 5d29 290d 0a0d  ].shape[1:]))...
-00010c10: 0a0d 0a20 2020 2020 2020 2020 2020 2065  ...            e
-00010c20: 6c69 6620 7365 6c66 2e64 6174 6173 6574  lif self.dataset
-00010c30: 2e68 5f70 6172 616d 735b 2774 6172 6765  .h_params['targe
-00010c40: 745f 7479 7065 275d 203d 3d20 2769 6e74  t_type'] == 'int
-00010c50: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
-00010c60: 2020 2020 7266 6f63 7320 3d20 6e70 2e61      rfocs = np.a
-00010c70: 7272 6179 285b 7065 6172 736f 6e72 2879  rray([pearsonr(y
-00010c80: 5f2c 2066 295b 305d 2066 6f72 2066 2069  _, f)[0] for f i
-00010c90: 6e20 666c 6174 5f66 6561 7473 2e54 5d29  n flat_feats.T])
-00010ca0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00010cb0: 2020 636f 7272 5f74 6f5f 6f75 7470 7574    corr_to_output
-00010cc0: 2e61 7070 656e 6428 7266 6f63 732e 7265  .append(rfocs.re
-00010cd0: 7368 6170 6528 6163 7469 7661 7469 6f6e  shape(activation
-00010ce0: 735b 2774 636f 6e76 275d 2e73 6861 7065  s['tconv'].shape
-00010cf0: 5b31 3a5d 2929 0d0a 2020 2020 2020 2020  [1:]))..        
-00010d00: 2020 2020 2020 2020 2379 5f74 7275 6520          #y_true 
-00010d10: 3d20 795f 7472 7565 2f6e 702e 6c69 6e61  = y_true/np.lina
-00010d20: 6c67 2e6e 6f72 6d28 795f 7472 7565 2c20  lg.norm(y_true, 
-00010d30: 6f72 643d 312c 2061 7869 733d 3029 5b4e  ord=1, axis=0)[N
-00010d40: 6f6e 652c 203a 5d0d 0a20 2020 2020 2020  one, :]..       
-00010d50: 2020 2020 2020 2020 2023 666c 6174 5f64           #flat_d
-00010d60: 6976 203d 206e 702e 6c69 6e61 6c67 2e6e  iv = np.linalg.n
-00010d70: 6f72 6d28 666c 6174 5f66 6561 7473 2c20  orm(flat_feats, 
-00010d80: 312c 2061 7869 733d 3029 5b4e 6f6e 652c  1, axis=0)[None,
-00010d90: 203a 5d0d 0a20 2020 2020 2020 2020 2020   :]..           
-00010da0: 2020 2020 2023 666c 6174 5f66 6561 7473       #flat_feats
-00010db0: 203d 2066 6c61 745f 6665 6174 732f 666c   = flat_feats/fl
-00010dc0: 6174 5f64 6976 0d0a 2020 2020 2020 2020  at_div..        
-00010dd0: 2020 2020 2020 2020 2370 7269 6e74 2822          #print("
-00010de0: 6666 3a22 2c20 666c 6174 5f66 6561 7473  ff:", flat_feats
-00010df0: 2e73 6861 7065 290d 0a20 2020 2020 2020  .shape)..       
-00010e00: 2020 2020 2020 2020 2023 7072 696e 7428           #print(
-00010e10: 2279 5f74 7275 653a 222c 2079 5f74 7275  "y_true:", y_tru
-00010e20: 652e 7368 6170 6529 0d0a 2020 2020 2020  e.shape)..      
-00010e30: 2020 2020 2020 2020 2020 2366 6f72 2079            #for y
-00010e40: 5f20 696e 2079 5f74 7275 652e 543a 0d0a  _ in y_true.T:..
-00010e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e60: 2020 2020 2370 7269 6e74 2827 792e 543a      #print('y.T:
-00010e70: 272c 2079 5f2e 7368 6170 6529 0d0a 2020  ', y_.shape)..  
-00010e80: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00010e90: 2020 2072 666f 6373 203d 2032 2e20 2d20     rfocs = 2. - 
-00010ea0: 6e70 2e73 756d 286e 702e 6162 7328 666c  np.sum(np.abs(fl
-00010eb0: 6174 5f66 6561 7473 202d 2079 5f5b 3a2c  at_feats - y_[:,
-00010ec0: 204e 6f6e 655d 292c 2030 290d 0a20 2020   None]), 0)..   
-00010ed0: 2020 2020 2020 2020 2020 2020 2023 2020               #  
-00010ee0: 2020 636f 7272 5f74 6f5f 6f75 7470 7574    corr_to_output
-00010ef0: 2e61 7070 656e 6428 7266 6f63 732e 7265  .append(rfocs.re
-00010f00: 7368 6170 6528 6163 7469 7661 7469 6f6e  shape(activation
-00010f10: 735b 2774 636f 6e76 275d 2e73 6861 7065  s['tconv'].shape
-00010f20: 5b31 3a5d 2929 0d0a 0d0a 2020 2020 2020  [1:]))....      
-00010f30: 2020 636f 7272 5f74 6f5f 6f75 7470 7574    corr_to_output
-00010f40: 203d 206e 702e 636f 6e63 6174 656e 6174   = np.concatenat
-00010f50: 6528 636f 7272 5f74 6f5f 6f75 7470 7574  e(corr_to_output
-00010f60: 2c20 3029 2e74 7261 6e73 706f 7365 285b  , 0).transpose([
-00010f70: 312c 2032 2c20 305d 290d 0a20 2020 2020  1, 2, 0])..     
-00010f80: 2020 2023 7072 696e 7428 636f 7272 5f74     #print(corr_t
-00010f90: 6f5f 6f75 7470 7574 2e73 6861 7065 290d  o_output.shape).
-00010fa0: 0a20 2020 2020 2020 2069 6620 6e70 2e61  .        if np.a
-00010fb0: 6e79 286e 702e 6973 6e61 6e28 636f 7272  ny(np.isnan(corr
-00010fc0: 5f74 6f5f 6f75 7470 7574 2929 3a0d 0a20  _to_output)):.. 
-00010fd0: 2020 2020 2020 2020 2020 2063 6f72 725f             corr_
-00010fe0: 746f 5f6f 7574 7075 745b 6e70 2e69 736e  to_output[np.isn
-00010ff0: 616e 2863 6f72 725f 746f 5f6f 7574 7075  an(corr_to_outpu
-00011000: 7429 5d20 3d20 300d 0a20 2020 2020 2020  t)] = 0..       
-00011010: 2072 6574 7572 6e20 636f 7272 5f74 6f5f   return corr_to_
-00011020: 6f75 7470 7574 0d0a 0d0a 2020 2020 2320  output....    # 
-00011030: 2d2d 2d20 4c46 434e 4e20 706c 6f74 2066  --- LFCNN plot f
-00011040: 756e 6374 696f 6e73 202d 2d2d 0d0a 0d0a  unctions ---....
-00011050: 2020 2020 6465 6620 706c 6f74 5f65 766f      def plot_evo
-00011060: 6b65 645f 7065 616b 7328 7365 6c66 2c20  ked_peaks(self, 
-00011070: 6461 7461 3d4e 6f6e 652c 2074 3d4e 6f6e  data=None, t=Non
-00011080: 652c 2063 6c61 7373 5f73 7562 7365 743d  e, class_subset=
-00011090: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2020  None,..         
-000110a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000110b0: 2073 656e 736f 725f 6c61 796f 7574 3d27   sensor_layout='
-000110c0: 5665 6374 6f72 7669 6577 2d6d 6167 272c  Vectorview-mag',
-000110d0: 2074 6974 6c65 3d4e 6f6e 652c 2073 6176   title=None, sav
-000110e0: 6566 6967 3d4e 6f6e 6529 3a0d 0a20 2020  efig=None):..   
-000110f0: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-00011100: 2020 506c 6f74 206f 6e65 2073 7061 7469    Plot one spati
-00011110: 616c 2074 6f70 6f67 7261 7068 7920 6f66  al topography of
-00011120: 2063 6c61 7373 2d63 6f6e 6469 7469 6f6e   class-condition
-00011130: 616c 2061 7665 7261 6765 206f 6620 7468  al average of th
-00011140: 6520 696e 7075 742e 0d0a 2020 2020 2020  e input...      
-00011150: 2020 4966 2074 696d 6570 6f69 6e74 2069    If timepoint i
-00011160: 7320 6e6f 7420 7370 6563 6966 6965 6420  s not specified 
-00011170: 6974 2069 7320 7069 636b 6564 2061 7320  it is picked as 
-00011180: 6120 6d61 7869 6d75 6d20 524d 5320 666f  a maximum RMS fo
-00011190: 7220 6561 6368 0d0a 2020 2020 2020 2020  r each..        
-000111a0: 636c 6173 732e 0d0a 0d0a 0d0a 2020 2020  class.......    
-000111b0: 2020 2020 5061 7261 6d65 7465 7273 0d0a      Parameters..
-000111c0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-000111d0: 2d2d 0d0a 2020 2020 2020 2020 746f 706f  --..        topo
-000111e0: 7320 3a20 6e70 2e61 7272 6179 0d0a 2020  s : np.array..  
-000111f0: 2020 2020 2020 2020 2020 5b6e 5f63 682c            [n_ch,
-00011200: 206e 5f74 2c20 6e5f 636c 6173 7365 735d   n_t, n_classes]
-00011210: 0d0a 2020 2020 2020 2020 7365 6e73 6f72  ..        sensor
-00011220: 5f6c 6179 6f75 7420 3a20 5459 5045 2c20  _layout : TYPE, 
-00011230: 6f70 7469 6f6e 616c 0d0a 2020 2020 2020  optional..      
-00011240: 2020 2020 2020 4445 5343 5249 5054 494f        DESCRIPTIO
-00011250: 4e2e 2054 6865 2064 6566 6175 6c74 2069  N. The default i
-00011260: 7320 2756 6563 746f 7276 6965 772d 6d61  s 'Vectorview-ma
-00011270: 6727 2e0d 0a0d 0a20 2020 2020 2020 2022  g'.....        "
-00011280: 2222 0d0a 2020 2020 2020 2020 6e20 3d20  ""..        n = 
-00011290: 7365 6c66 2e6f 7574 5f64 696d 0d0a 0d0a  self.out_dim....
-000112a0: 2020 2020 2020 2020 6966 2064 6174 6120          if data 
-000112b0: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-000112c0: 2020 2020 2020 6461 7461 203d 2073 656c        data = sel
-000112d0: 662e 7472 7565 5f65 766f 6b65 645f 6461  f.true_evoked_da
-000112e0: 7461 0d0a 2020 2020 2020 2020 2020 2020  ta..            
-000112f0: 6966 206e 6f74 2074 6974 6c65 3a0d 0a20  if not title:.. 
-00011300: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00011310: 6974 6c65 203d 2027 5472 7565 2050 6174  itle = 'True Pat
-00011320: 7465 726e 7327 0d0a 2020 2020 2020 2020  terns'..        
-00011330: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00011340: 2020 2074 6974 6c65 203d 2027 4d6f 6465     title = 'Mode
-00011350: 6c2d 6465 7269 7665 6420 7061 7474 6572  l-derived patter
-00011360: 6e73 270d 0a0d 0a20 2020 2020 2020 2069  ns'....        i
-00011370: 6620 7420 6973 204e 6f6e 653a 0d0a 2020  f t is None:..  
-00011380: 2020 2020 2020 2020 2020 7420 3d20 6e70            t = np
-00011390: 2e61 7267 6d61 7828 6e70 2e6d 6561 6e28  .argmax(np.mean(
-000113a0: 6461 7461 2a2a 322c 2061 7869 733d 3029  data**2, axis=0)
-000113b0: 2e6d 6561 6e28 2d31 2929 0d0a 2020 2020  .mean(-1))..    
-000113c0: 2020 2020 7469 746c 6520 3d20 7469 746c      title = titl
-000113d0: 6520 2b20 2027 743d 7b7d 272e 666f 726d  e +  't={}'.form
-000113e0: 6174 2874 290d 0a20 2020 2020 2020 2065  at(t)..        e
-000113f0: 6420 3d20 6e70 2e73 7461 636b 285b 6461  d = np.stack([da
-00011400: 7461 5b69 2c20 742c 203a 5d20 666f 7220  ta[i, t, :] for 
-00011410: 6920 696e 2072 616e 6765 286e 295d 2c20  i in range(n)], 
-00011420: 6178 6973 3d2d 3129 0d0a 2020 2020 2020  axis=-1)..      
-00011430: 2020 6173 7365 7274 2065 642e 6e64 696d    assert ed.ndim
-00011440: 3d3d 320d 0a20 2020 2020 2020 2074 6f70  ==2..        top
-00011450: 6f70 6c6f 7420 3d20 7365 6c66 2e70 6c6f  oplot = self.plo
-00011460: 745f 746f 706f 7328 6564 2c20 7365 6e73  t_topos(ed, sens
-00011470: 6f72 5f6c 6179 6f75 743d 7365 6e73 6f72  or_layout=sensor
-00011480: 5f6c 6179 6f75 742c 0d0a 2020 2020 2020  _layout,..      
-00011490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000114a0: 2020 2020 2020 2020 2020 2020 2063 6c61               cla
-000114b0: 7373 5f73 7562 7365 743d 636c 6173 735f  ss_subset=class_
-000114c0: 7375 6273 6574 2c20 7469 746c 653d 7469  subset, title=ti
-000114d0: 746c 6529 0d0a 0d0a 2020 2020 2020 2020  tle)....        
-000114e0: 2374 6f70 6f70 6c6f 742e 6669 6775 7265  #topoplot.figure
-000114f0: 2e73 7570 7469 746c 6528 7469 746c 6529  .suptitle(title)
-00011500: 0d0a 2020 2020 2020 2020 746f 706f 706c  ..        topopl
-00011510: 6f74 2e73 686f 7728 290d 0a20 2020 2020  ot.show()..     
-00011520: 2020 2069 6620 7361 7665 6669 673a 0d0a     if savefig:..
-00011530: 2020 2020 2020 2020 2020 2020 6669 676e              fign
-00011540: 616d 6520 3d20 272d 272e 6a6f 696e 285b  ame = '-'.join([
-00011550: 7365 6c66 2e6d 6574 612e 6461 7461 5b27  self.meta.data['
-00011560: 7061 7468 275d 202b 2073 656c 662e 7363  path'] + self.sc
-00011570: 6f70 652c 2073 656c 662e 6d65 7461 2e64  ope, self.meta.d
-00011580: 6174 615b 2764 6174 615f 6964 275d 2c20  ata['data_id'], 
-00011590: 7469 746c 652c 2022 746f 706f 732e 7376  title, "topos.sv
-000115a0: 6722 5d29 0d0a 2020 2020 2020 2020 2020  g"])..          
-000115b0: 2020 746f 706f 706c 6f74 2e73 6176 6566    topoplot.savef
-000115c0: 6967 2866 6967 6e61 6d65 2c20 666f 726d  ig(figname, form
-000115d0: 6174 3d27 7376 6727 2c20 7472 616e 7370  at='svg', transp
-000115e0: 6172 656e 743d 5472 7565 290d 0a20 2020  arent=True)..   
-000115f0: 2020 2020 2072 6574 7572 6e20 746f 706f       return topo
-00011600: 706c 6f74 0d0a 2020 2020 0d0a 2020 2020  plot..    ..    
-00011610: 6465 6620 706c 6f74 5f74 6f70 6f73 2873  def plot_topos(s
-00011620: 656c 662c 2074 6f70 6f73 2c20 7365 6e73  elf, topos, sens
-00011630: 6f72 5f6c 6179 6f75 743d 2756 6563 746f  or_layout='Vecto
-00011640: 7276 6965 772d 6d61 6727 2c20 636c 6173  rview-mag', clas
-00011650: 735f 7375 6273 6574 3d4e 6f6e 652c 0d0a  s_subset=None,..
-00011660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011670: 2020 2074 6974 6c65 3d22 436c 6173 7320     title="Class 
-00011680: 2567 2229 3a0d 0a20 2020 2020 2020 2022  %g"):..        "
-00011690: 2222 0d0a 2020 2020 2020 2020 506c 6f74  ""..        Plot
-000116a0: 2061 6e79 2073 7061 7469 616c 2064 6973   any spatial dis
-000116b0: 7472 6962 7574 696f 6e20 696e 2074 6865  tribution in the
-000116c0: 2073 656e 736f 7220 7370 6163 652e 0d0a   sensor space...
-000116d0: 2020 2020 2020 2020 544f 444f 3a20 496e          TODO: In
-000116e0: 7465 7270 6f6c 6174 696f 6e3f 3f0d 0a0d  terpolation??...
-000116f0: 0a0d 0a20 2020 2020 2020 2050 6172 616d  ...        Param
-00011700: 6574 6572 730d 0a20 2020 2020 2020 202d  eters..        -
-00011710: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 2020  ---------..     
-00011720: 2020 2074 6f70 6f73 203a 206e 702e 6172     topos : np.ar
-00011730: 7261 790d 0a20 2020 2020 2020 2020 2020  ray..           
-00011740: 205b 6e5f 6368 2c20 6e5f 636c 6173 7365   [n_ch, n_classe
-00011750: 732c 202e 2e2e 5d0d 0a20 2020 2020 2020  s, ...]..       
-00011760: 2073 656e 736f 725f 6c61 796f 7574 203a   sensor_layout :
-00011770: 2054 5950 452c 206f 7074 696f 6e61 6c0d   TYPE, optional.
-00011780: 0a20 2020 2020 2020 2020 2020 2044 4553  .            DES
-00011790: 4352 4950 5449 4f4e 2e20 5468 6520 6465  CRIPTION. The de
-000117a0: 6661 756c 7420 6973 2027 5665 6374 6f72  fault is 'Vector
-000117b0: 7669 6577 2d6d 6167 272e 0d0a 2020 2020  view-mag'...    
-000117c0: 2020 2020 636c 6173 735f 7375 6273 6574      class_subset
-000117d0: 2020 3a20 6e70 2e61 7272 6179 2c20 6f70    : np.array, op
-000117e0: 7469 6f6e 616c 0d0a 0d0a 2020 2020 2020  tional....      
-000117f0: 2020 5265 7475 726e 730d 0a20 2020 2020    Returns..     
-00011800: 2020 202d 2d2d 2d2d 2d2d 0d0a 2020 2020     -------..    
-00011810: 2020 2020 4e6f 6e65 2e0d 0a0d 0a20 2020      None.....   
-00011820: 2020 2020 2022 2222 0d0a 200d 0a20 2020       """.. ..   
-00011830: 2020 2020 2069 6620 746f 706f 732e 6e64       if topos.nd
-00011840: 696d 203e 2032 3a0d 0a20 2020 2020 2020  im > 2:..       
-00011850: 2020 2020 2074 6f70 6f73 203d 2074 6f70       topos = top
-00011860: 6f73 2e6d 6561 6e28 2d31 290d 0a20 2020  os.mean(-1)..   
-00011870: 2020 2020 2074 6f70 6f73 5f6e 6577 203d       topos_new =
-00011880: 2074 6f70 6f73 202f 2074 6f70 6f73 2e73   topos / topos.s
-00011890: 7464 2830 2c20 6b65 6570 6469 6d73 3d54  td(0, keepdims=T
-000118a0: 7275 6529 0d0a 0d0a 2020 2020 2020 2020  rue)....        
-000118b0: 6e20 3d20 746f 706f 732e 7368 6170 655b  n = topos.shape[
-000118c0: 315d 0d0a 0d0a 2020 2020 2020 2020 6966  1]....        if
-000118d0: 2063 6c61 7373 5f73 7562 7365 7420 6973   class_subset is
-000118e0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-000118f0: 2020 2020 636c 6173 735f 7375 6273 6574      class_subset
-00011900: 203d 206e 702e 6172 616e 6765 2830 2c20   = np.arange(0, 
-00011910: 206e 2c20 312e 290d 0a0d 0a20 2020 2020   n, 1.)....     
-00011920: 2020 2066 616b 655f 6576 6f6b 6564 203d     fake_evoked =
-00011930: 2073 656c 662e 6d61 6b65 5f66 616b 655f   self.make_fake_
-00011940: 6576 6f6b 6564 2874 6f70 6f73 5f6e 6577  evoked(topos_new
-00011950: 2c20 7365 6e73 6f72 5f6c 6179 6f75 7429  , sensor_layout)
-00011960: 0d0a 0d0a 2020 2020 2020 2020 6674 203d  ....        ft =
-00011970: 2066 616b 655f 6576 6f6b 6564 2e70 6c6f   fake_evoked.plo
-00011980: 745f 746f 706f 6d61 7028 7469 6d65 733d  t_topomap(times=
-00011990: 636c 6173 735f 7375 6273 6574 2c0d 0a20  class_subset,.. 
-000119a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000119b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000119c0: 2020 2063 6f6c 6f72 6261 723d 5472 7565     colorbar=True
-000119d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000119e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000119f0: 2020 2020 2020 2073 6361 6c69 6e67 733d         scalings=
-00011a00: 312c 0d0a 2020 2020 2020 2020 2020 2020  1,..            
-00011a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a20: 2020 2020 2020 2020 7469 6d65 5f66 6f72          time_for
-00011a30: 6d61 743d 7469 746c 652c 0d0a 2020 2020  mat=title,..    
-00011a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a60: 6f75 746c 696e 6573 3d27 6865 6164 272c  outlines='head',
-00011a70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00011a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a90: 2020 2020 2020 2376 6c69 6d3d 206e 702e        #vlim= np.
-00011aa0: 7065 7263 656e 7469 6c65 2874 6f70 6f73  percentile(topos
-00011ab0: 2c20 5b35 2c20 3935 5d29 0d0a 2020 2020  , [5, 95])..    
-00011ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ae0: 290d 0a20 2020 2020 2020 2023 6674 2e73  )..        #ft.s
-00011af0: 686f 7728 290d 0a20 2020 2020 2020 2072  how()..        r
-00011b00: 6574 7572 6e20 6674 0d0a 2020 2020 0d0a  eturn ft..    ..
-00011b10: 2020 2020 6465 6620 6d61 6b65 5f66 616b      def make_fak
-00011b20: 655f 6576 6f6b 6564 2873 656c 662c 2074  e_evoked(self, t
-00011b30: 6f70 6f73 2c20 7365 6e73 6f72 5f6c 6179  opos, sensor_lay
-00011b40: 6f75 7429 3a0d 0a20 2020 2020 2020 2069  out):..        i
-00011b50: 6620 2769 6e66 6f27 206e 6f74 2069 6e20  f 'info' not in 
-00011b60: 7365 6c66 2e6d 6574 612e 6461 7461 2e6b  self.meta.data.k
-00011b70: 6579 7328 293a 0d0a 2020 2020 2020 2020  eys():..        
-00011b80: 2020 2020 6c6f 203d 2063 6861 6e6e 656c      lo = channel
-00011b90: 732e 7265 6164 5f6c 6179 6f75 7428 7365  s.read_layout(se
-00011ba0: 6e73 6f72 5f6c 6179 6f75 7429 0d0a 2020  nsor_layout)..  
-00011bb0: 2020 2020 2020 2020 2020 236c 6f20 3d20            #lo = 
-00011bc0: 6368 616e 6e65 6c73 2e67 656e 6572 6174  channels.generat
-00011bd0: 655f 3264 5f6c 6179 6f75 7428 6c6f 2e70  e_2d_layout(lo.p
-00011be0: 6f73 290d 0a20 2020 2020 2020 2020 2020  os)..           
-00011bf0: 2069 6e66 6f20 3d20 6372 6561 7465 5f69   info = create_i
-00011c00: 6e66 6f28 6c6f 2e6e 616d 6573 2c20 312e  nfo(lo.names, 1.
-00011c10: 2c20 7365 6e73 6f72 5f6c 6179 6f75 742e  , sensor_layout.
-00011c20: 7370 6c69 7428 272d 2729 5b2d 315d 290d  split('-')[-1]).
-00011c30: 0a20 2020 2020 2020 2020 2020 206f 7269  .            ori
-00011c40: 675f 7879 203d 206e 702e 6d65 616e 286c  g_xy = np.mean(l
-00011c50: 6f2e 706f 735b 3a2c 203a 325d 2c20 3029  o.pos[:, :2], 0)
-00011c60: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-00011c70: 7220 692c 2063 6820 696e 2065 6e75 6d65  r i, ch in enume
-00011c80: 7261 7465 286c 6f2e 6e61 6d65 7329 3a0d  rate(lo.names):.
-00011c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011ca0: 2069 6620 696e 666f 5b27 6368 7327 5d5b   if info['chs'][
-00011cb0: 695d 5b27 6368 5f6e 616d 6527 5d20 3d3d  i]['ch_name'] ==
-00011cc0: 2063 683a 0d0a 2020 2020 2020 2020 2020   ch:..          
-00011cd0: 2020 2020 2020 2020 2020 696e 666f 5b27            info['
-00011ce0: 6368 7327 5d5b 695d 5b27 6c6f 6327 5d5b  chs'][i]['loc'][
-00011cf0: 3a32 5d20 3d20 286c 6f2e 706f 735b 692c  :2] = (lo.pos[i,
-00011d00: 203a 325d 202d 206f 7269 675f 7879 292f   :2] - orig_xy)/
-00011d10: 342e 350d 0a20 2020 2020 2020 2020 2020  4.5..           
-00011d20: 2020 2020 2020 2020 2023 696e 666f 5b27           #info['
-00011d30: 6368 7327 5d5b 695d 5b27 6c6f 6327 5d5b  chs'][i]['loc'][
-00011d40: 343a 5d20 3d20 300d 0a20 2020 2020 2020  4:] = 0..       
-00011d50: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-00011d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d70: 2020 2020 7072 696e 7428 2243 6861 6e6e      print("Chann
-00011d80: 656c 206e 616d 6520 6d69 736d 6174 6368  el name mismatch
-00011d90: 2e20 696e 666f 3a20 7b7d 2076 7320 6c6f  . info: {} vs lo
-00011da0: 3a20 7b7d 222e 666f 726d 6174 280d 0a20  : {}".format(.. 
-00011db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011dc0: 2020 2020 2020 2069 6e66 6f5b 2763 6873         info['chs
-00011dd0: 275d 5b69 5d5b 2763 685f 6e61 6d65 275d  '][i]['ch_name']
-00011de0: 2c20 6368 2929 0d0a 2020 2020 2020 2020  , ch))..        
-00011df0: 2369 6e66 6f5b 2773 6672 6571 275d 203d  #info['sfreq'] =
-00011e00: 2031 0d0a 2020 2020 2020 2020 6661 6b65   1..        fake
-00011e10: 5f65 766f 6b65 6420 3d20 6576 6f6b 6564  _evoked = evoked
-00011e20: 2e45 766f 6b65 6441 7272 6179 2874 6f70  .EvokedArray(top
-00011e30: 6f73 2c20 696e 666f 290d 0a20 2020 2020  os, info)..     
-00011e40: 2020 2072 6574 7572 6e20 6661 6b65 5f65     return fake_e
-00011e50: 766f 6b65 640d 0a0d 0a0d 0a20 2020 2064  voked......    d
-00011e60: 6566 2065 7870 6c6f 7265 5f63 6f6d 706f  ef explore_compo
-00011e70: 6e65 6e74 7328 7365 6c66 2c20 7061 7474  nents(self, patt
-00011e80: 6572 6e73 5f73 7472 7563 742c 2073 6f72  erns_struct, sor
-00011e90: 7469 6e67 3d27 6f75 7470 7574 5f63 6f72  ting='output_cor
-00011ea0: 7227 2c0d 0a20 2020 2020 2020 2020 2020  r',..           
-00011eb0: 2020 2020 2020 2020 2020 2020 2020 696e                in
-00011ec0: 7465 6772 6174 653d 276d 6178 272c 2069  tegrate='max', i
-00011ed0: 6e66 6f3d 4e6f 6e65 2c20 7365 6e73 6f72  nfo=None, sensor
-00011ee0: 5f6c 6179 6f75 743d 2756 6563 746f 7276  _layout='Vectorv
-00011ef0: 6965 772d 6772 6164 272c 0d0a 2020 2020  iew-grad',..    
-00011f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011f10: 2020 2020 2063 6c61 7373 5f6e 616d 6573       class_names
-00011f20: 3d4e 6f6e 6529 3a0d 0a20 2020 2020 2020  =None):..       
-00011f30: 2022 2222 506c 6f74 7320 7468 6520 7765   """Plots the we
-00011f40: 6967 6874 7320 6f66 2074 6865 206f 7574  ights of the out
-00011f50: 7075 7420 6c61 7965 722e 0d0a 0d0a 2020  put layer.....  
-00011f60: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-00011f70: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
-00011f80: 2d2d 2d2d 0d0a 0d0a 2020 2020 2020 2020  ----....        
-00011f90: 7061 7420 3a20 696e 7420 5b30 2c20 7365  pat : int [0, se
-00011fa0: 6c66 2e73 7065 6373 5b27 6e5f 6c61 7465  lf.specs['n_late
-00011fb0: 6e74 275d 290d 0a20 2020 2020 2020 2020  nt'])..         
-00011fc0: 2020 2049 6e64 6578 206f 6620 7468 6520     Index of the 
-00011fd0: 6c61 7465 6e74 2063 6f6d 706f 6e65 6e74  latent component
-00011fe0: 2074 6f20 6869 676c 6967 6874 0d0a 0d0a   to higlight....
-00011ff0: 2020 2020 2020 2020 7420 3a20 696e 7420          t : int 
-00012000: 5b30 2c20 7365 6c66 2e68 5f70 6172 616d  [0, self.h_param
-00012010: 735b 276e 5f74 275d 290d 0a20 2020 2020  s['n_t'])..     
-00012020: 2020 2020 2020 2049 6e64 6578 206f 6620         Index of 
-00012030: 7469 6d65 706f 696e 7420 746f 2068 6967  timepoint to hig
-00012040: 686c 6967 6874 0d0a 0d0a 2020 2020 2020  hlight....      
-00012050: 2020 5265 7475 726e 730d 0a20 2020 2020    Returns..     
-00012060: 2020 202d 2d2d 2d2d 2d2d 0d0a 2020 2020     -------..    
-00012070: 2020 2020 6669 6775 7265 203a 0d0a 2020      figure :..  
-00012080: 2020 2020 2020 2020 2020 496d 7368 6f77            Imshow
-00012090: 205b 6e5f 6c61 7465 6e74 2c20 795f 7368   [n_latent, y_sh
-000120a0: 6170 655d 0d0a 0d0a 2020 2020 2020 2020  ape]....        
-000120b0: 2222 220d 0a20 2020 2020 2020 2073 656c  """..        sel
-000120c0: 662e 6d65 7461 2e65 7870 6c6f 7265 5f63  f.meta.explore_c
-000120d0: 6f6d 706f 6e65 6e74 7328 290d 0a0d 0a0d  omponents().....
-000120e0: 0a0d 0a0d 0a20 2020 2064 6566 2070 6c6f  .....    def plo
-000120f0: 745f 7761 7665 666f 726d 7328 7365 6c66  t_waveforms(self
-00012100: 2c20 7061 7474 6572 6e73 5f73 7472 7563  , patterns_struc
-00012110: 742c 2073 6f72 7469 6e67 3d27 636f 6d70  t, sorting='comp
-00012120: 7769 7365 5f6c 6f73 7327 2c20 746d 696e  wise_loss', tmin
-00012130: 3d30 2c20 636c 6173 735f 6e61 6d65 733d  =0, class_names=
-00012140: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2020  None,..         
-00012150: 2020 2020 2020 2020 2020 2020 2020 6270                bp
-00012160: 5f66 696c 7465 723d 4661 6c73 652c 2074  _filter=False, t
-00012170: 6c69 6d3d 4e6f 6e65 2c20 6170 706c 795f  lim=None, apply_
-00012180: 6b65 726e 656c 733d 4661 6c73 6529 3a0d  kernels=False):.
-00012190: 0a20 2020 2020 2020 2022 2222 506c 6f74  .        """Plot
-000121a0: 7320 7469 6d65 636f 7572 7365 7320 6f66  s timecourses of
-000121b0: 206c 6174 656e 7420 636f 6d70 6f6e 656e   latent componen
-000121c0: 7473 2e0d 0a0d 0a20 2020 2020 2020 2050  ts.....        P
-000121d0: 6172 616d 6574 6572 730d 0a20 2020 2020  arameters..     
-000121e0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20     ----------.. 
-000121f0: 2020 2020 2020 2074 6d69 6e20 3a20 666c         tmin : fl
-00012200: 6f61 740d 0a20 2020 2020 2020 2020 2020  oat..           
-00012210: 2042 6567 696e 6e69 6e67 206f 6620 7468   Beginning of th
-00012220: 6520 4d45 4720 6570 6f63 6820 7769 7468  e MEG epoch with
-00012230: 2072 6567 6172 6420 746f 2072 6566 6572   regard to refer
-00012240: 656e 6365 2065 7665 6e74 2e0d 0a20 2020  ence event...   
-00012250: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
-00012260: 7320 746f 2030 2e0d 0a0d 0a0d 0a20 2020  s to 0.......   
-00012270: 2020 2020 2073 6f72 7469 6e67 203a 2073       sorting : s
-00012280: 7472 0d0a 2020 2020 2020 2020 2020 2020  tr..            
-00012290: 6865 7572 6973 7469 6320 666f 7220 7365  heuristic for se
-000122a0: 6c65 6374 696e 6720 7265 6c65 7661 6e74  lecting relevant
-000122b0: 2063 6f6d 706f 6e65 6e74 732e 2053 6565   components. See
-000122c0: 204c 4643 4e4e 2e5f 736f 7274 696e 670d   LFCNN._sorting.
-000122d0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
-000122e0: 2020 2020 2020 2369 6620 6e6f 7420 6861        #if not ha
-000122f0: 7361 7474 7228 7365 6c66 2c20 2777 6176  sattr(self, 'wav
-00012300: 6566 6f72 6d73 2729 3a0d 0a20 2020 2020  eforms'):..     
-00012310: 2020 2023 2020 2020 7365 6c66 2e63 6f6d     #    self.com
-00012320: 7075 7465 5f70 6174 7465 726e 7328 7365  pute_patterns(se
-00012330: 6c66 2e64 6174 6173 6574 290d 0a0d 0a20  lf.dataset).... 
-00012340: 2020 2020 2020 2023 6966 206e 6f74 2068         #if not h
-00012350: 6173 6174 7472 2873 656c 662c 2027 756f  asattr(self, 'uo
-00012360: 7264 6572 2729 3a0d 0a20 2020 2020 2020  rder'):..       
-00012370: 206f 7264 6572 2c20 5f20 3d20 7365 6c66   order, _ = self
-00012380: 2e5f 736f 7274 696e 6728 7061 7474 6572  ._sorting(patter
-00012390: 6e73 5f73 7472 7563 742c 2073 6f72 7469  ns_struct, sorti
-000123a0: 6e67 290d 0a20 2020 2020 2020 2073 656c  ng)..        sel
-000123b0: 662e 756f 7264 6572 203d 206f 7264 6572  f.uorder = order
-000123c0: 2e72 6176 656c 2829 0d0a 2020 2020 2020  .ravel()..      
-000123d0: 2020 7761 7665 666f 726d 7320 3d20 7061    waveforms = pa
-000123e0: 7474 6572 6e73 5f73 7472 7563 745b 2763  tterns_struct['c
-000123f0: 636d 7327 5d5b 2774 636f 6e76 275d 0d0a  cms']['tconv']..
-00012400: 0d0a 2020 2020 2020 2020 2020 2020 2373  ..            #s
-00012410: 656c 662e 756f 7264 6572 203d 206e 702e  elf.uorder = np.
-00012420: 7371 7565 657a 6528 6f72 6465 7229 0d0a  squeeze(order)..
-00012430: 2020 2020 2020 2020 2370 7269 6e74 2873          #print(s
-00012440: 656c 662e 756f 7264 6572 290d 0a20 2020  elf.uorder)..   
-00012450: 2020 2020 2069 6620 6e6f 7420 636c 6173       if not clas
-00012460: 735f 6e61 6d65 733a 0d0a 2020 2020 2020  s_names:..      
-00012470: 2020 2020 2020 636c 6173 735f 6e61 6d65        class_name
-00012480: 7320 3d20 5b22 436c 6173 7320 7b7d 222e  s = ["Class {}".
-00012490: 666f 726d 6174 2869 2920 666f 7220 6920  format(i) for i 
-000124a0: 696e 2072 616e 6765 2873 656c 662e 795f  in range(self.y_
-000124b0: 7368 6170 655b 2d31 5d29 5d0d 0a0d 0a20  shape[-1])].... 
-000124c0: 2020 2020 2020 2066 2c20 6178 203d 2070         f, ax = p
-000124d0: 6c74 2e73 7562 706c 6f74 7328 322c 2032  lt.subplots(2, 2
-000124e0: 290d 0a20 2020 2020 2020 2066 2e73 6574  )..        f.set
-000124f0: 5f73 697a 655f 696e 6368 6573 285b 3136  _size_inches([16
-00012500: 2c20 3136 5d29 0d0a 2020 2020 2020 2020  , 16])..        
-00012510: 6966 206e 702e 616e 7928 7365 6c66 2e75  if np.any(self.u
-00012520: 6f72 6465 7229 3a0d 0a20 2020 2020 2020  order):..       
-00012530: 2020 2020 2023 666f 7220 6a6a 2c20 756f       #for jj, uo
-00012540: 2069 6e20 656e 756d 6572 6174 6528 7365   in enumerate(se
-00012550: 6c66 2e75 6f72 6465 7229 3a0d 0a20 2020  lf.uorder):..   
-00012560: 2020 2020 2020 2020 206e 7420 3d20 7365           nt = se
-00012570: 6c66 2e64 6174 6173 6574 2e68 5f70 6172  lf.dataset.h_par
-00012580: 616d 735b 276e 5f74 275d 0d0a 0d0a 2020  ams['n_t']....  
-00012590: 2020 2020 2020 2020 2020 7473 7465 7020            tstep 
-000125a0: 3d20 312f 666c 6f61 7428 7365 6c66 2e64  = 1/float(self.d
-000125b0: 6174 6173 6574 2e68 5f70 6172 616d 735b  ataset.h_params[
-000125c0: 2766 7327 5d29 0d0a 2020 2020 2020 2020  'fs'])..        
-000125d0: 2020 2020 7469 6d65 7320 3d20 746d 696e      times = tmin
-000125e0: 202b 2074 7374 6570 2a6e 702e 6172 616e   + tstep*np.aran
-000125f0: 6765 286e 7429 0d0a 2020 2020 2020 2020  ge(nt)..        
-00012600: 2020 2020 6966 2061 7070 6c79 5f6b 6572      if apply_ker
-00012610: 6e65 6c73 3a0d 0a20 2020 2020 2020 2020  nels:..         
-00012620: 2020 2020 2020 2073 6361 6c65 645f 7761         scaled_wa
-00012630: 7665 666f 726d 7320 3d20 6e70 2e61 7272  veforms = np.arr
-00012640: 6179 285b 6e70 2e63 6f6e 766f 6c76 6528  ay([np.convolve(
-00012650: 6b65 726e 2c20 7766 2c20 2773 616d 6527  kern, wf, 'same'
-00012660: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00012670: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00012680: 6f72 206b 6572 6e2c 2077 6620 696e 207a  or kern, wf in z
-00012690: 6970 2873 656c 662e 6669 6c74 6572 732c  ip(self.filters,
-000126a0: 2073 656c 662e 7761 7665 666f 726d 7329   self.waveforms)
-000126b0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-000126c0: 2020 2020 2373 6361 6c65 645f 7761 7665      #scaled_wave
-000126d0: 666f 726d 7320 3d28 7363 616c 6564 5f77  forms =(scaled_w
-000126e0: 6176 6566 6f72 6d73 202d 2073 6361 6c65  aveforms - scale
-000126f0: 645f 7761 7665 666f 726d 732e 6d65 616e  d_waveforms.mean
-00012700: 282d 312c 206b 6565 7064 696d 733d 5472  (-1, keepdims=Tr
-00012710: 7565 2929 2020 2f20 2832 2a73 6361 6c65  ue))  / (2*scale
-00012720: 645f 7761 7665 666f 726d 732e 7374 6428  d_waveforms.std(
-00012730: 2d31 2c20 6b65 6570 6469 6d73 3d54 7275  -1, keepdims=Tru
-00012740: 6529 290d 0a20 2020 2020 2020 2020 2020  e))..           
-00012750: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00012760: 2020 2020 2020 2020 2373 6361 6c69 6e67          #scaling
-00012770: 203d 2033 2a6e 702e 6d65 616e 286e 702e   = 3*np.mean(np.
-00012780: 7374 6428 7365 6c66 2e77 6176 6566 6f72  std(self.wavefor
-00012790: 6d73 2c20 2d31 2929 0d0a 0d0a 2020 2020  ms, -1))....    
-000127a0: 2020 2020 2020 2020 2020 2020 7363 616c              scal
-000127b0: 6564 5f77 6176 6566 6f72 6d73 203d 2028  ed_waveforms = (
-000127c0: 7761 7665 666f 726d 7320 2d20 7761 7665  waveforms - wave
-000127d0: 666f 726d 732e 6d65 616e 282d 312c 206b  forms.mean(-1, k
-000127e0: 6565 7064 696d 733d 5472 7565 2929 2020  eepdims=True))  
-000127f0: 2f20 2832 2a77 6176 6566 6f72 6d73 2e73  / (2*waveforms.s
-00012800: 7464 282d 312c 206b 6565 7064 696d 733d  td(-1, keepdims=
-00012810: 5472 7565 2929 0d0a 2020 2020 2020 2020  True))..        
-00012820: 2020 2020 6966 2062 705f 6669 6c74 6572      if bp_filter
-00012830: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00012840: 2020 2073 6361 6c65 645f 7761 7665 666f     scaled_wavefo
-00012850: 726d 7320 3d20 7363 616c 6564 5f77 6176  rms = scaled_wav
-00012860: 6566 6f72 6d73 2e61 7374 7970 6528 6e70  eforms.astype(np
-00012870: 2e66 6c6f 6174 3634 290d 0a20 2020 2020  .float64)..     
-00012880: 2020 2020 2020 2020 2020 2073 6361 6c65             scale
-00012890: 645f 7761 7665 666f 726d 7320 3d20 6669  d_waveforms = fi
-000128a0: 6c74 6572 5f64 6174 6128 7363 616c 6564  lter_data(scaled
-000128b0: 5f77 6176 6566 6f72 6d73 2c0d 0a20 2020  _waveforms,..   
+000101f0: 2020 2020 2020 7365 6c66 2e64 6d78 2e73        self.dmx.s
+00010200: 697a 652c 0d0a 2020 2020 2020 2020 2020  ize,..          
+00010210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010220: 2020 2020 2020 2020 7365 6c66 2e6f 7574          self.out
+00010230: 5f64 696d 5d2c 0d0a 2020 2020 2020 2020  _dim],..        
+00010240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010250: 2020 2020 2020 2020 206f 7264 6572 3d27           order='
+00010260: 4327 290d 0a20 2020 2020 2020 2077 6569  C')..        wei
+00010270: 6768 7473 5b27 6663 5f62 275d 203d 2073  ghts['fc_b'] = s
+00010280: 656c 662e 6669 6e5f 6663 2e62 2e6e 756d  elf.fin_fc.b.num
+00010290: 7079 2829 0d0a 2020 2020 2020 2020 6966  py()..        if
+000102a0: 2076 6572 626f 7365 3a0d 0a20 2020 2020   verbose:..     
+000102b0: 2020 2020 2020 2070 7269 6e74 2822 2222         print("""
+000102c0: 2257 6569 6768 7473 3a20 5c6e 0d0a 2020  "Weights: \n..  
+000102d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000102e0: 444d 583a 207b 7d0d 0a20 2020 2020 2020  DMX: {}..       
+000102f0: 2020 2020 2020 2020 2020 2054 434f 4e56             TCONV
+00010300: 3a20 7b7d 0d0a 2020 2020 2020 2020 2020  : {}..          
+00010310: 2020 2020 2020 2020 4643 5f44 454e 5345          FC_DENSE
+00010320: 3a20 7b7d 2222 222e 666f 726d 6174 2877  : {}""".format(w
+00010330: 6569 6768 7473 5b27 646d 7827 5d2e 7368  eights['dmx'].sh
+00010340: 6170 652c 0d0a 2020 2020 2020 2020 2020  ape,..          
+00010350: 2020 2020 2020 2020 7765 6967 6874 735b          weights[
+00010360: 2774 636f 6e76 275d 2e73 6861 7065 2c0d  'tconv'].shape,.
+00010370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010380: 2020 2077 6569 6768 7473 5b27 6f75 745f     weights['out_
+00010390: 7765 6967 6874 7327 5d2e 7368 6170 6529  weights'].shape)
+000103a0: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+000103b0: 6e20 7765 6967 6874 730d 0a0d 0a20 2020  n weights....   
+000103c0: 2064 6566 2063 6f6d 7075 7465 5f63 6f6d   def compute_com
+000103d0: 706f 6e65 6e74 7769 7365 5f6c 6f73 7328  ponentwise_loss(
+000103e0: 7365 6c66 2c20 582c 2079 2c20 7765 6967  self, X, y, weig
+000103f0: 6874 7329 3a0d 0a0d 0a20 2020 2020 2020  hts):....       
+00010400: 2022 2222 0d0a 2020 2020 2020 2020 436f   """..        Co
+00010410: 6d70 7574 6520 636f 6d70 6f6e 656e 7420  mpute component 
+00010420: 7265 6c65 7661 6e63 6573 2062 7920 7265  relevances by re
+00010430: 6375 7273 6976 6520 656c 696d 696e 6174  cursive eliminat
+00010440: 696f 6e0d 0a20 2020 2020 2020 2022 2222  ion..        """
+00010450: 0d0a 2020 2020 2020 2020 6d6f 6465 6c5f  ..        model_
+00010460: 7765 6967 6874 7320 3d20 7365 6c66 2e6b  weights = self.k
+00010470: 6d2e 6765 745f 7765 6967 6874 7328 290d  m.get_weights().
+00010480: 0a20 2020 2020 2020 206f 7269 6769 6e61  .        origina
+00010490: 6c5f 7765 6967 6874 7320 3d20 6d6f 6465  l_weights = mode
+000104a0: 6c5f 7765 6967 6874 732e 636f 7079 2829  l_weights.copy()
+000104b0: 0d0a 2020 2020 2020 2020 6261 7365 5f6c  ..        base_l
+000104c0: 6f73 732c 2062 6173 655f 7065 7266 6f72  oss, base_perfor
+000104d0: 6d61 6e63 6520 3d20 7365 6c66 2e6b 6d2e  mance = self.km.
+000104e0: 6576 616c 7561 7465 2858 2c20 792c 2076  evaluate(X, y, v
+000104f0: 6572 626f 7365 3d30 290d 0a20 2020 2020  erbose=0)..     
+00010500: 2020 2023 2069 6620 6c65 6e28 6261 7365     # if len(base
+00010510: 5f70 6572 666f 726d 616e 6365 203e 2031  _performance > 1
+00010520: 293a 0d0a 2020 2020 2020 2020 2320 2020  ):..        #   
+00010530: 2062 6173 655f 7065 7266 6f72 6d61 6e63   base_performanc
+00010540: 6520 3d20 6262 6173 655f 7065 7266 6f72  e = bbase_perfor
+00010550: 6d61 6e63 655b 305d 0d0a 2020 2020 2020  mance[0]..      
+00010560: 2020 6665 6174 7572 655f 7265 6c65 7661    feature_releva
+00010570: 6e63 6573 5f6c 6f73 7320 3d20 5b5d 0d0a  nces_loss = []..
+00010580: 2020 2020 2020 2020 6e5f 6f75 745f 7420          n_out_t 
+00010590: 3d20 7765 6967 6874 735b 276f 7574 5f77  = weights['out_w
+000105a0: 6569 6768 7473 275d 2e73 6861 7065 5b30  eights'].shape[0
+000105b0: 5d0d 0a20 2020 2020 2020 206e 5f6f 7574  ]..        n_out
+000105c0: 5f79 203d 2077 6569 6768 7473 5b27 6f75  _y = weights['ou
+000105d0: 745f 7765 6967 6874 7327 5d2e 7368 6170  t_weights'].shap
+000105e0: 655b 2d31 5d0d 0a20 2020 2020 2020 2023  e[-1]..        #
+000105f0: 7a65 726f 7765 6967 6874 7320 3d20 6e70  zeroweights = np
+00010600: 2e7a 6572 6f73 2828 6e5f 6f75 745f 742c  .zeros((n_out_t,
+00010610: 2929 0d0a 2020 2020 2020 2020 6c6f 7373  ))..        loss
+00010620: 6573 203d 206e 702e 7a65 726f 7328 5b6e  es = np.zeros([n
+00010630: 5f6f 7574 5f74 2c20 7365 6c66 2e73 7065  _out_t, self.spe
+00010640: 6373 5b27 6e5f 6c61 7465 6e74 275d 2c20  cs['n_latent'], 
+00010650: 6e5f 6f75 745f 795d 290d 0a20 2020 2020  n_out_y])..     
+00010660: 2020 2066 6f72 2074 2069 6e20 7261 6e67     for t in rang
+00010670: 6528 6e5f 6f75 745f 7429 3a0d 0a20 2020  e(n_out_t):..   
+00010680: 2020 2020 2020 2020 2066 6f72 206a 6a20           for jj 
+00010690: 696e 2072 616e 6765 286e 5f6f 7574 5f79  in range(n_out_y
+000106a0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+000106b0: 2020 2020 2366 6f72 2065 6163 6820 636c      #for each cl
+000106c0: 6173 730d 0a20 2020 2020 2020 2020 2020  ass..           
+000106d0: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+000106e0: 6e67 6528 7365 6c66 2e73 7065 6373 5b22  nge(self.specs["
+000106f0: 6e5f 6c61 7465 6e74 225d 293a 0d0a 2020  n_latent"]):..  
+00010700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010710: 2020 2366 6f72 2065 6163 6820 636f 6d70    #for each comp
+00010720: 6f6e 656e 740d 0a20 2020 2020 2020 2020  onent..         
+00010730: 2020 2020 2020 2020 2020 2023 6c6f 7373             #loss
+00010740: 5f70 6572 5f63 6f6d 706f 6e65 6e74 203d  _per_component =
+00010750: 205b 5d0d 0a20 2020 200d 0a20 2020 2020   []..    ..     
+00010760: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00010770: 6577 5f77 6569 6768 7473 203d 2077 6569  ew_weights = wei
+00010780: 6768 7473 5b27 6f75 745f 7765 6967 6874  ghts['out_weight
+00010790: 7327 5d2e 636f 7079 2829 0d0a 2020 2020  s'].copy()..    
+000107a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000107b0: 6e65 775f 6269 6173 203d 2077 6569 6768  new_bias = weigh
+000107c0: 7473 5b27 6663 5f62 275d 2e63 6f70 7928  ts['fc_b'].copy(
+000107d0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000107e0: 2020 2020 2020 206e 6577 5f77 6569 6768         new_weigh
+000107f0: 7473 5b74 2c20 692c 206a 6a5d 203d 2030  ts[t, i, jj] = 0
+00010800: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00010810: 2020 2020 2020 6e65 775f 6269 6173 5b6a        new_bias[j
+00010820: 6a5d 203d 2030 0d0a 2020 2020 2020 2020  j] = 0..        
+00010830: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00010840: 7765 6967 6874 7320 3d20 6e70 2e72 6573  weights = np.res
+00010850: 6861 7065 286e 6577 5f77 6569 6768 7473  hape(new_weights
+00010860: 2c20 7765 6967 6874 735b 276f 7574 5f77  , weights['out_w
+00010870: 5f66 6c61 7427 5d2e 7368 6170 6529 0d0a  _flat'].shape)..
+00010880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010890: 2020 2020 6d6f 6465 6c5f 7765 6967 6874      model_weight
+000108a0: 735b 2d32 5d20 3d20 6e65 775f 7765 6967  s[-2] = new_weig
+000108b0: 6874 730d 0a20 2020 2020 2020 2020 2020  hts..           
+000108c0: 2020 2020 2020 2020 206d 6f64 656c 5f77           model_w
+000108d0: 6569 6768 7473 5b2d 315d 203d 206e 6577  eights[-1] = new
+000108e0: 5f62 6961 730d 0a20 2020 2020 2020 2020  _bias..         
+000108f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00010900: 6b6d 2e73 6574 5f77 6569 6768 7473 286d  km.set_weights(m
+00010910: 6f64 656c 5f77 6569 6768 7473 290d 0a20  odel_weights).. 
+00010920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010930: 2020 206c 6f73 7320 3d20 7365 6c66 2e6b     loss = self.k
+00010940: 6d2e 6576 616c 7561 7465 2858 2c20 792c  m.evaluate(X, y,
+00010950: 2076 6572 626f 7365 3d30 295b 305d 0d0a   verbose=0)[0]..
+00010960: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
+00010970: 2020 2020 2020 2020 2020 236c 6f73 735f            #loss_
+00010980: 7065 725f 636f 6d70 6f6e 656e 742e 6170  per_component.ap
+00010990: 7065 6e64 2862 6173 655f 6c6f 7373 202d  pend(base_loss -
+000109a0: 206c 6f73 7329 0d0a 2020 2020 2020 2020   loss)..        
+000109b0: 2020 2020 2020 2020 2020 2020 6c6f 7373              loss
+000109c0: 6573 5b74 2c20 692c 206a 6a5d 203d 206c  es[t, i, jj] = l
+000109d0: 6f73 7320 2d20 6261 7365 5f6c 6f73 730d  oss - base_loss.
+000109e0: 0a20 2020 2020 2020 2020 2020 2023 6665  .            #fe
+000109f0: 6174 7572 655f 7265 6c65 7661 6e63 6573  ature_relevances
+00010a00: 5f6c 6f73 732e 6170 7065 6e64 286e 702e  _loss.append(np.
+00010a10: 6172 7261 7928 6c6f 7373 5f70 6572 5f63  array(loss_per_c
+00010a20: 636f 6d70 6f6e 656e 7429 290d 0a20 2020  component))..   
+00010a30: 2020 2020 2023 7072 696e 7428 6c6f 7373       #print(loss
+00010a40: 6573 2e73 6861 7065 290d 0a20 2020 2020  es.shape)..     
+00010a50: 2020 2073 656c 662e 6b6d 2e73 6574 5f77     self.km.set_w
+00010a60: 6569 6768 7473 286f 7269 6769 6e61 6c5f  eights(original_
+00010a70: 7765 6967 6874 7329 0d0a 2020 2020 2020  weights)..      
+00010a80: 2020 7265 7475 726e 206c 6f73 7365 730d    return losses.
+00010a90: 0a0d 0a0d 0a20 2020 2064 6566 2067 6574  .....    def get
+00010aa0: 5f6f 7574 7075 745f 636f 7272 656c 6174  _output_correlat
+00010ab0: 696f 6e73 2873 656c 662c 2061 6374 6976  ions(self, activ
+00010ac0: 6174 696f 6e73 2c20 795f 7472 7565 293a  ations, y_true):
+00010ad0: 0d0a 2020 2020 2020 2020 2222 2243 6f6d  ..        """Com
+00010ae0: 7075 7465 7320 6120 7369 6d69 6c61 7269  putes a similari
+00010af0: 7479 206d 6574 7269 6320 6265 7477 6565  ty metric betwee
+00010b00: 6e20 6561 6368 206f 6620 7468 6520 6578  n each of the ex
+00010b10: 7472 6163 7465 640d 0a20 2020 2020 2020  tracted..       
+00010b20: 2066 6561 7475 7265 7320 616e 6420 7468   features and th
+00010b30: 6520 7461 7267 6574 2076 6172 6961 626c  e target variabl
+00010b40: 652e 0d0a 0d0a 2020 2020 2020 2020 5468  e.....        Th
+00010b50: 6520 6d65 7472 6963 2069 7320 6120 4d61  e metric is a Ma
+00010b60: 6e68 6174 7461 6e20 6469 7374 616e 6365  nhattan distance
+00010b70: 2066 6f72 2064 6963 7265 7465 2074 6172   for dicrete tar
+00010b80: 6765 7473 2c20 616e 640d 0a20 2020 2020  gets, and..     
+00010b90: 2020 2053 7065 6172 6d61 6e20 636f 7272     Spearman corr
+00010ba0: 656c 6174 696f 6e20 666f 7220 636f 6e74  elation for cont
+00010bb0: 696e 756f 7573 2074 6172 6765 7473 2e0d  inuous targets..
+00010bc0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+00010bd0: 2020 2020 2020 636f 7272 5f74 6f5f 6f75        corr_to_ou
+00010be0: 7470 7574 203d 205b 5d0d 0a20 2020 2020  tput = []..     
+00010bf0: 2020 2079 5f74 7275 6520 3d20 795f 7472     y_true = y_tr
+00010c00: 7565 2e6e 756d 7079 2829 0d0a 2020 2020  ue.numpy()..    
+00010c10: 2020 2020 666c 6174 5f66 6561 7473 203d      flat_feats =
+00010c20: 2061 6374 6976 6174 696f 6e73 5b27 7463   activations['tc
+00010c30: 6f6e 7627 5d2e 6e75 6d70 7928 292e 7265  onv'].numpy().re
+00010c40: 7368 6170 6528 795f 7472 7565 2e73 6861  shape(y_true.sha
+00010c50: 7065 5b30 5d2c 202d 3129 0d0a 0d0a 2020  pe[0], -1)....  
+00010c60: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00010c70: 666f 7220 795f 2069 6e20 795f 7472 7565  for y_ in y_true
+00010c80: 2e54 3a0d 0a20 2020 2020 2020 2020 2020  .T:..           
+00010c90: 2069 6620 7365 6c66 2e64 6174 6173 6574   if self.dataset
+00010ca0: 2e68 5f70 6172 616d 735b 2774 6172 6765  .h_params['targe
+00010cb0: 745f 7479 7065 275d 2069 6e20 5b27 666c  t_type'] in ['fl
+00010cc0: 6f61 7427 2c20 2773 6967 6e61 6c27 5d3a  oat', 'signal']:
+00010cd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00010ce0: 2020 7266 6f63 7320 3d20 6e70 2e61 7272    rfocs = np.arr
+00010cf0: 6179 285b 7370 6561 726d 616e 7228 795f  ay([spearmanr(y_
+00010d00: 2c20 6629 5b30 5d20 666f 7220 6620 696e  , f)[0] for f in
+00010d10: 2066 6c61 745f 6665 6174 732e 545d 290d   flat_feats.T]).
+00010d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010d30: 2063 6f72 725f 746f 5f6f 7574 7075 742e   corr_to_output.
+00010d40: 6170 7065 6e64 2872 666f 6373 2e72 6573  append(rfocs.res
+00010d50: 6861 7065 2861 6374 6976 6174 696f 6e73  hape(activations
+00010d60: 5b27 7463 6f6e 7627 5d2e 7368 6170 655b  ['tconv'].shape[
+00010d70: 313a 5d29 290d 0a0d 0a0d 0a20 2020 2020  1:]))......     
+00010d80: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+00010d90: 2e64 6174 6173 6574 2e68 5f70 6172 616d  .dataset.h_param
+00010da0: 735b 2774 6172 6765 745f 7479 7065 275d  s['target_type']
+00010db0: 203d 3d20 2769 6e74 273a 0d0a 2020 2020   == 'int':..    
+00010dc0: 2020 2020 2020 2020 2020 2020 7266 6f63              rfoc
+00010dd0: 7320 3d20 6e70 2e61 7272 6179 285b 7065  s = np.array([pe
+00010de0: 6172 736f 6e72 2879 5f2c 2066 295b 305d  arsonr(y_, f)[0]
+00010df0: 2066 6f72 2066 2069 6e20 666c 6174 5f66   for f in flat_f
+00010e00: 6561 7473 2e54 5d29 0d0a 2020 2020 2020  eats.T])..      
+00010e10: 2020 2020 2020 2020 2020 636f 7272 5f74            corr_t
+00010e20: 6f5f 6f75 7470 7574 2e61 7070 656e 6428  o_output.append(
+00010e30: 7266 6f63 732e 7265 7368 6170 6528 6163  rfocs.reshape(ac
+00010e40: 7469 7661 7469 6f6e 735b 2774 636f 6e76  tivations['tconv
+00010e50: 275d 2e73 6861 7065 5b31 3a5d 2929 0d0a  '].shape[1:]))..
+00010e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e70: 2379 5f74 7275 6520 3d20 795f 7472 7565  #y_true = y_true
+00010e80: 2f6e 702e 6c69 6e61 6c67 2e6e 6f72 6d28  /np.linalg.norm(
+00010e90: 795f 7472 7565 2c20 6f72 643d 312c 2061  y_true, ord=1, a
+00010ea0: 7869 733d 3029 5b4e 6f6e 652c 203a 5d0d  xis=0)[None, :].
+00010eb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010ec0: 2023 666c 6174 5f64 6976 203d 206e 702e   #flat_div = np.
+00010ed0: 6c69 6e61 6c67 2e6e 6f72 6d28 666c 6174  linalg.norm(flat
+00010ee0: 5f66 6561 7473 2c20 312c 2061 7869 733d  _feats, 1, axis=
+00010ef0: 3029 5b4e 6f6e 652c 203a 5d0d 0a20 2020  0)[None, :]..   
+00010f00: 2020 2020 2020 2020 2020 2020 2023 666c               #fl
+00010f10: 6174 5f66 6561 7473 203d 2066 6c61 745f  at_feats = flat_
+00010f20: 6665 6174 732f 666c 6174 5f64 6976 0d0a  feats/flat_div..
+00010f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010f40: 2370 7269 6e74 2822 6666 3a22 2c20 666c  #print("ff:", fl
+00010f50: 6174 5f66 6561 7473 2e73 6861 7065 290d  at_feats.shape).
+00010f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010f70: 2023 7072 696e 7428 2279 5f74 7275 653a   #print("y_true:
+00010f80: 222c 2079 5f74 7275 652e 7368 6170 6529  ", y_true.shape)
+00010f90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00010fa0: 2020 2366 6f72 2079 5f20 696e 2079 5f74    #for y_ in y_t
+00010fb0: 7275 652e 543a 0d0a 2020 2020 2020 2020  rue.T:..        
+00010fc0: 2020 2020 2020 2020 2020 2020 2370 7269              #pri
+00010fd0: 6e74 2827 792e 543a 272c 2079 5f2e 7368  nt('y.T:', y_.sh
+00010fe0: 6170 6529 0d0a 2020 2020 2020 2020 2020  ape)..          
+00010ff0: 2020 2020 2020 2320 2020 2072 666f 6373        #    rfocs
+00011000: 203d 2032 2e20 2d20 6e70 2e73 756d 286e   = 2. - np.sum(n
+00011010: 702e 6162 7328 666c 6174 5f66 6561 7473  p.abs(flat_feats
+00011020: 202d 2079 5f5b 3a2c 204e 6f6e 655d 292c   - y_[:, None]),
+00011030: 2030 290d 0a20 2020 2020 2020 2020 2020   0)..           
+00011040: 2020 2020 2023 2020 2020 636f 7272 5f74       #    corr_t
+00011050: 6f5f 6f75 7470 7574 2e61 7070 656e 6428  o_output.append(
+00011060: 7266 6f63 732e 7265 7368 6170 6528 6163  rfocs.reshape(ac
+00011070: 7469 7661 7469 6f6e 735b 2774 636f 6e76  tivations['tconv
+00011080: 275d 2e73 6861 7065 5b31 3a5d 2929 0d0a  '].shape[1:]))..
+00011090: 0d0a 2020 2020 2020 2020 636f 7272 5f74  ..        corr_t
+000110a0: 6f5f 6f75 7470 7574 203d 206e 702e 636f  o_output = np.co
+000110b0: 6e63 6174 656e 6174 6528 636f 7272 5f74  ncatenate(corr_t
+000110c0: 6f5f 6f75 7470 7574 2c20 3029 2e74 7261  o_output, 0).tra
+000110d0: 6e73 706f 7365 285b 312c 2032 2c20 305d  nspose([1, 2, 0]
+000110e0: 290d 0a20 2020 2020 2020 2023 7072 696e  )..        #prin
+000110f0: 7428 636f 7272 5f74 6f5f 6f75 7470 7574  t(corr_to_output
+00011100: 2e73 6861 7065 290d 0a20 2020 2020 2020  .shape)..       
+00011110: 2069 6620 6e70 2e61 6e79 286e 702e 6973   if np.any(np.is
+00011120: 6e61 6e28 636f 7272 5f74 6f5f 6f75 7470  nan(corr_to_outp
+00011130: 7574 2929 3a0d 0a20 2020 2020 2020 2020  ut)):..         
+00011140: 2020 2063 6f72 725f 746f 5f6f 7574 7075     corr_to_outpu
+00011150: 745b 6e70 2e69 736e 616e 2863 6f72 725f  t[np.isnan(corr_
+00011160: 746f 5f6f 7574 7075 7429 5d20 3d20 300d  to_output)] = 0.
+00011170: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00011180: 636f 7272 5f74 6f5f 6f75 7470 7574 0d0a  corr_to_output..
+00011190: 0d0a 2020 2020 2320 2d2d 2d20 4c46 434e  ..    # --- LFCN
+000111a0: 4e20 706c 6f74 2066 756e 6374 696f 6e73  N plot functions
+000111b0: 202d 2d2d 0d0a 0d0a 2020 2020 6465 6620   ---....    def 
+000111c0: 706c 6f74 5f65 766f 6b65 645f 7065 616b  plot_evoked_peak
+000111d0: 7328 7365 6c66 2c20 6461 7461 3d4e 6f6e  s(self, data=Non
+000111e0: 652c 2074 3d4e 6f6e 652c 2063 6c61 7373  e, t=None, class
+000111f0: 5f73 7562 7365 743d 4e6f 6e65 2c0d 0a20  _subset=None,.. 
+00011200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011210: 2020 2020 2020 2020 2073 656e 736f 725f           sensor_
+00011220: 6c61 796f 7574 3d27 5665 6374 6f72 7669  layout='Vectorvi
+00011230: 6577 2d6d 6167 272c 2074 6974 6c65 3d4e  ew-mag', title=N
+00011240: 6f6e 652c 2073 6176 6566 6967 3d4e 6f6e  one, savefig=Non
+00011250: 6529 3a0d 0a20 2020 2020 2020 2022 2222  e):..        """
+00011260: 0d0a 2020 2020 2020 2020 506c 6f74 206f  ..        Plot o
+00011270: 6e65 2073 7061 7469 616c 2074 6f70 6f67  ne spatial topog
+00011280: 7261 7068 7920 6f66 2063 6c61 7373 2d63  raphy of class-c
+00011290: 6f6e 6469 7469 6f6e 616c 2061 7665 7261  onditional avera
+000112a0: 6765 206f 6620 7468 6520 696e 7075 742e  ge of the input.
+000112b0: 0d0a 2020 2020 2020 2020 4966 2074 696d  ..        If tim
+000112c0: 6570 6f69 6e74 2069 7320 6e6f 7420 7370  epoint is not sp
+000112d0: 6563 6966 6965 6420 6974 2069 7320 7069  ecified it is pi
+000112e0: 636b 6564 2061 7320 6120 6d61 7869 6d75  cked as a maximu
+000112f0: 6d20 524d 5320 666f 7220 6561 6368 0d0a  m RMS for each..
+00011300: 2020 2020 2020 2020 636c 6173 732e 0d0a          class...
+00011310: 0d0a 0d0a 2020 2020 2020 2020 5061 7261  ....        Para
+00011320: 6d65 7465 7273 0d0a 2020 2020 2020 2020  meters..        
+00011330: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
+00011340: 2020 2020 746f 706f 7320 3a20 6e70 2e61      topos : np.a
+00011350: 7272 6179 0d0a 2020 2020 2020 2020 2020  rray..          
+00011360: 2020 5b6e 5f63 682c 206e 5f74 2c20 6e5f    [n_ch, n_t, n_
+00011370: 636c 6173 7365 735d 0d0a 2020 2020 2020  classes]..      
+00011380: 2020 7365 6e73 6f72 5f6c 6179 6f75 7420    sensor_layout 
+00011390: 3a20 5459 5045 2c20 6f70 7469 6f6e 616c  : TYPE, optional
+000113a0: 0d0a 2020 2020 2020 2020 2020 2020 4445  ..            DE
+000113b0: 5343 5249 5054 494f 4e2e 2054 6865 2064  SCRIPTION. The d
+000113c0: 6566 6175 6c74 2069 7320 2756 6563 746f  efault is 'Vecto
+000113d0: 7276 6965 772d 6d61 6727 2e0d 0a0d 0a20  rview-mag'..... 
+000113e0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+000113f0: 2020 2020 6e20 3d20 7365 6c66 2e6f 7574      n = self.out
+00011400: 5f64 696d 0d0a 0d0a 2020 2020 2020 2020  _dim....        
+00011410: 6966 2064 6174 6120 6973 204e 6f6e 653a  if data is None:
+00011420: 0d0a 2020 2020 2020 2020 2020 2020 6461  ..            da
+00011430: 7461 203d 2073 656c 662e 7472 7565 5f65  ta = self.true_e
+00011440: 766f 6b65 645f 6461 7461 0d0a 2020 2020  voked_data..    
+00011450: 2020 2020 2020 2020 6966 206e 6f74 2074          if not t
+00011460: 6974 6c65 3a0d 0a20 2020 2020 2020 2020  itle:..         
+00011470: 2020 2020 2020 2074 6974 6c65 203d 2027         title = '
+00011480: 5472 7565 2050 6174 7465 726e 7327 0d0a  True Patterns'..
+00011490: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+000114a0: 2020 2020 2020 2020 2020 2074 6974 6c65             title
+000114b0: 203d 2027 4d6f 6465 6c2d 6465 7269 7665   = 'Model-derive
+000114c0: 6420 7061 7474 6572 6e73 270d 0a0d 0a20  d patterns'.... 
+000114d0: 2020 2020 2020 2069 6620 7420 6973 204e         if t is N
+000114e0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+000114f0: 2020 7420 3d20 6e70 2e61 7267 6d61 7828    t = np.argmax(
+00011500: 6e70 2e6d 6561 6e28 6461 7461 2a2a 322c  np.mean(data**2,
+00011510: 2061 7869 733d 3029 2e6d 6561 6e28 2d31   axis=0).mean(-1
+00011520: 2929 0d0a 2020 2020 2020 2020 7469 746c  ))..        titl
+00011530: 6520 3d20 7469 746c 6520 2b20 2027 743d  e = title +  't=
+00011540: 7b7d 272e 666f 726d 6174 2874 290d 0a20  {}'.format(t).. 
+00011550: 2020 2020 2020 2065 6420 3d20 6e70 2e73         ed = np.s
+00011560: 7461 636b 285b 6461 7461 5b69 2c20 742c  tack([data[i, t,
+00011570: 203a 5d20 666f 7220 6920 696e 2072 616e   :] for i in ran
+00011580: 6765 286e 295d 2c20 6178 6973 3d2d 3129  ge(n)], axis=-1)
+00011590: 0d0a 2020 2020 2020 2020 6173 7365 7274  ..        assert
+000115a0: 2065 642e 6e64 696d 3d3d 320d 0a20 2020   ed.ndim==2..   
+000115b0: 2020 2020 2074 6f70 6f70 6c6f 7420 3d20       topoplot = 
+000115c0: 7365 6c66 2e70 6c6f 745f 746f 706f 7328  self.plot_topos(
+000115d0: 6564 2c20 7365 6e73 6f72 5f6c 6179 6f75  ed, sensor_layou
+000115e0: 743d 7365 6e73 6f72 5f6c 6179 6f75 742c  t=sensor_layout,
+000115f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00011600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011610: 2020 2020 2063 6c61 7373 5f73 7562 7365       class_subse
+00011620: 743d 636c 6173 735f 7375 6273 6574 2c20  t=class_subset, 
+00011630: 7469 746c 653d 7469 746c 6529 0d0a 0d0a  title=title)....
+00011640: 2020 2020 2020 2020 2374 6f70 6f70 6c6f          #topoplo
+00011650: 742e 6669 6775 7265 2e73 7570 7469 746c  t.figure.suptitl
+00011660: 6528 7469 746c 6529 0d0a 2020 2020 2020  e(title)..      
+00011670: 2020 746f 706f 706c 6f74 2e73 686f 7728    topoplot.show(
+00011680: 290d 0a20 2020 2020 2020 2069 6620 7361  )..        if sa
+00011690: 7665 6669 673a 0d0a 2020 2020 2020 2020  vefig:..        
+000116a0: 2020 2020 6669 676e 616d 6520 3d20 272d      figname = '-
+000116b0: 272e 6a6f 696e 285b 7365 6c66 2e6d 6574  '.join([self.met
+000116c0: 612e 6461 7461 5b27 7061 7468 275d 202b  a.data['path'] +
+000116d0: 2073 656c 662e 7363 6f70 652c 2073 656c   self.scope, sel
+000116e0: 662e 6d65 7461 2e64 6174 615b 2764 6174  f.meta.data['dat
+000116f0: 615f 6964 275d 2c20 7469 746c 652c 2022  a_id'], title, "
+00011700: 746f 706f 732e 7376 6722 5d29 0d0a 2020  topos.svg"])..  
+00011710: 2020 2020 2020 2020 2020 746f 706f 706c            topopl
+00011720: 6f74 2e73 6176 6566 6967 2866 6967 6e61  ot.savefig(figna
+00011730: 6d65 2c20 666f 726d 6174 3d27 7376 6727  me, format='svg'
+00011740: 2c20 7472 616e 7370 6172 656e 743d 5472  , transparent=Tr
+00011750: 7565 290d 0a20 2020 2020 2020 2072 6574  ue)..        ret
+00011760: 7572 6e20 746f 706f 706c 6f74 0d0a 2020  urn topoplot..  
+00011770: 2020 0d0a 2020 2020 6465 6620 706c 6f74    ..    def plot
+00011780: 5f74 6f70 6f73 2873 656c 662c 2074 6f70  _topos(self, top
+00011790: 6f73 2c20 7365 6e73 6f72 5f6c 6179 6f75  os, sensor_layou
+000117a0: 743d 2756 6563 746f 7276 6965 772d 6d61  t='Vectorview-ma
+000117b0: 6727 2c20 636c 6173 735f 7375 6273 6574  g', class_subset
+000117c0: 3d4e 6f6e 652c 0d0a 2020 2020 2020 2020  =None,..        
+000117d0: 2020 2020 2020 2020 2020 2074 6974 6c65             title
+000117e0: 3d22 436c 6173 7320 2567 2229 3a0d 0a20  ="Class %g"):.. 
+000117f0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00011800: 2020 2020 506c 6f74 2061 6e79 2073 7061      Plot any spa
+00011810: 7469 616c 2064 6973 7472 6962 7574 696f  tial distributio
+00011820: 6e20 696e 2074 6865 2073 656e 736f 7220  n in the sensor 
+00011830: 7370 6163 652e 0d0a 2020 2020 2020 2020  space...        
+00011840: 544f 444f 3a20 496e 7465 7270 6f6c 6174  TODO: Interpolat
+00011850: 696f 6e3f 3f0d 0a0d 0a0d 0a20 2020 2020  ion??......     
+00011860: 2020 2050 6172 616d 6574 6572 730d 0a20     Parameters.. 
+00011870: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+00011880: 2d0d 0a20 2020 2020 2020 2074 6f70 6f73  -..        topos
+00011890: 203a 206e 702e 6172 7261 790d 0a20 2020   : np.array..   
+000118a0: 2020 2020 2020 2020 205b 6e5f 6368 2c20           [n_ch, 
+000118b0: 6e5f 636c 6173 7365 732c 202e 2e2e 5d0d  n_classes, ...].
+000118c0: 0a20 2020 2020 2020 2073 656e 736f 725f  .        sensor_
+000118d0: 6c61 796f 7574 203a 2054 5950 452c 206f  layout : TYPE, o
+000118e0: 7074 696f 6e61 6c0d 0a20 2020 2020 2020  ptional..       
+000118f0: 2020 2020 2044 4553 4352 4950 5449 4f4e       DESCRIPTION
+00011900: 2e20 5468 6520 6465 6661 756c 7420 6973  . The default is
+00011910: 2027 5665 6374 6f72 7669 6577 2d6d 6167   'Vectorview-mag
+00011920: 272e 0d0a 2020 2020 2020 2020 636c 6173  '...        clas
+00011930: 735f 7375 6273 6574 2020 3a20 6e70 2e61  s_subset  : np.a
+00011940: 7272 6179 2c20 6f70 7469 6f6e 616c 0d0a  rray, optional..
+00011950: 0d0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+00011960: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
+00011970: 2d2d 0d0a 2020 2020 2020 2020 4e6f 6e65  --..        None
+00011980: 2e0d 0a0d 0a20 2020 2020 2020 2022 2222  .....        """
+00011990: 0d0a 200d 0a20 2020 2020 2020 2069 6620  .. ..        if 
+000119a0: 746f 706f 732e 6e64 696d 203e 2032 3a0d  topos.ndim > 2:.
+000119b0: 0a20 2020 2020 2020 2020 2020 2074 6f70  .            top
+000119c0: 6f73 203d 2074 6f70 6f73 2e6d 6561 6e28  os = topos.mean(
+000119d0: 2d31 290d 0a20 2020 2020 2020 2074 6f70  -1)..        top
+000119e0: 6f73 5f6e 6577 203d 2074 6f70 6f73 202f  os_new = topos /
+000119f0: 2074 6f70 6f73 2e73 7464 2830 2c20 6b65   topos.std(0, ke
+00011a00: 6570 6469 6d73 3d54 7275 6529 0d0a 0d0a  epdims=True)....
+00011a10: 2020 2020 2020 2020 6e20 3d20 746f 706f          n = topo
+00011a20: 732e 7368 6170 655b 315d 0d0a 0d0a 2020  s.shape[1]....  
+00011a30: 2020 2020 2020 6966 2063 6c61 7373 5f73        if class_s
+00011a40: 7562 7365 7420 6973 204e 6f6e 653a 0d0a  ubset is None:..
+00011a50: 2020 2020 2020 2020 2020 2020 636c 6173              clas
+00011a60: 735f 7375 6273 6574 203d 206e 702e 6172  s_subset = np.ar
+00011a70: 616e 6765 2830 2c20 206e 2c20 312e 290d  ange(0,  n, 1.).
+00011a80: 0a0d 0a20 2020 2020 2020 2066 616b 655f  ...        fake_
+00011a90: 6576 6f6b 6564 203d 2073 656c 662e 6d61  evoked = self.ma
+00011aa0: 6b65 5f66 616b 655f 6576 6f6b 6564 2874  ke_fake_evoked(t
+00011ab0: 6f70 6f73 5f6e 6577 2c20 7365 6e73 6f72  opos_new, sensor
+00011ac0: 5f6c 6179 6f75 7429 0d0a 0d0a 2020 2020  _layout)....    
+00011ad0: 2020 2020 6674 203d 2066 616b 655f 6576      ft = fake_ev
+00011ae0: 6f6b 6564 2e70 6c6f 745f 746f 706f 6d61  oked.plot_topoma
+00011af0: 7028 7469 6d65 733d 636c 6173 735f 7375  p(times=class_su
+00011b00: 6273 6574 2c0d 0a20 2020 2020 2020 2020  bset,..         
+00011b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011b20: 2020 2020 2020 2020 2020 2063 6f6c 6f72             color
+00011b30: 6261 723d 5472 7565 2c0d 0a20 2020 2020  bar=True,..     
+00011b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011b50: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00011b60: 6361 6c69 6e67 733d 312c 0d0a 2020 2020  calings=1,..    
+00011b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011b90: 7469 6d65 5f66 6f72 6d61 743d 7469 746c  time_format=titl
+00011ba0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+00011bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011bc0: 2020 2020 2020 2020 6f75 746c 696e 6573          outlines
+00011bd0: 3d27 6865 6164 272c 0d0a 2020 2020 2020  ='head',..      
+00011be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011bf0: 2020 2020 2020 2020 2020 2020 2020 2376                #v
+00011c00: 6c69 6d3d 206e 702e 7065 7263 656e 7469  lim= np.percenti
+00011c10: 6c65 2874 6f70 6f73 2c20 5b35 2c20 3935  le(topos, [5, 95
+00011c20: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00011c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c40: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+00011c50: 2020 2023 6674 2e73 686f 7728 290d 0a20     #ft.show().. 
+00011c60: 2020 2020 2020 2072 6574 7572 6e20 6674         return ft
+00011c70: 0d0a 2020 2020 0d0a 2020 2020 6465 6620  ..    ..    def 
+00011c80: 6d61 6b65 5f66 616b 655f 6576 6f6b 6564  make_fake_evoked
+00011c90: 2873 656c 662c 2074 6f70 6f73 2c20 7365  (self, topos, se
+00011ca0: 6e73 6f72 5f6c 6179 6f75 7429 3a0d 0a20  nsor_layout):.. 
+00011cb0: 2020 2020 2020 2069 6620 2769 6e66 6f27         if 'info'
+00011cc0: 206e 6f74 2069 6e20 7365 6c66 2e6d 6574   not in self.met
+00011cd0: 612e 6461 7461 2e6b 6579 7328 293a 0d0a  a.data.keys():..
+00011ce0: 2020 2020 2020 2020 2020 2020 6c6f 203d              lo =
+00011cf0: 2063 6861 6e6e 656c 732e 7265 6164 5f6c   channels.read_l
+00011d00: 6179 6f75 7428 7365 6e73 6f72 5f6c 6179  ayout(sensor_lay
+00011d10: 6f75 7429 0d0a 2020 2020 2020 2020 2020  out)..          
+00011d20: 2020 236c 6f20 3d20 6368 616e 6e65 6c73    #lo = channels
+00011d30: 2e67 656e 6572 6174 655f 3264 5f6c 6179  .generate_2d_lay
+00011d40: 6f75 7428 6c6f 2e70 6f73 290d 0a20 2020  out(lo.pos)..   
+00011d50: 2020 2020 2020 2020 2069 6e66 6f20 3d20           info = 
+00011d60: 6372 6561 7465 5f69 6e66 6f28 6c6f 2e6e  create_info(lo.n
+00011d70: 616d 6573 2c20 312e 2c20 7365 6e73 6f72  ames, 1., sensor
+00011d80: 5f6c 6179 6f75 742e 7370 6c69 7428 272d  _layout.split('-
+00011d90: 2729 5b2d 315d 290d 0a20 2020 2020 2020  ')[-1])..       
+00011da0: 2020 2020 206f 7269 675f 7879 203d 206e       orig_xy = n
+00011db0: 702e 6d65 616e 286c 6f2e 706f 735b 3a2c  p.mean(lo.pos[:,
+00011dc0: 203a 325d 2c20 3029 0d0a 2020 2020 2020   :2], 0)..      
+00011dd0: 2020 2020 2020 666f 7220 692c 2063 6820        for i, ch 
+00011de0: 696e 2065 6e75 6d65 7261 7465 286c 6f2e  in enumerate(lo.
+00011df0: 6e61 6d65 7329 3a0d 0a20 2020 2020 2020  names):..       
+00011e00: 2020 2020 2020 2020 2069 6620 696e 666f           if info
+00011e10: 5b27 6368 7327 5d5b 695d 5b27 6368 5f6e  ['chs'][i]['ch_n
+00011e20: 616d 6527 5d20 3d3d 2063 683a 0d0a 2020  ame'] == ch:..  
+00011e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e40: 2020 696e 666f 5b27 6368 7327 5d5b 695d    info['chs'][i]
+00011e50: 5b27 6c6f 6327 5d5b 3a32 5d20 3d20 286c  ['loc'][:2] = (l
+00011e60: 6f2e 706f 735b 692c 203a 325d 202d 206f  o.pos[i, :2] - o
+00011e70: 7269 675f 7879 292f 342e 350d 0a20 2020  rig_xy)/4.5..   
+00011e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e90: 2023 696e 666f 5b27 6368 7327 5d5b 695d   #info['chs'][i]
+00011ea0: 5b27 6c6f 6327 5d5b 343a 5d20 3d20 300d  ['loc'][4:] = 0.
+00011eb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011ec0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00011ed0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00011ee0: 7428 2243 6861 6e6e 656c 206e 616d 6520  t("Channel name 
+00011ef0: 6d69 736d 6174 6368 2e20 696e 666f 3a20  mismatch. info: 
+00011f00: 7b7d 2076 7320 6c6f 3a20 7b7d 222e 666f  {} vs lo: {}".fo
+00011f10: 726d 6174 280d 0a20 2020 2020 2020 2020  rmat(..         
+00011f20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00011f30: 6e66 6f5b 2763 6873 275d 5b69 5d5b 2763  nfo['chs'][i]['c
+00011f40: 685f 6e61 6d65 275d 2c20 6368 2929 0d0a  h_name'], ch))..
+00011f50: 2020 2020 2020 2020 2369 6e66 6f5b 2773          #info['s
+00011f60: 6672 6571 275d 203d 2031 0d0a 2020 2020  freq'] = 1..    
+00011f70: 2020 2020 6661 6b65 5f65 766f 6b65 6420      fake_evoked 
+00011f80: 3d20 6576 6f6b 6564 2e45 766f 6b65 6441  = evoked.EvokedA
+00011f90: 7272 6179 2874 6f70 6f73 2c20 696e 666f  rray(topos, info
+00011fa0: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00011fb0: 6e20 6661 6b65 5f65 766f 6b65 640d 0a0d  n fake_evoked...
+00011fc0: 0a0d 0a20 2020 2064 6566 2065 7870 6c6f  ...    def explo
+00011fd0: 7265 5f63 6f6d 706f 6e65 6e74 7328 7365  re_components(se
+00011fe0: 6c66 2c20 7061 7474 6572 6e73 5f73 7472  lf, patterns_str
+00011ff0: 7563 742c 2073 6f72 7469 6e67 3d27 6f75  uct, sorting='ou
+00012000: 7470 7574 5f63 6f72 7227 2c0d 0a20 2020  tput_corr',..   
+00012010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012020: 2020 2020 2020 696e 7465 6772 6174 653d        integrate=
+00012030: 276d 6178 272c 2069 6e66 6f3d 4e6f 6e65  'max', info=None
+00012040: 2c20 7365 6e73 6f72 5f6c 6179 6f75 743d  , sensor_layout=
+00012050: 2756 6563 746f 7276 6965 772d 6772 6164  'Vectorview-grad
+00012060: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
+00012070: 2020 2020 2020 2020 2020 2020 2063 6c61               cla
+00012080: 7373 5f6e 616d 6573 3d4e 6f6e 6529 3a0d  ss_names=None):.
+00012090: 0a20 2020 2020 2020 2022 2222 506c 6f74  .        """Plot
+000120a0: 7320 7468 6520 7765 6967 6874 7320 6f66  s the weights of
+000120b0: 2074 6865 206f 7574 7075 7420 6c61 7965   the output laye
+000120c0: 722e 0d0a 0d0a 2020 2020 2020 2020 5061  r.....        Pa
+000120d0: 7261 6d65 7465 7273 0d0a 2020 2020 2020  rameters..      
+000120e0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 0d0a    ----------....
+000120f0: 2020 2020 2020 2020 7061 7420 3a20 696e          pat : in
+00012100: 7420 5b30 2c20 7365 6c66 2e73 7065 6373  t [0, self.specs
+00012110: 5b27 6e5f 6c61 7465 6e74 275d 290d 0a20  ['n_latent']).. 
+00012120: 2020 2020 2020 2020 2020 2049 6e64 6578             Index
+00012130: 206f 6620 7468 6520 6c61 7465 6e74 2063   of the latent c
+00012140: 6f6d 706f 6e65 6e74 2074 6f20 6869 676c  omponent to higl
+00012150: 6967 6874 0d0a 0d0a 2020 2020 2020 2020  ight....        
+00012160: 7420 3a20 696e 7420 5b30 2c20 7365 6c66  t : int [0, self
+00012170: 2e68 5f70 6172 616d 735b 276e 5f74 275d  .h_params['n_t']
+00012180: 290d 0a20 2020 2020 2020 2020 2020 2049  )..            I
+00012190: 6e64 6578 206f 6620 7469 6d65 706f 696e  ndex of timepoin
+000121a0: 7420 746f 2068 6967 686c 6967 6874 0d0a  t to highlight..
+000121b0: 0d0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+000121c0: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
+000121d0: 2d2d 0d0a 2020 2020 2020 2020 6669 6775  --..        figu
+000121e0: 7265 203a 0d0a 2020 2020 2020 2020 2020  re :..          
+000121f0: 2020 496d 7368 6f77 205b 6e5f 6c61 7465    Imshow [n_late
+00012200: 6e74 2c20 795f 7368 6170 655d 0d0a 0d0a  nt, y_shape]....
+00012210: 2020 2020 2020 2020 2222 220d 0a20 2020          """..   
+00012220: 2020 2020 2073 656c 662e 6d65 7461 2e65       self.meta.e
+00012230: 7870 6c6f 7265 5f63 6f6d 706f 6e65 6e74  xplore_component
+00012240: 7328 290d 0a0d 0a0d 0a0d 0a0d 0a20 2020  s()..........   
+00012250: 2064 6566 2070 6c6f 745f 7761 7665 666f   def plot_wavefo
+00012260: 726d 7328 7365 6c66 2c20 7061 7474 6572  rms(self, patter
+00012270: 6e73 5f73 7472 7563 742c 2073 6f72 7469  ns_struct, sorti
+00012280: 6e67 3d27 636f 6d70 7769 7365 5f6c 6f73  ng='compwise_los
+00012290: 7327 2c20 746d 696e 3d30 2c20 636c 6173  s', tmin=0, clas
+000122a0: 735f 6e61 6d65 733d 4e6f 6e65 2c0d 0a20  s_names=None,.. 
+000122b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000122c0: 2020 2020 2020 6270 5f66 696c 7465 723d        bp_filter=
+000122d0: 4661 6c73 652c 2074 6c69 6d3d 4e6f 6e65  False, tlim=None
+000122e0: 2c20 6170 706c 795f 6b65 726e 656c 733d  , apply_kernels=
+000122f0: 4661 6c73 6529 3a0d 0a20 2020 2020 2020  False):..       
+00012300: 2022 2222 506c 6f74 7320 7469 6d65 636f   """Plots timeco
+00012310: 7572 7365 7320 6f66 206c 6174 656e 7420  urses of latent 
+00012320: 636f 6d70 6f6e 656e 7473 2e0d 0a0d 0a20  components..... 
+00012330: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00012340: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
+00012350: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 2074  -----..        t
+00012360: 6d69 6e20 3a20 666c 6f61 740d 0a20 2020  min : float..   
+00012370: 2020 2020 2020 2020 2042 6567 696e 6e69           Beginni
+00012380: 6e67 206f 6620 7468 6520 4d45 4720 6570  ng of the MEG ep
+00012390: 6f63 6820 7769 7468 2072 6567 6172 6420  och with regard 
+000123a0: 746f 2072 6566 6572 656e 6365 2065 7665  to reference eve
+000123b0: 6e74 2e0d 0a20 2020 2020 2020 2020 2020  nt...           
+000123c0: 2044 6566 6175 6c74 7320 746f 2030 2e0d   Defaults to 0..
+000123d0: 0a0d 0a0d 0a20 2020 2020 2020 2073 6f72  .....        sor
+000123e0: 7469 6e67 203a 2073 7472 0d0a 2020 2020  ting : str..    
+000123f0: 2020 2020 2020 2020 6865 7572 6973 7469          heuristi
+00012400: 6320 666f 7220 7365 6c65 6374 696e 6720  c for selecting 
+00012410: 7265 6c65 7661 6e74 2063 6f6d 706f 6e65  relevant compone
+00012420: 6e74 732e 2053 6565 204c 4643 4e4e 2e5f  nts. See LFCNN._
+00012430: 736f 7274 696e 670d 0a20 2020 2020 2020  sorting..       
+00012440: 2022 2222 0d0a 2020 2020 2020 2020 2369   """..        #i
+00012450: 6620 6e6f 7420 6861 7361 7474 7228 7365  f not hasattr(se
+00012460: 6c66 2c20 2777 6176 6566 6f72 6d73 2729  lf, 'waveforms')
+00012470: 3a0d 0a20 2020 2020 2020 2023 2020 2020  :..        #    
+00012480: 7365 6c66 2e63 6f6d 7075 7465 5f70 6174  self.compute_pat
+00012490: 7465 726e 7328 7365 6c66 2e64 6174 6173  terns(self.datas
+000124a0: 6574 290d 0a0d 0a20 2020 2020 2020 2023  et)....        #
+000124b0: 6966 206e 6f74 2068 6173 6174 7472 2873  if not hasattr(s
+000124c0: 656c 662c 2027 756f 7264 6572 2729 3a0d  elf, 'uorder'):.
+000124d0: 0a20 2020 2020 2020 206f 7264 6572 2c20  .        order, 
+000124e0: 5f20 3d20 7365 6c66 2e5f 736f 7274 696e  _ = self._sortin
+000124f0: 6728 7061 7474 6572 6e73 5f73 7472 7563  g(patterns_struc
+00012500: 742c 2073 6f72 7469 6e67 290d 0a20 2020  t, sorting)..   
+00012510: 2020 2020 2073 656c 662e 756f 7264 6572       self.uorder
+00012520: 203d 206f 7264 6572 2e72 6176 656c 2829   = order.ravel()
+00012530: 0d0a 2020 2020 2020 2020 7761 7665 666f  ..        wavefo
+00012540: 726d 7320 3d20 7061 7474 6572 6e73 5f73  rms = patterns_s
+00012550: 7472 7563 745b 2763 636d 7327 5d5b 2774  truct['ccms']['t
+00012560: 636f 6e76 275d 0d0a 0d0a 2020 2020 2020  conv']....      
+00012570: 2020 2020 2020 2373 656c 662e 756f 7264        #self.uord
+00012580: 6572 203d 206e 702e 7371 7565 657a 6528  er = np.squeeze(
+00012590: 6f72 6465 7229 0d0a 2020 2020 2020 2020  order)..        
+000125a0: 2370 7269 6e74 2873 656c 662e 756f 7264  #print(self.uord
+000125b0: 6572 290d 0a20 2020 2020 2020 2069 6620  er)..        if 
+000125c0: 6e6f 7420 636c 6173 735f 6e61 6d65 733a  not class_names:
+000125d0: 0d0a 2020 2020 2020 2020 2020 2020 636c  ..            cl
+000125e0: 6173 735f 6e61 6d65 7320 3d20 5b22 436c  ass_names = ["Cl
+000125f0: 6173 7320 7b7d 222e 666f 726d 6174 2869  ass {}".format(i
+00012600: 2920 666f 7220 6920 696e 2072 616e 6765  ) for i in range
+00012610: 2873 656c 662e 795f 7368 6170 655b 2d31  (self.y_shape[-1
+00012620: 5d29 5d0d 0a0d 0a20 2020 2020 2020 2066  ])]....        f
+00012630: 2c20 6178 203d 2070 6c74 2e73 7562 706c  , ax = plt.subpl
+00012640: 6f74 7328 322c 2032 290d 0a20 2020 2020  ots(2, 2)..     
+00012650: 2020 2066 2e73 6574 5f73 697a 655f 696e     f.set_size_in
+00012660: 6368 6573 285b 3136 2c20 3136 5d29 0d0a  ches([16, 16])..
+00012670: 2020 2020 2020 2020 6966 206e 702e 616e          if np.an
+00012680: 7928 7365 6c66 2e75 6f72 6465 7229 3a0d  y(self.uorder):.
+00012690: 0a20 2020 2020 2020 2020 2020 2023 666f  .            #fo
+000126a0: 7220 6a6a 2c20 756f 2069 6e20 656e 756d  r jj, uo in enum
+000126b0: 6572 6174 6528 7365 6c66 2e75 6f72 6465  erate(self.uorde
+000126c0: 7229 3a0d 0a20 2020 2020 2020 2020 2020  r):..           
+000126d0: 206e 7420 3d20 7365 6c66 2e64 6174 6173   nt = self.datas
+000126e0: 6574 2e68 5f70 6172 616d 735b 276e 5f74  et.h_params['n_t
+000126f0: 275d 0d0a 0d0a 2020 2020 2020 2020 2020  ']....          
+00012700: 2020 7473 7465 7020 3d20 312f 666c 6f61    tstep = 1/floa
+00012710: 7428 7365 6c66 2e64 6174 6173 6574 2e68  t(self.dataset.h
+00012720: 5f70 6172 616d 735b 2766 7327 5d29 0d0a  _params['fs'])..
+00012730: 2020 2020 2020 2020 2020 2020 7469 6d65              time
+00012740: 7320 3d20 746d 696e 202b 2074 7374 6570  s = tmin + tstep
+00012750: 2a6e 702e 6172 616e 6765 286e 7429 0d0a  *np.arange(nt)..
+00012760: 2020 2020 2020 2020 2020 2020 6966 2061              if a
+00012770: 7070 6c79 5f6b 6572 6e65 6c73 3a0d 0a20  pply_kernels:.. 
+00012780: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00012790: 6361 6c65 645f 7761 7665 666f 726d 7320  caled_waveforms 
+000127a0: 3d20 6e70 2e61 7272 6179 285b 6e70 2e63  = np.array([np.c
+000127b0: 6f6e 766f 6c76 6528 6b65 726e 2c20 7766  onvolve(kern, wf
+000127c0: 2c20 2773 616d 6527 290d 0a20 2020 2020  , 'same')..     
+000127d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000127e0: 2020 2020 2020 2066 6f72 206b 6572 6e2c         for kern,
+000127f0: 2077 6620 696e 207a 6970 2873 656c 662e   wf in zip(self.
+00012800: 6669 6c74 6572 732c 2073 656c 662e 7761  filters, self.wa
+00012810: 7665 666f 726d 7329 5d29 0d0a 2020 2020  veforms)])..    
+00012820: 2020 2020 2020 2020 2020 2020 2373 6361              #sca
+00012830: 6c65 645f 7761 7665 666f 726d 7320 3d28  led_waveforms =(
+00012840: 7363 616c 6564 5f77 6176 6566 6f72 6d73  scaled_waveforms
+00012850: 202d 2073 6361 6c65 645f 7761 7665 666f   - scaled_wavefo
+00012860: 726d 732e 6d65 616e 282d 312c 206b 6565  rms.mean(-1, kee
+00012870: 7064 696d 733d 5472 7565 2929 2020 2f20  pdims=True))  / 
+00012880: 2832 2a73 6361 6c65 645f 7761 7665 666f  (2*scaled_wavefo
+00012890: 726d 732e 7374 6428 2d31 2c20 6b65 6570  rms.std(-1, keep
+000128a0: 6469 6d73 3d54 7275 6529 290d 0a20 2020  dims=True))..   
+000128b0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
 000128c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000128d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000128e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000128f0: 656c 662e 6461 7461 7365 742e 685f 7061  elf.dataset.h_pa
-00012900: 7261 6d73 5b27 6673 275d 2c0d 0a20 2020  rams['fs'],..   
-00012910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012930: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00012940: 5f66 7265 713d 6270 5f66 696c 7465 725b  _freq=bp_filter[
-00012950: 305d 2c0d 0a20 2020 2020 2020 2020 2020  0],..           
-00012960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012980: 2020 2020 2020 2068 5f66 7265 713d 6270         h_freq=bp
-00012990: 5f66 696c 7465 725b 315d 2c0d 0a20 2020  _filter[1],..   
-000129a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000129b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000129c0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000129d0: 6574 686f 643d 2769 6972 272c 0d0a 2020  ethod='iir',..  
-000129e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000129f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a10: 7665 7262 6f73 653d 4661 6c73 6529 0d0a  verbose=False)..
-00012a20: 2020 2020 2020 2020 2020 2020 5b61 785b              [ax[
-00012a30: 302c 2030 5d2e 706c 6f74 2874 696d 6573  0, 0].plot(times
-00012a40: 2c20 7766 2c20 636f 6c6f 723d 2774 6162  , wf, color='tab
-00012a50: 3a67 7265 7927 2c20 616c 7068 613d 2e32  :grey', alpha=.2
-00012a60: 3529 0d0a 2020 2020 2020 2020 2020 2020  5)..            
-00012a70: 2066 6f72 2069 2c20 7766 2069 6e20 656e   for i, wf in en
-00012a80: 756d 6572 6174 6528 7363 616c 6564 5f77  umerate(scaled_w
-00012a90: 6176 6566 6f72 6d73 2920 6966 2069 206e  aveforms) if i n
-00012aa0: 6f74 2069 6e20 7365 6c66 2e75 6f72 6465  ot in self.uorde
-00012ab0: 725d 0d0a 0d0a 2020 2020 2020 2020 2020  r]....          
-00012ac0: 2020 5b61 785b 302c 2030 5d2e 706c 6f74    [ax[0, 0].plot
-00012ad0: 2874 696d 6573 2c0d 0a20 2020 2020 2020  (times,..       
-00012ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012af0: 2020 2073 6361 6c65 645f 7761 7665 666f     scaled_wavefo
-00012b00: 726d 735b 756f 5d2c 0d0a 2020 2020 2020  rms[uo],..      
+000128d0: 2373 6361 6c69 6e67 203d 2033 2a6e 702e  #scaling = 3*np.
+000128e0: 6d65 616e 286e 702e 7374 6428 7365 6c66  mean(np.std(self
+000128f0: 2e77 6176 6566 6f72 6d73 2c20 2d31 2929  .waveforms, -1))
+00012900: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00012910: 2020 2020 7363 616c 6564 5f77 6176 6566      scaled_wavef
+00012920: 6f72 6d73 203d 2028 7761 7665 666f 726d  orms = (waveform
+00012930: 7320 2d20 7761 7665 666f 726d 732e 6d65  s - waveforms.me
+00012940: 616e 282d 312c 206b 6565 7064 696d 733d  an(-1, keepdims=
+00012950: 5472 7565 2929 2020 2f20 2832 2a77 6176  True))  / (2*wav
+00012960: 6566 6f72 6d73 2e73 7464 282d 312c 206b  eforms.std(-1, k
+00012970: 6565 7064 696d 733d 5472 7565 2929 0d0a  eepdims=True))..
+00012980: 2020 2020 2020 2020 2020 2020 6966 2062              if b
+00012990: 705f 6669 6c74 6572 3a0d 0a20 2020 2020  p_filter:..     
+000129a0: 2020 2020 2020 2020 2020 2073 6361 6c65             scale
+000129b0: 645f 7761 7665 666f 726d 7320 3d20 7363  d_waveforms = sc
+000129c0: 616c 6564 5f77 6176 6566 6f72 6d73 2e61  aled_waveforms.a
+000129d0: 7374 7970 6528 6e70 2e66 6c6f 6174 3634  stype(np.float64
+000129e0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000129f0: 2020 2073 6361 6c65 645f 7761 7665 666f     scaled_wavefo
+00012a00: 726d 7320 3d20 6669 6c74 6572 5f64 6174  rms = filter_dat
+00012a10: 6128 7363 616c 6564 5f77 6176 6566 6f72  a(scaled_wavefor
+00012a20: 6d73 2c0d 0a20 2020 2020 2020 2020 2020  ms,..           
+00012a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a50: 2020 2020 2020 2073 656c 662e 6461 7461         self.data
+00012a60: 7365 742e 685f 7061 7261 6d73 5b27 6673  set.h_params['fs
+00012a70: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
+00012a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012aa0: 2020 2020 2020 206c 5f66 7265 713d 6270         l_freq=bp
+00012ab0: 5f66 696c 7465 725b 305d 2c0d 0a20 2020  _filter[0],..   
+00012ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ae0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+00012af0: 5f66 7265 713d 6270 5f66 696c 7465 725b  _freq=bp_filter[
+00012b00: 315d 2c0d 0a20 2020 2020 2020 2020 2020  1],..           
 00012b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012b20: 2020 2020 6c69 6e65 7769 6474 683d 322e      linewidth=2.
-00012b30: 2c20 6c61 6265 6c3d 636c 6173 735f 6e61  , label=class_na
-00012b40: 6d65 735b 695d 2c20 616c 7068 613d 2e37  mes[i], alpha=.7
-00012b50: 3529 0d0a 2020 2020 2020 2020 2020 2020  5)..            
-00012b60: 2066 6f72 2069 2c20 756f 2069 6e20 656e   for i, uo in en
-00012b70: 756d 6572 6174 6528 7365 6c66 2e75 6f72  umerate(self.uor
-00012b80: 6465 7229 5d0d 0a20 2020 2020 2020 2020  der)]..         
-00012b90: 2020 2061 785b 302c 2030 5d2e 7365 745f     ax[0, 0].set_
-00012ba0: 7469 746c 6528 274c 6174 656e 7420 636f  title('Latent co
-00012bb0: 6d70 6f6e 656e 7420 7761 7665 666f 726d  mponent waveform
-00012bc0: 7327 290d 0a20 2020 2020 2020 2020 2020  s')..           
-00012bd0: 2069 6620 746c 696d 3a0d 0a20 2020 2020   if tlim:..     
-00012be0: 2020 2020 2020 2020 2020 2061 785b 302c             ax[0,
-00012bf0: 2030 5d2e 7365 745f 786c 696d 2874 6c69   0].set_xlim(tli
-00012c00: 6d29 0d0a 0d0a 2020 2020 2020 2020 2020  m)....          
-00012c10: 2020 7473 7465 7020 3d20 666c 6f61 7428    tstep = float(
-00012c20: 7365 6c66 2e73 7065 6373 5b27 7374 7269  self.specs['stri
-00012c30: 6465 275d 292f 7365 6c66 2e64 6174 6173  de'])/self.datas
-00012c40: 6574 2e68 5f70 6172 616d 735b 2766 7327  et.h_params['fs'
-00012c50: 5d0d 0a20 2020 2020 2020 2020 2020 2073  ]..            s
-00012c60: 7472 6964 6573 3120 3d20 6e70 2e61 7261  trides1 = np.ara
-00012c70: 6e67 6528 7469 6d65 735b 305d 2c20 7469  nge(times[0], ti
-00012c80: 6d65 735b 2d31 5d20 2b20 7473 7465 702f  mes[-1] + tstep/
-00012c90: 322c 2074 7374 6570 290d 0a20 2020 2020  2, tstep)..     
-00012ca0: 2020 2020 2020 2061 785b 312c 2030 5d2e         ax[1, 0].
-00012cb0: 7063 6f6c 6f72 2873 7472 6964 6573 312c  pcolor(strides1,
-00012cc0: 206e 702e 6172 616e 6765 2873 656c 662e   np.arange(self.
-00012cd0: 7370 6563 735b 276e 5f6c 6174 656e 7427  specs['n_latent'
-00012ce0: 5d29 2c0d 0a20 2020 2020 2020 2020 2020  ]),..           
-00012cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012d00: 6e70 2e6d 6561 6e28 7365 6c66 2e74 635f  np.mean(self.tc_
-00012d10: 6f75 742c 2030 292e 542c 2023 7368 6164  out, 0).T, #shad
-00012d20: 696e 673d 2761 7574 6f27 0d0a 2020 2020  ing='auto'..    
-00012d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012d40: 2020 2020 2020 2029 0d0a 2320 2020 2020         )..#     
-00012d50: 2020 2020 2020 2074 636f 7574 203d 206e         tcout = n
-00012d60: 702e 6d65 616e 2873 656c 662e 7463 5f6f  p.mean(self.tc_o
-00012d70: 7574 5f75 6e70 6f6f 6c65 642c 3029 2e54  ut_unpooled,0).T
-00012d80: 202d 2073 656c 662e 745f 636f 6e76 5f62   - self.t_conv_b
-00012d90: 6961 7365 735b 3a2c 204e 6f6e 655d 0d0a  iases[:, None]..
-00012da0: 2320 2020 2020 2020 2020 2020 205b 6178  #            [ax
-00012db0: 5b31 2c20 305d 2e70 6c6f 7428 7469 6d65  [1, 0].plot(time
-00012dc0: 732c 2074 636f 7574 692c 2063 6f6c 6f72  s, tcouti, color
-00012dd0: 3d27 7461 623a 6772 6579 272c 2061 6c70  ='tab:grey', alp
-00012de0: 6861 3d2e 3235 290d 0a23 2020 2020 2020  ha=.25)..#      
-00012df0: 2020 2020 2020 666f 7220 692c 2074 636f        for i, tco
-00012e00: 7574 6920 696e 2065 6e75 6d65 7261 7465  uti in enumerate
-00012e10: 2874 636f 7574 2920 6966 2069 206e 6f74  (tcout) if i not
-00012e20: 2069 6e20 7365 6c66 2e75 6f72 6465 725d   in self.uorder]
-00012e30: 0d0a 0d0a 2320 2020 2020 2020 2020 2020  ....#           
-00012e40: 205b 6178 5b31 2c20 305d 2e70 6c6f 7428   [ax[1, 0].plot(
-00012e50: 7469 6d65 732c 2074 636f 7574 5b75 6f5d  times, tcout[uo]
-00012e60: 2920 666f 7220 692c 2075 6f20 696e 2065  ) for i, uo in e
-00012e70: 6e75 6d65 7261 7465 2873 656c 662e 756f  numerate(self.uo
-00012e80: 7264 6572 295d 0d0a 2020 2020 2020 2020  rder)]..        
-00012e90: 2020 2020 6178 5b31 2c20 305d 2e73 6574      ax[1, 0].set
-00012ea0: 5f74 6974 6c65 2822 4176 672e 2054 656d  _title("Avg. Tem
-00012eb0: 706f 7261 6c20 436f 6e76 6f6c 7574 696f  poral Convolutio
-00012ec0: 6e20 4f75 7470 7574 2229 0d0a 2020 2020  n Output")..    
-00012ed0: 2020 2020 2020 2020 6178 5b31 2c20 305d          ax[1, 0]
-00012ee0: 2e73 6574 5f79 6c61 6265 6c28 2243 6f6d  .set_ylabel("Com
-00012ef0: 706f 6e65 6e74 2069 6e64 6578 2229 0d0a  ponent index")..
-00012f00: 2020 2020 2020 2020 2020 2020 6178 5b31              ax[1
-00012f10: 2c20 305d 2e73 6574 5f78 6c61 6265 6c28  , 0].set_xlabel(
-00012f20: 2254 696d 652c 2073 2229 0d0a 2020 2020  "Time, s")..    
-00012f30: 2020 2020 2020 2020 6966 2074 6c69 6d3a          if tlim:
-00012f40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00012f50: 2020 6178 5b31 2c20 305d 2e73 6574 5f78    ax[1, 0].set_x
-00012f60: 6c69 6d28 746c 696d 290d 0a20 2020 2020  lim(tlim)..     
-00012f70: 2020 2020 2020 2069 6620 6e6f 7420 6861         if not ha
-00012f80: 7361 7474 7228 7365 6c66 2c20 2770 6174  sattr(self, 'pat
-00012f90: 7465 726e 5f77 6569 6768 7473 2729 3a0d  tern_weights'):.
-00012fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012fb0: 2070 6174 7465 726e 5f77 6569 6768 7473   pattern_weights
-00012fc0: 203d 206e 702e 6569 6e73 756d 2827 696a   = np.einsum('ij
-00012fd0: 6b2c 206a 6b6c 202d 3e69 6b6c 272c 2073  k, jkl ->ikl', s
-00012fe0: 656c 662e 7463 5f6f 7574 2c20 7365 6c66  elf.tc_out, self
-00012ff0: 2e6f 7574 5f77 6569 6768 7473 290d 0a20  .out_weights).. 
-00013000: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00013010: 656c 662e 7061 7474 6572 6e5f 7765 6967  elf.pattern_weig
-00013020: 6874 7320 3d20 6e70 2e6d 6178 696d 756d  hts = np.maximum
-00013030: 2870 6174 7465 726e 5f77 6569 6768 7473  (pattern_weights
-00013040: 202b 2073 656c 662e 6f75 745f 6269 6173   + self.out_bias
-00013050: 6573 5b4e 6f6e 652c 203a 5d2c 2030 2e29  es[None, :], 0.)
-00013060: 2e6d 6561 6e28 3029 0d0a 0d0a 2020 2020  .mean(0)....    
-00013070: 2020 2020 2020 2020 6120 3d20 6178 5b30          a = ax[0
-00013080: 2c20 315d 2e70 636f 6c6f 7228 7365 6c66  , 1].pcolor(self
-00013090: 2e70 6174 7465 726e 5f77 6569 6768 7473  .pattern_weights
-000130a0: 2c20 636d 6170 3d27 626f 6e65 5f72 2729  , cmap='bone_r')
-000130b0: 0d0a 2020 2020 2020 2020 2020 2020 6469  ..            di
-000130c0: 7669 6465 7220 3d20 6d61 6b65 5f61 7865  vider = make_axe
-000130d0: 735f 6c6f 6361 7461 626c 6528 6178 5b30  s_locatable(ax[0
-000130e0: 2c31 5d29 0d0a 2020 2020 2020 2020 2020  ,1])..          
-000130f0: 2020 6361 7820 3d20 6469 7669 6465 722e    cax = divider.
-00013100: 6170 7065 6e64 5f61 7865 7328 2772 6967  append_axes('rig
-00013110: 6874 272c 2073 697a 653d 2735 2527 2c20  ht', size='5%', 
-00013120: 7061 643d 302e 3035 290d 0a20 2020 2020  pad=0.05)..     
-00013130: 2020 2020 2020 2066 2e63 6f6c 6f72 6261         f.colorba
-00013140: 7228 612c 2063 6178 3d63 6178 2c20 6f72  r(a, cax=cax, or
-00013150: 6965 6e74 6174 696f 6e3d 2776 6572 7469  ientation='verti
-00013160: 6361 6c27 290d 0a20 2020 2020 2020 2020  cal')..         
-00013170: 2020 2072 203d 205b 7074 6368 2e52 6563     r = [ptch.Rec
-00013180: 7461 6e67 6c65 2828 692c 2075 6f29 2c20  tangle((i, uo), 
-00013190: 7769 6474 683d 312c 0d0a 2020 2020 2020  width=1,..      
-000131a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000131b0: 2020 2020 2020 2020 2020 6865 6967 6874            height
-000131c0: 3d31 2c20 616e 676c 653d 302e 3029 2066  =1, angle=0.0) f
-000131d0: 6f72 2069 2c20 756f 2069 6e20 656e 756d  or i, uo in enum
-000131e0: 6572 6174 6528 7365 6c66 2e75 6f72 6465  erate(self.uorde
-000131f0: 7229 5d0d 0a20 2020 2020 2020 2020 2020  r)]..           
-00013200: 2070 6320 3d20 636f 6c6c 6563 7469 6f6e   pc = collection
-00013210: 732e 5061 7463 6843 6f6c 6c65 6374 696f  s.PatchCollectio
-00013220: 6e28 722c 2066 6163 6563 6f6c 6f72 3d4e  n(r, facecolor=N
-00013230: 6f6e 652c 2061 6c70 6861 3d2e 352c 0d0a  one, alpha=.5,..
-00013240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013260: 2020 2020 2020 2020 2020 2020 206c 696e               lin
-00013270: 6577 6964 7468 3d32 2e2c 0d0a 2020 2020  ewidth=2.,..    
-00013280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000132a0: 2020 2020 2020 2020 2065 6467 6563 6f6c           edgecol
-000132b0: 6f72 3d27 7461 623a 6f72 616e 6765 2729  or='tab:orange')
-000132c0: 0d0a 2020 2020 2020 2020 2020 2020 6178  ..            ax
-000132d0: 5b30 2c20 315d 2e61 6464 5f63 6f6c 6c65  [0, 1].add_colle
-000132e0: 6374 696f 6e28 7063 290d 0a0d 0a20 2020  ction(pc)....   
-000132f0: 2020 2020 2020 2020 2061 785b 302c 2031           ax[0, 1
-00013300: 5d2e 7365 745f 7469 746c 6528 2250 6174  ].set_title("Pat
-00013310: 7465 726e 2077 6569 6768 7473 2229 0d0a  tern weights")..
-00013320: 2020 2020 2020 2020 2020 2020 6178 5b30              ax[0
-00013330: 2c20 315d 2e73 6574 5f79 6c61 6265 6c28  , 1].set_ylabel(
-00013340: 2243 6f6d 706f 6e65 6e74 2069 6e64 6578  "Component index
-00013350: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
-00013360: 6178 5b30 2c20 315d 2e73 6574 5f78 7469  ax[0, 1].set_xti
-00013370: 636b 7328 6e70 2e61 7261 6e67 6528 302e  cks(np.arange(0.
-00013380: 352c 2030 2e35 2b6c 656e 2863 6c61 7373  5, 0.5+len(class
-00013390: 5f6e 616d 6573 292c 2031 2929 0d0a 2020  _names), 1))..  
-000133a0: 2020 2020 2020 2020 2020 6178 5b30 2c20            ax[0, 
-000133b0: 315d 2e73 6574 5f78 7469 636b 6c61 6265  1].set_xticklabe
-000133c0: 6c73 2863 6c61 7373 5f6e 616d 6573 290d  ls(class_names).
-000133d0: 0a20 2020 2020 2020 2020 2020 2072 7073  .            rps
-000133e0: 7320 3d20 5b5d 0d0a 2020 2020 2020 2020  s = []..        
-000133f0: 2020 2020 666f 7220 692c 2066 6c74 2069      for i, flt i
-00013400: 6e20 656e 756d 6572 6174 6528 7365 6c66  n enumerate(self
-00013410: 2e66 696c 7465 7273 2e54 293a 0d0a 0d0a  .filters.T):....
-00013420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013430: 666c 7420 2d3d 2066 6c74 2e6d 6561 6e28  flt -= flt.mean(
-00013440: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00013450: 2020 2068 203d 2073 656c 662e 6672 6571     h = self.freq
-00013460: 5f72 6573 706f 6e73 6573 5b69 2c20 3a5d  _responses[i, :]
-00013470: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013480: 2020 7073 6420 3d20 7365 6c66 2e70 7364    psd = self.psd
-00013490: 735b 692c 203a 5d0d 0a0d 0a20 2020 2020  s[i, :]....     
-000134a0: 2020 2020 2020 2020 2020 2023 7270 7373             #rpss
-000134b0: 2e61 7070 656e 6428 682f 6e70 2e73 756d  .append(h/np.sum
-000134c0: 2868 2929 0d0a 2020 2020 2020 2020 2020  (h))..          
-000134d0: 2020 2020 2020 7270 7373 2e61 7070 656e        rpss.appen
-000134e0: 6428 2870 7364 2a68 2929 2023 2529 2f6e  d((psd*h)) #%)/n
-000134f0: 702e 7375 6d28 7073 642a 6829 0d0a 0d0a  p.sum(psd*h)....
-00013500: 2020 2020 2020 2020 2020 2020 5b61 785b              [ax[
-00013510: 312c 2031 5d2e 706c 6f74 2873 656c 662e  1, 1].plot(self.
-00013520: 6672 6571 732c 2072 7073 735b 756f 5d2c  freqs, rpss[uo],
-00013530: 206c 696e 6577 6964 7468 3d32 2e35 2c20   linewidth=2.5, 
-00013540: 6c61 6265 6c3d 636c 6173 735f 6e61 6d65  label=class_name
-00013550: 735b 695d 290d 0a20 2020 2020 2020 2020  s[i])..         
-00013560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013570: 2020 2020 666f 7220 692c 2075 6f20 696e      for i, uo in
-00013580: 2065 6e75 6d65 7261 7465 2873 656c 662e   enumerate(self.
-00013590: 756f 7264 6572 295d 0d0a 2020 2020 2020  uorder)]..      
-000135a0: 2020 2020 2020 6178 5b31 2c20 315d 2e73        ax[1, 1].s
-000135b0: 6574 5f78 6c69 6d28 302c 3930 2e29 0d0a  et_xlim(0,90.)..
-000135c0: 2020 2020 2020 2020 2020 2020 6178 5b31              ax[1
-000135d0: 2c20 315d 2e73 6574 5f74 6974 6c65 2822  , 1].set_title("
-000135e0: 5265 6c61 7469 7665 2070 6f77 6572 2c20  Relative power, 
-000135f0: 2522 290d 0a20 2020 2020 2020 2020 2020  %")..           
-00013600: 2061 785b 312c 2031 5d2e 7365 745f 786c   ax[1, 1].set_xl
-00013610: 6162 656c 2822 4672 6571 7565 6e63 792c  abel("Frequency,
-00013620: 2048 7a22 290d 0a20 2020 2020 2020 2020   Hz")..         
-00013630: 2020 2061 785b 312c 2031 5d2e 6c65 6765     ax[1, 1].lege
-00013640: 6e64 2829 0d0a 2020 2020 2020 2020 2020  nd()..          
-00013650: 2020 706c 742e 7368 6f77 2829 0d0a 2020    plt.show()..  
-00013660: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00013670: 0d0a 0d0a 0d0a 0d0a 2020 2020 6465 6620  ........    def 
-00013680: 5f73 6f72 7469 6e67 2873 656c 662c 2070  _sorting(self, p
-00013690: 6174 7465 726e 735f 7374 7275 6374 2c20  atterns_struct, 
-000136a0: 736f 7274 696e 673d 2763 6f6d 7077 6973  sorting='compwis
-000136b0: 655f 6c6f 7373 272c 206e 5f63 6f6d 703d  e_loss', n_comp=
-000136c0: 3129 3a0d 0a20 2020 2020 2020 2022 2222  1):..        """
-000136d0: 5370 6563 6966 7920 7768 6963 6820 636f  Specify which co
-000136e0: 6d70 6f6e 656e 7473 2074 6f20 706c 6f74  mponents to plot
-000136f0: 2e0d 0a0d 0a20 2020 2020 2020 2050 6172  .....        Par
-00013700: 616d 6574 6572 730d 0a20 2020 2020 2020  ameters..       
-00013710: 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020   ----------..   
-00013720: 2020 2020 2073 6f72 7469 6e67 203a 2073       sorting : s
-00013730: 7472 0d0a 2020 2020 2020 2020 2020 2020  tr..            
-00013740: 536f 7274 696e 6720 6865 7572 6973 7469  Sorting heuristi
-00013750: 6373 2e0d 0a0d 0a20 2020 2020 2020 2020  cs.....         
-00013760: 2020 2027 7765 6967 6874 5f6e 6f72 6d27     'weight_norm'
-00013770: 202d 2070 6c6f 7473 2061 6c6c 2063 6f6d   - plots all com
-00013780: 706f 6e65 6e74 7320 736f 7274 6564 2062  ponents sorted b
-00013790: 7920 6c32 206e 6f72 6d20 6f66 2061 6374  y l2 norm of act
-000137a0: 6976 6174 696f 6e73 2069 6e20 7468 650d  ivations in the.
-000137b0: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-000137c0: 7075 7420 6c61 7965 7220 696e 2064 6573  put layer in des
-000137d0: 6365 6e64 696e 6720 6f72 6465 722e 0d0a  cending order...
-000137e0: 0d0a 2020 2020 2020 2020 2020 2020 2763  ..            'c
-000137f0: 6f6d 6d70 7769 7365 5f6c 6f73 7327 202d  ommpwise_loss' -
-00013800: 2063 6f6d 7075 7465 2074 6865 2065 6666   compute the eff
-00013810: 6563 7420 6f66 2065 6c69 6d69 6e61 7469  ect of eliminati
-00013820: 6e67 2074 6865 206c 6174 656e 740d 0a20  ng the latent.. 
-00013830: 2020 2020 2020 2020 2020 2063 6f6d 706f             compo
-00013840: 6e65 6e74 206f 6e20 7468 6520 7661 6c69  nent on the vali
-00013850: 6461 7469 6f6e 206c 6f73 732e 2050 6572  dation loss. Per
-00013860: 6f66 726d 6564 2066 6f72 2065 6163 6820  ofrmed for each 
-00013870: 636c 6173 730d 0a20 2020 2020 2020 2020  class..         
-00013880: 2020 2073 6570 6172 6174 656c 792e 0d0a     separately...
-00013890: 0d0a 2020 2020 2020 2020 2020 2020 2777  ..            'w
-000138a0: 6569 6768 7427 202d 2070 6c6f 7473 2061  eight' - plots a
-000138b0: 2073 696e 676c 6520 636f 6d70 6f6e 656e   single componen
-000138c0: 7420 7468 6174 2068 6173 2061 206d 6178  t that has a max
-000138d0: 696d 756d 0d0a 2020 2020 2020 2020 2020  imum..          
-000138e0: 2020 7765 6967 6874 2066 6f72 2065 6163    weight for eac
-000138f0: 6820 636c 6173 7320 696e 2074 6865 206f  h class in the o
-00013900: 7574 7075 7420 6c61 7965 722e 0d0a 0d0a  utput layer.....
-00013910: 2020 2020 2020 2020 2020 2020 276f 7574              'out
-00013920: 7075 745f 636f 7272 2720 2d20 706c 6f74  put_corr' - plot
-00013930: 7320 6120 7369 6e67 6c65 2063 6f6d 706f  s a single compo
-00013940: 6e65 6e74 2c20 7768 6963 6820 7072 6f64  nent, which prod
-00013950: 7563 6573 2061 0d0a 2020 2020 2020 2020  uces a..        
-00013960: 2020 2020 6665 6174 7572 6520 696e 2074      feature in t
-00013970: 6865 206f 7574 7075 7420 6c61 7965 7220  he output layer 
-00013980: 7468 6174 2068 6173 206d 6178 696d 756d  that has maximum
-00013990: 2063 6f72 7265 6c61 7469 6f6e 0d0a 2020   correlation..  
-000139a0: 2020 2020 2020 2020 2020 7769 7468 2065            with e
-000139b0: 6163 6820 7461 7267 6574 2076 6172 6961  ach target varia
-000139c0: 626c 652e 0d0a 0d0a 2020 2020 2020 2020  ble.....        
-000139d0: 2020 2020 2777 6569 6768 745f 636f 7272      'weight_corr
-000139e0: 2720 2d20 706c 6f74 7320 6120 7369 6e67  ' - plots a sing
-000139f0: 6c65 2063 6f6d 706f 6e65 6e74 2c20 6861  le component, ha
-00013a00: 7320 6d61 7869 6d75 6d20 7265 6c65 7661  s maximum releva
-00013a10: 6e63 650d 0a20 2020 2020 2020 2020 2020  nce..           
-00013a20: 2076 616c 7565 2064 6566 696e 6564 2061   value defined a
-00013a30: 7320 6f75 7470 7574 5f6c 6179 6572 5f77  s output_layer_w
-00013a40: 6575 6768 742a 636f 7272 656c 6174 696f  eught*correlatio
-00013a50: 6e2e 0d0a 0d0a 2020 2020 2020 2020 5265  n.....        Re
-00013a60: 7475 726e 733a 0d0a 2020 2020 2020 2020  turns:..        
-00013a70: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 2020  --------..      
-00013a80: 2020 6f72 6465 7220 3a20 6c69 7374 206f    order : list o
-00013a90: 6620 696e 740d 0a20 2020 2020 2020 2020  f int..         
-00013aa0: 2020 2069 6e64 6963 6573 206f 6620 7265     indices of re
-00013ab0: 6c65 7661 6e74 2063 6f6d 706f 6e65 6e74  levant component
-00013ac0: 730d 0a0d 0a20 2020 2020 2020 2074 7320  s....        ts 
-00013ad0: 3a20 6c69 7374 206f 6620 696e 7474 6f70  : list of inttop
-00013ae0: 6f2c 2066 7265 715f 7265 7370 6f6e 7365  o, freq_response
-00013af0: 2c20 7073 640d 0a20 2020 2020 2020 2020  , psd..         
-00013b00: 2020 2069 6e64 6963 6573 206f 6620 7265     indices of re
-00013b10: 6c65 7661 6e74 2074 696d 6570 6f69 6e74  levant timepoint
-00013b20: 730d 0a20 2020 2020 2020 2022 2222 0d0a  s..        """..
-00013b30: 2020 2020 2020 2020 6f72 6465 7220 3d20          order = 
-00013b40: 5b5d 0d0a 2020 2020 2020 2020 7473 203d  []..        ts =
-00013b50: 205b 5d0d 0a20 2020 2020 2020 206f 7574   []..        out
-00013b60: 5f77 6569 6768 7473 203d 2070 6174 7465  _weights = patte
-00013b70: 726e 735f 7374 7275 6374 5b27 7765 6967  rns_struct['weig
-00013b80: 6874 7327 5d5b 276f 7574 5f77 6569 6768  hts']['out_weigh
-00013b90: 7473 275d 0d0a 2020 2020 2020 2020 6966  ts']..        if
-00013ba0: 2073 6f72 7469 6e67 203d 3d20 2777 6569   sorting == 'wei
-00013bb0: 6768 745f 6e6f 726d 273a 0d0a 2020 2020  ght_norm':..    
-00013bc0: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-00013bd0: 2072 616e 6765 2873 656c 662e 6f75 745f   range(self.out_
-00013be0: 6469 6d29 3a0d 0a0d 0a20 2020 2020 2020  dim):....       
-00013bf0: 2020 2020 2020 2020 2073 656c 662e 4620           self.F 
-00013c00: 3d20 6f75 745f 7765 6967 6874 735b 2e2e  = out_weights[..
-00013c10: 2e2c 2069 5d2e 540d 0a0d 0a20 2020 2020  ., i].T....     
-00013c20: 2020 2020 2020 2020 2020 206e 6f72 6d73             norms
-00013c30: 203d 206e 702e 6c69 6e61 6c67 2e6e 6f72   = np.linalg.nor
-00013c40: 6d28 7365 6c66 2e46 2c20 6178 6973 3d31  m(self.F, axis=1
-00013c50: 2c20 6f72 643d 3229 0d0a 2020 2020 2020  , ord=2)..      
-00013c60: 2020 2020 2020 2020 2020 7061 7420 3d20            pat = 
-00013c70: 6e70 2e61 7267 736f 7274 286e 6f72 6d73  np.argsort(norms
-00013c80: 295b 2d6e 5f63 6f6d 703a 5d0d 0a20 2020  )[-n_comp:]..   
-00013c90: 2020 2020 2020 2020 2020 2020 206f 7264               ord
-00013ca0: 6572 2e61 7070 656e 6428 7061 7429 0d0a  er.append(pat)..
-00013cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013cc0: 7473 2e61 7070 656e 6428 6e70 2e61 7261  ts.append(np.ara
-00013cd0: 6e67 6528 7365 6c66 2e46 2e73 6861 7065  nge(self.F.shape
-00013ce0: 5b2d 315d 2929 0d0a 2020 2020 2020 2020  [-1]))..        
-00013cf0: 2020 2020 2020 2020 2374 732e 6170 7065          #ts.appe
-00013d00: 6e64 284e 6f6e 6529 0d0a 0d0a 2020 2020  nd(None)....    
-00013d10: 2020 2020 656c 6966 2073 6f72 7469 6e67      elif sorting
-00013d20: 203d 3d20 2763 6f6d 7077 6973 655f 6c6f   == 'compwise_lo
-00013d30: 7373 273a 0d0a 2020 2020 2020 2020 2020  ss':..          
-00013d40: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
-00013d50: 2873 656c 662e 6f75 745f 6469 6d29 3a0d  (self.out_dim):.
-00013d60: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-00013d70: 2020 2073 656c 662e 4620 3d20 6f75 745f     self.F = out_
-00013d80: 7765 6967 6874 735b 2e2e 2e2c 2069 5d2e  weights[..., i].
-00013d90: 540d 0a20 2020 2020 2020 2020 2020 2020  T..             
-00013da0: 2020 2070 6174 203d 206e 702e 6172 676d     pat = np.argm
-00013db0: 696e 2870 6174 7465 726e 735f 7374 7275  in(patterns_stru
-00013dc0: 6374 5b27 636f 6d70 7769 7365 5f6c 6f73  ct['compwise_los
-00013dd0: 7327 5d5b 3a2c 203a 2c20 695d 2e73 756d  s'][:, :, i].sum
-00013de0: 2830 2929 0d0a 2020 2020 2020 2020 2020  (0))..          
-00013df0: 2020 2020 2020 2374 616b 6520 6e20 736d        #take n sm
-00013e00: 616c 6c65 7374 2028 6c61 7267 6573 7420  allest (largest 
-00013e10: 696e 6372 6561 7365 2069 6e20 636f 7374  increase in cost
-00013e20: 2066 756e 6374 696f 6e29 0d0a 2020 2020   function)..    
-00013e30: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
-00013e40: 722e 6170 7065 6e64 285b 7061 745d 290d  r.append([pat]).
-00013e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013e60: 2074 732e 6170 7065 6e64 286e 702e 6172   ts.append(np.ar
-00013e70: 616e 6765 2873 656c 662e 462e 7368 6170  ange(self.F.shap
-00013e80: 655b 2d31 5d29 290d 0a0d 0a20 2020 2020  e[-1]))....     
-00013e90: 2020 2065 6c69 6620 736f 7274 696e 6720     elif sorting 
-00013ea0: 3d3d 2027 6162 735f 7765 6967 6874 273a  == 'abs_weight':
-00013eb0: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-00013ec0: 7220 6920 696e 2072 616e 6765 2873 656c  r i in range(sel
-00013ed0: 662e 6f75 745f 6469 6d29 3a0d 0a0d 0a20  f.out_dim):.... 
-00013ee0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00013ef0: 656c 662e 4620 3d20 6e70 2e61 6273 286f  elf.F = np.abs(o
-00013f00: 7574 5f77 6569 6768 7473 5b2e 2e2e 2c20  ut_weights[..., 
-00013f10: 695d 2e54 290d 0a20 2020 2020 2020 2020  i].T)..         
-00013f20: 2020 2020 2020 2070 6174 2c20 7420 3d20         pat, t = 
-00013f30: 6e70 2e77 6865 7265 2873 656c 662e 4620  np.where(self.F 
-00013f40: 3d3d 206e 702e 6d61 7828 7365 6c66 2e46  == np.max(self.F
-00013f50: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-00013f60: 2020 2020 2370 7269 6e74 2827 4d61 7869      #print('Maxi
-00013f70: 6d75 6d20 7370 6561 726d 616e 2072 3a27  mum spearman r:'
-00013f80: 2c20 6e70 2e6d 6178 2873 656c 662e 636f  , np.max(self.co
-00013f90: 7272 5f74 6f5f 6f75 7470 7574 5b2e 2e2e  rr_to_output[...
-00013fa0: 2c20 695d 2e54 2929 0d0a 2020 2020 2020  , i].T))..      
-00013fb0: 2020 2020 2020 2020 2020 6f72 6465 722e            order.
-00013fc0: 6170 7065 6e64 2870 6174 290d 0a20 2020  append(pat)..   
-00013fd0: 2020 2020 2020 2020 2020 2020 2074 732e               ts.
-00013fe0: 6170 7065 6e64 2874 290d 0a0d 0a20 2020  append(t)....   
-00013ff0: 2020 2020 2065 6c69 6620 736f 7274 696e       elif sortin
-00014000: 6720 3d3d 2027 7765 6967 6874 273a 0d0a  g == 'weight':..
-00014010: 2020 2020 2020 2020 2020 2020 6e5f 636f              n_co
-00014020: 6d70 203d 2031 0d0a 2020 2020 2020 2020  mp = 1..        
-00014030: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
-00014040: 6765 2873 656c 662e 6f75 745f 6469 6d29  ge(self.out_dim)
-00014050: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00014060: 2020 2073 656c 662e 4620 3d20 6f75 745f     self.F = out_
-00014070: 7765 6967 6874 735b 2e2e 2e2c 2069 5d2e  weights[..., i].
-00014080: 540d 0a20 2020 2020 2020 2020 2020 2020  T..             
-00014090: 2020 2070 6174 2c20 7420 3d20 6e70 2e77     pat, t = np.w
-000140a0: 6865 7265 2873 656c 662e 4620 3d3d 206e  here(self.F == n
-000140b0: 702e 6d61 7828 7365 6c66 2e46 2929 0d0a  p.max(self.F))..
-000140c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000140d0: 2370 7269 6e74 2827 4d61 7869 6d75 6d20  #print('Maximum 
-000140e0: 7765 6967 6874 3a27 2c20 6e70 2e6d 6178  weight:', np.max
-000140f0: 2873 656c 662e 4629 290d 0a20 2020 2020  (self.F))..     
-00014100: 2020 2020 2020 2020 2020 206f 7264 6572             order
-00014110: 2e61 7070 656e 6428 7061 7429 0d0a 2020  .append(pat)..  
-00014120: 2020 2020 2020 2020 2020 2020 2020 7473                ts
-00014130: 2e61 7070 656e 6428 7429 0d0a 0d0a 2020  .append(t)....  
-00014140: 2020 2020 2020 656c 6966 2073 6f72 7469        elif sorti
-00014150: 6e67 203d 3d20 276f 7574 7075 745f 636f  ng == 'output_co
-00014160: 7272 273a 0d0a 0d0a 2020 2020 2020 2020  rr':....        
-00014170: 2020 2020 7365 6c66 2e46 203d 2070 6174      self.F = pat
-00014180: 7465 726e 735f 7374 7275 6374 5b27 636f  terns_struct['co
-00014190: 7272 5f74 6f5f 6f75 7470 7574 275d 232e  rr_to_output']#.
-000141a0: 6d65 616e 2830 290d 0a20 2020 2020 2020  mean(0)..       
-000141b0: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-000141c0: 6e67 6528 7365 6c66 2e6f 7574 5f64 696d  nge(self.out_dim
-000141d0: 293a 0d0a 0d0a 2020 2020 2020 2020 2020  ):....          
-000141e0: 2020 2020 2020 2370 7269 6e74 2827 4d61        #print('Ma
-000141f0: 7869 6d75 6d20 725f 7370 6561 723a 272c  ximum r_spear:',
-00014200: 206e 702e 6d61 7828 7365 6c66 2e46 5b2e   np.max(self.F[.
-00014210: 2e2e 2c20 695d 2929 0d0a 2020 2020 2020  .., i]))..      
-00014220: 2020 2020 2020 2020 2020 7061 7420 3d20            pat = 
-00014230: 6e70 2e77 6865 7265 2873 656c 662e 465b  np.where(self.F[
-00014240: 2e2e 2e2c 2069 5d20 3d3d 206e 702e 6d61  ..., i] == np.ma
-00014250: 7828 7365 6c66 2e46 5b2e 2e2e 2c20 695d  x(self.F[..., i]
-00014260: 2929 5b31 5d0d 0a20 2020 2020 2020 2020  ))[1]..         
-00014270: 2020 2020 2020 206f 7264 6572 2e61 7070         order.app
-00014280: 656e 6428 7061 7429 0d0a 2020 2020 2020  end(pat)..      
-00014290: 2020 2020 2020 2020 2020 7473 2e61 7070            ts.app
-000142a0: 656e 6428 6e70 2e61 7261 6e67 6528 7365  end(np.arange(se
-000142b0: 6c66 2e46 2e73 6861 7065 5b2d 315d 2929  lf.F.shape[-1]))
-000142c0: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-000142d0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-000142e0: 6e74 2822 536f 7274 696e 6720 7b3a 737d  nt("Sorting {:s}
-000142f0: 206e 6f74 2069 6d70 6c65 6d65 6e74 6564   not implemented
-00014300: 222e 666f 726d 6174 2873 6f72 7469 6e67  ".format(sorting
-00014310: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-00014320: 7265 7475 726e 204e 6f6e 652c 204e 6f6e  return None, Non
-00014330: 650d 0a0d 0a20 2020 2020 2020 206f 7264  e....        ord
-00014340: 6572 203d 206e 702e 6172 7261 7928 6f72  er = np.array(or
-00014350: 6465 7229 0d0a 2020 2020 2020 2020 7473  der)..        ts
-00014360: 203d 206e 702e 6172 7261 7928 7473 290d   = np.array(ts).
-00014370: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00014380: 6f72 6465 722c 2074 730d 0a0d 0a0d 0a20  order, ts...... 
-00014390: 2020 2064 6566 2073 696e 676c 655f 636f     def single_co
-000143a0: 6d70 6f6e 656e 745f 7061 7474 6572 6e28  mponent_pattern(
-000143b0: 7365 6c66 2c20 7061 7474 6572 6e73 5f73  self, patterns_s
-000143c0: 7472 7563 742c 2073 6f72 7469 6e67 3d27  truct, sorting='
-000143d0: 636f 6d70 7769 7365 5f6c 6f73 7327 2c0d  compwise_loss',.
-000143e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000143f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014400: 2020 6e5f 636f 6d70 3d31 293a 0d0a 2020    n_comp=1):..  
-00014410: 2020 2020 2020 2222 2250 6963 6b20 7369        """Pick si
-00014420: 6e67 6c65 2063 6f6d 706f 6e65 6e74 2061  ngle component a
-00014430: 6363 6f72 6469 6e67 2074 6f20 736f 7274  ccording to sort
-00014440: 696e 6720 6d65 7468 6f64 2e0d 0a20 2020  ing method...   
-00014450: 2020 2020 204d 756c 7469 706c 7920 7370       Multiply sp
-00014460: 6174 6961 6c20 6669 6c74 6572 2062 7920  atial filter by 
-00014470: 6461 7461 2063 6f76 6172 6961 6e63 6522  data covariance"
-00014480: 2222 0d0a 2020 2020 2020 2020 6f72 6465  ""..        orde
-00014490: 722c 2074 7320 3d20 7365 6c66 2e5f 736f  r, ts = self._so
-000144a0: 7274 696e 6728 2070 6174 7465 726e 735f  rting( patterns_
-000144b0: 7374 7275 6374 2c20 736f 7274 696e 672c  struct, sorting,
-000144c0: 206e 5f63 6f6d 703d 6e5f 636f 6d70 290d   n_comp=n_comp).
-000144d0: 0a20 2020 2020 2020 2063 5f74 6f70 6f73  .        c_topos
-000144e0: 203d 205b 5d0d 0a20 2020 2020 2020 2063   = []..        c
-000144f0: 5f70 7364 7320 3d20 5b5d 0d0a 2020 2020  _psds = []..    
-00014500: 2020 2020 635f 6672 7320 3d20 5b5d 0d0a      c_frs = []..
-00014510: 2020 2020 2020 2020 2370 7269 6e74 2873          #print(s
-00014520: 6f72 7469 6e67 2c20 6f72 6465 7229 0d0a  orting, order)..
-00014530: 2020 2020 2020 2020 7720 3d20 7061 7474          w = patt
-00014540: 6572 6e73 5f73 7472 7563 745b 2777 6569  erns_struct['wei
-00014550: 6768 7473 275d 5b27 646d 7827 5d0d 0a20  ghts']['dmx'].. 
-00014560: 2020 2020 2020 2023 6120 3d20 6e70 2e64         #a = np.d
-00014570: 6f74 2870 6174 7465 726e 735f 7374 7275  ot(patterns_stru
-00014580: 6374 5b27 6463 6f76 275d 5b27 696e 7075  ct['dcov']['inpu
-00014590: 745f 7370 6174 6961 6c27 5d2c 2077 290d  t_spatial'], w).
-000145a0: 0a20 2020 2020 2020 2070 7269 6e74 2873  .        print(s
-000145b0: 6f72 7469 6e67 2c20 273a 2063 6f6d 706f  orting, ': compo
-000145c0: 6e65 6e74 2023 7b7d 272c 206f 7264 6572  nent #{}', order
-000145d0: 5b30 5d5b 305d 290d 0a20 2020 2020 2020  [0][0])..       
-000145e0: 2066 6f72 2069 2c20 636f 6d70 7320 696e   for i, comps in
-000145f0: 2065 6e75 6d65 7261 7465 286f 7264 6572   enumerate(order
-00014600: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00014610: 6120 3d20 6e70 2e64 6f74 2870 6174 7465  a = np.dot(patte
-00014620: 726e 735f 7374 7275 6374 5b27 6463 6f76  rns_struct['dcov
-00014630: 275d 5b27 696e 7075 745f 7370 6174 6961  ']['input_spatia
-00014640: 6c27 5d2c 2077 290d 0a20 2020 2020 2020  l'], w)..       
-00014650: 2020 2020 2023 6120 3d20 6e70 2e64 6f74       #a = np.dot
-00014660: 2870 6174 7465 726e 735f 7374 7275 6374  (patterns_struct
-00014670: 5b27 6463 6f76 275d 5b27 636c 6173 735f  ['dcov']['class_
-00014680: 636f 6e64 6974 696f 6e61 6c27 5d5b 695d  conditional'][i]
-00014690: 2c20 7729 0d0a 0d0a 2020 2020 2020 2020  , w)....        
-000146a0: 2020 2020 635f 746f 706f 732e 6170 7065      c_topos.appe
-000146b0: 6e64 2861 5b3a 2c20 636f 6d70 735d 290d  nd(a[:, comps]).
-000146c0: 0a20 2020 2020 2020 2020 2020 2063 5f70  .            c_p
-000146d0: 7364 732e 6170 7065 6e64 2870 6174 7465  sds.append(patte
-000146e0: 726e 735f 7374 7275 6374 5b27 7370 6563  rns_struct['spec
-000146f0: 7472 6127 5d5b 2770 7364 7327 5d5b 636f  tra']['psds'][co
-00014700: 6d70 732c 203a 5d2e 542c 290d 0a20 2020  mps, :].T,)..   
-00014710: 2020 2020 2020 2020 2063 5f66 7273 2e61           c_frs.a
-00014720: 7070 656e 6428 7061 7474 6572 6e73 5f73  ppend(patterns_s
-00014730: 7472 7563 745b 2773 7065 6374 7261 275d  truct['spectra']
-00014740: 5b27 6672 6571 5f72 6573 706f 6e73 6573  ['freq_responses
-00014750: 275d 5b63 6f6d 7073 2c20 3a5d 2e54 290d  '][comps, :].T).
-00014760: 0a20 2020 2020 2020 2074 6f70 6f20 3d20  .        topo = 
-00014770: 6e70 2e63 6f6e 6361 7465 6e61 7465 2863  np.concatenate(c
-00014780: 5f74 6f70 6f73 2c20 6178 6973 3d2d 3129  _topos, axis=-1)
-00014790: 0d0a 2020 2020 2020 2020 6672 6571 5f72  ..        freq_r
-000147a0: 6573 706f 6e73 6520 3d20 6e70 2e63 6f6e  esponse = np.con
-000147b0: 6361 7465 6e61 7465 2863 5f66 7273 2c20  catenate(c_frs, 
-000147c0: 6178 6973 3d2d 3129 0d0a 2020 2020 2020  axis=-1)..      
-000147d0: 2020 7073 6420 3d20 6e70 2e63 6f6e 6361    psd = np.conca
-000147e0: 7465 6e61 7465 2863 5f70 7364 732c 2061  tenate(c_psds, a
-000147f0: 7869 733d 2d31 290d 0a20 2020 2020 2020  xis=-1)..       
-00014800: 2023 6672 6571 7320 3d20 7061 7474 6572   #freqs = patter
-00014810: 6e73 5f73 7472 7563 745b 2766 7265 7173  ns_struct['freqs
-00014820: 275d 0d0a 2020 2020 2020 2020 7265 7475  ']..        retu
-00014830: 726e 2074 6f70 6f2c 2066 7265 715f 7265  rn topo, freq_re
-00014840: 7370 6f6e 7365 2c20 7073 6423 2c20 6672  sponse, psd#, fr
-00014850: 6571 730d 0a0d 0a20 2020 2064 6566 2070  eqs....    def p
-00014860: 6c6f 745f 636f 6d62 696e 6564 5f70 6174  lot_combined_pat
-00014870: 7465 726e 2873 656c 662c 206d 6574 686f  tern(self, metho
-00014880: 643d 2763 6f6d 6269 6e65 6427 2c20 7365  d='combined', se
-00014890: 6e73 6f72 5f6c 6179 6f75 743d 4e6f 6e65  nsor_layout=None
-000148a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000148b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000148c0: 206e 616d 6573 3d4e 6f6e 652c 206e 5f63   names=None, n_c
-000148d0: 6f6d 703d 312c 2070 6c6f 745f 7472 7565  omp=1, plot_true
-000148e0: 5f65 766f 6b65 643d 4661 6c73 652c 0d0a  _evoked=False,..
-000148f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014900: 2020 2020 2020 2020 2020 2020 2020 7361                sa
-00014910: 7665 6669 673d 4e6f 6e65 293a 0d0a 2020  vefig=None):..  
-00014920: 2020 2020 2020 6966 206e 6f74 206e 616d        if not nam
-00014930: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
-00014940: 206e 616d 6573 203d 205b 2743 6c61 7373   names = ['Class
-00014950: 207b 7d27 2e66 6f72 6d61 7428 6929 2066   {}'.format(i) f
-00014960: 6f72 2069 2069 6e20 7261 6e67 6528 7365  or i in range(se
-00014970: 6c66 2e79 5f73 6861 7065 5b2d 315d 295d  lf.y_shape[-1])]
-00014980: 0d0a 0d0a 0d0a 2320 2020 2020 2020 2063  ......#        c
-00014990: 6320 3d20 6e70 2e61 7272 6179 285b 6e70  c = np.array([np
-000149a0: 2e63 6f72 7263 6f65 6628 7365 6c66 2e63  .corrcoef(self.c
-000149b0: 765f 7061 7474 6572 6e73 5b3a 2c20 692c  v_patterns[:, i,
-000149c0: 203a 5d2e 5429 5b69 2c3a 5d0d 0a23 2020   :].T)[i,:]..#  
-000149d0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-000149e0: 2069 2069 6e20 7261 6e67 6528 7365 6c66   i in range(self
-000149f0: 2e63 765f 7061 7474 6572 6e73 2e73 6861  .cv_patterns.sha
-00014a00: 7065 5b31 5d29 5d29 0d0a 2020 2020 2020  pe[1])])..      
-00014a10: 2020 6966 206c 656e 2873 656c 662e 6376    if len(self.cv
-00014a20: 5f70 6174 7465 726e 732e 6974 656d 7328  _patterns.items(
-00014a30: 2929 203e 2030 3a0d 0a20 2020 2020 2020  )) > 0:..       
-00014a40: 2020 2020 2070 7269 6e74 2822 5265 7374       print("Rest
-00014a50: 6f72 696e 6720 6672 6f6d 3a22 2c20 6d65  oring from:", me
-00014a60: 7468 6f64 2029 0d0a 2020 2020 2020 2020  thod )..        
-00014a70: 2020 2020 746f 706f 7320 3d20 6e70 2e6d      topos = np.m
-00014a80: 6561 6e28 7365 6c66 2e63 765f 7061 7474  ean(self.cv_patt
-00014a90: 6572 6e73 5b6d 6574 686f 645d 5b27 7370  erns[method]['sp
-00014aa0: 6174 6961 6c27 5d2c 0d0a 2020 2020 2020  atial'],..      
-00014ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ac0: 2020 2020 2020 2020 2020 2020 2020 202d                 -
-00014ad0: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
-00014ae0: 6669 6c74 6572 7320 3d20 6e70 2e6d 6561  filters = np.mea
-00014af0: 6e28 7365 6c66 2e63 765f 7061 7474 6572  n(self.cv_patter
-00014b00: 6e73 5b6d 6574 686f 645d 5b27 7465 6d70  ns[method]['temp
-00014b10: 6f72 616c 275d 2c0d 0a20 2020 2020 2020  oral'],..       
-00014b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b40: 2d31 290d 0a20 2020 2020 2020 2020 2020  -1)..           
-00014b50: 2070 7364 7320 3d20 6e70 2e6d 6561 6e28   psds = np.mean(
-00014b60: 7365 6c66 2e63 765f 7061 7474 6572 6e73  self.cv_patterns
-00014b70: 5b6d 6574 686f 645d 5b27 7073 6473 275d  [method]['psds']
-00014b80: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00014b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ba0: 2020 2020 2020 202d 3129 0d0a 2020 2020         -1)..    
-00014bb0: 2020 2020 2020 2020 2366 7265 7173 203d          #freqs =
-00014bc0: 2073 656c 662e 6672 6571 730d 0a0d 0a20   self.freqs.... 
-00014bd0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00014be0: 2065 6c69 6620 6d65 7468 6f64 2069 6e20   elif method in 
-00014bf0: 5b27 7765 6967 6874 272c 2027 636f 6d70  ['weight', 'comp
-00014c00: 7769 7365 5f6c 6f73 7327 5d3a 0d0a 2020  wise_loss']:..  
-00014c10: 2020 2020 2020 2020 2020 746f 706f 732c            topos,
-00014c20: 2066 696c 7465 7273 2c20 7073 6473 203d   filters, psds =
-00014c30: 2073 656c 662e 7369 6e67 6c65 5f70 6174   self.single_pat
-00014c40: 7465 726e 2873 6f72 7469 6e67 3d6d 6574  tern(sorting=met
-00014c50: 686f 642c 0d0a 2020 2020 2020 2020 2020  hod,..          
-00014c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c80: 2020 2020 2020 2020 2020 2020 206e 5f63               n_c
-00014c90: 6f6d 703d 6e5f 636f 6d70 290d 0a0d 0a0d  omp=n_comp).....
-00014ca0: 0a20 2020 2020 2020 2066 7265 7173 203d  .        freqs =
-00014cb0: 2073 656c 662e 6376 5f70 6174 7465 726e   self.cv_pattern
-00014cc0: 735b 2766 7265 7173 275d 0d0a 0d0a 2020  s['freqs']....  
-00014cd0: 2020 2020 2020 746f 706f 7320 2f3d 206e        topos /= n
-00014ce0: 702e 6d61 7869 6d75 6d28 746f 706f 732e  p.maximum(topos.
-00014cf0: 7374 6428 6178 6973 3d30 2c20 6b65 6570  std(axis=0, keep
-00014d00: 6469 6d73 3d54 7275 6529 2c0d 0a20 2020  dims=True),..   
-00014d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d30: 2020 3165 2d33 290d 0a20 2020 2020 2020    1e-3)..       
-00014d40: 206e 203d 2073 656c 662e 795f 7368 6170   n = self.y_shap
-00014d50: 655b 305d 0d0a 2020 2020 2020 2020 6e63  e[0]..        nc
-00014d60: 6f6c 7320 3d20 6e0d 0a20 2020 2020 2020  ols = n..       
-00014d70: 206c 6f20 3d20 6368 616e 6e65 6c73 2e72   lo = channels.r
-00014d80: 6561 645f 6c61 796f 7574 2873 656e 736f  ead_layout(senso
-00014d90: 725f 6c61 796f 7574 290d 0a20 2020 2020  r_layout)..     
-00014da0: 2020 2023 6c6f 203d 2063 6861 6e6e 656c     #lo = channel
-00014db0: 732e 6765 6e65 7261 7465 5f32 645f 6c61  s.generate_2d_la
-00014dc0: 796f 7574 286c 6f2e 706f 7329 0d0a 2020  yout(lo.pos)..  
-00014dd0: 2020 2020 2020 696e 666f 203d 2063 7265        info = cre
-00014de0: 6174 655f 696e 666f 286c 6f2e 6e61 6d65  ate_info(lo.name
-00014df0: 732c 2031 2e2c 2073 656e 736f 725f 6c61  s, 1., sensor_la
-00014e00: 796f 7574 2e73 706c 6974 2827 2d27 295b  yout.split('-')[
-00014e10: 2d31 5d29 0d0a 2020 2020 2020 2020 6f72  -1])..        or
-00014e20: 6967 5f78 7920 3d20 6e70 2e6d 6561 6e28  ig_xy = np.mean(
-00014e30: 6c6f 2e70 6f73 5b3a 2c20 3a32 5d2c 2030  lo.pos[:, :2], 0
-00014e40: 290d 0a20 2020 2020 2020 2066 6f72 2069  )..        for i
-00014e50: 2c20 6368 2069 6e20 656e 756d 6572 6174  , ch in enumerat
-00014e60: 6528 6c6f 2e6e 616d 6573 293a 0d0a 2020  e(lo.names):..  
-00014e70: 2020 2020 2020 2020 2020 6966 2069 6e66            if inf
-00014e80: 6f5b 2763 6873 275d 5b69 5d5b 2763 685f  o['chs'][i]['ch_
-00014e90: 6e61 6d65 275d 203d 3d20 6368 3a0d 0a20  name'] == ch:.. 
-00014ea0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00014eb0: 6e66 6f5b 2763 6873 275d 5b69 5d5b 276c  nfo['chs'][i]['l
-00014ec0: 6f63 275d 5b3a 325d 203d 2028 6c6f 2e70  oc'][:2] = (lo.p
-00014ed0: 6f73 5b69 2c20 3a32 5d20 2d20 6f72 6967  os[i, :2] - orig
-00014ee0: 5f78 7929 2f34 2e35 0d0a 2020 2020 2020  _xy)/4.5..      
-00014ef0: 2020 2020 2020 2020 2020 2369 6e66 6f5b            #info[
-00014f00: 2763 6873 275d 5b69 5d5b 276c 6f63 275d  'chs'][i]['loc']
-00014f10: 5b34 3a5d 203d 2030 0d0a 2020 2020 2020  [4:] = 0..      
-00014f20: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00014f30: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00014f40: 6e74 2822 4368 616e 6e65 6c20 6e61 6d65  nt("Channel name
-00014f50: 206d 6973 6d61 7463 682e 2069 6e66 6f3a   mismatch. info:
-00014f60: 207b 7d20 7673 206c 6f3a 207b 7d22 2e66   {} vs lo: {}".f
-00014f70: 6f72 6d61 7428 0d0a 2020 2020 2020 2020  ormat(..        
-00014f80: 2020 2020 2020 2020 2020 2020 696e 666f              info
-00014f90: 5b27 6368 7327 5d5b 695d 5b27 6368 5f6e  ['chs'][i]['ch_n
-00014fa0: 616d 6527 5d2c 2063 6829 290d 0a0d 0a20  ame'], ch)).... 
-00014fb0: 2020 2020 2020 2073 656c 662e 6661 6b65         self.fake
-00014fc0: 5f65 766f 6b65 6420 3d20 6576 6f6b 6564  _evoked = evoked
-00014fd0: 2e45 766f 6b65 6441 7272 6179 2874 6f70  .EvokedArray(top
-00014fe0: 6f73 2c20 696e 666f 290d 0a20 2020 2020  os, info)..     
-00014ff0: 2020 2073 656c 662e 6661 6b65 5f65 766f     self.fake_evo
-00015000: 6b65 642e 6461 7461 5b3a 2c20 3a6e 5d20  ked.data[:, :n] 
-00015010: 3d20 746f 706f 730d 0a0d 0a20 2020 2020  = topos....     
-00015020: 2020 2066 616b 655f 7469 6d65 7320 3d20     fake_times = 
-00015030: 6e70 2e61 7261 6e67 6528 302c 2020 6e2c  np.arange(0,  n,
-00015040: 2031 2e29 0d0a 2020 2020 2020 2020 6674   1.)..        ft
-00015050: 203d 2073 656c 662e 6661 6b65 5f65 766f   = self.fake_evo
-00015060: 6b65 642e 706c 6f74 5f74 6f70 6f6d 6170  ked.plot_topomap
-00015070: 2874 696d 6573 3d66 616b 655f 7469 6d65  (times=fake_time
-00015080: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
-00015090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150a0: 2020 2020 2020 2020 2020 2020 2020 2361                #a
-000150b0: 7865 733d 6178 5b30 2c20 305d 2c0d 0a20  xes=ax[0, 0],.. 
-000150c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150e0: 2020 2020 2020 2020 2063 6f6c 6f72 6261           colorba
-000150f0: 723d 5472 7565 2c0d 0a20 2020 2020 2020  r=True,..       
-00015100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015120: 2020 2023 766d 6178 3d76 6d61 782c 0d0a     #vmax=vmax,..
-00015130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015150: 2020 2020 2020 2020 2020 7363 616c 696e            scalin
-00015160: 6773 3d31 2c0d 0a20 2020 2020 2020 2020  gs=1,..         
-00015170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015190: 2074 696d 655f 666f 726d 6174 3d6d 6574   time_format=met
-000151a0: 686f 642c 0d0a 2020 2020 2020 2020 2020  hod,..          
-000151b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000151c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000151d0: 2374 6974 6c65 3d27 272c 0d0a 2020 2020  #title='',..    
-000151e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012b30: 2020 2020 2020 206d 6574 686f 643d 2769         method='i
+00012b40: 6972 272c 0d0a 2020 2020 2020 2020 2020  ir',..          
+00012b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012b70: 2020 2020 2020 2020 7665 7262 6f73 653d          verbose=
+00012b80: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
+00012b90: 2020 2020 5b61 785b 302c 2030 5d2e 706c      [ax[0, 0].pl
+00012ba0: 6f74 2874 696d 6573 2c20 7766 2c20 636f  ot(times, wf, co
+00012bb0: 6c6f 723d 2774 6162 3a67 7265 7927 2c20  lor='tab:grey', 
+00012bc0: 616c 7068 613d 2e32 3529 0d0a 2020 2020  alpha=.25)..    
+00012bd0: 2020 2020 2020 2020 2066 6f72 2069 2c20           for i, 
+00012be0: 7766 2069 6e20 656e 756d 6572 6174 6528  wf in enumerate(
+00012bf0: 7363 616c 6564 5f77 6176 6566 6f72 6d73  scaled_waveforms
+00012c00: 2920 6966 2069 206e 6f74 2069 6e20 7365  ) if i not in se
+00012c10: 6c66 2e75 6f72 6465 725d 0d0a 0d0a 2020  lf.uorder]....  
+00012c20: 2020 2020 2020 2020 2020 5b61 785b 302c            [ax[0,
+00012c30: 2030 5d2e 706c 6f74 2874 696d 6573 2c0d   0].plot(times,.
+00012c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012c50: 2020 2020 2020 2020 2020 2073 6361 6c65             scale
+00012c60: 645f 7761 7665 666f 726d 735b 756f 5d2c  d_waveforms[uo],
+00012c70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012c80: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+00012c90: 7769 6474 683d 322e 2c20 6c61 6265 6c3d  width=2., label=
+00012ca0: 636c 6173 735f 6e61 6d65 735b 695d 2c20  class_names[i], 
+00012cb0: 616c 7068 613d 2e37 3529 0d0a 2020 2020  alpha=.75)..    
+00012cc0: 2020 2020 2020 2020 2066 6f72 2069 2c20           for i, 
+00012cd0: 756f 2069 6e20 656e 756d 6572 6174 6528  uo in enumerate(
+00012ce0: 7365 6c66 2e75 6f72 6465 7229 5d0d 0a20  self.uorder)].. 
+00012cf0: 2020 2020 2020 2020 2020 2061 785b 302c             ax[0,
+00012d00: 2030 5d2e 7365 745f 7469 746c 6528 274c   0].set_title('L
+00012d10: 6174 656e 7420 636f 6d70 6f6e 656e 7420  atent component 
+00012d20: 7761 7665 666f 726d 7327 290d 0a20 2020  waveforms')..   
+00012d30: 2020 2020 2020 2020 2069 6620 746c 696d           if tlim
+00012d40: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00012d50: 2020 2061 785b 302c 2030 5d2e 7365 745f     ax[0, 0].set_
+00012d60: 786c 696d 2874 6c69 6d29 0d0a 0d0a 2020  xlim(tlim)....  
+00012d70: 2020 2020 2020 2020 2020 7473 7465 7020            tstep 
+00012d80: 3d20 666c 6f61 7428 7365 6c66 2e73 7065  = float(self.spe
+00012d90: 6373 5b27 7374 7269 6465 275d 292f 7365  cs['stride'])/se
+00012da0: 6c66 2e64 6174 6173 6574 2e68 5f70 6172  lf.dataset.h_par
+00012db0: 616d 735b 2766 7327 5d0d 0a20 2020 2020  ams['fs']..     
+00012dc0: 2020 2020 2020 2073 7472 6964 6573 3120         strides1 
+00012dd0: 3d20 6e70 2e61 7261 6e67 6528 7469 6d65  = np.arange(time
+00012de0: 735b 305d 2c20 7469 6d65 735b 2d31 5d20  s[0], times[-1] 
+00012df0: 2b20 7473 7465 702f 322c 2074 7374 6570  + tstep/2, tstep
+00012e00: 290d 0a20 2020 2020 2020 2020 2020 2061  )..            a
+00012e10: 785b 312c 2030 5d2e 7063 6f6c 6f72 2873  x[1, 0].pcolor(s
+00012e20: 7472 6964 6573 312c 206e 702e 6172 616e  trides1, np.aran
+00012e30: 6765 2873 656c 662e 7370 6563 735b 276e  ge(self.specs['n
+00012e40: 5f6c 6174 656e 7427 5d29 2c0d 0a20 2020  _latent']),..   
+00012e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e60: 2020 2020 2020 2020 6e70 2e6d 6561 6e28          np.mean(
+00012e70: 7365 6c66 2e74 635f 6f75 742c 2030 292e  self.tc_out, 0).
+00012e80: 542c 2023 7368 6164 696e 673d 2761 7574  T, #shading='aut
+00012e90: 6f27 0d0a 2020 2020 2020 2020 2020 2020  o'..            
+00012ea0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00012eb0: 0d0a 2320 2020 2020 2020 2020 2020 2074  ..#            t
+00012ec0: 636f 7574 203d 206e 702e 6d65 616e 2873  cout = np.mean(s
+00012ed0: 656c 662e 7463 5f6f 7574 5f75 6e70 6f6f  elf.tc_out_unpoo
+00012ee0: 6c65 642c 3029 2e54 202d 2073 656c 662e  led,0).T - self.
+00012ef0: 745f 636f 6e76 5f62 6961 7365 735b 3a2c  t_conv_biases[:,
+00012f00: 204e 6f6e 655d 0d0a 2320 2020 2020 2020   None]..#       
+00012f10: 2020 2020 205b 6178 5b31 2c20 305d 2e70       [ax[1, 0].p
+00012f20: 6c6f 7428 7469 6d65 732c 2074 636f 7574  lot(times, tcout
+00012f30: 692c 2063 6f6c 6f72 3d27 7461 623a 6772  i, color='tab:gr
+00012f40: 6579 272c 2061 6c70 6861 3d2e 3235 290d  ey', alpha=.25).
+00012f50: 0a23 2020 2020 2020 2020 2020 2020 666f  .#            fo
+00012f60: 7220 692c 2074 636f 7574 6920 696e 2065  r i, tcouti in e
+00012f70: 6e75 6d65 7261 7465 2874 636f 7574 2920  numerate(tcout) 
+00012f80: 6966 2069 206e 6f74 2069 6e20 7365 6c66  if i not in self
+00012f90: 2e75 6f72 6465 725d 0d0a 0d0a 2320 2020  .uorder]....#   
+00012fa0: 2020 2020 2020 2020 205b 6178 5b31 2c20           [ax[1, 
+00012fb0: 305d 2e70 6c6f 7428 7469 6d65 732c 2074  0].plot(times, t
+00012fc0: 636f 7574 5b75 6f5d 2920 666f 7220 692c  cout[uo]) for i,
+00012fd0: 2075 6f20 696e 2065 6e75 6d65 7261 7465   uo in enumerate
+00012fe0: 2873 656c 662e 756f 7264 6572 295d 0d0a  (self.uorder)]..
+00012ff0: 2020 2020 2020 2020 2020 2020 6178 5b31              ax[1
+00013000: 2c20 305d 2e73 6574 5f74 6974 6c65 2822  , 0].set_title("
+00013010: 4176 672e 2054 656d 706f 7261 6c20 436f  Avg. Temporal Co
+00013020: 6e76 6f6c 7574 696f 6e20 4f75 7470 7574  nvolution Output
+00013030: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+00013040: 6178 5b31 2c20 305d 2e73 6574 5f79 6c61  ax[1, 0].set_yla
+00013050: 6265 6c28 2243 6f6d 706f 6e65 6e74 2069  bel("Component i
+00013060: 6e64 6578 2229 0d0a 2020 2020 2020 2020  ndex")..        
+00013070: 2020 2020 6178 5b31 2c20 305d 2e73 6574      ax[1, 0].set
+00013080: 5f78 6c61 6265 6c28 2254 696d 652c 2073  _xlabel("Time, s
+00013090: 2229 0d0a 2020 2020 2020 2020 2020 2020  ")..            
+000130a0: 6966 2074 6c69 6d3a 0d0a 2020 2020 2020  if tlim:..      
+000130b0: 2020 2020 2020 2020 2020 6178 5b31 2c20            ax[1, 
+000130c0: 305d 2e73 6574 5f78 6c69 6d28 746c 696d  0].set_xlim(tlim
+000130d0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+000130e0: 6620 6e6f 7420 6861 7361 7474 7228 7365  f not hasattr(se
+000130f0: 6c66 2c20 2770 6174 7465 726e 5f77 6569  lf, 'pattern_wei
+00013100: 6768 7473 2729 3a0d 0a20 2020 2020 2020  ghts'):..       
+00013110: 2020 2020 2020 2020 2070 6174 7465 726e           pattern
+00013120: 5f77 6569 6768 7473 203d 206e 702e 6569  _weights = np.ei
+00013130: 6e73 756d 2827 696a 6b2c 206a 6b6c 202d  nsum('ijk, jkl -
+00013140: 3e69 6b6c 272c 2073 656c 662e 7463 5f6f  >ikl', self.tc_o
+00013150: 7574 2c20 7365 6c66 2e6f 7574 5f77 6569  ut, self.out_wei
+00013160: 6768 7473 290d 0a20 2020 2020 2020 2020  ghts)..         
+00013170: 2020 2020 2020 2073 656c 662e 7061 7474         self.patt
+00013180: 6572 6e5f 7765 6967 6874 7320 3d20 6e70  ern_weights = np
+00013190: 2e6d 6178 696d 756d 2870 6174 7465 726e  .maximum(pattern
+000131a0: 5f77 6569 6768 7473 202b 2073 656c 662e  _weights + self.
+000131b0: 6f75 745f 6269 6173 6573 5b4e 6f6e 652c  out_biases[None,
+000131c0: 203a 5d2c 2030 2e29 2e6d 6561 6e28 3029   :], 0.).mean(0)
+000131d0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+000131e0: 6120 3d20 6178 5b30 2c20 315d 2e70 636f  a = ax[0, 1].pco
+000131f0: 6c6f 7228 7365 6c66 2e70 6174 7465 726e  lor(self.pattern
+00013200: 5f77 6569 6768 7473 2c20 636d 6170 3d27  _weights, cmap='
+00013210: 626f 6e65 5f72 2729 0d0a 2020 2020 2020  bone_r')..      
+00013220: 2020 2020 2020 6469 7669 6465 7220 3d20        divider = 
+00013230: 6d61 6b65 5f61 7865 735f 6c6f 6361 7461  make_axes_locata
+00013240: 626c 6528 6178 5b30 2c31 5d29 0d0a 2020  ble(ax[0,1])..  
+00013250: 2020 2020 2020 2020 2020 6361 7820 3d20            cax = 
+00013260: 6469 7669 6465 722e 6170 7065 6e64 5f61  divider.append_a
+00013270: 7865 7328 2772 6967 6874 272c 2073 697a  xes('right', siz
+00013280: 653d 2735 2527 2c20 7061 643d 302e 3035  e='5%', pad=0.05
+00013290: 290d 0a20 2020 2020 2020 2020 2020 2066  )..            f
+000132a0: 2e63 6f6c 6f72 6261 7228 612c 2063 6178  .colorbar(a, cax
+000132b0: 3d63 6178 2c20 6f72 6965 6e74 6174 696f  =cax, orientatio
+000132c0: 6e3d 2776 6572 7469 6361 6c27 290d 0a20  n='vertical').. 
+000132d0: 2020 2020 2020 2020 2020 2072 203d 205b             r = [
+000132e0: 7074 6368 2e52 6563 7461 6e67 6c65 2828  ptch.Rectangle((
+000132f0: 692c 2075 6f29 2c20 7769 6474 683d 312c  i, uo), width=1,
+00013300: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013320: 2020 6865 6967 6874 3d31 2c20 616e 676c    height=1, angl
+00013330: 653d 302e 3029 2066 6f72 2069 2c20 756f  e=0.0) for i, uo
+00013340: 2069 6e20 656e 756d 6572 6174 6528 7365   in enumerate(se
+00013350: 6c66 2e75 6f72 6465 7229 5d0d 0a20 2020  lf.uorder)]..   
+00013360: 2020 2020 2020 2020 2070 6320 3d20 636f           pc = co
+00013370: 6c6c 6563 7469 6f6e 732e 5061 7463 6843  llections.PatchC
+00013380: 6f6c 6c65 6374 696f 6e28 722c 2066 6163  ollection(r, fac
+00013390: 6563 6f6c 6f72 3d4e 6f6e 652c 2061 6c70  ecolor=None, alp
+000133a0: 6861 3d2e 352c 0d0a 2020 2020 2020 2020  ha=.5,..        
+000133b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000133c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000133d0: 2020 2020 206c 696e 6577 6964 7468 3d32       linewidth=2
+000133e0: 2e2c 0d0a 2020 2020 2020 2020 2020 2020  .,..            
+000133f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013410: 2065 6467 6563 6f6c 6f72 3d27 7461 623a   edgecolor='tab:
+00013420: 6f72 616e 6765 2729 0d0a 2020 2020 2020  orange')..      
+00013430: 2020 2020 2020 6178 5b30 2c20 315d 2e61        ax[0, 1].a
+00013440: 6464 5f63 6f6c 6c65 6374 696f 6e28 7063  dd_collection(pc
+00013450: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+00013460: 2061 785b 302c 2031 5d2e 7365 745f 7469   ax[0, 1].set_ti
+00013470: 746c 6528 2250 6174 7465 726e 2077 6569  tle("Pattern wei
+00013480: 6768 7473 2229 0d0a 2020 2020 2020 2020  ghts")..        
+00013490: 2020 2020 6178 5b30 2c20 315d 2e73 6574      ax[0, 1].set
+000134a0: 5f79 6c61 6265 6c28 2243 6f6d 706f 6e65  _ylabel("Compone
+000134b0: 6e74 2069 6e64 6578 2229 0d0a 2020 2020  nt index")..    
+000134c0: 2020 2020 2020 2020 6178 5b30 2c20 315d          ax[0, 1]
+000134d0: 2e73 6574 5f78 7469 636b 7328 6e70 2e61  .set_xticks(np.a
+000134e0: 7261 6e67 6528 302e 352c 2030 2e35 2b6c  range(0.5, 0.5+l
+000134f0: 656e 2863 6c61 7373 5f6e 616d 6573 292c  en(class_names),
+00013500: 2031 2929 0d0a 2020 2020 2020 2020 2020   1))..          
+00013510: 2020 6178 5b30 2c20 315d 2e73 6574 5f78    ax[0, 1].set_x
+00013520: 7469 636b 6c61 6265 6c73 2863 6c61 7373  ticklabels(class
+00013530: 5f6e 616d 6573 290d 0a20 2020 2020 2020  _names)..       
+00013540: 2020 2020 2072 7073 7320 3d20 5b5d 0d0a       rpss = []..
+00013550: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00013560: 692c 2066 6c74 2069 6e20 656e 756d 6572  i, flt in enumer
+00013570: 6174 6528 7365 6c66 2e66 696c 7465 7273  ate(self.filters
+00013580: 2e54 293a 0d0a 0d0a 2020 2020 2020 2020  .T):....        
+00013590: 2020 2020 2020 2020 666c 7420 2d3d 2066          flt -= f
+000135a0: 6c74 2e6d 6561 6e28 290d 0a20 2020 2020  lt.mean()..     
+000135b0: 2020 2020 2020 2020 2020 2068 203d 2073             h = s
+000135c0: 656c 662e 6672 6571 5f72 6573 706f 6e73  elf.freq_respons
+000135d0: 6573 5b69 2c20 3a5d 0d0a 2020 2020 2020  es[i, :]..      
+000135e0: 2020 2020 2020 2020 2020 7073 6420 3d20            psd = 
+000135f0: 7365 6c66 2e70 7364 735b 692c 203a 5d0d  self.psds[i, :].
+00013600: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+00013610: 2020 2023 7270 7373 2e61 7070 656e 6428     #rpss.append(
+00013620: 682f 6e70 2e73 756d 2868 2929 0d0a 2020  h/np.sum(h))..  
+00013630: 2020 2020 2020 2020 2020 2020 2020 7270                rp
+00013640: 7373 2e61 7070 656e 6428 2870 7364 2a68  ss.append((psd*h
+00013650: 2929 2023 2529 2f6e 702e 7375 6d28 7073  )) #%)/np.sum(ps
+00013660: 642a 6829 0d0a 0d0a 2020 2020 2020 2020  d*h)....        
+00013670: 2020 2020 5b61 785b 312c 2031 5d2e 706c      [ax[1, 1].pl
+00013680: 6f74 2873 656c 662e 6672 6571 732c 2072  ot(self.freqs, r
+00013690: 7073 735b 756f 5d2c 206c 696e 6577 6964  pss[uo], linewid
+000136a0: 7468 3d32 2e35 2c20 6c61 6265 6c3d 636c  th=2.5, label=cl
+000136b0: 6173 735f 6e61 6d65 735b 695d 290d 0a20  ass_names[i]).. 
+000136c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000136d0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000136e0: 692c 2075 6f20 696e 2065 6e75 6d65 7261  i, uo in enumera
+000136f0: 7465 2873 656c 662e 756f 7264 6572 295d  te(self.uorder)]
+00013700: 0d0a 2020 2020 2020 2020 2020 2020 6178  ..            ax
+00013710: 5b31 2c20 315d 2e73 6574 5f78 6c69 6d28  [1, 1].set_xlim(
+00013720: 302c 3930 2e29 0d0a 2020 2020 2020 2020  0,90.)..        
+00013730: 2020 2020 6178 5b31 2c20 315d 2e73 6574      ax[1, 1].set
+00013740: 5f74 6974 6c65 2822 5265 6c61 7469 7665  _title("Relative
+00013750: 2070 6f77 6572 2c20 2522 290d 0a20 2020   power, %")..   
+00013760: 2020 2020 2020 2020 2061 785b 312c 2031           ax[1, 1
+00013770: 5d2e 7365 745f 786c 6162 656c 2822 4672  ].set_xlabel("Fr
+00013780: 6571 7565 6e63 792c 2048 7a22 290d 0a20  equency, Hz").. 
+00013790: 2020 2020 2020 2020 2020 2061 785b 312c             ax[1,
+000137a0: 2031 5d2e 6c65 6765 6e64 2829 0d0a 2020   1].legend()..  
+000137b0: 2020 2020 2020 2020 2020 706c 742e 7368            plt.sh
+000137c0: 6f77 2829 0d0a 2020 2020 2020 2020 2020  ow()..          
+000137d0: 2020 7265 7475 726e 0d0a 0d0a 0d0a 0d0a    return........
+000137e0: 2020 2020 6465 6620 5f73 6f72 7469 6e67      def _sorting
+000137f0: 2873 656c 662c 2070 6174 7465 726e 735f  (self, patterns_
+00013800: 7374 7275 6374 2c20 736f 7274 696e 673d  struct, sorting=
+00013810: 2763 6f6d 7077 6973 655f 6c6f 7373 272c  'compwise_loss',
+00013820: 206e 5f63 6f6d 703d 3129 3a0d 0a20 2020   n_comp=1):..   
+00013830: 2020 2020 2022 2222 5370 6563 6966 7920       """Specify 
+00013840: 7768 6963 6820 636f 6d70 6f6e 656e 7473  which components
+00013850: 2074 6f20 706c 6f74 2e0d 0a0d 0a20 2020   to plot.....   
+00013860: 2020 2020 2050 6172 616d 6574 6572 730d       Parameters.
+00013870: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00013880: 2d2d 2d0d 0a20 2020 2020 2020 2073 6f72  ---..        sor
+00013890: 7469 6e67 203a 2073 7472 0d0a 2020 2020  ting : str..    
+000138a0: 2020 2020 2020 2020 536f 7274 696e 6720          Sorting 
+000138b0: 6865 7572 6973 7469 6373 2e0d 0a0d 0a20  heuristics..... 
+000138c0: 2020 2020 2020 2020 2020 2027 7765 6967             'weig
+000138d0: 6874 5f6e 6f72 6d27 202d 2070 6c6f 7473  ht_norm' - plots
+000138e0: 2061 6c6c 2063 6f6d 706f 6e65 6e74 7320   all components 
+000138f0: 736f 7274 6564 2062 7920 6c32 206e 6f72  sorted by l2 nor
+00013900: 6d20 6f66 2061 6374 6976 6174 696f 6e73  m of activations
+00013910: 2069 6e20 7468 650d 0a20 2020 2020 2020   in the..       
+00013920: 2020 2020 206f 7574 7075 7420 6c61 7965       output laye
+00013930: 7220 696e 2064 6573 6365 6e64 696e 6720  r in descending 
+00013940: 6f72 6465 722e 0d0a 0d0a 2020 2020 2020  order.....      
+00013950: 2020 2020 2020 2763 6f6d 6d70 7769 7365        'commpwise
+00013960: 5f6c 6f73 7327 202d 2063 6f6d 7075 7465  _loss' - compute
+00013970: 2074 6865 2065 6666 6563 7420 6f66 2065   the effect of e
+00013980: 6c69 6d69 6e61 7469 6e67 2074 6865 206c  liminating the l
+00013990: 6174 656e 740d 0a20 2020 2020 2020 2020  atent..         
+000139a0: 2020 2063 6f6d 706f 6e65 6e74 206f 6e20     component on 
+000139b0: 7468 6520 7661 6c69 6461 7469 6f6e 206c  the validation l
+000139c0: 6f73 732e 2050 6572 6f66 726d 6564 2066  oss. Perofrmed f
+000139d0: 6f72 2065 6163 6820 636c 6173 730d 0a20  or each class.. 
+000139e0: 2020 2020 2020 2020 2020 2073 6570 6172             separ
+000139f0: 6174 656c 792e 0d0a 0d0a 2020 2020 2020  ately.....      
+00013a00: 2020 2020 2020 2777 6569 6768 7427 202d        'weight' -
+00013a10: 2070 6c6f 7473 2061 2073 696e 676c 6520   plots a single 
+00013a20: 636f 6d70 6f6e 656e 7420 7468 6174 2068  component that h
+00013a30: 6173 2061 206d 6178 696d 756d 0d0a 2020  as a maximum..  
+00013a40: 2020 2020 2020 2020 2020 7765 6967 6874            weight
+00013a50: 2066 6f72 2065 6163 6820 636c 6173 7320   for each class 
+00013a60: 696e 2074 6865 206f 7574 7075 7420 6c61  in the output la
+00013a70: 7965 722e 0d0a 0d0a 2020 2020 2020 2020  yer.....        
+00013a80: 2020 2020 276f 7574 7075 745f 636f 7272      'output_corr
+00013a90: 2720 2d20 706c 6f74 7320 6120 7369 6e67  ' - plots a sing
+00013aa0: 6c65 2063 6f6d 706f 6e65 6e74 2c20 7768  le component, wh
+00013ab0: 6963 6820 7072 6f64 7563 6573 2061 0d0a  ich produces a..
+00013ac0: 2020 2020 2020 2020 2020 2020 6665 6174              feat
+00013ad0: 7572 6520 696e 2074 6865 206f 7574 7075  ure in the outpu
+00013ae0: 7420 6c61 7965 7220 7468 6174 2068 6173  t layer that has
+00013af0: 206d 6178 696d 756d 2063 6f72 7265 6c61   maximum correla
+00013b00: 7469 6f6e 0d0a 2020 2020 2020 2020 2020  tion..          
+00013b10: 2020 7769 7468 2065 6163 6820 7461 7267    with each targ
+00013b20: 6574 2076 6172 6961 626c 652e 0d0a 0d0a  et variable.....
+00013b30: 2020 2020 2020 2020 2020 2020 2777 6569              'wei
+00013b40: 6768 745f 636f 7272 2720 2d20 706c 6f74  ght_corr' - plot
+00013b50: 7320 6120 7369 6e67 6c65 2063 6f6d 706f  s a single compo
+00013b60: 6e65 6e74 2c20 6861 7320 6d61 7869 6d75  nent, has maximu
+00013b70: 6d20 7265 6c65 7661 6e63 650d 0a20 2020  m relevance..   
+00013b80: 2020 2020 2020 2020 2076 616c 7565 2064           value d
+00013b90: 6566 696e 6564 2061 7320 6f75 7470 7574  efined as output
+00013ba0: 5f6c 6179 6572 5f77 6575 6768 742a 636f  _layer_weught*co
+00013bb0: 7272 656c 6174 696f 6e2e 0d0a 0d0a 2020  rrelation.....  
+00013bc0: 2020 2020 2020 5265 7475 726e 733a 0d0a        Returns:..
+00013bd0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00013be0: 0d0a 2020 2020 2020 2020 6f72 6465 7220  ..        order 
+00013bf0: 3a20 6c69 7374 206f 6620 696e 740d 0a20  : list of int.. 
+00013c00: 2020 2020 2020 2020 2020 2069 6e64 6963             indic
+00013c10: 6573 206f 6620 7265 6c65 7661 6e74 2063  es of relevant c
+00013c20: 6f6d 706f 6e65 6e74 730d 0a0d 0a20 2020  omponents....   
+00013c30: 2020 2020 2074 7320 3a20 6c69 7374 206f       ts : list o
+00013c40: 6620 696e 7474 6f70 6f2c 2066 7265 715f  f inttopo, freq_
+00013c50: 7265 7370 6f6e 7365 2c20 7073 640d 0a20  response, psd.. 
+00013c60: 2020 2020 2020 2020 2020 2069 6e64 6963             indic
+00013c70: 6573 206f 6620 7265 6c65 7661 6e74 2074  es of relevant t
+00013c80: 696d 6570 6f69 6e74 730d 0a20 2020 2020  imepoints..     
+00013c90: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
+00013ca0: 6f72 6465 7220 3d20 5b5d 0d0a 2020 2020  order = []..    
+00013cb0: 2020 2020 7473 203d 205b 5d0d 0a20 2020      ts = []..   
+00013cc0: 2020 2020 206f 7574 5f77 6569 6768 7473       out_weights
+00013cd0: 203d 2070 6174 7465 726e 735f 7374 7275   = patterns_stru
+00013ce0: 6374 5b27 7765 6967 6874 7327 5d5b 276f  ct['weights']['o
+00013cf0: 7574 5f77 6569 6768 7473 275d 0d0a 2020  ut_weights']..  
+00013d00: 2020 2020 2020 6966 2073 6f72 7469 6e67        if sorting
+00013d10: 203d 3d20 2777 6569 6768 745f 6e6f 726d   == 'weight_norm
+00013d20: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
+00013d30: 666f 7220 6920 696e 2072 616e 6765 2873  for i in range(s
+00013d40: 656c 662e 6f75 745f 6469 6d29 3a0d 0a0d  elf.out_dim):...
+00013d50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013d60: 2073 656c 662e 4620 3d20 6f75 745f 7765   self.F = out_we
+00013d70: 6967 6874 735b 2e2e 2e2c 2069 5d2e 540d  ights[..., i].T.
+00013d80: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+00013d90: 2020 206e 6f72 6d73 203d 206e 702e 6c69     norms = np.li
+00013da0: 6e61 6c67 2e6e 6f72 6d28 7365 6c66 2e46  nalg.norm(self.F
+00013db0: 2c20 6178 6973 3d31 2c20 6f72 643d 3229  , axis=1, ord=2)
+00013dc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013dd0: 2020 7061 7420 3d20 6e70 2e61 7267 736f    pat = np.argso
+00013de0: 7274 286e 6f72 6d73 295b 2d6e 5f63 6f6d  rt(norms)[-n_com
+00013df0: 703a 5d0d 0a20 2020 2020 2020 2020 2020  p:]..           
+00013e00: 2020 2020 206f 7264 6572 2e61 7070 656e       order.appen
+00013e10: 6428 7061 7429 0d0a 2020 2020 2020 2020  d(pat)..        
+00013e20: 2020 2020 2020 2020 7473 2e61 7070 656e          ts.appen
+00013e30: 6428 6e70 2e61 7261 6e67 6528 7365 6c66  d(np.arange(self
+00013e40: 2e46 2e73 6861 7065 5b2d 315d 2929 0d0a  .F.shape[-1]))..
+00013e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e60: 2374 732e 6170 7065 6e64 284e 6f6e 6529  #ts.append(None)
+00013e70: 0d0a 0d0a 2020 2020 2020 2020 656c 6966  ....        elif
+00013e80: 2073 6f72 7469 6e67 203d 3d20 2763 6f6d   sorting == 'com
+00013e90: 7077 6973 655f 6c6f 7373 273a 0d0a 2020  pwise_loss':..  
+00013ea0: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
+00013eb0: 696e 2072 616e 6765 2873 656c 662e 6f75  in range(self.ou
+00013ec0: 745f 6469 6d29 3a0d 0a0d 0a20 2020 2020  t_dim):....     
+00013ed0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00013ee0: 4620 3d20 6f75 745f 7765 6967 6874 735b  F = out_weights[
+00013ef0: 2e2e 2e2c 2069 5d2e 540d 0a20 2020 2020  ..., i].T..     
+00013f00: 2020 2020 2020 2020 2020 2070 6174 203d             pat =
+00013f10: 206e 702e 6172 676d 696e 2870 6174 7465   np.argmin(patte
+00013f20: 726e 735f 7374 7275 6374 5b27 636f 6d70  rns_struct['comp
+00013f30: 7769 7365 5f6c 6f73 7327 5d5b 3a2c 203a  wise_loss'][:, :
+00013f40: 2c20 695d 2e73 756d 2830 2929 0d0a 2020  , i].sum(0))..  
+00013f50: 2020 2020 2020 2020 2020 2020 2020 2374                #t
+00013f60: 616b 6520 6e20 736d 616c 6c65 7374 2028  ake n smallest (
+00013f70: 6c61 7267 6573 7420 696e 6372 6561 7365  largest increase
+00013f80: 2069 6e20 636f 7374 2066 756e 6374 696f   in cost functio
+00013f90: 6e29 0d0a 2020 2020 2020 2020 2020 2020  n)..            
+00013fa0: 2020 2020 6f72 6465 722e 6170 7065 6e64      order.append
+00013fb0: 285b 7061 745d 290d 0a20 2020 2020 2020  ([pat])..       
+00013fc0: 2020 2020 2020 2020 2074 732e 6170 7065           ts.appe
+00013fd0: 6e64 286e 702e 6172 616e 6765 2873 656c  nd(np.arange(sel
+00013fe0: 662e 462e 7368 6170 655b 2d31 5d29 290d  f.F.shape[-1])).
+00013ff0: 0a0d 0a20 2020 2020 2020 2065 6c69 6620  ...        elif 
+00014000: 736f 7274 696e 6720 3d3d 2027 6162 735f  sorting == 'abs_
+00014010: 7765 6967 6874 273a 0d0a 2020 2020 2020  weight':..      
+00014020: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+00014030: 616e 6765 2873 656c 662e 6f75 745f 6469  ange(self.out_di
+00014040: 6d29 3a0d 0a0d 0a20 2020 2020 2020 2020  m):....         
+00014050: 2020 2020 2020 2073 656c 662e 4620 3d20         self.F = 
+00014060: 6e70 2e61 6273 286f 7574 5f77 6569 6768  np.abs(out_weigh
+00014070: 7473 5b2e 2e2e 2c20 695d 2e54 290d 0a20  ts[..., i].T).. 
+00014080: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00014090: 6174 2c20 7420 3d20 6e70 2e77 6865 7265  at, t = np.where
+000140a0: 2873 656c 662e 4620 3d3d 206e 702e 6d61  (self.F == np.ma
+000140b0: 7828 7365 6c66 2e46 2929 0d0a 2020 2020  x(self.F))..    
+000140c0: 2020 2020 2020 2020 2020 2020 2370 7269              #pri
+000140d0: 6e74 2827 4d61 7869 6d75 6d20 7370 6561  nt('Maximum spea
+000140e0: 726d 616e 2072 3a27 2c20 6e70 2e6d 6178  rman r:', np.max
+000140f0: 2873 656c 662e 636f 7272 5f74 6f5f 6f75  (self.corr_to_ou
+00014100: 7470 7574 5b2e 2e2e 2c20 695d 2e54 2929  tput[..., i].T))
+00014110: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00014120: 2020 6f72 6465 722e 6170 7065 6e64 2870    order.append(p
+00014130: 6174 290d 0a20 2020 2020 2020 2020 2020  at)..           
+00014140: 2020 2020 2074 732e 6170 7065 6e64 2874       ts.append(t
+00014150: 290d 0a0d 0a20 2020 2020 2020 2065 6c69  )....        eli
+00014160: 6620 736f 7274 696e 6720 3d3d 2027 7765  f sorting == 'we
+00014170: 6967 6874 273a 0d0a 2020 2020 2020 2020  ight':..        
+00014180: 2020 2020 6e5f 636f 6d70 203d 2031 0d0a      n_comp = 1..
+00014190: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000141a0: 6920 696e 2072 616e 6765 2873 656c 662e  i in range(self.
+000141b0: 6f75 745f 6469 6d29 3a0d 0a20 2020 2020  out_dim):..     
+000141c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000141d0: 4620 3d20 6f75 745f 7765 6967 6874 735b  F = out_weights[
+000141e0: 2e2e 2e2c 2069 5d2e 540d 0a20 2020 2020  ..., i].T..     
+000141f0: 2020 2020 2020 2020 2020 2070 6174 2c20             pat, 
+00014200: 7420 3d20 6e70 2e77 6865 7265 2873 656c  t = np.where(sel
+00014210: 662e 4620 3d3d 206e 702e 6d61 7828 7365  f.F == np.max(se
+00014220: 6c66 2e46 2929 0d0a 2020 2020 2020 2020  lf.F))..        
+00014230: 2020 2020 2020 2020 2370 7269 6e74 2827          #print('
+00014240: 4d61 7869 6d75 6d20 7765 6967 6874 3a27  Maximum weight:'
+00014250: 2c20 6e70 2e6d 6178 2873 656c 662e 4629  , np.max(self.F)
+00014260: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00014270: 2020 206f 7264 6572 2e61 7070 656e 6428     order.append(
+00014280: 7061 7429 0d0a 2020 2020 2020 2020 2020  pat)..          
+00014290: 2020 2020 2020 7473 2e61 7070 656e 6428        ts.append(
+000142a0: 7429 0d0a 0d0a 2020 2020 2020 2020 656c  t)....        el
+000142b0: 6966 2073 6f72 7469 6e67 203d 3d20 276f  if sorting == 'o
+000142c0: 7574 7075 745f 636f 7272 273a 0d0a 0d0a  utput_corr':....
+000142d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000142e0: 2e46 203d 2070 6174 7465 726e 735f 7374  .F = patterns_st
+000142f0: 7275 6374 5b27 636f 7272 5f74 6f5f 6f75  ruct['corr_to_ou
+00014300: 7470 7574 275d 232e 6d65 616e 2830 290d  tput']#.mean(0).
+00014310: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00014320: 2069 2069 6e20 7261 6e67 6528 7365 6c66   i in range(self
+00014330: 2e6f 7574 5f64 696d 293a 0d0a 0d0a 2020  .out_dim):....  
+00014340: 2020 2020 2020 2020 2020 2020 2020 2370                #p
+00014350: 7269 6e74 2827 4d61 7869 6d75 6d20 725f  rint('Maximum r_
+00014360: 7370 6561 723a 272c 206e 702e 6d61 7828  spear:', np.max(
+00014370: 7365 6c66 2e46 5b2e 2e2e 2c20 695d 2929  self.F[..., i]))
+00014380: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00014390: 2020 7061 7420 3d20 6e70 2e77 6865 7265    pat = np.where
+000143a0: 2873 656c 662e 465b 2e2e 2e2c 2069 5d20  (self.F[..., i] 
+000143b0: 3d3d 206e 702e 6d61 7828 7365 6c66 2e46  == np.max(self.F
+000143c0: 5b2e 2e2e 2c20 695d 2929 5b31 5d0d 0a20  [..., i]))[1].. 
+000143d0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+000143e0: 7264 6572 2e61 7070 656e 6428 7061 7429  rder.append(pat)
+000143f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00014400: 2020 7473 2e61 7070 656e 6428 6e70 2e61    ts.append(np.a
+00014410: 7261 6e67 6528 7365 6c66 2e46 2e73 6861  range(self.F.sha
+00014420: 7065 5b2d 315d 2929 0d0a 2020 2020 2020  pe[-1]))..      
+00014430: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00014440: 2020 2020 2070 7269 6e74 2822 536f 7274       print("Sort
+00014450: 696e 6720 7b3a 737d 206e 6f74 2069 6d70  ing {:s} not imp
+00014460: 6c65 6d65 6e74 6564 222e 666f 726d 6174  lemented".format
+00014470: 2873 6f72 7469 6e67 2929 0d0a 2020 2020  (sorting))..    
+00014480: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+00014490: 6f6e 652c 204e 6f6e 650d 0a0d 0a20 2020  one, None....   
+000144a0: 2020 2020 206f 7264 6572 203d 206e 702e       order = np.
+000144b0: 6172 7261 7928 6f72 6465 7229 0d0a 2020  array(order)..  
+000144c0: 2020 2020 2020 7473 203d 206e 702e 6172        ts = np.ar
+000144d0: 7261 7928 7473 290d 0a20 2020 2020 2020  ray(ts)..       
+000144e0: 2072 6574 7572 6e20 6f72 6465 722c 2074   return order, t
+000144f0: 730d 0a0d 0a0d 0a20 2020 2064 6566 2073  s......    def s
+00014500: 696e 676c 655f 636f 6d70 6f6e 656e 745f  ingle_component_
+00014510: 7061 7474 6572 6e28 7365 6c66 2c20 7061  pattern(self, pa
+00014520: 7474 6572 6e73 5f73 7472 7563 742c 2073  tterns_struct, s
+00014530: 6f72 7469 6e67 3d27 636f 6d70 7769 7365  orting='compwise
+00014540: 5f6c 6f73 7327 2c0d 0a20 2020 2020 2020  _loss',..       
+00014550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014560: 2020 2020 2020 2020 2020 6e5f 636f 6d70            n_comp
+00014570: 3d31 293a 0d0a 2020 2020 2020 2020 2222  =1):..        ""
+00014580: 2250 6963 6b20 7369 6e67 6c65 2063 6f6d  "Pick single com
+00014590: 706f 6e65 6e74 2061 6363 6f72 6469 6e67  ponent according
+000145a0: 2074 6f20 736f 7274 696e 6720 6d65 7468   to sorting meth
+000145b0: 6f64 2e0d 0a20 2020 2020 2020 204d 756c  od...        Mul
+000145c0: 7469 706c 7920 7370 6174 6961 6c20 6669  tiply spatial fi
+000145d0: 6c74 6572 2062 7920 6461 7461 2063 6f76  lter by data cov
+000145e0: 6172 6961 6e63 6522 2222 0d0a 2020 2020  ariance"""..    
+000145f0: 2020 2020 6f72 6465 722c 2074 7320 3d20      order, ts = 
+00014600: 7365 6c66 2e5f 736f 7274 696e 6728 2070  self._sorting( p
+00014610: 6174 7465 726e 735f 7374 7275 6374 2c20  atterns_struct, 
+00014620: 736f 7274 696e 672c 206e 5f63 6f6d 703d  sorting, n_comp=
+00014630: 6e5f 636f 6d70 290d 0a20 2020 2020 2020  n_comp)..       
+00014640: 2063 5f74 6f70 6f73 203d 205b 5d0d 0a20   c_topos = [].. 
+00014650: 2020 2020 2020 2063 5f70 7364 7320 3d20         c_psds = 
+00014660: 5b5d 0d0a 2020 2020 2020 2020 635f 6672  []..        c_fr
+00014670: 7320 3d20 5b5d 0d0a 2020 2020 2020 2020  s = []..        
+00014680: 2370 7269 6e74 2873 6f72 7469 6e67 2c20  #print(sorting, 
+00014690: 6f72 6465 7229 0d0a 2020 2020 2020 2020  order)..        
+000146a0: 7720 3d20 7061 7474 6572 6e73 5f73 7472  w = patterns_str
+000146b0: 7563 745b 2777 6569 6768 7473 275d 5b27  uct['weights']['
+000146c0: 646d 7827 5d0d 0a20 2020 2020 2020 2023  dmx']..        #
+000146d0: 6120 3d20 6e70 2e64 6f74 2870 6174 7465  a = np.dot(patte
+000146e0: 726e 735f 7374 7275 6374 5b27 6463 6f76  rns_struct['dcov
+000146f0: 275d 5b27 696e 7075 745f 7370 6174 6961  ']['input_spatia
+00014700: 6c27 5d2c 2077 290d 0a20 2020 2020 2020  l'], w)..       
+00014710: 2070 7269 6e74 2873 6f72 7469 6e67 2c20   print(sorting, 
+00014720: 273a 2063 6f6d 706f 6e65 6e74 2023 7b7d  ': component #{}
+00014730: 272c 206f 7264 6572 5b30 5d5b 305d 290d  ', order[0][0]).
+00014740: 0a20 2020 2020 2020 2066 6f72 2069 2c20  .        for i, 
+00014750: 636f 6d70 7320 696e 2065 6e75 6d65 7261  comps in enumera
+00014760: 7465 286f 7264 6572 293a 0d0a 2020 2020  te(order):..    
+00014770: 2020 2020 2020 2020 6120 3d20 6e70 2e64          a = np.d
+00014780: 6f74 2870 6174 7465 726e 735f 7374 7275  ot(patterns_stru
+00014790: 6374 5b27 6463 6f76 275d 5b27 696e 7075  ct['dcov']['inpu
+000147a0: 745f 7370 6174 6961 6c27 5d2c 2077 290d  t_spatial'], w).
+000147b0: 0a20 2020 2020 2020 2020 2020 2023 6120  .            #a 
+000147c0: 3d20 6e70 2e64 6f74 2870 6174 7465 726e  = np.dot(pattern
+000147d0: 735f 7374 7275 6374 5b27 6463 6f76 275d  s_struct['dcov']
+000147e0: 5b27 636c 6173 735f 636f 6e64 6974 696f  ['class_conditio
+000147f0: 6e61 6c27 5d5b 695d 2c20 7729 0d0a 0d0a  nal'][i], w)....
+00014800: 2020 2020 2020 2020 2020 2020 635f 746f              c_to
+00014810: 706f 732e 6170 7065 6e64 2861 5b3a 2c20  pos.append(a[:, 
+00014820: 636f 6d70 735d 290d 0a20 2020 2020 2020  comps])..       
+00014830: 2020 2020 2063 5f70 7364 732e 6170 7065       c_psds.appe
+00014840: 6e64 2870 6174 7465 726e 735f 7374 7275  nd(patterns_stru
+00014850: 6374 5b27 7370 6563 7472 6127 5d5b 2770  ct['spectra']['p
+00014860: 7364 7327 5d5b 636f 6d70 732c 203a 5d2e  sds'][comps, :].
+00014870: 542c 290d 0a20 2020 2020 2020 2020 2020  T,)..           
+00014880: 2063 5f66 7273 2e61 7070 656e 6428 7061   c_frs.append(pa
+00014890: 7474 6572 6e73 5f73 7472 7563 745b 2773  tterns_struct['s
+000148a0: 7065 6374 7261 275d 5b27 6672 6571 5f72  pectra']['freq_r
+000148b0: 6573 706f 6e73 6573 275d 5b63 6f6d 7073  esponses'][comps
+000148c0: 2c20 3a5d 2e54 290d 0a20 2020 2020 2020  , :].T)..       
+000148d0: 2074 6f70 6f20 3d20 6e70 2e63 6f6e 6361   topo = np.conca
+000148e0: 7465 6e61 7465 2863 5f74 6f70 6f73 2c20  tenate(c_topos, 
+000148f0: 6178 6973 3d2d 3129 0d0a 2020 2020 2020  axis=-1)..      
+00014900: 2020 6672 6571 5f72 6573 706f 6e73 6520    freq_response 
+00014910: 3d20 6e70 2e63 6f6e 6361 7465 6e61 7465  = np.concatenate
+00014920: 2863 5f66 7273 2c20 6178 6973 3d2d 3129  (c_frs, axis=-1)
+00014930: 0d0a 2020 2020 2020 2020 7073 6420 3d20  ..        psd = 
+00014940: 6e70 2e63 6f6e 6361 7465 6e61 7465 2863  np.concatenate(c
+00014950: 5f70 7364 732c 2061 7869 733d 2d31 290d  _psds, axis=-1).
+00014960: 0a20 2020 2020 2020 2023 6672 6571 7320  .        #freqs 
+00014970: 3d20 7061 7474 6572 6e73 5f73 7472 7563  = patterns_struc
+00014980: 745b 2766 7265 7173 275d 0d0a 2020 2020  t['freqs']..    
+00014990: 2020 2020 7265 7475 726e 2074 6f70 6f2c      return topo,
+000149a0: 2066 7265 715f 7265 7370 6f6e 7365 2c20   freq_response, 
+000149b0: 7073 6423 2c20 6672 6571 730d 0a0d 0a20  psd#, freqs.... 
+000149c0: 2020 2064 6566 2070 6c6f 745f 636f 6d62     def plot_comb
+000149d0: 696e 6564 5f70 6174 7465 726e 2873 656c  ined_pattern(sel
+000149e0: 662c 206d 6574 686f 643d 2763 6f6d 6269  f, method='combi
+000149f0: 6e65 6427 2c20 7365 6e73 6f72 5f6c 6179  ned', sensor_lay
+00014a00: 6f75 743d 4e6f 6e65 2c0d 0a20 2020 2020  out=None,..     
+00014a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a20: 2020 2020 2020 2020 206e 616d 6573 3d4e           names=N
+00014a30: 6f6e 652c 206e 5f63 6f6d 703d 312c 2070  one, n_comp=1, p
+00014a40: 6c6f 745f 7472 7565 5f65 766f 6b65 643d  lot_true_evoked=
+00014a50: 4661 6c73 652c 0d0a 2020 2020 2020 2020  False,..        
+00014a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a70: 2020 2020 2020 7361 7665 6669 673d 4e6f        savefig=No
+00014a80: 6e65 293a 0d0a 2020 2020 2020 2020 6966  ne):..        if
+00014a90: 206e 6f74 206e 616d 6573 3a0d 0a20 2020   not names:..   
+00014aa0: 2020 2020 2020 2020 206e 616d 6573 203d           names =
+00014ab0: 205b 2743 6c61 7373 207b 7d27 2e66 6f72   ['Class {}'.for
+00014ac0: 6d61 7428 6929 2066 6f72 2069 2069 6e20  mat(i) for i in 
+00014ad0: 7261 6e67 6528 7365 6c66 2e79 5f73 6861  range(self.y_sha
+00014ae0: 7065 5b2d 315d 295d 0d0a 0d0a 0d0a 2320  pe[-1])]......# 
+00014af0: 2020 2020 2020 2063 6320 3d20 6e70 2e61         cc = np.a
+00014b00: 7272 6179 285b 6e70 2e63 6f72 7263 6f65  rray([np.corrcoe
+00014b10: 6628 7365 6c66 2e63 765f 7061 7474 6572  f(self.cv_patter
+00014b20: 6e73 5b3a 2c20 692c 203a 5d2e 5429 5b69  ns[:, i, :].T)[i
+00014b30: 2c3a 5d0d 0a23 2020 2020 2020 2020 2020  ,:]..#          
+00014b40: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+00014b50: 6e67 6528 7365 6c66 2e63 765f 7061 7474  nge(self.cv_patt
+00014b60: 6572 6e73 2e73 6861 7065 5b31 5d29 5d29  erns.shape[1])])
+00014b70: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
+00014b80: 2873 656c 662e 6376 5f70 6174 7465 726e  (self.cv_pattern
+00014b90: 732e 6974 656d 7328 2929 203e 2030 3a0d  s.items()) > 0:.
+00014ba0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00014bb0: 6e74 2822 5265 7374 6f72 696e 6720 6672  nt("Restoring fr
+00014bc0: 6f6d 3a22 2c20 6d65 7468 6f64 2029 0d0a  om:", method )..
+00014bd0: 2020 2020 2020 2020 2020 2020 746f 706f              topo
+00014be0: 7320 3d20 6e70 2e6d 6561 6e28 7365 6c66  s = np.mean(self
+00014bf0: 2e63 765f 7061 7474 6572 6e73 5b6d 6574  .cv_patterns[met
+00014c00: 686f 645d 5b27 7370 6174 6961 6c27 5d2c  hod]['spatial'],
+00014c10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00014c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c30: 2020 2020 2020 202d 3129 0d0a 2020 2020         -1)..    
+00014c40: 2020 2020 2020 2020 6669 6c74 6572 7320          filters 
+00014c50: 3d20 6e70 2e6d 6561 6e28 7365 6c66 2e63  = np.mean(self.c
+00014c60: 765f 7061 7474 6572 6e73 5b6d 6574 686f  v_patterns[metho
+00014c70: 645d 5b27 7465 6d70 6f72 616c 275d 2c0d  d]['temporal'],.
+00014c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ca0: 2020 2020 2020 2020 2d31 290d 0a20 2020          -1)..   
+00014cb0: 2020 2020 2020 2020 2070 7364 7320 3d20           psds = 
+00014cc0: 6e70 2e6d 6561 6e28 7365 6c66 2e63 765f  np.mean(self.cv_
+00014cd0: 7061 7474 6572 6e73 5b6d 6574 686f 645d  patterns[method]
+00014ce0: 5b27 7073 6473 275d 2c0d 0a20 2020 2020  ['psds'],..     
+00014cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014d00: 2020 2020 2020 2020 2020 2020 2020 202d                 -
+00014d10: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
+00014d20: 2366 7265 7173 203d 2073 656c 662e 6672  #freqs = self.fr
+00014d30: 6571 730d 0a0d 0a20 2020 2020 2020 200d  eqs....        .
+00014d40: 0a20 2020 2020 2020 2065 6c69 6620 6d65  .        elif me
+00014d50: 7468 6f64 2069 6e20 5b27 7765 6967 6874  thod in ['weight
+00014d60: 272c 2027 636f 6d70 7769 7365 5f6c 6f73  ', 'compwise_los
+00014d70: 7327 5d3a 0d0a 2020 2020 2020 2020 2020  s']:..          
+00014d80: 2020 746f 706f 732c 2066 696c 7465 7273    topos, filters
+00014d90: 2c20 7073 6473 203d 2073 656c 662e 7369  , psds = self.si
+00014da0: 6e67 6c65 5f70 6174 7465 726e 2873 6f72  ngle_pattern(sor
+00014db0: 7469 6e67 3d6d 6574 686f 642c 0d0a 2020  ting=method,..  
+00014dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014df0: 2020 2020 206e 5f63 6f6d 703d 6e5f 636f       n_comp=n_co
+00014e00: 6d70 290d 0a0d 0a0d 0a20 2020 2020 2020  mp)......       
+00014e10: 2066 7265 7173 203d 2073 656c 662e 6376   freqs = self.cv
+00014e20: 5f70 6174 7465 726e 735b 2766 7265 7173  _patterns['freqs
+00014e30: 275d 0d0a 0d0a 2020 2020 2020 2020 746f  ']....        to
+00014e40: 706f 7320 2f3d 206e 702e 6d61 7869 6d75  pos /= np.maximu
+00014e50: 6d28 746f 706f 732e 7374 6428 6178 6973  m(topos.std(axis
+00014e60: 3d30 2c20 6b65 6570 6469 6d73 3d54 7275  =0, keepdims=Tru
+00014e70: 6529 2c0d 0a20 2020 2020 2020 2020 2020  e),..           
+00014e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e90: 2020 2020 2020 2020 2020 3165 2d33 290d            1e-3).
+00014ea0: 0a20 2020 2020 2020 206e 203d 2073 656c  .        n = sel
+00014eb0: 662e 795f 7368 6170 655b 305d 0d0a 2020  f.y_shape[0]..  
+00014ec0: 2020 2020 2020 6e63 6f6c 7320 3d20 6e0d        ncols = n.
+00014ed0: 0a20 2020 2020 2020 206c 6f20 3d20 6368  .        lo = ch
+00014ee0: 616e 6e65 6c73 2e72 6561 645f 6c61 796f  annels.read_layo
+00014ef0: 7574 2873 656e 736f 725f 6c61 796f 7574  ut(sensor_layout
+00014f00: 290d 0a20 2020 2020 2020 2023 6c6f 203d  )..        #lo =
+00014f10: 2063 6861 6e6e 656c 732e 6765 6e65 7261   channels.genera
+00014f20: 7465 5f32 645f 6c61 796f 7574 286c 6f2e  te_2d_layout(lo.
+00014f30: 706f 7329 0d0a 2020 2020 2020 2020 696e  pos)..        in
+00014f40: 666f 203d 2063 7265 6174 655f 696e 666f  fo = create_info
+00014f50: 286c 6f2e 6e61 6d65 732c 2031 2e2c 2073  (lo.names, 1., s
+00014f60: 656e 736f 725f 6c61 796f 7574 2e73 706c  ensor_layout.spl
+00014f70: 6974 2827 2d27 295b 2d31 5d29 0d0a 2020  it('-')[-1])..  
+00014f80: 2020 2020 2020 6f72 6967 5f78 7920 3d20        orig_xy = 
+00014f90: 6e70 2e6d 6561 6e28 6c6f 2e70 6f73 5b3a  np.mean(lo.pos[:
+00014fa0: 2c20 3a32 5d2c 2030 290d 0a20 2020 2020  , :2], 0)..     
+00014fb0: 2020 2066 6f72 2069 2c20 6368 2069 6e20     for i, ch in 
+00014fc0: 656e 756d 6572 6174 6528 6c6f 2e6e 616d  enumerate(lo.nam
+00014fd0: 6573 293a 0d0a 2020 2020 2020 2020 2020  es):..          
+00014fe0: 2020 6966 2069 6e66 6f5b 2763 6873 275d    if info['chs']
+00014ff0: 5b69 5d5b 2763 685f 6e61 6d65 275d 203d  [i]['ch_name'] =
+00015000: 3d20 6368 3a0d 0a20 2020 2020 2020 2020  = ch:..         
+00015010: 2020 2020 2020 2069 6e66 6f5b 2763 6873         info['chs
+00015020: 275d 5b69 5d5b 276c 6f63 275d 5b3a 325d  '][i]['loc'][:2]
+00015030: 203d 2028 6c6f 2e70 6f73 5b69 2c20 3a32   = (lo.pos[i, :2
+00015040: 5d20 2d20 6f72 6967 5f78 7929 2f34 2e35  ] - orig_xy)/4.5
+00015050: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00015060: 2020 2369 6e66 6f5b 2763 6873 275d 5b69    #info['chs'][i
+00015070: 5d5b 276c 6f63 275d 5b34 3a5d 203d 2030  ]['loc'][4:] = 0
+00015080: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00015090: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+000150a0: 2020 2020 2070 7269 6e74 2822 4368 616e       print("Chan
+000150b0: 6e65 6c20 6e61 6d65 206d 6973 6d61 7463  nel name mismatc
+000150c0: 682e 2069 6e66 6f3a 207b 7d20 7673 206c  h. info: {} vs l
+000150d0: 6f3a 207b 7d22 2e66 6f72 6d61 7428 0d0a  o: {}".format(..
+000150e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000150f0: 2020 2020 696e 666f 5b27 6368 7327 5d5b      info['chs'][
+00015100: 695d 5b27 6368 5f6e 616d 6527 5d2c 2063  i]['ch_name'], c
+00015110: 6829 290d 0a0d 0a20 2020 2020 2020 2073  h))....        s
+00015120: 656c 662e 6661 6b65 5f65 766f 6b65 6420  elf.fake_evoked 
+00015130: 3d20 6576 6f6b 6564 2e45 766f 6b65 6441  = evoked.EvokedA
+00015140: 7272 6179 2874 6f70 6f73 2c20 696e 666f  rray(topos, info
+00015150: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00015160: 6661 6b65 5f65 766f 6b65 642e 6461 7461  fake_evoked.data
+00015170: 5b3a 2c20 3a6e 5d20 3d20 746f 706f 730d  [:, :n] = topos.
+00015180: 0a0d 0a20 2020 2020 2020 2066 616b 655f  ...        fake_
+00015190: 7469 6d65 7320 3d20 6e70 2e61 7261 6e67  times = np.arang
+000151a0: 6528 302c 2020 6e2c 2031 2e29 0d0a 2020  e(0,  n, 1.)..  
+000151b0: 2020 2020 2020 6674 203d 2073 656c 662e        ft = self.
+000151c0: 6661 6b65 5f65 766f 6b65 642e 706c 6f74  fake_evoked.plot
+000151d0: 5f74 6f70 6f6d 6170 2874 696d 6573 3d66  _topomap(times=f
+000151e0: 616b 655f 7469 6d65 732c 0d0a 2020 2020  ake_times,..    
 000151f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015200: 2020 2020 2020 2373 697a 653d 312c 0d0a        #size=1,..
-00015210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015230: 2020 2020 2020 2020 2020 6f75 746c 696e            outlin
-00015240: 6573 3d27 6865 6164 272c 0d0a 2020 2020  es='head',..    
-00015250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015270: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-00015280: 2023 6d65 7468 6f64 203d 2022 7061 7465   #method = "pate
-00015290: 726e 6e65 745f 7265 6374 5f63 635f 636f  rnnet_rect_cc_co
-000152a0: 7664 6966 5f63 635f 6663 6163 7464 6966  vdif_cc_fcactdif
-000152b0: 220d 0a20 2020 2020 2020 2023 6674 2e73  "..        #ft.s
-000152c0: 6574 5f73 697a 655f 696e 6368 6573 285b  et_size_inches([
-000152d0: 3135 2c33 2e35 5d29 0d0a 2020 2020 2020  15,3.5])..      
-000152e0: 2020 6966 2073 6176 6566 6967 3a0d 0a20    if savefig:.. 
-000152f0: 2020 2020 2020 2020 2020 2066 6967 6e61             figna
-00015300: 6d65 203d 2027 2d27 2e6a 6f69 6e28 5b73  me = '-'.join([s
-00015310: 656c 662e 6d65 7461 2e64 6174 615b 2770  elf.meta.data['p
-00015320: 6174 6827 5d20 2b20 6d65 7468 6f64 2c20  ath'] + method, 
-00015330: 2274 6f70 6f73 2e73 7667 225d 290d 0a20  "topos.svg"]).. 
-00015340: 2020 2020 2020 2020 2020 2066 742e 7361             ft.sa
-00015350: 7665 6669 6728 6669 676e 616d 652c 2066  vefig(figname, f
-00015360: 6f72 6d61 743d 2773 7667 272c 2074 7261  ormat='svg', tra
-00015370: 6e73 7061 7265 6e74 3d54 7275 6529 0d0a  nsparent=True)..
-00015380: 2020 2020 2020 2020 6966 2070 6c6f 745f          if plot_
-00015390: 7472 7565 5f65 766f 6b65 643a 0d0a 2020  true_evoked:..  
-000153a0: 2020 2020 2020 2020 2020 2374 7275 655f            #true_
-000153b0: 7469 6d65 7320 3d20 6e70 2e61 7267 6d61  times = np.argma
-000153c0: 7828 6e70 2e6d 6561 6e28 7365 6c66 2e74  x(np.mean(self.t
-000153d0: 7275 655f 6576 6f6b 6564 5f64 6174 612a  rue_evoked_data*
-000153e0: 2a32 2c20 2d31 292c 3129 0d0a 2020 2020  *2, -1),1)..    
-000153f0: 2020 2020 2020 2020 2365 6420 3d20 6e70          #ed = np
-00015400: 2e73 7461 636b 285b 7365 6c66 2e74 7275  .stack([self.tru
-00015410: 655f 6576 6f6b 6564 5f64 6174 615b 692c  e_evoked_data[i,
-00015420: 2074 742c 203a 5d20 666f 7220 692c 2074   tt, :] for i, t
-00015430: 7420 696e 2065 6e75 6d65 7261 7465 2874  t in enumerate(t
-00015440: 7275 655f 7469 6d65 7329 5d29 0d0a 2020  rue_times)])..  
-00015450: 2020 2020 2020 2020 2020 7420 3d20 7365            t = se
-00015460: 6c66 2e70 6c6f 745f 6576 6f6b 6564 5f70  lf.plot_evoked_p
-00015470: 6561 6b73 284e 6f6e 652c 2073 656e 736f  eaks(None, senso
-00015480: 725f 6c61 796f 7574 3d73 656e 736f 725f  r_layout=sensor_
-00015490: 6c61 796f 7574 2c0d 0a20 2020 2020 2020  layout,..       
-000154a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000154b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000154c0: 7469 746c 653d 2754 7275 6520 6576 6f6b  title='True evok
-000154d0: 6564 2729 0d0a 2020 2020 2020 2020 2020  ed')..          
-000154e0: 2020 6669 676e 616d 6520 3d20 272d 272e    figname = '-'.
-000154f0: 6a6f 696e 285b 7365 6c66 2e6d 6574 612e  join([self.meta.
-00015500: 6461 7461 5b27 7061 7468 275d 202b 2073  data['path'] + s
-00015510: 656c 662e 7363 6f70 652c 2073 656c 662e  elf.scope, self.
-00015520: 6d65 7461 2e64 6174 615b 2764 6174 615f  meta.data['data_
-00015530: 6964 275d 2c20 2774 7275 6527 2c20 2274  id'], 'true', "t
-00015540: 6f70 6f73 2e73 7667 225d 290d 0a20 2020  opos.svg"])..   
-00015550: 2020 2020 2020 2020 2074 2e73 6176 6566           t.savef
-00015560: 6967 2866 6967 6e61 6d65 2c20 666f 726d  ig(figname, form
-00015570: 6174 3d27 7376 6727 2c20 7472 616e 7370  at='svg', transp
-00015580: 6172 656e 743d 5472 7565 290d 0a0d 0a23  arent=True)....#
-00015590: 2020 2020 2020 2020 2069 6620 6e63 6f6c           if ncol
-000155a0: 7320 3d3d 2031 3a0d 0a23 2020 2020 2020  s == 1:..#      
-000155b0: 2020 2020 2020 2070 6c74 2e66 6967 7572         plt.figur
-000155c0: 6528 290d 0a23 2020 2020 2020 2020 2020  e()..#          
-000155d0: 2020 2061 7820 3d20 706c 742e 6763 6128     ax = plt.gca(
-000155e0: 290d 0a23 2020 2020 2020 2020 2020 2020  )..#            
-000155f0: 206e 6f72 6d61 6c69 7a65 645f 696e 7075   normalized_inpu
-00015600: 745f 7270 7320 3d20 7073 6473 2f6e 702e  t_rps = psds/np.
-00015610: 6d61 7869 6d75 6d28 6e70 2e73 756d 2870  maximum(np.sum(p
-00015620: 7364 7329 2c20 3165 2d36 290d 0a23 2020  sds), 1e-6)..#  
-00015630: 2020 2020 2020 2020 2020 206e 6f72 6d61             norma
-00015640: 6c69 7a65 645f 6f75 7470 7574 5f72 7073  lized_output_rps
-00015650: 203d 2066 696c 7465 7273 2a70 7364 730d   = filters*psds.
-00015660: 0a23 2020 2020 2020 2020 2020 2020 206e  .#             n
-00015670: 6f72 6d61 6c69 7a65 645f 6f75 7470 7574  ormalized_output
-00015680: 5f72 7073 202f 3d20 6e70 2e6d 6178 696d  _rps /= np.maxim
-00015690: 756d 286e 702e 7375 6d28 6669 6c74 6572  um(np.sum(filter
-000156a0: 732a 7073 6473 292c 2031 652d 3629 0d0a  s*psds), 1e-6)..
-000156b0: 2320 2020 2020 2020 2020 2020 2020 6178  #             ax
-000156c0: 2e70 6c6f 7428 6672 6571 732c 206e 6f72  .plot(freqs, nor
-000156d0: 6d61 6c69 7a65 645f 696e 7075 745f 7270  malized_input_rp
-000156e0: 732c 206c 6162 656c 3d27 496e 7075 7420  s, label='Input 
-000156f0: 5250 5327 290d 0a23 2020 2020 2020 2020  RPS')..#        
-00015700: 2020 2020 2061 782e 706c 6f74 2866 7265       ax.plot(fre
-00015710: 7173 2c20 6e6f 726d 616c 697a 6564 5f6f  qs, normalized_o
-00015720: 7574 7075 745f 7270 732c 206c 6162 656c  utput_rps, label
-00015730: 3d27 4f75 7470 7574 2052 5053 2729 0d0a  ='Output RPS')..
-00015740: 2320 2320 2020 2020 2020 2020 2020 2061  # #            a
-00015750: 782e 706c 6f74 2866 7265 7173 2c20 6669  x.plot(freqs, fi
-00015760: 6c74 6572 732f 6e70 2e6d 6178 696d 756d  lters/np.maximum
-00015770: 286e 702e 7375 6d28 6669 6c74 6572 7329  (np.sum(filters)
-00015780: 2c20 3165 2d36 292c 0d0a 2320 2320 2020  , 1e-6),..# #   
-00015790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000157a0: 206c 6162 656c 3d27 4672 6571 2072 6573   label='Freq res
-000157b0: 706f 6e73 6527 290d 0a23 2020 2020 2020  ponse')..#      
-000157c0: 2020 2020 2020 2061 782e 6c65 6765 6e64         ax.legend
-000157d0: 2829 0d0a 2320 2020 2020 2020 2020 2020  ()..#           
-000157e0: 2020 6178 2e73 6574 5f78 6c69 6d28 302c    ax.set_xlim(0,
-000157f0: 2039 3029 0d0a 2320 2020 2020 2020 2020   90)..#         
-00015800: 2020 2020 2370 6c74 2e73 686f 7728 290d      #plt.show().
-00015810: 0a23 2020 2020 2020 2020 2065 6c73 653a  .#         else:
-00015820: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-00015830: 662c 2061 7820 3d20 706c 742e 7375 6270  f, ax = plt.subp
-00015840: 6c6f 7473 2831 2c20 6e63 6f6c 732c 2073  lots(1, ncols, s
-00015850: 6861 7265 793d 5472 7565 2c20 636f 6e73  harey=True, cons
-00015860: 7472 6169 6e65 645f 6c61 796f 7574 3d54  trained_layout=T
-00015870: 7275 6529 0d0a 2320 2020 2020 2020 2020  rue)..#         
-00015880: 2020 2020 2366 2e63 6f6e 7374 7261 696e      #f.constrain
-00015890: 6564 5f6c 6179 6f75 7428 290d 0a23 2020  ed_layout()..#  
-000158a0: 2020 2020 2020 2020 2020 2066 2e73 6574             f.set
-000158b0: 5f73 697a 655f 696e 6368 6573 285b 3134  _size_inches([14
-000158c0: 2c20 332e 5d29 0d0a 2320 2020 2020 2020  , 3.])..#       
-000158d0: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
-000158e0: 616e 6765 286e 636f 6c73 293a 0d0a 2320  ange(ncols):..# 
-000158f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015900: 2361 785b 695d 2e73 656d 696c 6f67 7928  #ax[i].semilogy(
-00015910: 6672 6571 735b 3a2d 315d 2c20 636f 6d62  freqs[:-1], comb
-00015920: 696e 6564 5f66 696c 7465 7273 5b3a 2c69  ined_filters[:,i
-00015930: 5d2c 206c 6162 656c 3d27 496d 7075 6c73  ], label='Impuls
-00015940: 6520 7265 7370 6f6e 7365 2729 0d0a 2320  e response')..# 
-00015950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015960: 6e6f 726d 616c 697a 6564 5f6f 7574 7075  normalized_outpu
-00015970: 745f 7270 7320 3d20 6669 6c74 6572 735b  t_rps = filters[
-00015980: 3a2c 695d 2a70 7364 735b 3a2c 695d 0d0a  :,i]*psds[:,i]..
-00015990: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-000159a0: 2020 6e6f 726d 616c 697a 6564 5f6f 7574    normalized_out
-000159b0: 7075 745f 7270 7320 2f3d 206e 702e 6d61  put_rps /= np.ma
-000159c0: 7869 6d75 6d28 6e70 2e73 756d 2866 696c  ximum(np.sum(fil
-000159d0: 7465 7273 5b3a 2c69 5d2a 7073 6473 5b3a  ters[:,i]*psds[:
-000159e0: 2c69 5d29 2c20 3165 2d36 290d 0a23 2020  ,i]), 1e-6)..#  
-000159f0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00015a00: 6f72 6d61 6c69 7a65 645f 696e 7075 745f  ormalized_input_
-00015a10: 7270 7320 3d20 7073 6473 5b3a 2c69 5d20  rps = psds[:,i] 
-00015a20: 2f20 6e70 2e6d 6178 696d 756d 286e 702e  / np.maximum(np.
-00015a30: 7375 6d28 7073 6473 5b3a 2c69 5d29 2c20  sum(psds[:,i]), 
-00015a40: 3165 2d36 290d 0a0d 0a0d 0a0d 0a23 2020  1e-6)........#  
-00015a50: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00015a60: 785b 695d 2e70 6c6f 7428 6672 6571 732c  x[i].plot(freqs,
-00015a70: 206e 6f72 6d61 6c69 7a65 645f 696e 7075   normalized_inpu
-00015a80: 745f 7270 732c 206c 6162 656c 3d27 4c61  t_rps, label='La
-00015a90: 7965 7220 496e 7075 7427 290d 0a23 2020  yer Input')..#  
-00015aa0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00015ab0: 785b 695d 2e73 6574 5f74 6974 6c65 286e  x[i].set_title(n
-00015ac0: 616d 6573 5b69 5d29 0d0a 2320 2020 2020  ames[i])..#     
-00015ad0: 2020 2020 2020 2020 2020 2020 6178 5b69              ax[i
-00015ae0: 5d2e 706c 6f74 2866 7265 7173 2c20 6e6f  ].plot(freqs, no
-00015af0: 726d 616c 697a 6564 5f6f 7574 7075 745f  rmalized_output_
-00015b00: 7270 732c 206c 6162 656c 3d27 4578 7472  rps, label='Extr
-00015b10: 6163 7465 6420 436f 6d70 6f6e 656e 7427  acted Component'
-00015b20: 290d 0a23 2023 2020 2020 2020 2020 2020  )..# #          
-00015b30: 2020 2020 2020 6178 5b69 5d2e 706c 6f74        ax[i].plot
-00015b40: 2866 7265 7173 2c20 6669 6c74 6572 735b  (freqs, filters[
-00015b50: 3a2c 2069 5d2f 6e70 2e6d 6178 696d 756d  :, i]/np.maximum
-00015b60: 286e 702e 7375 6d28 6669 6c74 6572 735b  (np.sum(filters[
-00015b70: 3a2c 2069 5d29 2c20 3165 2d36 292c 0d0a  :, i]), 1e-6),..
-00015b80: 2320 2320 2020 2020 2020 2020 2020 2020  # #             
-00015b90: 2020 2020 2020 206c 6162 656c 3d27 4672         label='Fr
-00015ba0: 6571 2072 6573 706f 6e73 6527 290d 0a23  eq response')..#
-00015bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015bc0: 2023 6178 5b69 5d2e 706c 6f74 2866 7265   #ax[i].plot(fre
-00015bd0: 7173 5b3a 2d31 5d2c 2063 6f6d 6269 6e65  qs[:-1], combine
-00015be0: 645f 6669 6c74 6572 735b 3a2c 695d 2c20  d_filters[:,i], 
-00015bf0: 6c61 6265 6c3d 274f 7574 7075 7420 5250  label='Output RP
-00015c00: 5327 290d 0a23 2020 2020 2020 2020 2020  S')..#          
-00015c10: 2020 2020 2020 2023 6178 5b69 5d2e 706c         #ax[i].pl
-00015c20: 6f74 2866 7265 7173 5b3a 2d31 5d2c 2063  ot(freqs[:-1], c
-00015c30: 6f6d 6269 6e65 645f 7073 6473 5b3a 2c69  ombined_psds[:,i
-00015c40: 5d2c 206c 6162 656c 3d27 496e 7075 7420  ], label='Input 
-00015c50: 5250 5327 290d 0a23 2020 2020 2020 2020  RPS')..#        
-00015c60: 2020 2020 2020 2020 2061 785b 695d 2e73           ax[i].s
-00015c70: 6574 5f78 6c69 6d28 302c 2037 3029 0d0a  et_xlim(0, 70)..
-00015c80: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-00015c90: 2020 2020 6178 5b69 5d2e 7365 745f 7874      ax[i].set_xt
-00015ca0: 6963 6b6c 6162 656c 7328 6178 5b69 5d2e  icklabels(ax[i].
-00015cb0: 6765 745f 786d 616a 6f72 7469 636b 6c61  get_xmajortickla
-00015cc0: 6265 6c73 2829 2c0d 0a23 2020 2020 2020  bels(),..#      
-00015cd0: 2020 2020 2020 2020 2020 2020 2066 6f6e               fon
-00015ce0: 7464 6963 743d 7b27 666f 6e74 7369 7a65  tdict={'fontsize
-00015cf0: 273a 3134 7d29 0d0a 2320 2020 2020 2020  ':14})..#       
-00015d00: 2020 2020 2020 2020 2020 666f 7220 7370            for sp
-00015d10: 696e 6520 696e 205b 2774 6f70 272c 2027  ine in ['top', '
-00015d20: 7269 6768 7427 5d3a 0d0a 2320 2020 2020  right']:..#     
-00015d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015d40: 6178 5b69 5d2e 7370 696e 6573 5b73 7069  ax[i].spines[spi
-00015d50: 6e65 5d2e 7365 745f 7669 7369 626c 6528  ne].set_visible(
-00015d60: 4661 6c73 6529 0d0a 2320 2020 2020 2020  False)..#       
-00015d70: 2020 2020 2020 2020 2020 2361 785b 695d            #ax[i]
-00015d80: 2e73 6574 5f66 7261 6d65 5f6f 6e28 4661  .set_frame_on(Fa
-00015d90: 6c73 6529 0d0a 2320 2020 2020 2020 2020  lse)..#         
-00015da0: 2020 2020 2020 2020 2361 785b 695d 2e73          #ax[i].s
-00015db0: 6574 5f79 6c69 6d28 3165 2d35 2c20 312e  et_ylim(1e-5, 1.
-00015dc0: 290d 0a23 2020 2020 2020 2020 2020 2020  )..#            
-00015dd0: 2020 2020 2069 6620 6920 3d3d 206e 636f       if i == nco
-00015de0: 6c73 2d31 3a0d 0a23 2020 2020 2020 2020  ls-1:..#        
-00015df0: 2020 2020 2020 2020 2020 2020 2061 785b               ax[
-00015e00: 695d 2e6c 6567 656e 6428 290d 0a23 2020  i].legend()..#  
-00015e10: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00015e20: 6620 6920 3d3d 2030 3a0d 0a23 2020 2020  f i == 0:..#    
-00015e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e40: 2074 6963 6b73 203d 2061 785b 695d 2e67   ticks = ax[i].g
-00015e50: 6574 5f79 7469 636b 7328 290d 0a23 2020  et_yticks()..#  
-00015e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e70: 2020 2069 6620 7469 636b 735b 305d 203c     if ticks[0] <
-00015e80: 2030 2061 6e64 2074 6963 6b73 5b31 5d20   0 and ticks[1] 
-00015e90: 3d3d 2030 3a0d 0a23 2020 2020 2020 2020  == 0:..#        
-00015ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015eb0: 2069 6e64 203d 206e 702e 6172 616e 6765   ind = np.arange
-00015ec0: 2831 2c20 6c65 6e28 7469 636b 7329 2c20  (1, len(ticks), 
-00015ed0: 322c 2064 7479 7065 3d69 6e74 290d 0a23  2, dtype=int)..#
-00015ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015ef0: 2020 2020 2065 6c73 653a 0d0a 2320 2020       else:..#   
+00015200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015210: 2020 2020 2020 2361 7865 733d 6178 5b30        #axes=ax[0
+00015220: 2c20 305d 2c0d 0a20 2020 2020 2020 2020  , 0],..         
+00015230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015250: 2063 6f6c 6f72 6261 723d 5472 7565 2c0d   colorbar=True,.
+00015260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015280: 2020 2020 2020 2020 2020 2023 766d 6178             #vmax
+00015290: 3d76 6d61 782c 0d0a 2020 2020 2020 2020  =vmax,..        
+000152a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000152b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000152c0: 2020 7363 616c 696e 6773 3d31 2c0d 0a20    scalings=1,.. 
+000152d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000152e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000152f0: 2020 2020 2020 2020 2074 696d 655f 666f           time_fo
+00015300: 726d 6174 3d6d 6574 686f 642c 0d0a 2020  rmat=method,..  
+00015310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015330: 2020 2020 2020 2020 2374 6974 6c65 3d27          #title='
+00015340: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
+00015350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015360: 2020 2020 2020 2020 2020 2020 2020 2373                #s
+00015370: 697a 653d 312c 0d0a 2020 2020 2020 2020  ize=1,..        
+00015380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000153a0: 2020 6f75 746c 696e 6573 3d27 6865 6164    outlines='head
+000153b0: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
+000153c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000153d0: 2020 2020 2020 2020 2020 2020 2020 290d                ).
+000153e0: 0a20 2020 2020 2020 2023 6d65 7468 6f64  .        #method
+000153f0: 203d 2022 7061 7465 726e 6e65 745f 7265   = "paternnet_re
+00015400: 6374 5f63 635f 636f 7664 6966 5f63 635f  ct_cc_covdif_cc_
+00015410: 6663 6163 7464 6966 220d 0a20 2020 2020  fcactdif"..     
+00015420: 2020 2023 6674 2e73 6574 5f73 697a 655f     #ft.set_size_
+00015430: 696e 6368 6573 285b 3135 2c33 2e35 5d29  inches([15,3.5])
+00015440: 0d0a 2020 2020 2020 2020 6966 2073 6176  ..        if sav
+00015450: 6566 6967 3a0d 0a20 2020 2020 2020 2020  efig:..         
+00015460: 2020 2066 6967 6e61 6d65 203d 2027 2d27     figname = '-'
+00015470: 2e6a 6f69 6e28 5b73 656c 662e 6d65 7461  .join([self.meta
+00015480: 2e64 6174 615b 2770 6174 6827 5d20 2b20  .data['path'] + 
+00015490: 6d65 7468 6f64 2c20 2274 6f70 6f73 2e73  method, "topos.s
+000154a0: 7667 225d 290d 0a20 2020 2020 2020 2020  vg"])..         
+000154b0: 2020 2066 742e 7361 7665 6669 6728 6669     ft.savefig(fi
+000154c0: 676e 616d 652c 2066 6f72 6d61 743d 2773  gname, format='s
+000154d0: 7667 272c 2074 7261 6e73 7061 7265 6e74  vg', transparent
+000154e0: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
+000154f0: 6966 2070 6c6f 745f 7472 7565 5f65 766f  if plot_true_evo
+00015500: 6b65 643a 0d0a 2020 2020 2020 2020 2020  ked:..          
+00015510: 2020 2374 7275 655f 7469 6d65 7320 3d20    #true_times = 
+00015520: 6e70 2e61 7267 6d61 7828 6e70 2e6d 6561  np.argmax(np.mea
+00015530: 6e28 7365 6c66 2e74 7275 655f 6576 6f6b  n(self.true_evok
+00015540: 6564 5f64 6174 612a 2a32 2c20 2d31 292c  ed_data**2, -1),
+00015550: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
+00015560: 2365 6420 3d20 6e70 2e73 7461 636b 285b  #ed = np.stack([
+00015570: 7365 6c66 2e74 7275 655f 6576 6f6b 6564  self.true_evoked
+00015580: 5f64 6174 615b 692c 2074 742c 203a 5d20  _data[i, tt, :] 
+00015590: 666f 7220 692c 2074 7420 696e 2065 6e75  for i, tt in enu
+000155a0: 6d65 7261 7465 2874 7275 655f 7469 6d65  merate(true_time
+000155b0: 7329 5d29 0d0a 2020 2020 2020 2020 2020  s)])..          
+000155c0: 2020 7420 3d20 7365 6c66 2e70 6c6f 745f    t = self.plot_
+000155d0: 6576 6f6b 6564 5f70 6561 6b73 284e 6f6e  evoked_peaks(Non
+000155e0: 652c 2073 656e 736f 725f 6c61 796f 7574  e, sensor_layout
+000155f0: 3d73 656e 736f 725f 6c61 796f 7574 2c0d  =sensor_layout,.
+00015600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015620: 2020 2020 2020 2020 7469 746c 653d 2754          title='T
+00015630: 7275 6520 6576 6f6b 6564 2729 0d0a 2020  rue evoked')..  
+00015640: 2020 2020 2020 2020 2020 6669 676e 616d            fignam
+00015650: 6520 3d20 272d 272e 6a6f 696e 285b 7365  e = '-'.join([se
+00015660: 6c66 2e6d 6574 612e 6461 7461 5b27 7061  lf.meta.data['pa
+00015670: 7468 275d 202b 2073 656c 662e 7363 6f70  th'] + self.scop
+00015680: 652c 2073 656c 662e 6d65 7461 2e64 6174  e, self.meta.dat
+00015690: 615b 2764 6174 615f 6964 275d 2c20 2774  a['data_id'], 't
+000156a0: 7275 6527 2c20 2274 6f70 6f73 2e73 7667  rue', "topos.svg
+000156b0: 225d 290d 0a20 2020 2020 2020 2020 2020  "])..           
+000156c0: 2074 2e73 6176 6566 6967 2866 6967 6e61   t.savefig(figna
+000156d0: 6d65 2c20 666f 726d 6174 3d27 7376 6727  me, format='svg'
+000156e0: 2c20 7472 616e 7370 6172 656e 743d 5472  , transparent=Tr
+000156f0: 7565 290d 0a0d 0a23 2020 2020 2020 2020  ue)....#        
+00015700: 2069 6620 6e63 6f6c 7320 3d3d 2031 3a0d   if ncols == 1:.
+00015710: 0a23 2020 2020 2020 2020 2020 2020 2070  .#             p
+00015720: 6c74 2e66 6967 7572 6528 290d 0a23 2020  lt.figure()..#  
+00015730: 2020 2020 2020 2020 2020 2061 7820 3d20             ax = 
+00015740: 706c 742e 6763 6128 290d 0a23 2020 2020  plt.gca()..#    
+00015750: 2020 2020 2020 2020 206e 6f72 6d61 6c69           normali
+00015760: 7a65 645f 696e 7075 745f 7270 7320 3d20  zed_input_rps = 
+00015770: 7073 6473 2f6e 702e 6d61 7869 6d75 6d28  psds/np.maximum(
+00015780: 6e70 2e73 756d 2870 7364 7329 2c20 3165  np.sum(psds), 1e
+00015790: 2d36 290d 0a23 2020 2020 2020 2020 2020  -6)..#          
+000157a0: 2020 206e 6f72 6d61 6c69 7a65 645f 6f75     normalized_ou
+000157b0: 7470 7574 5f72 7073 203d 2066 696c 7465  tput_rps = filte
+000157c0: 7273 2a70 7364 730d 0a23 2020 2020 2020  rs*psds..#      
+000157d0: 2020 2020 2020 206e 6f72 6d61 6c69 7a65         normalize
+000157e0: 645f 6f75 7470 7574 5f72 7073 202f 3d20  d_output_rps /= 
+000157f0: 6e70 2e6d 6178 696d 756d 286e 702e 7375  np.maximum(np.su
+00015800: 6d28 6669 6c74 6572 732a 7073 6473 292c  m(filters*psds),
+00015810: 2031 652d 3629 0d0a 2320 2020 2020 2020   1e-6)..#       
+00015820: 2020 2020 2020 6178 2e70 6c6f 7428 6672        ax.plot(fr
+00015830: 6571 732c 206e 6f72 6d61 6c69 7a65 645f  eqs, normalized_
+00015840: 696e 7075 745f 7270 732c 206c 6162 656c  input_rps, label
+00015850: 3d27 496e 7075 7420 5250 5327 290d 0a23  ='Input RPS')..#
+00015860: 2020 2020 2020 2020 2020 2020 2061 782e               ax.
+00015870: 706c 6f74 2866 7265 7173 2c20 6e6f 726d  plot(freqs, norm
+00015880: 616c 697a 6564 5f6f 7574 7075 745f 7270  alized_output_rp
+00015890: 732c 206c 6162 656c 3d27 4f75 7470 7574  s, label='Output
+000158a0: 2052 5053 2729 0d0a 2320 2320 2020 2020   RPS')..# #     
+000158b0: 2020 2020 2020 2061 782e 706c 6f74 2866         ax.plot(f
+000158c0: 7265 7173 2c20 6669 6c74 6572 732f 6e70  reqs, filters/np
+000158d0: 2e6d 6178 696d 756d 286e 702e 7375 6d28  .maximum(np.sum(
+000158e0: 6669 6c74 6572 7329 2c20 3165 2d36 292c  filters), 1e-6),
+000158f0: 0d0a 2320 2320 2020 2020 2020 2020 2020  ..# #           
+00015900: 2020 2020 2020 2020 206c 6162 656c 3d27           label='
+00015910: 4672 6571 2072 6573 706f 6e73 6527 290d  Freq response').
+00015920: 0a23 2020 2020 2020 2020 2020 2020 2061  .#             a
+00015930: 782e 6c65 6765 6e64 2829 0d0a 2320 2020  x.legend()..#   
+00015940: 2020 2020 2020 2020 2020 6178 2e73 6574            ax.set
+00015950: 5f78 6c69 6d28 302c 2039 3029 0d0a 2320  _xlim(0, 90)..# 
+00015960: 2020 2020 2020 2020 2020 2020 2370 6c74              #plt
+00015970: 2e73 686f 7728 290d 0a23 2020 2020 2020  .show()..#      
+00015980: 2020 2065 6c73 653a 0d0a 2320 2020 2020     else:..#     
+00015990: 2020 2020 2020 2020 662c 2061 7820 3d20          f, ax = 
+000159a0: 706c 742e 7375 6270 6c6f 7473 2831 2c20  plt.subplots(1, 
+000159b0: 6e63 6f6c 732c 2073 6861 7265 793d 5472  ncols, sharey=Tr
+000159c0: 7565 2c20 636f 6e73 7472 6169 6e65 645f  ue, constrained_
+000159d0: 6c61 796f 7574 3d54 7275 6529 0d0a 2320  layout=True)..# 
+000159e0: 2020 2020 2020 2020 2020 2020 2366 2e63              #f.c
+000159f0: 6f6e 7374 7261 696e 6564 5f6c 6179 6f75  onstrained_layou
+00015a00: 7428 290d 0a23 2020 2020 2020 2020 2020  t()..#          
+00015a10: 2020 2066 2e73 6574 5f73 697a 655f 696e     f.set_size_in
+00015a20: 6368 6573 285b 3134 2c20 332e 5d29 0d0a  ches([14, 3.])..
+00015a30: 2320 2020 2020 2020 2020 2020 2020 666f  #             fo
+00015a40: 7220 6920 696e 2072 616e 6765 286e 636f  r i in range(nco
+00015a50: 6c73 293a 0d0a 2320 2020 2020 2020 2020  ls):..#         
+00015a60: 2020 2020 2020 2020 2361 785b 695d 2e73          #ax[i].s
+00015a70: 656d 696c 6f67 7928 6672 6571 735b 3a2d  emilogy(freqs[:-
+00015a80: 315d 2c20 636f 6d62 696e 6564 5f66 696c  1], combined_fil
+00015a90: 7465 7273 5b3a 2c69 5d2c 206c 6162 656c  ters[:,i], label
+00015aa0: 3d27 496d 7075 6c73 6520 7265 7370 6f6e  ='Impulse respon
+00015ab0: 7365 2729 0d0a 2320 2020 2020 2020 2020  se')..#         
+00015ac0: 2020 2020 2020 2020 6e6f 726d 616c 697a          normaliz
+00015ad0: 6564 5f6f 7574 7075 745f 7270 7320 3d20  ed_output_rps = 
+00015ae0: 6669 6c74 6572 735b 3a2c 695d 2a70 7364  filters[:,i]*psd
+00015af0: 735b 3a2c 695d 0d0a 2320 2020 2020 2020  s[:,i]..#       
+00015b00: 2020 2020 2020 2020 2020 6e6f 726d 616c            normal
+00015b10: 697a 6564 5f6f 7574 7075 745f 7270 7320  ized_output_rps 
+00015b20: 2f3d 206e 702e 6d61 7869 6d75 6d28 6e70  /= np.maximum(np
+00015b30: 2e73 756d 2866 696c 7465 7273 5b3a 2c69  .sum(filters[:,i
+00015b40: 5d2a 7073 6473 5b3a 2c69 5d29 2c20 3165  ]*psds[:,i]), 1e
+00015b50: 2d36 290d 0a23 2020 2020 2020 2020 2020  -6)..#          
+00015b60: 2020 2020 2020 206e 6f72 6d61 6c69 7a65         normalize
+00015b70: 645f 696e 7075 745f 7270 7320 3d20 7073  d_input_rps = ps
+00015b80: 6473 5b3a 2c69 5d20 2f20 6e70 2e6d 6178  ds[:,i] / np.max
+00015b90: 696d 756d 286e 702e 7375 6d28 7073 6473  imum(np.sum(psds
+00015ba0: 5b3a 2c69 5d29 2c20 3165 2d36 290d 0a0d  [:,i]), 1e-6)...
+00015bb0: 0a0d 0a0d 0a23 2020 2020 2020 2020 2020  .....#          
+00015bc0: 2020 2020 2020 2061 785b 695d 2e70 6c6f         ax[i].plo
+00015bd0: 7428 6672 6571 732c 206e 6f72 6d61 6c69  t(freqs, normali
+00015be0: 7a65 645f 696e 7075 745f 7270 732c 206c  zed_input_rps, l
+00015bf0: 6162 656c 3d27 4c61 7965 7220 496e 7075  abel='Layer Inpu
+00015c00: 7427 290d 0a23 2020 2020 2020 2020 2020  t')..#          
+00015c10: 2020 2020 2020 2061 785b 695d 2e73 6574         ax[i].set
+00015c20: 5f74 6974 6c65 286e 616d 6573 5b69 5d29  _title(names[i])
+00015c30: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+00015c40: 2020 2020 6178 5b69 5d2e 706c 6f74 2866      ax[i].plot(f
+00015c50: 7265 7173 2c20 6e6f 726d 616c 697a 6564  reqs, normalized
+00015c60: 5f6f 7574 7075 745f 7270 732c 206c 6162  _output_rps, lab
+00015c70: 656c 3d27 4578 7472 6163 7465 6420 436f  el='Extracted Co
+00015c80: 6d70 6f6e 656e 7427 290d 0a23 2023 2020  mponent')..# #  
+00015c90: 2020 2020 2020 2020 2020 2020 2020 6178                ax
+00015ca0: 5b69 5d2e 706c 6f74 2866 7265 7173 2c20  [i].plot(freqs, 
+00015cb0: 6669 6c74 6572 735b 3a2c 2069 5d2f 6e70  filters[:, i]/np
+00015cc0: 2e6d 6178 696d 756d 286e 702e 7375 6d28  .maximum(np.sum(
+00015cd0: 6669 6c74 6572 735b 3a2c 2069 5d29 2c20  filters[:, i]), 
+00015ce0: 3165 2d36 292c 0d0a 2320 2320 2020 2020  1e-6),..# #     
+00015cf0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00015d00: 6162 656c 3d27 4672 6571 2072 6573 706f  abel='Freq respo
+00015d10: 6e73 6527 290d 0a23 2020 2020 2020 2020  nse')..#        
+00015d20: 2020 2020 2020 2020 2023 6178 5b69 5d2e           #ax[i].
+00015d30: 706c 6f74 2866 7265 7173 5b3a 2d31 5d2c  plot(freqs[:-1],
+00015d40: 2063 6f6d 6269 6e65 645f 6669 6c74 6572   combined_filter
+00015d50: 735b 3a2c 695d 2c20 6c61 6265 6c3d 274f  s[:,i], label='O
+00015d60: 7574 7075 7420 5250 5327 290d 0a23 2020  utput RPS')..#  
+00015d70: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00015d80: 6178 5b69 5d2e 706c 6f74 2866 7265 7173  ax[i].plot(freqs
+00015d90: 5b3a 2d31 5d2c 2063 6f6d 6269 6e65 645f  [:-1], combined_
+00015da0: 7073 6473 5b3a 2c69 5d2c 206c 6162 656c  psds[:,i], label
+00015db0: 3d27 496e 7075 7420 5250 5327 290d 0a23  ='Input RPS')..#
+00015dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015dd0: 2061 785b 695d 2e73 6574 5f78 6c69 6d28   ax[i].set_xlim(
+00015de0: 302c 2037 3029 0d0a 0d0a 2320 2020 2020  0, 70)....#     
+00015df0: 2020 2020 2020 2020 2020 2020 6178 5b69              ax[i
+00015e00: 5d2e 7365 745f 7874 6963 6b6c 6162 656c  ].set_xticklabel
+00015e10: 7328 6178 5b69 5d2e 6765 745f 786d 616a  s(ax[i].get_xmaj
+00015e20: 6f72 7469 636b 6c61 6265 6c73 2829 2c0d  orticklabels(),.
+00015e30: 0a23 2020 2020 2020 2020 2020 2020 2020  .#              
+00015e40: 2020 2020 2066 6f6e 7464 6963 743d 7b27       fontdict={'
+00015e50: 666f 6e74 7369 7a65 273a 3134 7d29 0d0a  fontsize':14})..
+00015e60: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+00015e70: 2020 666f 7220 7370 696e 6520 696e 205b    for spine in [
+00015e80: 2774 6f70 272c 2027 7269 6768 7427 5d3a  'top', 'right']:
+00015e90: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+00015ea0: 2020 2020 2020 2020 6178 5b69 5d2e 7370          ax[i].sp
+00015eb0: 696e 6573 5b73 7069 6e65 5d2e 7365 745f  ines[spine].set_
+00015ec0: 7669 7369 626c 6528 4661 6c73 6529 0d0a  visible(False)..
+00015ed0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+00015ee0: 2020 2361 785b 695d 2e73 6574 5f66 7261    #ax[i].set_fra
+00015ef0: 6d65 5f6f 6e28 4661 6c73 6529 0d0a 2320  me_on(False)..# 
 00015f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015f10: 2020 2020 2020 696e 6420 3d20 6e70 2e61        ind = np.a
-00015f20: 7261 6e67 6528 302c 206c 656e 2874 6963  range(0, len(tic
-00015f30: 6b73 292c 2032 2c20 6474 7970 653d 696e  ks), 2, dtype=in
-00015f40: 7429 0d0a 0d0a 2320 2020 2020 2020 2020  t)....#         
-00015f50: 2020 2020 2020 2020 2020 2020 6178 5b69              ax[i
-00015f60: 5d2e 7365 745f 7974 6963 6b73 2874 6963  ].set_yticks(tic
-00015f70: 6b73 5b69 6e64 5d29 0d0a 2320 2020 2020  ks[ind])..#     
-00015f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015f90: 6178 5b69 5d2e 7365 745f 7974 6963 6b6c  ax[i].set_ytickl
-00015fa0: 6162 656c 7328 6178 5b69 5d2e 6765 745f  abels(ax[i].get_
-00015fb0: 796d 616a 6f72 7469 636b 6c61 6265 6c73  ymajorticklabels
-00015fc0: 2829 2c0d 0a23 2020 2020 2020 2020 2020  (),..#          
-00015fd0: 2020 2020 2020 2020 2020 2020 2066 6f6e               fon
-00015fe0: 7464 6963 743d 7b27 666f 6e74 7369 7a65  tdict={'fontsize
-00015ff0: 273a 3134 7d29 0d0a 2320 2020 2020 2020  ':14})..#       
-00016000: 2020 2020 2020 2020 2020 2020 2020 6178                ax
-00016010: 5b69 5d2e 7365 745f 796c 6162 656c 2827  [i].set_ylabel('
-00016020: 5265 6c61 7469 7665 2070 6f77 6572 2c20  Relative power, 
-00016030: 2527 2c20 666f 6e74 7369 7a65 3d31 3629  %', fontsize=16)
-00016040: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-00016050: 662e 7375 7078 6c61 6265 6c28 2746 7265  f.supxlabel('Fre
-00016060: 7175 656e 6379 2c20 487a 272c 2066 6f6e  quency, Hz', fon
-00016070: 7473 697a 653d 3136 290d 0a23 2020 2020  tsize=16)..#    
-00016080: 2020 2020 2070 6c74 2e73 686f 7728 290d       plt.show().
-00016090: 0a23 2020 2020 2020 2020 2020 2020 2020  .#              
-000160a0: 2020 2023 6178 5b69 5d2e 7368 6f77 2829     #ax[i].show()
-000160b0: 0d0a 0d0a 0d0a 0d0a 0d0a 0d0a 2020 2020  ............    
-000160c0: 2320 6465 6620 706c 6f74 5f73 7065 6374  # def plot_spect
-000160d0: 7261 2873 656c 662c 2070 6174 7465 726e  ra(self, pattern
-000160e0: 735f 7374 7275 6374 2c20 636f 6d70 6f6e  s_struct, compon
-000160f0: 656e 745f 696e 642c 2061 782c 2066 733d  ent_ind, ax, fs=
-00016100: 4e6f 6e65 2c20 6c6f 6167 3d46 616c 7365  None, loag=False
-00016110: 293a 0d0a 2020 2020 2320 2020 2020 2222  ):..    #     ""
-00016120: 2252 656c 6174 6976 6520 706f 7765 7220  "Relative power 
-00016130: 7370 6563 7472 6120 6f66 2061 2067 6976  spectra of a giv
-00016140: 656e 206c 6174 656e 7420 636f 6d70 6f6e  en latent compon
-00016150: 656e 6465 2062 6566 6f72 6520 616e 6420  ende before and 
-00016160: 6166 7465 720d 0a20 2020 2023 2020 2020  after..    #    
-00016170: 2020 2020 6170 706c 7969 6e67 2074 6865      applying the
-00016180: 2063 6f6e 766f 6c75 7469 6f6e 2e0d 0a0d   convolution....
-00016190: 0a20 2020 2023 2020 2020 2050 6172 616d  .    #     Param
-000161a0: 6574 6572 730d 0a20 2020 2023 2020 2020  eters..    #    
-000161b0: 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a0d 0a20   ----------.... 
-000161c0: 2020 2023 2020 2020 2070 6174 7465 726e     #     pattern
-000161d0: 735f 7374 7275 6374 203a 0d0a 2020 2020  s_struct :..    
-000161e0: 2320 2020 2020 2020 2020 696e 7374 616e  #         instan
-000161f0: 6365 206f 6620 7061 7474 6572 6e73 5f73  ce of patterns_s
-00016200: 7472 7563 7420 7072 6f64 7563 6564 2062  truct produced b
-00016210: 7920 6d6f 6465 6c2e 636f 6d70 7574 655f  y model.compute_
-00016220: 7061 7474 6572 6e73 0d0a 0d0a 2020 2020  patterns....    
-00016230: 2320 2020 2020 6178 203a 2061 7865 730d  #     ax : axes.
-00016240: 0a0d 0a20 2020 2023 2020 2020 2066 7320  ...    #     fs 
-00016250: 3a20 666c 6f61 740d 0a20 2020 2023 2020  : float..    #  
-00016260: 2020 2020 2020 2053 616d 706c 696e 6720         Sampling 
-00016270: 6672 6571 7565 6e63 792e 0d0a 0d0a 2020  frequency.....  
-00016280: 2020 2320 2020 2020 6c6f 6720 3a20 626f    #     log : bo
-00016290: 6f6c 0d0a 2020 2020 2320 2020 2020 2020  ol..    #       
-000162a0: 2020 4170 706c 7920 6c6f 672d 7472 616e    Apply log-tran
-000162b0: 7366 6f72 6d20 746f 2074 6865 2073 7065  sform to the spe
-000162c0: 6374 7261 2e0d 0a0d 0a0d 0a0d 0a20 2020  ctra.........   
-000162d0: 2023 2020 2020 2022 2222 0d0a 0d0a 2020   #     """....  
-000162e0: 2020 2320 2020 2020 6966 206e 6f74 2066    #     if not f
-000162f0: 733a 0d0a 2020 2020 2320 2020 2020 2020  s:..    #       
-00016300: 2070 7269 6e74 2827 5361 6d70 6c69 6e67   print('Sampling
-00016310: 2066 7265 7175 656e 6379 206e 6f74 2073   frequency not s
-00016320: 7065 6369 6669 6564 2c20 7365 7474 696e  pecified, settin
-00016330: 6720 746f 2031 2e27 290d 0a20 2020 2023  g to 1.')..    #
-00016340: 2020 2020 2020 2020 7365 6c66 2e66 7320          self.fs 
-00016350: 3d20 312e 0d0a 0d0a 2020 2020 2320 2020  = 1.....    #   
-00016360: 2020 6669 6c74 6572 7320 3d20 7061 7474    filters = patt
-00016370: 6572 6e73 5f73 7472 7563 745b 2777 6569  erns_struct['wei
-00016380: 6768 7473 275d 5b27 7463 6f6e 7627 5d5b  ghts']['tconv'][
-00016390: 3a2c 2063 6f6d 706f 6e65 6e74 5f69 6e64  :, component_ind
-000163a0: 5d0d 0a20 2020 2023 2020 2020 2070 5f69  ]..    #     p_i
-000163b0: 6e70 7574 203d 2070 6174 7465 726e 735f  nput = patterns_
-000163c0: 7374 7275 6374 5b27 7370 6563 7472 6127  struct['spectra'
-000163d0: 5d5b 2770 7364 7327 5d5b 636f 6d70 6f6e  ]['psds'][compon
-000163e0: 656e 745f 696e 642c 203a 5d0d 0a0d 0a20  ent_ind, :].... 
-000163f0: 2020 2023 2020 2020 2077 2c20 6820 3d20     #     w, h = 
-00016400: 6672 6571 7a28 6669 6c74 6572 732c 2031  freqz(filters, 1
-00016410: 2c20 776f 724e 3d73 656c 662e 6e66 6674  , worN=self.nfft
-00016420: 290d 0a20 2020 2023 2020 2020 2066 7231  )..    #     fr1
-00016430: 203d 2077 2f6e 702e 7069 2a73 656c 662e   = w/np.pi*self.
-00016440: 6673 2f32 0d0a 2020 2020 2320 2020 2020  fs/2..    #     
-00016450: 6830 203d 2070 5f69 6e70 7574 2a6e 702e  h0 = p_input*np.
-00016460: 6162 7328 6829 0d0a 0d0a 0d0a 2020 2020  abs(h)......    
-00016470: 2320 2020 2020 6966 206c 6f67 3a0d 0a20  #     if log:.. 
-00016480: 2020 2023 2020 2020 2020 2020 2061 785b     #         ax[
-00016490: 692c 206a 6a5d 2e73 656d 696c 6f67 7928  i, jj].semilogy(
-000164a0: 6672 312c 2070 5f69 6e70 7574 2f70 5f69  fr1, p_input/p_i
-000164b0: 6e70 7574 2e73 756d 2829 2c0d 0a20 2020  nput.sum(),..   
-000164c0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-000164d0: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-000164e0: 6265 6c3d 2746 696c 7465 7220 696e 7075  bel='Filter inpu
-000164f0: 7420 5250 5327 290d 0a20 2020 2023 2020  t RPS')..    #  
-00016500: 2020 2020 2020 2061 785b 692c 206a 6a5d         ax[i, jj]
-00016510: 2e73 656d 696c 6f67 7928 6672 312c 2068  .semilogy(fr1, h
-00016520: 302f 6830 2e73 756d 2829 2c0d 0a20 2020  0/h0.sum(),..   
-00016530: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-00016540: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-00016550: 6265 6c3d 2746 6974 6c65 7220 6f75 7470  bel='Fitler outp
-00016560: 7574 2052 5053 2729 0d0a 2020 2020 2320  ut RPS')..    # 
-00016570: 2020 2020 2020 2020 6178 5b69 2c20 6a6a          ax[i, jj
-00016580: 5d2e 7365 6d69 6c6f 6779 2866 7231 2c20  ].semilogy(fr1, 
-00016590: 6e70 2e61 6273 2868 292f 6e70 2e61 6273  np.abs(h)/np.abs
-000165a0: 2868 292e 7375 6d28 292c 0d0a 2020 2020  (h).sum(),..    
-000165b0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-000165c0: 2020 2020 2020 2020 2020 2020 206c 6162               lab
-000165d0: 656c 3d27 4672 6571 2072 6573 706f 6e73  el='Freq respons
-000165e0: 6520 5250 5327 290d 0a20 2020 2023 2020  e RPS')..    #  
-000165f0: 2020 2065 6c73 653a 0d0a 2020 2020 2320     else:..    # 
-00016600: 2020 2020 2020 2020 6178 5b69 2c20 6a6a          ax[i, jj
-00016610: 5d2e 706c 6f74 2866 7231 2c20 705f 696e  ].plot(fr1, p_in
-00016620: 7075 742f 705f 696e 7075 742e 7375 6d28  put/p_input.sum(
-00016630: 292c 0d0a 2020 2020 2320 2020 2020 2020  ),..    #       
-00016640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016650: 206c 6162 656c 3d27 4669 6c74 6572 2069   label='Filter i
-00016660: 6e70 7574 2052 5053 2729 0d0a 2020 2020  nput RPS')..    
-00016670: 2320 2020 2020 2020 2020 6178 5b69 2c20  #         ax[i, 
-00016680: 6a6a 5d2e 706c 6f74 2866 7231 2c20 6830  jj].plot(fr1, h0
-00016690: 2f68 302e 7375 6d28 292c 206c 6162 656c  /h0.sum(), label
-000166a0: 3d27 4669 746c 6572 206f 7574 7075 7420  ='Fitler output 
-000166b0: 5250 5327 290d 0a20 2020 2023 2020 2020  RPS')..    #    
-000166c0: 2020 2020 2061 785b 692c 206a 6a5d 2e70       ax[i, jj].p
-000166d0: 6c6f 7428 6672 312c 206e 702e 6162 7328  lot(fr1, np.abs(
-000166e0: 6829 2f6e 702e 6162 7328 6829 2e73 756d  h)/np.abs(h).sum
-000166f0: 2829 2c0d 0a20 2020 2023 2020 2020 2020  (),..    #      
-00016700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016710: 2020 6c61 6265 6c3d 2746 7265 7120 7265    label='Freq re
-00016720: 7370 6f6e 7365 2729 0d0a 2020 2020 2320  sponse')..    # 
-00016730: 2020 2020 2370 7269 6e74 286e 702e 616c      #print(np.al
-00016740: 6c28 6e70 2e72 6f75 6e64 2866 725b 3a2d  l(np.round(fr[:-
-00016750: 315d 2c20 2d34 2920 3d3d 206e 702e 726f  1], -4) == np.ro
-00016760: 756e 6428 6672 312c 202d 3429 2929 0d0a  und(fr1, -4)))..
-00016770: 0d0a 0d0a 2020 2020 2320 6178 5b69 2c20  ....    # ax[i, 
-00016780: 6a6a 5d2e 7365 745f 786c 696d 2830 2c20  jj].set_xlim(0, 
-00016790: 3735 2e29 0d0a 2020 2020 2320 2361 785b  75.)..    # #ax[
-000167a0: 692c 206a 6a5d 2e73 6574 5f78 6c69 6d28  i, jj].set_xlim(
-000167b0: 302c 2037 352e 290d 0a20 2020 2023 2069  0, 75.)..    # i
-000167c0: 6620 6920 3d3d 2030 2061 6e64 206a 6a20  f i == 0 and jj 
-000167d0: 3d3d 206e 636f 6c73 2d31 3a0d 0a20 2020  == ncols-1:..   
-000167e0: 2023 2020 2020 2061 785b 692c 206a 6a5d   #     ax[i, jj]
-000167f0: 2e6c 6567 656e 6428 6672 616d 656f 6e3d  .legend(frameon=
-00016800: 4661 6c73 6529 0d0a 2020 2020 2320 7265  False)..    # re
-00016810: 7475 726e 2066 0d0a 0d0a 0d0a 636c 6173  turn f......clas
-00016820: 7320 5641 5243 4e4e 2842 6173 654d 6f64  s VARCNN(BaseMod
-00016830: 656c 293a 0d0a 2020 2020 2222 2256 4152  el):..    """VAR
-00016840: 2d43 4e4e 2e0d 0a0d 0a20 2020 2046 6f72  -CNN.....    For
-00016850: 2064 6574 6169 6c73 2073 6565 205b 315d   details see [1]
-00016860: 2e0d 0a0d 0a20 2020 2052 6566 6572 656e  .....    Referen
-00016870: 6365 730d 0a20 2020 202d 2d2d 2d2d 2d2d  ces..    -------
-00016880: 2d2d 2d0d 0a20 2020 2020 2020 205b 315d  ---..        [1]
-00016890: 2049 2e20 5a75 6261 7265 762c 2065 7420   I. Zubarev, et 
-000168a0: 616c 2e2c 2041 6461 7074 6976 6520 6e65  al., Adaptive ne
-000168b0: 7572 616c 206e 6574 776f 726b 2063 6c61  ural network cla
-000168c0: 7373 6966 6965 7220 666f 720d 0a20 2020  ssifier for..   
-000168d0: 2020 2020 2064 6563 6f64 696e 6720 4d45       decoding ME
-000168e0: 4720 7369 676e 616c 732e 204e 6575 726f  G signals. Neuro
-000168f0: 696d 6167 652e 2028 3230 3139 2920 4d61  image. (2019) Ma
-00016900: 7920 343b 3139 373a 3432 352d 3433 340d  y 4;197:425-434.
-00016910: 0a20 2020 2022 2222 0d0a 2020 2020 6465  .    """..    de
-00016920: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-00016930: 206d 6574 612c 2064 6174 6173 6574 3d4e   meta, dataset=N
-00016940: 6f6e 6529 3a0d 0a20 2020 2020 2020 2022  one):..        "
-00016950: 2222 0d0a 2020 2020 2020 2020 5061 7261  ""..        Para
-00016960: 6d65 7465 7273 0d0a 2020 2020 2020 2020  meters..        
-00016970: 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020  ----------..    
-00016980: 2020 2020 4461 7461 7365 7420 3a20 6d6e      Dataset : mn
-00016990: 6566 6c6f 772e 4461 7461 7365 740d 0a0d  eflow.Dataset...
-000169a0: 0a20 2020 2020 2020 2073 7065 6373 203a  .        specs :
-000169b0: 2064 6963 740d 0a20 2020 2020 2020 2020   dict..         
-000169c0: 2020 2020 2020 2064 6963 7469 6f6e 6172         dictionar
-000169d0: 7920 6f66 206d 6f64 656c 2068 7970 6572  y of model hyper
-000169e0: 7061 7261 6d65 7465 7273 207b 0d0a 0d0a  parameters {....
-000169f0: 2020 2020 2020 2020 6e5f 6c61 7465 6e74          n_latent
-00016a00: 203a 2069 6e74 0d0a 2020 2020 2020 2020   : int..        
-00016a10: 2020 2020 4e75 6d62 6572 206f 6620 6c61      Number of la
-00016a20: 7465 6e74 2063 6f6d 706f 6e65 6e74 732e  tent components.
-00016a30: 0d0a 2020 2020 2020 2020 2020 2020 4465  ..            De
-00016a40: 6661 756c 7473 2074 6f20 3332 2e0d 0a0d  faults to 32....
-00016a50: 0a20 2020 2020 2020 206e 6f6e 6c69 6e20  .        nonlin 
-00016a60: 3a20 6361 6c6c 6162 6c65 0d0a 2020 2020  : callable..    
-00016a70: 2020 2020 2020 2020 4163 7469 7661 7469          Activati
-00016a80: 6f6e 2066 756e 6374 696f 6e20 6f66 2074  on function of t
-00016a90: 6865 2074 656d 706f 7261 6c20 636f 6e76  he temporal conv
-00016aa0: 6f6c 7574 696f 6e20 6c61 7965 722e 0d0a  olution layer...
-00016ab0: 2020 2020 2020 2020 2020 2020 4465 6661              Defa
-00016ac0: 756c 7473 2074 6f20 7466 2e6e 6e2e 7265  ults to tf.nn.re
-00016ad0: 6c75 0d0a 0d0a 2020 2020 2020 2020 6669  lu....        fi
-00016ae0: 6c74 6572 5f6c 656e 6774 6820 3a20 696e  lter_length : in
-00016af0: 740d 0a20 2020 2020 2020 2020 2020 204c  t..            L
-00016b00: 656e 6774 6820 6f66 2073 7061 7469 6f2d  ength of spatio-
-00016b10: 7465 6d70 6f72 616c 206b 6572 6e65 6c73  temporal kernels
-00016b20: 2069 6e20 7468 6520 7465 6d70 6f72 616c   in the temporal
-00016b30: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
-00016b40: 6e76 6f6c 7574 696f 6e20 6c61 7965 722e  nvolution layer.
-00016b50: 2044 6566 6175 6c74 7320 746f 2037 2e0d   Defaults to 7..
-00016b60: 0a0d 0a20 2020 2020 2020 2070 6f6f 6c69  ...        pooli
-00016b70: 6e67 203a 2069 6e74 0d0a 2020 2020 2020  ng : int..      
-00016b80: 2020 2020 2020 506f 6f6c 696e 6720 6661        Pooling fa
-00016b90: 6374 6f72 206f 6620 7468 6520 6d61 7820  ctor of the max 
-00016ba0: 706f 6f6c 696e 6720 6c61 7965 722e 2044  pooling layer. D
-00016bb0: 6566 6175 6c74 7320 746f 2032 0d0a 0d0a  efaults to 2....
-00016bc0: 2020 2020 2020 2020 706f 6f6c 5f74 7970          pool_typ
-00016bd0: 6520 3a20 7374 7220 7b27 6176 6727 2c20  e : str {'avg', 
-00016be0: 276d 6178 277d 0d0a 2020 2020 2020 2020  'max'}..        
-00016bf0: 2020 2020 5479 7065 206f 6620 706f 6f6c      Type of pool
-00016c00: 696e 6720 6f70 6572 6174 696f 6e2e 2044  ing operation. D
-00016c10: 6566 6175 6c74 7320 746f 2027 6d61 7827  efaults to 'max'
-00016c20: 2e0d 0a0d 0a20 2020 2020 2020 2070 6164  .....        pad
-00016c30: 6469 6e67 203a 2073 7472 207b 2753 414d  ding : str {'SAM
-00016c40: 4527 2c20 2746 554c 4c27 2c20 2756 414c  E', 'FULL', 'VAL
-00016c50: 4944 277d 0d0a 2020 2020 2020 2020 2020  ID'}..          
-00016c60: 2020 436f 6e76 6f6c 7574 696f 6e20 7061    Convolution pa
-00016c70: 6464 696e 672e 2044 6566 6175 6c74 7320  dding. Defaults 
-00016c80: 746f 2027 5341 4d45 272e 7d22 2222 0d0a  to 'SAME'.}"""..
-00016c90: 2020 2020 2020 2020 7365 6c66 2e73 636f          self.sco
-00016ca0: 7065 203d 2027 7661 7263 6e6e 270d 0a20  pe = 'varcnn'.. 
-00016cb0: 2020 2020 2020 206d 6574 612e 6d6f 6465         meta.mode
-00016cc0: 6c5f 7370 6563 732e 7365 7464 6566 6175  l_specs.setdefau
-00016cd0: 6c74 2827 6669 6c74 6572 5f6c 656e 6774  lt('filter_lengt
-00016ce0: 6827 2c20 3729 0d0a 2020 2020 2020 2020  h', 7)..        
-00016cf0: 6d65 7461 2e6d 6f64 656c 5f73 7065 6373  meta.model_specs
-00016d00: 2e73 6574 6465 6661 756c 7428 276e 5f6c  .setdefault('n_l
-00016d10: 6174 656e 7427 2c20 3332 290d 0a20 2020  atent', 32)..   
-00016d20: 2020 2020 206d 6574 612e 6d6f 6465 6c5f       meta.model_
-00016d30: 7370 6563 732e 7365 7464 6566 6175 6c74  specs.setdefault
-00016d40: 2827 706f 6f6c 696e 6727 2c20 3229 0d0a  ('pooling', 2)..
-00016d50: 2020 2020 2020 2020 6d65 7461 2e6d 6f64          meta.mod
-00016d60: 656c 5f73 7065 6373 2e73 6574 6465 6661  el_specs.setdefa
-00016d70: 756c 7428 2773 7472 6964 6527 2c20 3229  ult('stride', 2)
-00016d80: 0d0a 2020 2020 2020 2020 6d65 7461 2e6d  ..        meta.m
-00016d90: 6f64 656c 5f73 7065 6373 2e73 6574 6465  odel_specs.setde
-00016da0: 6661 756c 7428 2770 6164 6469 6e67 272c  fault('padding',
-00016db0: 2027 5341 4d45 2729 0d0a 2020 2020 2020   'SAME')..      
-00016dc0: 2020 6d65 7461 2e6d 6f64 656c 5f73 7065    meta.model_spe
-00016dd0: 6373 2e73 6574 6465 6661 756c 7428 2770  cs.setdefault('p
-00016de0: 6f6f 6c5f 7479 7065 272c 2027 6d61 7827  ool_type', 'max'
-00016df0: 290d 0a20 2020 2020 2020 206d 6574 612e  )..        meta.
-00016e00: 6d6f 6465 6c5f 7370 6563 732e 7365 7464  model_specs.setd
-00016e10: 6566 6175 6c74 2827 6e6f 6e6c 696e 272c  efault('nonlin',
-00016e20: 2074 662e 6e6e 2e72 656c 7529 0d0a 2020   tf.nn.relu)..  
-00016e30: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
-00016e40: 5f73 7065 6373 2e73 6574 6465 6661 756c  _specs.setdefaul
-00016e50: 7428 276c 315f 6c61 6d62 6461 272c 2033  t('l1_lambda', 3
-00016e60: 652d 3429 0d0a 2020 2020 2020 2020 6d65  e-4)..        me
-00016e70: 7461 2e6d 6f64 656c 5f73 7065 6373 2e73  ta.model_specs.s
-00016e80: 6574 6465 6661 756c 7428 276c 325f 6c61  etdefault('l2_la
-00016e90: 6d62 6461 272c 2030 290d 0a20 2020 2020  mbda', 0)..     
-00016ea0: 2020 206d 6574 612e 6d6f 6465 6c5f 7370     meta.model_sp
-00016eb0: 6563 732e 7365 7464 6566 6175 6c74 2827  ecs.setdefault('
-00016ec0: 6c31 5f73 636f 7065 272c 205b 2766 6327  l1_scope', ['fc'
-00016ed0: 2c20 2764 656d 6978 272c 2027 6c66 5f63  , 'demix', 'lf_c
-00016ee0: 6f6e 7627 5d29 0d0a 2020 2020 2020 2020  onv'])..        
-00016ef0: 6d65 7461 2e6d 6f64 656c 5f73 7065 6373  meta.model_specs
-00016f00: 2e73 6574 6465 6661 756c 7428 276c 325f  .setdefault('l2_
-00016f10: 7363 6f70 6527 2c20 5b5d 290d 0a20 2020  scope', [])..   
-00016f20: 2020 2020 206d 6574 612e 6d6f 6465 6c5f       meta.model_
-00016f30: 7370 6563 732e 7365 7464 6566 6175 6c74  specs.setdefault
-00016f40: 2827 756e 6974 6e6f 726d 5f73 636f 7065  ('unitnorm_scope
-00016f50: 272c 205b 5d29 0d0a 2020 2020 2020 2020  ', [])..        
-00016f60: 6d65 7461 2e6d 6f64 656c 5f73 7065 6373  meta.model_specs
-00016f70: 5b27 7363 6f70 6527 5d20 3d20 7365 6c66  ['scope'] = self
-00016f80: 2e73 636f 7065 0d0a 2020 2020 2020 2020  .scope..        
-00016f90: 7375 7065 7228 5641 5243 4e4e 2c20 7365  super(VARCNN, se
-00016fa0: 6c66 292e 5f5f 696e 6974 5f5f 286d 6574  lf).__init__(met
-00016fb0: 612c 2064 6174 6173 6574 290d 0a0d 0a20  a, dataset).... 
-00016fc0: 2020 2064 6566 2062 7569 6c64 5f67 7261     def build_gra
-00016fd0: 7068 2873 656c 6629 3a0d 0a20 2020 2020  ph(self):..     
-00016fe0: 2020 2022 2222 4275 696c 6420 636f 6d70     """Build comp
-00016ff0: 7574 6174 696f 6e61 6c20 6772 6170 6820  utational graph 
-00017000: 7573 696e 6720 6465 6669 6e65 6420 706c  using defined pl
-00017010: 6163 6568 6f6c 6465 7220 6073 656c 662e  aceholder `self.
-00017020: 5860 0d0a 2020 2020 2020 2020 6173 2069  X`..        as i
-00017030: 6e70 7574 2e0d 0a0d 0a20 2020 2020 2020  nput.....       
-00017040: 2052 6574 7572 6e73 0d0a 2020 2020 2020   Returns..      
-00017050: 2020 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020    --------..    
-00017060: 2020 2020 795f 7072 6564 203a 2074 662e      y_pred : tf.
-00017070: 5465 6e73 6f72 0d0a 2020 2020 2020 2020  Tensor..        
-00017080: 2020 2020 4f75 7470 7574 206f 6620 7468      Output of th
-00017090: 6520 666f 7277 6172 6420 7061 7373 206f  e forward pass o
-000170a0: 6620 7468 6520 636f 6d70 7574 6174 696f  f the computatio
-000170b0: 6e61 6c20 6772 6170 682e 0d0a 2020 2020  nal graph...    
-000170c0: 2020 2020 2020 2020 5072 6564 6963 7469          Predicti
-000170d0: 6f6e 206f 6620 7468 6520 7461 7267 6574  on of the target
-000170e0: 2076 6172 6961 626c 652e 0d0a 2020 2020   variable...    
-000170f0: 2020 2020 2222 220d 0a0d 0a20 2020 2020      """....     
-00017100: 2020 2073 656c 662e 646d 7820 3d20 4465     self.dmx = De
-00017110: 4d69 7869 6e67 2873 697a 653d 7365 6c66  Mixing(size=self
-00017120: 2e73 7065 6373 5b27 6e5f 6c61 7465 6e74  .specs['n_latent
-00017130: 275d 2c20 6e6f 6e6c 696e 3d74 662e 6964  '], nonlin=tf.id
-00017140: 656e 7469 7479 2c0d 0a20 2020 2020 2020  entity,..       
-00017150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017160: 2020 2020 2061 7869 733d 332c 2073 7065       axis=3, spe
-00017170: 6373 3d73 656c 662e 7370 6563 7329 2873  cs=self.specs)(s
-00017180: 656c 662e 696e 7075 7473 290d 0a0d 0a0d  elf.inputs).....
-00017190: 0a20 2020 2020 2020 2073 656c 662e 7463  .        self.tc
-000171a0: 6f6e 7620 3d20 5641 5243 6f6e 7628 7369  onv = VARConv(si
-000171b0: 7a65 3d73 656c 662e 7370 6563 735b 276e  ze=self.specs['n
-000171c0: 5f6c 6174 656e 7427 5d2c 0d0a 2020 2020  _latent'],..    
-000171d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000171e0: 2020 2020 2020 2020 206e 6f6e 6c69 6e3d           nonlin=
-000171f0: 7365 6c66 2e73 7065 6373 5b27 6e6f 6e6c  self.specs['nonl
-00017200: 696e 275d 2c0d 0a20 2020 2020 2020 2020  in'],..         
-00017210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017220: 2020 2020 6669 6c74 6572 5f6c 656e 6774      filter_lengt
-00017230: 683d 7365 6c66 2e73 7065 6373 5b27 6669  h=self.specs['fi
-00017240: 6c74 6572 5f6c 656e 6774 6827 5d2c 0d0a  lter_length'],..
-00017250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017260: 2020 2020 2020 2020 2020 2020 2070 6164               pad
-00017270: 6469 6e67 3d73 656c 662e 7370 6563 735b  ding=self.specs[
-00017280: 2770 6164 6469 6e67 275d 2c0d 0a20 2020  'padding'],..   
-00017290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000172a0: 2020 2020 2020 2020 2020 7370 6563 733d            specs=
-000172b0: 7365 6c66 2e73 7065 6373 0d0a 2020 2020  self.specs..    
-000172c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000172d0: 2020 2020 2020 2020 2029 2873 656c 662e           )(self.
-000172e0: 646d 7829 0d0a 0d0a 2020 2020 2020 2020  dmx)....        
-000172f0: 7365 6c66 2e70 6f6f 6c65 6420 3d20 5465  self.pooled = Te
-00017300: 6d70 506f 6f6c 696e 6728 706f 6f6c 696e  mpPooling(poolin
-00017310: 673d 7365 6c66 2e73 7065 6373 5b27 706f  g=self.specs['po
-00017320: 6f6c 696e 6727 5d2c 0d0a 2020 2020 2020  oling'],..      
-00017330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017340: 2020 2020 2020 2020 2020 2020 706f 6f6c              pool
-00017350: 5f74 7970 653d 7365 6c66 2e73 7065 6373  _type=self.specs
-00017360: 5b27 706f 6f6c 5f74 7970 6527 5d2c 0d0a  ['pool_type'],..
+00015f10: 2361 785b 695d 2e73 6574 5f79 6c69 6d28  #ax[i].set_ylim(
+00015f20: 3165 2d35 2c20 312e 290d 0a23 2020 2020  1e-5, 1.)..#    
+00015f30: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00015f40: 6920 3d3d 206e 636f 6c73 2d31 3a0d 0a23  i == ncols-1:..#
+00015f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015f60: 2020 2020 2061 785b 695d 2e6c 6567 656e       ax[i].legen
+00015f70: 6428 290d 0a23 2020 2020 2020 2020 2020  d()..#          
+00015f80: 2020 2020 2020 2069 6620 6920 3d3d 2030         if i == 0
+00015f90: 3a0d 0a23 2020 2020 2020 2020 2020 2020  :..#            
+00015fa0: 2020 2020 2020 2020 2074 6963 6b73 203d           ticks =
+00015fb0: 2061 785b 695d 2e67 6574 5f79 7469 636b   ax[i].get_ytick
+00015fc0: 7328 290d 0a23 2020 2020 2020 2020 2020  s()..#          
+00015fd0: 2020 2020 2020 2020 2020 2069 6620 7469             if ti
+00015fe0: 636b 735b 305d 203c 2030 2061 6e64 2074  cks[0] < 0 and t
+00015ff0: 6963 6b73 5b31 5d20 3d3d 2030 3a0d 0a23  icks[1] == 0:..#
+00016000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016010: 2020 2020 2020 2020 2069 6e64 203d 206e           ind = n
+00016020: 702e 6172 616e 6765 2831 2c20 6c65 6e28  p.arange(1, len(
+00016030: 7469 636b 7329 2c20 322c 2064 7479 7065  ticks), 2, dtype
+00016040: 3d69 6e74 290d 0a23 2020 2020 2020 2020  =int)..#        
+00016050: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00016060: 653a 0d0a 2320 2020 2020 2020 2020 2020  e:..#           
+00016070: 2020 2020 2020 2020 2020 2020 2020 696e                in
+00016080: 6420 3d20 6e70 2e61 7261 6e67 6528 302c  d = np.arange(0,
+00016090: 206c 656e 2874 6963 6b73 292c 2032 2c20   len(ticks), 2, 
+000160a0: 6474 7970 653d 696e 7429 0d0a 0d0a 2320  dtype=int)....# 
+000160b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000160c0: 2020 2020 6178 5b69 5d2e 7365 745f 7974      ax[i].set_yt
+000160d0: 6963 6b73 2874 6963 6b73 5b69 6e64 5d29  icks(ticks[ind])
+000160e0: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+000160f0: 2020 2020 2020 2020 6178 5b69 5d2e 7365          ax[i].se
+00016100: 745f 7974 6963 6b6c 6162 656c 7328 6178  t_yticklabels(ax
+00016110: 5b69 5d2e 6765 745f 796d 616a 6f72 7469  [i].get_ymajorti
+00016120: 636b 6c61 6265 6c73 2829 2c0d 0a23 2020  cklabels(),..#  
+00016130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016140: 2020 2020 2066 6f6e 7464 6963 743d 7b27       fontdict={'
+00016150: 666f 6e74 7369 7a65 273a 3134 7d29 0d0a  fontsize':14})..
+00016160: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+00016170: 2020 2020 2020 6178 5b69 5d2e 7365 745f        ax[i].set_
+00016180: 796c 6162 656c 2827 5265 6c61 7469 7665  ylabel('Relative
+00016190: 2070 6f77 6572 2c20 2527 2c20 666f 6e74   power, %', font
+000161a0: 7369 7a65 3d31 3629 0d0a 2320 2020 2020  size=16)..#     
+000161b0: 2020 2020 2020 2020 662e 7375 7078 6c61          f.supxla
+000161c0: 6265 6c28 2746 7265 7175 656e 6379 2c20  bel('Frequency, 
+000161d0: 487a 272c 2066 6f6e 7473 697a 653d 3136  Hz', fontsize=16
+000161e0: 290d 0a23 2020 2020 2020 2020 2070 6c74  )..#         plt
+000161f0: 2e73 686f 7728 290d 0a23 2020 2020 2020  .show()..#      
+00016200: 2020 2020 2020 2020 2020 2023 6178 5b69             #ax[i
+00016210: 5d2e 7368 6f77 2829 0d0a 0d0a 0d0a 0d0a  ].show()........
+00016220: 0d0a 0d0a 2020 2020 2320 6465 6620 706c  ....    # def pl
+00016230: 6f74 5f73 7065 6374 7261 2873 656c 662c  ot_spectra(self,
+00016240: 2070 6174 7465 726e 735f 7374 7275 6374   patterns_struct
+00016250: 2c20 636f 6d70 6f6e 656e 745f 696e 642c  , component_ind,
+00016260: 2061 782c 2066 733d 4e6f 6e65 2c20 6c6f   ax, fs=None, lo
+00016270: 6167 3d46 616c 7365 293a 0d0a 2020 2020  ag=False):..    
+00016280: 2320 2020 2020 2222 2252 656c 6174 6976  #     """Relativ
+00016290: 6520 706f 7765 7220 7370 6563 7472 6120  e power spectra 
+000162a0: 6f66 2061 2067 6976 656e 206c 6174 656e  of a given laten
+000162b0: 7420 636f 6d70 6f6e 656e 6465 2062 6566  t componende bef
+000162c0: 6f72 6520 616e 6420 6166 7465 720d 0a20  ore and after.. 
+000162d0: 2020 2023 2020 2020 2020 2020 6170 706c     #        appl
+000162e0: 7969 6e67 2074 6865 2063 6f6e 766f 6c75  ying the convolu
+000162f0: 7469 6f6e 2e0d 0a0d 0a20 2020 2023 2020  tion.....    #  
+00016300: 2020 2050 6172 616d 6574 6572 730d 0a20     Parameters.. 
+00016310: 2020 2023 2020 2020 202d 2d2d 2d2d 2d2d     #     -------
+00016320: 2d2d 2d0d 0a0d 0a20 2020 2023 2020 2020  ---....    #    
+00016330: 2070 6174 7465 726e 735f 7374 7275 6374   patterns_struct
+00016340: 203a 0d0a 2020 2020 2320 2020 2020 2020   :..    #       
+00016350: 2020 696e 7374 616e 6365 206f 6620 7061    instance of pa
+00016360: 7474 6572 6e73 5f73 7472 7563 7420 7072  tterns_struct pr
+00016370: 6f64 7563 6564 2062 7920 6d6f 6465 6c2e  oduced by model.
+00016380: 636f 6d70 7574 655f 7061 7474 6572 6e73  compute_patterns
+00016390: 0d0a 0d0a 2020 2020 2320 2020 2020 6178  ....    #     ax
+000163a0: 203a 2061 7865 730d 0a0d 0a20 2020 2023   : axes....    #
+000163b0: 2020 2020 2066 7320 3a20 666c 6f61 740d       fs : float.
+000163c0: 0a20 2020 2023 2020 2020 2020 2020 2053  .    #         S
+000163d0: 616d 706c 696e 6720 6672 6571 7565 6e63  ampling frequenc
+000163e0: 792e 0d0a 0d0a 2020 2020 2320 2020 2020  y.....    #     
+000163f0: 6c6f 6720 3a20 626f 6f6c 0d0a 2020 2020  log : bool..    
+00016400: 2320 2020 2020 2020 2020 4170 706c 7920  #         Apply 
+00016410: 6c6f 672d 7472 616e 7366 6f72 6d20 746f  log-transform to
+00016420: 2074 6865 2073 7065 6374 7261 2e0d 0a0d   the spectra....
+00016430: 0a0d 0a0d 0a20 2020 2023 2020 2020 2022  .....    #     "
+00016440: 2222 0d0a 0d0a 2020 2020 2320 2020 2020  ""....    #     
+00016450: 6966 206e 6f74 2066 733a 0d0a 2020 2020  if not fs:..    
+00016460: 2320 2020 2020 2020 2070 7269 6e74 2827  #        print('
+00016470: 5361 6d70 6c69 6e67 2066 7265 7175 656e  Sampling frequen
+00016480: 6379 206e 6f74 2073 7065 6369 6669 6564  cy not specified
+00016490: 2c20 7365 7474 696e 6720 746f 2031 2e27  , setting to 1.'
+000164a0: 290d 0a20 2020 2023 2020 2020 2020 2020  )..    #        
+000164b0: 7365 6c66 2e66 7320 3d20 312e 0d0a 0d0a  self.fs = 1.....
+000164c0: 2020 2020 2320 2020 2020 6669 6c74 6572      #     filter
+000164d0: 7320 3d20 7061 7474 6572 6e73 5f73 7472  s = patterns_str
+000164e0: 7563 745b 2777 6569 6768 7473 275d 5b27  uct['weights']['
+000164f0: 7463 6f6e 7627 5d5b 3a2c 2063 6f6d 706f  tconv'][:, compo
+00016500: 6e65 6e74 5f69 6e64 5d0d 0a20 2020 2023  nent_ind]..    #
+00016510: 2020 2020 2070 5f69 6e70 7574 203d 2070       p_input = p
+00016520: 6174 7465 726e 735f 7374 7275 6374 5b27  atterns_struct['
+00016530: 7370 6563 7472 6127 5d5b 2770 7364 7327  spectra']['psds'
+00016540: 5d5b 636f 6d70 6f6e 656e 745f 696e 642c  ][component_ind,
+00016550: 203a 5d0d 0a0d 0a20 2020 2023 2020 2020   :]....    #    
+00016560: 2077 2c20 6820 3d20 6672 6571 7a28 6669   w, h = freqz(fi
+00016570: 6c74 6572 732c 2031 2c20 776f 724e 3d73  lters, 1, worN=s
+00016580: 656c 662e 6e66 6674 290d 0a20 2020 2023  elf.nfft)..    #
+00016590: 2020 2020 2066 7231 203d 2077 2f6e 702e       fr1 = w/np.
+000165a0: 7069 2a73 656c 662e 6673 2f32 0d0a 2020  pi*self.fs/2..  
+000165b0: 2020 2320 2020 2020 6830 203d 2070 5f69    #     h0 = p_i
+000165c0: 6e70 7574 2a6e 702e 6162 7328 6829 0d0a  nput*np.abs(h)..
+000165d0: 0d0a 0d0a 2020 2020 2320 2020 2020 6966  ....    #     if
+000165e0: 206c 6f67 3a0d 0a20 2020 2023 2020 2020   log:..    #    
+000165f0: 2020 2020 2061 785b 692c 206a 6a5d 2e73       ax[i, jj].s
+00016600: 656d 696c 6f67 7928 6672 312c 2070 5f69  emilogy(fr1, p_i
+00016610: 6e70 7574 2f70 5f69 6e70 7574 2e73 756d  nput/p_input.sum
+00016620: 2829 2c0d 0a20 2020 2023 2020 2020 2020  (),..    #      
+00016630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016640: 2020 2020 2020 6c61 6265 6c3d 2746 696c        label='Fil
+00016650: 7465 7220 696e 7075 7420 5250 5327 290d  ter input RPS').
+00016660: 0a20 2020 2023 2020 2020 2020 2020 2061  .    #         a
+00016670: 785b 692c 206a 6a5d 2e73 656d 696c 6f67  x[i, jj].semilog
+00016680: 7928 6672 312c 2068 302f 6830 2e73 756d  y(fr1, h0/h0.sum
+00016690: 2829 2c0d 0a20 2020 2023 2020 2020 2020  (),..    #      
+000166a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000166b0: 2020 2020 2020 6c61 6265 6c3d 2746 6974        label='Fit
+000166c0: 6c65 7220 6f75 7470 7574 2052 5053 2729  ler output RPS')
+000166d0: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
+000166e0: 6178 5b69 2c20 6a6a 5d2e 7365 6d69 6c6f  ax[i, jj].semilo
+000166f0: 6779 2866 7231 2c20 6e70 2e61 6273 2868  gy(fr1, np.abs(h
+00016700: 292f 6e70 2e61 6273 2868 292e 7375 6d28  )/np.abs(h).sum(
+00016710: 292c 0d0a 2020 2020 2320 2020 2020 2020  ),..    #       
+00016720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016730: 2020 2020 206c 6162 656c 3d27 4672 6571       label='Freq
+00016740: 2072 6573 706f 6e73 6520 5250 5327 290d   response RPS').
+00016750: 0a20 2020 2023 2020 2020 2065 6c73 653a  .    #     else:
+00016760: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
+00016770: 6178 5b69 2c20 6a6a 5d2e 706c 6f74 2866  ax[i, jj].plot(f
+00016780: 7231 2c20 705f 696e 7075 742f 705f 696e  r1, p_input/p_in
+00016790: 7075 742e 7375 6d28 292c 0d0a 2020 2020  put.sum(),..    
+000167a0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+000167b0: 2020 2020 2020 2020 206c 6162 656c 3d27           label='
+000167c0: 4669 6c74 6572 2069 6e70 7574 2052 5053  Filter input RPS
+000167d0: 2729 0d0a 2020 2020 2320 2020 2020 2020  ')..    #       
+000167e0: 2020 6178 5b69 2c20 6a6a 5d2e 706c 6f74    ax[i, jj].plot
+000167f0: 2866 7231 2c20 6830 2f68 302e 7375 6d28  (fr1, h0/h0.sum(
+00016800: 292c 206c 6162 656c 3d27 4669 746c 6572  ), label='Fitler
+00016810: 206f 7574 7075 7420 5250 5327 290d 0a20   output RPS').. 
+00016820: 2020 2023 2020 2020 2020 2020 2061 785b     #         ax[
+00016830: 692c 206a 6a5d 2e70 6c6f 7428 6672 312c  i, jj].plot(fr1,
+00016840: 206e 702e 6162 7328 6829 2f6e 702e 6162   np.abs(h)/np.ab
+00016850: 7328 6829 2e73 756d 2829 2c0d 0a20 2020  s(h).sum(),..   
+00016860: 2023 2020 2020 2020 2020 2020 2020 2020   #              
+00016870: 2020 2020 2020 2020 2020 6c61 6265 6c3d            label=
+00016880: 2746 7265 7120 7265 7370 6f6e 7365 2729  'Freq response')
+00016890: 0d0a 2020 2020 2320 2020 2020 2370 7269  ..    #     #pri
+000168a0: 6e74 286e 702e 616c 6c28 6e70 2e72 6f75  nt(np.all(np.rou
+000168b0: 6e64 2866 725b 3a2d 315d 2c20 2d34 2920  nd(fr[:-1], -4) 
+000168c0: 3d3d 206e 702e 726f 756e 6428 6672 312c  == np.round(fr1,
+000168d0: 202d 3429 2929 0d0a 0d0a 0d0a 2020 2020   -4)))......    
+000168e0: 2320 6178 5b69 2c20 6a6a 5d2e 7365 745f  # ax[i, jj].set_
+000168f0: 786c 696d 2830 2c20 3735 2e29 0d0a 2020  xlim(0, 75.)..  
+00016900: 2020 2320 2361 785b 692c 206a 6a5d 2e73    # #ax[i, jj].s
+00016910: 6574 5f78 6c69 6d28 302c 2037 352e 290d  et_xlim(0, 75.).
+00016920: 0a20 2020 2023 2069 6620 6920 3d3d 2030  .    # if i == 0
+00016930: 2061 6e64 206a 6a20 3d3d 206e 636f 6c73   and jj == ncols
+00016940: 2d31 3a0d 0a20 2020 2023 2020 2020 2061  -1:..    #     a
+00016950: 785b 692c 206a 6a5d 2e6c 6567 656e 6428  x[i, jj].legend(
+00016960: 6672 616d 656f 6e3d 4661 6c73 6529 0d0a  frameon=False)..
+00016970: 2020 2020 2320 7265 7475 726e 2066 0d0a      # return f..
+00016980: 0d0a 0d0a 636c 6173 7320 5641 5243 4e4e  ....class VARCNN
+00016990: 2842 6173 654d 6f64 656c 293a 0d0a 2020  (BaseModel):..  
+000169a0: 2020 2222 2256 4152 2d43 4e4e 2e0d 0a0d    """VAR-CNN....
+000169b0: 0a20 2020 2046 6f72 2064 6574 6169 6c73  .    For details
+000169c0: 2073 6565 205b 315d 2e0d 0a0d 0a20 2020   see [1].....   
+000169d0: 2052 6566 6572 656e 6365 730d 0a20 2020   References..   
+000169e0: 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020   ----------..   
+000169f0: 2020 2020 205b 315d 2049 2e20 5a75 6261       [1] I. Zuba
+00016a00: 7265 762c 2065 7420 616c 2e2c 2041 6461  rev, et al., Ada
+00016a10: 7074 6976 6520 6e65 7572 616c 206e 6574  ptive neural net
+00016a20: 776f 726b 2063 6c61 7373 6966 6965 7220  work classifier 
+00016a30: 666f 720d 0a20 2020 2020 2020 2064 6563  for..        dec
+00016a40: 6f64 696e 6720 4d45 4720 7369 676e 616c  oding MEG signal
+00016a50: 732e 204e 6575 726f 696d 6167 652e 2028  s. Neuroimage. (
+00016a60: 3230 3139 2920 4d61 7920 343b 3139 373a  2019) May 4;197:
+00016a70: 3432 352d 3433 340d 0a20 2020 2022 2222  425-434..    """
+00016a80: 0d0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+00016a90: 5f5f 2873 656c 662c 206d 6574 612c 2064  __(self, meta, d
+00016aa0: 6174 6173 6574 3d4e 6f6e 6529 3a0d 0a20  ataset=None):.. 
+00016ab0: 2020 2020 2020 2022 2222 0d0a 2020 2020         """..    
+00016ac0: 2020 2020 5061 7261 6d65 7465 7273 0d0a      Parameters..
+00016ad0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00016ae0: 2d2d 0d0a 2020 2020 2020 2020 4461 7461  --..        Data
+00016af0: 7365 7420 3a20 6d6e 6566 6c6f 772e 4461  set : mneflow.Da
+00016b00: 7461 7365 740d 0a0d 0a20 2020 2020 2020  taset....       
+00016b10: 2073 7065 6373 203a 2064 6963 740d 0a20   specs : dict.. 
+00016b20: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00016b30: 6963 7469 6f6e 6172 7920 6f66 206d 6f64  ictionary of mod
+00016b40: 656c 2068 7970 6572 7061 7261 6d65 7465  el hyperparamete
+00016b50: 7273 207b 0d0a 0d0a 2020 2020 2020 2020  rs {....        
+00016b60: 6e5f 6c61 7465 6e74 203a 2069 6e74 0d0a  n_latent : int..
+00016b70: 2020 2020 2020 2020 2020 2020 4e75 6d62              Numb
+00016b80: 6572 206f 6620 6c61 7465 6e74 2063 6f6d  er of latent com
+00016b90: 706f 6e65 6e74 732e 0d0a 2020 2020 2020  ponents...      
+00016ba0: 2020 2020 2020 4465 6661 756c 7473 2074        Defaults t
+00016bb0: 6f20 3332 2e0d 0a0d 0a20 2020 2020 2020  o 32.....       
+00016bc0: 206e 6f6e 6c69 6e20 3a20 6361 6c6c 6162   nonlin : callab
+00016bd0: 6c65 0d0a 2020 2020 2020 2020 2020 2020  le..            
+00016be0: 4163 7469 7661 7469 6f6e 2066 756e 6374  Activation funct
+00016bf0: 696f 6e20 6f66 2074 6865 2074 656d 706f  ion of the tempo
+00016c00: 7261 6c20 636f 6e76 6f6c 7574 696f 6e20  ral convolution 
+00016c10: 6c61 7965 722e 0d0a 2020 2020 2020 2020  layer...        
+00016c20: 2020 2020 4465 6661 756c 7473 2074 6f20      Defaults to 
+00016c30: 7466 2e6e 6e2e 7265 6c75 0d0a 0d0a 2020  tf.nn.relu....  
+00016c40: 2020 2020 2020 6669 6c74 6572 5f6c 656e        filter_len
+00016c50: 6774 6820 3a20 696e 740d 0a20 2020 2020  gth : int..     
+00016c60: 2020 2020 2020 204c 656e 6774 6820 6f66         Length of
+00016c70: 2073 7061 7469 6f2d 7465 6d70 6f72 616c   spatio-temporal
+00016c80: 206b 6572 6e65 6c73 2069 6e20 7468 6520   kernels in the 
+00016c90: 7465 6d70 6f72 616c 0d0a 2020 2020 2020  temporal..      
+00016ca0: 2020 2020 2020 636f 6e76 6f6c 7574 696f        convolutio
+00016cb0: 6e20 6c61 7965 722e 2044 6566 6175 6c74  n layer. Default
+00016cc0: 7320 746f 2037 2e0d 0a0d 0a20 2020 2020  s to 7.....     
+00016cd0: 2020 2070 6f6f 6c69 6e67 203a 2069 6e74     pooling : int
+00016ce0: 0d0a 2020 2020 2020 2020 2020 2020 506f  ..            Po
+00016cf0: 6f6c 696e 6720 6661 6374 6f72 206f 6620  oling factor of 
+00016d00: 7468 6520 6d61 7820 706f 6f6c 696e 6720  the max pooling 
+00016d10: 6c61 7965 722e 2044 6566 6175 6c74 7320  layer. Defaults 
+00016d20: 746f 2032 0d0a 0d0a 2020 2020 2020 2020  to 2....        
+00016d30: 706f 6f6c 5f74 7970 6520 3a20 7374 7220  pool_type : str 
+00016d40: 7b27 6176 6727 2c20 276d 6178 277d 0d0a  {'avg', 'max'}..
+00016d50: 2020 2020 2020 2020 2020 2020 5479 7065              Type
+00016d60: 206f 6620 706f 6f6c 696e 6720 6f70 6572   of pooling oper
+00016d70: 6174 696f 6e2e 2044 6566 6175 6c74 7320  ation. Defaults 
+00016d80: 746f 2027 6d61 7827 2e0d 0a0d 0a20 2020  to 'max'.....   
+00016d90: 2020 2020 2070 6164 6469 6e67 203a 2073       padding : s
+00016da0: 7472 207b 2753 414d 4527 2c20 2746 554c  tr {'SAME', 'FUL
+00016db0: 4c27 2c20 2756 414c 4944 277d 0d0a 2020  L', 'VALID'}..  
+00016dc0: 2020 2020 2020 2020 2020 436f 6e76 6f6c            Convol
+00016dd0: 7574 696f 6e20 7061 6464 696e 672e 2044  ution padding. D
+00016de0: 6566 6175 6c74 7320 746f 2027 5341 4d45  efaults to 'SAME
+00016df0: 272e 7d22 2222 0d0a 2020 2020 2020 2020  '.}"""..        
+00016e00: 7365 6c66 2e73 636f 7065 203d 2027 7661  self.scope = 'va
+00016e10: 7263 6e6e 270d 0a20 2020 2020 2020 206d  rcnn'..        m
+00016e20: 6574 612e 6d6f 6465 6c5f 7370 6563 732e  eta.model_specs.
+00016e30: 7365 7464 6566 6175 6c74 2827 6669 6c74  setdefault('filt
+00016e40: 6572 5f6c 656e 6774 6827 2c20 3729 0d0a  er_length', 7)..
+00016e50: 2020 2020 2020 2020 6d65 7461 2e6d 6f64          meta.mod
+00016e60: 656c 5f73 7065 6373 2e73 6574 6465 6661  el_specs.setdefa
+00016e70: 756c 7428 276e 5f6c 6174 656e 7427 2c20  ult('n_latent', 
+00016e80: 3332 290d 0a20 2020 2020 2020 206d 6574  32)..        met
+00016e90: 612e 6d6f 6465 6c5f 7370 6563 732e 7365  a.model_specs.se
+00016ea0: 7464 6566 6175 6c74 2827 706f 6f6c 696e  tdefault('poolin
+00016eb0: 6727 2c20 3229 0d0a 2020 2020 2020 2020  g', 2)..        
+00016ec0: 6d65 7461 2e6d 6f64 656c 5f73 7065 6373  meta.model_specs
+00016ed0: 2e73 6574 6465 6661 756c 7428 2773 7472  .setdefault('str
+00016ee0: 6964 6527 2c20 3229 0d0a 2020 2020 2020  ide', 2)..      
+00016ef0: 2020 6d65 7461 2e6d 6f64 656c 5f73 7065    meta.model_spe
+00016f00: 6373 2e73 6574 6465 6661 756c 7428 2770  cs.setdefault('p
+00016f10: 6164 6469 6e67 272c 2027 5341 4d45 2729  adding', 'SAME')
+00016f20: 0d0a 2020 2020 2020 2020 6d65 7461 2e6d  ..        meta.m
+00016f30: 6f64 656c 5f73 7065 6373 2e73 6574 6465  odel_specs.setde
+00016f40: 6661 756c 7428 2770 6f6f 6c5f 7479 7065  fault('pool_type
+00016f50: 272c 2027 6d61 7827 290d 0a20 2020 2020  ', 'max')..     
+00016f60: 2020 206d 6574 612e 6d6f 6465 6c5f 7370     meta.model_sp
+00016f70: 6563 732e 7365 7464 6566 6175 6c74 2827  ecs.setdefault('
+00016f80: 6e6f 6e6c 696e 272c 2074 662e 6e6e 2e72  nonlin', tf.nn.r
+00016f90: 656c 7529 0d0a 2020 2020 2020 2020 6d65  elu)..        me
+00016fa0: 7461 2e6d 6f64 656c 5f73 7065 6373 2e73  ta.model_specs.s
+00016fb0: 6574 6465 6661 756c 7428 276c 315f 6c61  etdefault('l1_la
+00016fc0: 6d62 6461 272c 2033 652d 3429 0d0a 2020  mbda', 3e-4)..  
+00016fd0: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
+00016fe0: 5f73 7065 6373 2e73 6574 6465 6661 756c  _specs.setdefaul
+00016ff0: 7428 276c 325f 6c61 6d62 6461 272c 2030  t('l2_lambda', 0
+00017000: 290d 0a20 2020 2020 2020 206d 6574 612e  )..        meta.
+00017010: 6d6f 6465 6c5f 7370 6563 732e 7365 7464  model_specs.setd
+00017020: 6566 6175 6c74 2827 6c31 5f73 636f 7065  efault('l1_scope
+00017030: 272c 205b 2766 6327 2c20 2764 656d 6978  ', ['fc', 'demix
+00017040: 272c 2027 6c66 5f63 6f6e 7627 5d29 0d0a  ', 'lf_conv'])..
+00017050: 2020 2020 2020 2020 6d65 7461 2e6d 6f64          meta.mod
+00017060: 656c 5f73 7065 6373 2e73 6574 6465 6661  el_specs.setdefa
+00017070: 756c 7428 276c 325f 7363 6f70 6527 2c20  ult('l2_scope', 
+00017080: 5b5d 290d 0a20 2020 2020 2020 206d 6574  [])..        met
+00017090: 612e 6d6f 6465 6c5f 7370 6563 732e 7365  a.model_specs.se
+000170a0: 7464 6566 6175 6c74 2827 756e 6974 6e6f  tdefault('unitno
+000170b0: 726d 5f73 636f 7065 272c 205b 5d29 0d0a  rm_scope', [])..
+000170c0: 2020 2020 2020 2020 6d65 7461 2e6d 6f64          meta.mod
+000170d0: 656c 5f73 7065 6373 5b27 7363 6f70 6527  el_specs['scope'
+000170e0: 5d20 3d20 7365 6c66 2e73 636f 7065 0d0a  ] = self.scope..
+000170f0: 2020 2020 2020 2020 7375 7065 7228 5641          super(VA
+00017100: 5243 4e4e 2c20 7365 6c66 292e 5f5f 696e  RCNN, self).__in
+00017110: 6974 5f5f 286d 6574 612c 2064 6174 6173  it__(meta, datas
+00017120: 6574 290d 0a0d 0a20 2020 2064 6566 2062  et)....    def b
+00017130: 7569 6c64 5f67 7261 7068 2873 656c 6629  uild_graph(self)
+00017140: 3a0d 0a20 2020 2020 2020 2022 2222 4275  :..        """Bu
+00017150: 696c 6420 636f 6d70 7574 6174 696f 6e61  ild computationa
+00017160: 6c20 6772 6170 6820 7573 696e 6720 6465  l graph using de
+00017170: 6669 6e65 6420 706c 6163 6568 6f6c 6465  fined placeholde
+00017180: 7220 6073 656c 662e 5860 0d0a 2020 2020  r `self.X`..    
+00017190: 2020 2020 6173 2069 6e70 7574 2e0d 0a0d      as input....
+000171a0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+000171b0: 0d0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  ..        ------
+000171c0: 2d2d 0d0a 2020 2020 2020 2020 795f 7072  --..        y_pr
+000171d0: 6564 203a 2074 662e 5465 6e73 6f72 0d0a  ed : tf.Tensor..
+000171e0: 2020 2020 2020 2020 2020 2020 4f75 7470              Outp
+000171f0: 7574 206f 6620 7468 6520 666f 7277 6172  ut of the forwar
+00017200: 6420 7061 7373 206f 6620 7468 6520 636f  d pass of the co
+00017210: 6d70 7574 6174 696f 6e61 6c20 6772 6170  mputational grap
+00017220: 682e 0d0a 2020 2020 2020 2020 2020 2020  h...            
+00017230: 5072 6564 6963 7469 6f6e 206f 6620 7468  Prediction of th
+00017240: 6520 7461 7267 6574 2076 6172 6961 626c  e target variabl
+00017250: 652e 0d0a 2020 2020 2020 2020 2222 220d  e...        """.
+00017260: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00017270: 646d 7820 3d20 4465 4d69 7869 6e67 2873  dmx = DeMixing(s
+00017280: 697a 653d 7365 6c66 2e73 7065 6373 5b27  ize=self.specs['
+00017290: 6e5f 6c61 7465 6e74 275d 2c20 6e6f 6e6c  n_latent'], nonl
+000172a0: 696e 3d74 662e 6964 656e 7469 7479 2c0d  in=tf.identity,.
+000172b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000172c0: 2020 2020 2020 2020 2020 2020 2061 7869               axi
+000172d0: 733d 332c 2073 7065 6373 3d73 656c 662e  s=3, specs=self.
+000172e0: 7370 6563 7329 2873 656c 662e 696e 7075  specs)(self.inpu
+000172f0: 7473 290d 0a0d 0a0d 0a20 2020 2020 2020  ts)......       
+00017300: 2073 656c 662e 7463 6f6e 7620 3d20 5641   self.tconv = VA
+00017310: 5243 6f6e 7628 7369 7a65 3d73 656c 662e  RConv(size=self.
+00017320: 7370 6563 735b 276e 5f6c 6174 656e 7427  specs['n_latent'
+00017330: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+00017340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017350: 206e 6f6e 6c69 6e3d 7365 6c66 2e73 7065   nonlin=self.spe
+00017360: 6373 5b27 6e6f 6e6c 696e 275d 2c0d 0a20  cs['nonlin'],.. 
 00017370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017390: 2020 7374 7269 6465 3d73 656c 662e 7370    stride=self.sp
-000173a0: 6563 735b 2773 7472 6964 6527 5d2c 0d0a  ecs['stride'],..
-000173b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017380: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
+00017390: 6572 5f6c 656e 6774 683d 7365 6c66 2e73  er_length=self.s
+000173a0: 7065 6373 5b27 6669 6c74 6572 5f6c 656e  pecs['filter_len
+000173b0: 6774 6827 5d2c 0d0a 2020 2020 2020 2020  gth'],..        
 000173c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000173d0: 2020 7061 6464 696e 673d 7365 6c66 2e73    padding=self.s
-000173e0: 7065 6373 5b27 7061 6464 696e 6727 5d2c  pecs['padding'],
-000173f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000173d0: 2020 2020 2070 6164 6469 6e67 3d73 656c       padding=sel
+000173e0: 662e 7370 6563 735b 2770 6164 6469 6e67  f.specs['padding
+000173f0: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
 00017400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017410: 2020 2020 2928 7365 6c66 2e74 636f 6e76      )(self.tconv
-00017420: 290d 0a0d 0a20 2020 2020 2020 2064 726f  )....        dro
-00017430: 706f 7574 203d 2044 726f 706f 7574 2873  pout = Dropout(s
-00017440: 656c 662e 7370 6563 735b 2764 726f 706f  elf.specs['dropo
-00017450: 7574 275d 2c0d 0a20 2020 2020 2020 2020  ut'],..         
-00017460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017470: 206e 6f69 7365 5f73 6861 7065 3d4e 6f6e   noise_shape=Non
-00017480: 6529 2873 656c 662e 706f 6f6c 6564 290d  e)(self.pooled).
-00017490: 0a0d 0a20 2020 2020 2020 2023 6663 3120  ...        #fc1 
-000174a0: 3d20 4675 6c6c 7943 6f6e 6e65 6374 6564  = FullyConnected
-000174b0: 2873 697a 653d 3132 382c 206e 6f6e 6c69  (size=128, nonli
-000174c0: 6e3d 7466 2e6e 6e2e 656c 752c 0d0a 2020  n=tf.nn.elu,..  
-000174d0: 2020 2020 2020 2320 2020 2020 2020 2020        #         
-000174e0: 2020 2020 2020 2020 2020 2073 7065 6373             specs
-000174f0: 3d73 656c 662e 7370 6563 7329 2864 726f  =self.specs)(dro
-00017500: 706f 7574 290d 0a0d 0a20 2020 2020 2020  pout)....       
-00017510: 2073 656c 662e 6669 6e5f 6663 203d 2046   self.fin_fc = F
-00017520: 756c 6c79 436f 6e6e 6563 7465 6428 7369  ullyConnected(si
-00017530: 7a65 3d73 656c 662e 6f75 745f 6469 6d2c  ze=self.out_dim,
-00017540: 206e 6f6e 6c69 6e3d 7466 2e69 6465 6e74   nonlin=tf.ident
-00017550: 6974 792c 0d0a 2020 2020 2020 2020 2020  ity,..          
+00017410: 2020 7370 6563 733d 7365 6c66 2e73 7065    specs=self.spe
+00017420: 6373 0d0a 2020 2020 2020 2020 2020 2020  cs..            
+00017430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017440: 2029 2873 656c 662e 646d 7829 0d0a 0d0a   )(self.dmx)....
+00017450: 2020 2020 2020 2020 7365 6c66 2e70 6f6f          self.poo
+00017460: 6c65 6420 3d20 5465 6d70 506f 6f6c 696e  led = TempPoolin
+00017470: 6728 706f 6f6c 696e 673d 7365 6c66 2e73  g(pooling=self.s
+00017480: 7065 6373 5b27 706f 6f6c 696e 6727 5d2c  pecs['pooling'],
+00017490: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000174a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000174b0: 2020 2020 706f 6f6c 5f74 7970 653d 7365      pool_type=se
+000174c0: 6c66 2e73 7065 6373 5b27 706f 6f6c 5f74  lf.specs['pool_t
+000174d0: 7970 6527 5d2c 0d0a 2020 2020 2020 2020  ype'],..        
+000174e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000174f0: 2020 2020 2020 2020 2020 7374 7269 6465            stride
+00017500: 3d73 656c 662e 7370 6563 735b 2773 7472  =self.specs['str
+00017510: 6964 6527 5d2c 0d0a 2020 2020 2020 2020  ide'],..        
+00017520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017530: 2020 2020 2020 2020 2020 7061 6464 696e            paddin
+00017540: 673d 7365 6c66 2e73 7065 6373 5b27 7061  g=self.specs['pa
+00017550: 6464 696e 6727 5d2c 0d0a 2020 2020 2020  dding'],..      
 00017560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017570: 2020 7370 6563 733d 7365 6c66 2e73 7065    specs=self.spe
-00017580: 6373 290d 0a0d 0a20 2020 2020 2020 2079  cs)....        y
-00017590: 5f70 7265 6420 3d20 7365 6c66 2e66 696e  _pred = self.fin
-000175a0: 5f66 6328 6472 6f70 6f75 7429 0d0a 0d0a  _fc(dropout)....
-000175b0: 2020 2020 2020 2020 7265 7475 726e 2079          return y
-000175c0: 5f70 7265 640d 0a0d 0a0d 0a0d 0a63 6c61  _pred........cla
-000175d0: 7373 2046 4243 5350 5f53 6861 6c6c 6f77  ss FBCSP_Shallow
-000175e0: 4e65 7428 4261 7365 4d6f 6465 6c29 3a0d  Net(BaseModel):.
-000175f0: 0a20 2020 2022 2222 0d0a 2020 2020 5368  .    """..    Sh
-00017600: 616c 6c6f 7720 436f 6e76 4e65 7420 6d6f  allow ConvNet mo
-00017610: 6465 6c20 6672 6f6d 205b 3261 5d5f 2e0d  del from [2a]_..
-00017620: 0a20 2020 2052 6566 6572 656e 6365 730d  .    References.
-00017630: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d  .    ----------.
-00017640: 0a20 2020 202e 2e20 5b32 615d 2053 6368  .    .. [2a] Sch
-00017650: 6972 726d 6569 7374 6572 2c20 522e 2054  irrmeister, R. T
-00017660: 2e2c 2053 7072 696e 6765 6e62 6572 672c  ., Springenberg,
-00017670: 204a 2e20 542e 2c20 4669 6564 6572 6572   J. T., Fiederer
-00017680: 2c20 4c2e 2044 2e20 4a2e 2c0d 0a20 2020  , L. D. J.,..   
-00017690: 2020 2020 476c 6173 7374 6574 7465 722c      Glasstetter,
-000176a0: 204d 2e2c 2045 6767 656e 7370 6572 6765   M., Eggensperge
-000176b0: 722c 204b 2e2c 2054 616e 6765 726d 616e  r, K., Tangerman
-000176c0: 6e2c 204d 2e2c 2048 7574 7465 722c 2046  n, M., Hutter, F
-000176d0: 2e20 2620 4261 6c6c 2c20 542e 2028 3230  . & Ball, T. (20
-000176e0: 3137 292e 0d0a 2020 2020 2020 2044 6565  17)...       Dee
-000176f0: 7020 6c65 6172 6e69 6e67 2077 6974 6820  p learning with 
-00017700: 636f 6e76 6f6c 7574 696f 6e61 6c20 6e65  convolutional ne
-00017710: 7572 616c 206e 6574 776f 726b 7320 666f  ural networks fo
-00017720: 7220 4545 4720 6465 636f 6469 6e67 2061  r EEG decoding a
-00017730: 6e64 0d0a 2020 2020 2020 2076 6973 7561  nd..       visua
-00017740: 6c69 7a61 7469 6f6e 2e0d 0a20 2020 2020  lization...     
-00017750: 2020 4875 6d61 6e20 4272 6169 6e20 4d61    Human Brain Ma
-00017760: 7070 696e 6720 2c20 4175 672e 2032 3031  pping , Aug. 201
-00017770: 372e 204f 6e6c 696e 653a 2068 7474 703a  7. Online: http:
-00017780: 2f2f 6478 2e64 6f69 2e6f 7267 2f31 302e  //dx.doi.org/10.
-00017790: 3130 3032 2f68 626d 2e32 3337 3330 0d0a  1002/hbm.23730..
-000177a0: 2020 2020 2222 220d 0a20 2020 2064 6566      """..    def
-000177b0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-000177c0: 6d65 7461 2c20 6461 7461 7365 743d 4e6f  meta, dataset=No
-000177d0: 6e65 293a 0d0a 2020 2020 2020 2020 7365  ne):..        se
-000177e0: 6c66 2e73 636f 7065 203d 2027 6662 6373  lf.scope = 'fbcs
-000177f0: 702d 5368 616c 6c6f 774e 6574 270d 0a20  p-ShallowNet'.. 
-00017800: 2020 2020 2020 206d 6574 612e 6d6f 6465         meta.mode
-00017810: 6c5f 7370 6563 732e 7365 7464 6566 6175  l_specs.setdefau
-00017820: 6c74 2827 6669 6c74 6572 5f6c 656e 6774  lt('filter_lengt
-00017830: 6827 2c20 3235 290d 0a20 2020 2020 2020  h', 25)..       
-00017840: 206d 6574 612e 6d6f 6465 6c5f 7370 6563   meta.model_spec
-00017850: 732e 7365 7464 6566 6175 6c74 2827 6e5f  s.setdefault('n_
-00017860: 6c61 7465 6e74 272c 2034 3029 0d0a 2020  latent', 40)..  
-00017870: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
-00017880: 5f73 7065 6373 2e73 6574 6465 6661 756c  _specs.setdefaul
-00017890: 7428 2770 6f6f 6c69 6e67 272c 2037 3529  t('pooling', 75)
-000178a0: 0d0a 2020 2020 2020 2020 6d65 7461 2e6d  ..        meta.m
-000178b0: 6f64 656c 5f73 7065 6373 2e73 6574 6465  odel_specs.setde
-000178c0: 6661 756c 7428 2773 7472 6964 6527 2c20  fault('stride', 
-000178d0: 3135 290d 0a20 2020 2020 2020 206d 6574  15)..        met
-000178e0: 612e 6d6f 6465 6c5f 7370 6563 732e 7365  a.model_specs.se
-000178f0: 7464 6566 6175 6c74 2827 706f 6f6c 5f74  tdefault('pool_t
-00017900: 7970 6527 2c20 2761 7667 2729 0d0a 2020  ype', 'avg')..  
-00017910: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
-00017920: 5f73 7065 6373 2e73 6574 6465 6661 756c  _specs.setdefaul
-00017930: 7428 2770 6164 6469 6e67 272c 2027 5341  t('padding', 'SA
-00017940: 4d45 2729 0d0a 2020 2020 2020 2020 6d65  ME')..        me
-00017950: 7461 2e6d 6f64 656c 5f73 7065 6373 2e73  ta.model_specs.s
-00017960: 6574 6465 6661 756c 7428 276e 6f6e 6c69  etdefault('nonli
-00017970: 6e27 2c20 7466 2e6e 6e2e 7265 6c75 290d  n', tf.nn.relu).
-00017980: 0a20 2020 2020 2020 206d 6574 612e 6d6f  .        meta.mo
-00017990: 6465 6c5f 7370 6563 732e 7365 7464 6566  del_specs.setdef
-000179a0: 6175 6c74 2827 6c31 5f6c 616d 6264 6127  ault('l1_lambda'
-000179b0: 2c20 3365 2d34 290d 0a20 2020 2020 2020  , 3e-4)..       
-000179c0: 206d 6574 612e 6d6f 6465 6c5f 7370 6563   meta.model_spec
-000179d0: 732e 7365 7464 6566 6175 6c74 2827 6c32  s.setdefault('l2
-000179e0: 5f6c 616d 6264 6127 2c20 3365 2d32 290d  _lambda', 3e-2).
-000179f0: 0a20 2020 2020 2020 206d 6574 612e 6d6f  .        meta.mo
-00017a00: 6465 6c5f 7370 6563 732e 7365 7464 6566  del_specs.setdef
-00017a10: 6175 6c74 2827 6c31 5f73 636f 7065 272c  ault('l1_scope',
-00017a20: 205b 5d29 0d0a 2020 2020 2020 2020 6d65   [])..        me
-00017a30: 7461 2e6d 6f64 656c 5f73 7065 6373 2e73  ta.model_specs.s
-00017a40: 6574 6465 6661 756c 7428 276c 325f 7363  etdefault('l2_sc
-00017a50: 6f70 6527 2c20 5b27 636f 6e76 272c 2027  ope', ['conv', '
-00017a60: 6663 275d 290d 0a0d 0a20 2020 2020 2020  fc'])....       
-00017a70: 206d 6574 612e 6d6f 6465 6c5f 7370 6563   meta.model_spec
-00017a80: 732e 7365 7464 6566 6175 6c74 2827 756e  s.setdefault('un
-00017a90: 6974 6e6f 726d 5f73 636f 7065 272c 205b  itnorm_scope', [
-00017aa0: 5d29 0d0a 2020 2020 2020 2020 2373 7065  ])..        #spe
-00017ab0: 6373 2e73 6574 6465 6661 756c 7428 276d  cs.setdefault('m
-00017ac0: 6f64 656c 5f70 6174 6827 2c20 6f73 2e70  odel_path', os.p
-00017ad0: 6174 682e 6a6f 696e 2873 656c 662e 6461  ath.join(self.da
-00017ae0: 7461 7365 742e 685f 7061 7261 6d73 5b27  taset.h_params['
-00017af0: 7061 7468 275d 2c20 276d 6f64 656c 7327  path'], 'models'
-00017b00: 2929 0d0a 2020 2020 2020 2020 7375 7065  ))..        supe
-00017b10: 7228 4642 4353 505f 5368 616c 6c6f 774e  r(FBCSP_ShallowN
-00017b20: 6574 2c20 7365 6c66 292e 5f5f 696e 6974  et, self).__init
-00017b30: 5f5f 286d 6574 612c 2064 6174 6173 6574  __(meta, dataset
-00017b40: 290d 0a0d 0a20 2020 2064 6566 2062 7569  )....    def bui
-00017b50: 6c64 5f67 7261 7068 2873 656c 6629 3a0d  ld_graph(self):.
-00017b60: 0a0d 0a20 2020 2020 2020 2022 2222 5465  ...        """Te
-00017b70: 6d70 6f72 616c 2063 6f6e 765f 3120 3235  mporal conv_1 25
-00017b80: 2031 3078 3120 6b65 726e 656c 7322 2222   10x1 kernels"""
-00017b90: 0d0a 2020 2020 2020 2020 2328 7365 6c66  ..        #(self
-00017ba0: 2e69 6e70 7574 7329 0d0a 2020 2020 2020  .inputs)..      
-00017bb0: 2020 696e 7075 7473 203d 2074 662e 7472    inputs = tf.tr
-00017bc0: 616e 7370 6f73 6528 7365 6c66 2e69 6e70  anspose(self.inp
-00017bd0: 7574 732c 5b30 2c33 2c32 2c31 5d29 0d0a  uts,[0,3,2,1])..
-00017be0: 2020 2020 2020 2020 2370 7269 6e74 2869          #print(i
-00017bf0: 6e70 7574 732e 7368 6170 6529 0d0a 2020  nputs.shape)..  
-00017c00: 2020 2020 2020 2364 6620 3d20 2263 6861        #df = "cha
-00017c10: 6e6e 656c 735f 6669 7273 7422 0d0a 2020  nnels_first"..  
-00017c20: 2020 2020 2020 7463 6f6e 7631 203d 2044        tconv1 = D
-00017c30: 6570 7468 7769 7365 436f 6e76 3244 280d  epthwiseConv2D(.
-00017c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017c50: 2020 2020 2020 2020 206b 6572 6e65 6c5f           kernel_
-00017c60: 7369 7a65 3d28 312c 2073 656c 662e 7370  size=(1, self.sp
-00017c70: 6563 735b 2766 696c 7465 725f 6c65 6e67  ecs['filter_leng
-00017c80: 7468 275d 292c 0d0a 2020 2020 2020 2020  th']),..        
-00017c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ca0: 6465 7074 685f 6d75 6c74 6970 6c69 6572  depth_multiplier
-00017cb0: 203d 2073 656c 662e 7370 6563 735b 276e   = self.specs['n
-00017cc0: 5f6c 6174 656e 7427 5d2c 0d0a 2020 2020  _latent'],..    
-00017cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ce0: 2020 2020 7374 7269 6465 733d 312c 0d0a      strides=1,..
-00017cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d00: 2020 2020 2020 2020 7061 6464 696e 673d          padding=
-00017d10: 2256 414c 4944 222c 0d0a 2020 2020 2020  "VALID",..      
-00017d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d30: 2020 6163 7469 7661 7469 6f6e 203d 2074    activation = t
-00017d40: 662e 6964 656e 7469 7479 2c0d 0a20 2020  f.identity,..   
-00017d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017d60: 2020 2020 206b 6572 6e65 6c5f 696e 6974       kernel_init
-00017d70: 6961 6c69 7a65 723d 2268 655f 756e 6966  ializer="he_unif
-00017d80: 6f72 6d22 2c0d 0a20 2020 2020 2020 2020  orm",..         
-00017d90: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00017da0: 6961 735f 696e 6974 6961 6c69 7a65 723d  ias_initializer=
-00017db0: 436f 6e73 7461 6e74 2830 2e31 292c 0d0a  Constant(0.1),..
-00017dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017dd0: 2020 2020 2020 2020 6461 7461 5f66 6f72          data_for
-00017de0: 6d61 743d 2263 6861 6e6e 656c 735f 6c61  mat="channels_la
-00017df0: 7374 222c 0d0a 2020 2020 2020 2020 2020  st",..          
-00017e00: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
-00017e10: 726e 656c 5f72 6567 756c 6172 697a 6572  rnel_regularizer
-00017e20: 3d6b 5f72 6567 2e6c 3228 7365 6c66 2e73  =k_reg.l2(self.s
-00017e30: 7065 6373 5b27 6c32 5f6c 616d 6264 6127  pecs['l2_lambda'
-00017e40: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-00017e50: 2020 2020 2020 2020 2020 2020 236b 6572              #ker
-00017e60: 6e65 6c5f 636f 6e73 7472 6169 6e74 3d22  nel_constraint="
-00017e70: 6d61 786e 6f72 6d22 0d0a 2020 2020 2020  maxnorm"..      
-00017e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e90: 2020 290d 0a0d 0a20 2020 2020 2020 2074    )....        t
-00017ea0: 636f 6e76 315f 6f75 7420 3d20 7463 6f6e  conv1_out = tcon
-00017eb0: 7631 2869 6e70 7574 7329 0d0a 2020 2020  v1(inputs)..    
-00017ec0: 2020 2020 7072 696e 7428 2774 636f 6e76      print('tconv
-00017ed0: 313a 2027 2c20 7463 6f6e 7631 5f6f 7574  1: ', tconv1_out
-00017ee0: 2e73 6861 7065 2920 2373 686f 756c 6420  .shape) #should 
-00017ef0: 6265 206e 5f62 6174 6368 2c20 7365 6e73  be n_batch, sens
-00017f00: 6f72 732c 2074 696d 6573 2c20 6b65 726e  ors, times, kern
-00017f10: 656c 730d 0a0d 0a20 2020 2020 2020 2073  els....        s
-00017f20: 636f 6e76 3120 3d20 436f 6e76 3244 2866  conv1 = Conv2D(f
-00017f30: 696c 7465 7273 3d73 656c 662e 7370 6563  ilters=self.spec
-00017f40: 735b 276e 5f6c 6174 656e 7427 5d2c 0d0a  s['n_latent'],..
-00017f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f60: 2020 2020 2020 2020 6b65 726e 656c 5f73          kernel_s
-00017f70: 697a 653d 2873 656c 662e 6461 7461 7365  ize=(self.datase
-00017f80: 742e 685f 7061 7261 6d73 5b27 6e5f 6368  t.h_params['n_ch
-00017f90: 275d 2c20 3129 2c0d 0a20 2020 2020 2020  '], 1),..       
-00017fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017fb0: 2073 7472 6964 6573 3d31 2c0d 0a20 2020   strides=1,..   
-00017fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017fd0: 2020 2020 2070 6164 6469 6e67 3d22 5641       padding="VA
-00017fe0: 4c49 4422 2c0d 0a20 2020 2020 2020 2020  LID",..         
-00017ff0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00018000: 6374 6976 6174 696f 6e20 3d20 7466 2e73  ctivation = tf.s
-00018010: 7175 6172 652c 0d0a 2020 2020 2020 2020  quare,..        
-00018020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018030: 6b65 726e 656c 5f69 6e69 7469 616c 697a  kernel_initializ
-00018040: 6572 3d22 6865 5f75 6e69 666f 726d 222c  er="he_uniform",
-00018050: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00018060: 2020 2020 2020 2020 2020 6269 6173 5f69            bias_i
-00018070: 6e69 7469 616c 697a 6572 3d43 6f6e 7374  nitializer=Const
-00018080: 616e 7428 302e 3129 2c0d 0a20 2020 2020  ant(0.1),..     
-00018090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000180a0: 2020 2064 6174 615f 666f 726d 6174 3d22     data_format="
-000180b0: 6368 616e 6e65 6c73 5f6c 6173 7422 2c0d  channels_last",.
-000180c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000180d0: 2020 2020 2020 2020 2023 6461 7461 5f66           #data_f
-000180e0: 6f72 6d61 743d 2263 6861 6e6e 656c 735f  ormat="channels_
-000180f0: 6669 7273 7422 2c0d 0a20 2020 2020 2020  first",..       
-00018100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018110: 206b 6572 6e65 6c5f 7265 6775 6c61 7269   kernel_regulari
-00018120: 7a65 723d 6b5f 7265 672e 6c32 2873 656c  zer=k_reg.l2(sel
-00018130: 662e 7370 6563 735b 276c 325f 6c61 6d62  f.specs['l2_lamb
-00018140: 6461 275d 2929 0d0a 0d0a 0d0a 2020 2020  da']))......    
-00018150: 2020 2020 7363 6f6e 7631 5f6f 7574 203d      sconv1_out =
-00018160: 2073 636f 6e76 3128 7463 6f6e 7631 5f6f   sconv1(tconv1_o
-00018170: 7574 290d 0a20 2020 2020 2020 2070 7269  ut)..        pri
-00018180: 6e74 2827 7363 6f6e 7631 3a27 2c20 2073  nt('sconv1:',  s
-00018190: 636f 6e76 315f 6f75 742e 7368 6170 6529  conv1_out.shape)
-000181a0: 0d0a 0d0a 2020 2020 2020 2020 706f 6f6c  ....        pool
-000181b0: 3120 3d20 5465 6d70 506f 6f6c 696e 6728  1 = TempPooling(
-000181c0: 706f 6f6c 696e 673d 7365 6c66 2e73 7065  pooling=self.spe
-000181d0: 6373 5b27 706f 6f6c 696e 6727 5d2c 0d0a  cs['pooling'],..
-000181e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000181f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018200: 2020 706f 6f6c 5f74 7970 653d 2261 7667    pool_type="avg
-00018210: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-00018220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018230: 2020 2020 2020 7374 7269 6465 3d73 656c        stride=sel
-00018240: 662e 7370 6563 735b 2773 7472 6964 6527  f.specs['stride'
-00018250: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-00018260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018270: 2020 2020 2020 7061 6464 696e 673d 2753        padding='S
-00018280: 414d 4527 2c0d 0a20 2020 2020 2020 2020  AME',..         
-00018290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000182a0: 2020 2020 2020 2020 2029 2873 636f 6e76           )(sconv
-000182b0: 315f 6f75 7429 0d0a 0d0a 2020 2020 2020  1_out)....      
-000182c0: 2020 7072 696e 7428 2770 6f6f 6c31 3a20    print('pool1: 
-000182d0: 272c 2070 6f6f 6c31 2e73 6861 7065 290d  ', pool1.shape).
-000182e0: 0a20 2020 2020 2020 2066 635f 6f75 7420  .        fc_out 
-000182f0: 3d20 4675 6c6c 7943 6f6e 6e65 6374 6564  = FullyConnected
-00018300: 2873 697a 653d 7365 6c66 2e6f 7574 5f64  (size=self.out_d
-00018310: 696d 2c20 6e6f 6e6c 696e 3d74 662e 6964  im, nonlin=tf.id
-00018320: 656e 7469 7479 2c0d 0a20 2020 2020 2020  entity,..       
-00018330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018340: 2020 2020 2073 7065 6373 3d73 656c 662e       specs=self.
-00018350: 7370 6563 7329 0d0a 2020 2020 2020 2020  specs)..        
-00018360: 795f 7072 6564 203d 2066 635f 6f75 7428  y_pred = fc_out(
-00018370: 7466 2e6b 6572 6173 2e62 6163 6b65 6e64  tf.keras.backend
-00018380: 2e6c 6f67 2870 6f6f 6c31 2929 0d0a 2020  .log(pool1))..  
-00018390: 2020 2020 2020 7265 7475 726e 2079 5f70        return y_p
-000183a0: 7265 640d 0a23 0d0a 230d 0a63 6c61 7373  red..#..#..class
-000183b0: 204c 464c 5354 4d28 4261 7365 4d6f 6465   LFLSTM(BaseMode
-000183c0: 6c29 3a0d 0a20 2020 2023 2054 4f44 4f21  l):..    # TODO!
-000183d0: 2047 6162 693a 2063 6865 636b 2074 6861   Gabi: check tha
-000183e0: 7420 7468 6520 6465 7363 7269 7074 696f  t the descriptio
-000183f0: 6e20 6465 7363 7269 6265 7320 7468 6520  n describes the 
-00018400: 6d6f 6465 6c0d 0a20 2020 2022 2222 4c46  model..    """LF
-00018410: 2d43 4e4e 2d4c 5354 4d0d 0a0d 0a20 2020  -CNN-LSTM....   
-00018420: 2046 6f72 2064 6574 6169 6c73 2073 6565   For details see
-00018430: 205b 315d 2e0d 0a0d 0a20 2020 2050 6172   [1].....    Par
-00018440: 616d 6574 6572 730d 0a20 2020 202d 2d2d  ameters..    ---
-00018450: 2d2d 2d2d 2d2d 2d0d 0a20 2020 206e 5f6c  -------..    n_l
-00018460: 6174 656e 7420 3a20 696e 740d 0a20 2020  atent : int..   
-00018470: 2020 2020 206e 756d 6265 7220 6f66 206c       number of l
-00018480: 6174 656e 7420 636f 6d70 6f6e 656e 7473  atent components
-00018490: 0d0a 2020 2020 2020 2020 4465 6661 756c  ..        Defaul
-000184a0: 7473 2074 6f20 3332 0d0a 0d0a 2020 2020  ts to 32....    
-000184b0: 6669 6c74 6572 5f6c 656e 6774 6820 3a20  filter_length : 
-000184c0: 696e 740d 0a20 2020 2020 2020 206c 656e  int..        len
-000184d0: 6774 6820 6f66 2073 7061 7469 6f2d 7465  gth of spatio-te
-000184e0: 6d70 6f72 616c 206b 6572 6e65 6c73 2069  mporal kernels i
-000184f0: 6e20 7468 6520 7465 6d70 6f72 616c 0d0a  n the temporal..
-00018500: 2020 2020 2020 2020 636f 6e76 6f6c 7574          convolut
-00018510: 696f 6e20 6c61 7965 722e 2044 6566 6175  ion layer. Defau
-00018520: 6c74 7320 746f 2037 0d0a 0d0a 2020 2020  lts to 7....    
-00018530: 7374 7269 6465 203a 2069 6e74 0d0a 2020  stride : int..  
-00018540: 2020 2020 2020 7374 7269 6465 206f 6620        stride of 
-00018550: 7468 6520 6d61 7820 706f 6f6c 696e 6720  the max pooling 
-00018560: 6c61 7965 722e 2044 6566 6175 6c74 7320  layer. Defaults 
-00018570: 746f 2031 0d0a 0d0a 2020 2020 706f 6f6c  to 1....    pool
-00018580: 696e 6720 3a20 696e 740d 0a20 2020 2020  ing : int..     
-00018590: 2020 2070 6f6f 6c69 6e67 2066 6163 746f     pooling facto
-000185a0: 7220 6f66 2074 6865 206d 6178 2070 6f6f  r of the max poo
-000185b0: 6c69 6e67 206c 6179 6572 2e20 4465 6661  ling layer. Defa
-000185c0: 756c 7473 2074 6f20 320d 0a0d 0a20 2020  ults to 2....   
-000185d0: 2052 6566 6572 656e 6365 730d 0a20 2020   References..   
-000185e0: 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020   ----------..   
-000185f0: 2020 2020 205b 315d 2020 492e 205a 7562       [1]  I. Zub
-00018600: 6172 6576 2c20 6574 2061 6c2e 2c20 4164  arev, et al., Ad
-00018610: 6170 7469 7665 206e 6575 7261 6c20 6e65  aptive neural ne
-00018620: 7477 6f72 6b20 636c 6173 7369 6669 6572  twork classifier
-00018630: 2066 6f72 0d0a 2020 2020 2020 2020 6465   for..        de
-00018640: 636f 6469 6e67 204d 4547 2073 6967 6e61  coding MEG signa
-00018650: 6c73 2e20 4e65 7572 6f69 6d61 6765 2e20  ls. Neuroimage. 
-00018660: 2832 3031 3929 204d 6179 2034 3b31 3937  (2019) May 4;197
-00018670: 3a34 3235 2d34 3334 0d0a 2020 2020 2222  :425-434..    ""
-00018680: 220d 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
-00018690: 745f 5f28 7365 6c66 2c20 6d65 7461 2c20  t__(self, meta, 
-000186a0: 6461 7461 7365 743d 4e6f 6e65 293a 0d0a  dataset=None):..
-000186b0: 2020 2020 2020 2020 2222 220d 0a0d 0a20          """.... 
-000186c0: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
-000186d0: 730d 0a20 2020 2020 2020 202d 2d2d 2d2d  s..        -----
-000186e0: 2d2d 2d2d 2d0d 0a20 2020 2020 2020 2044  -----..        D
-000186f0: 6174 6173 6574 203a 206d 6e65 666c 6f77  ataset : mneflow
-00018700: 2e44 6174 6173 6574 0d0a 0d0a 2020 2020  .Dataset....    
-00018710: 2020 2020 7370 6563 7320 3a20 6469 6374      specs : dict
-00018720: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00018730: 2020 6469 6374 696f 6e61 7279 206f 6620    dictionary of 
-00018740: 6d6f 6465 6c20 6879 7065 7270 6172 616d  model hyperparam
-00018750: 6574 6572 7320 7b0d 0a0d 0a20 2020 2020  eters {....     
-00018760: 2020 206e 5f6c 6174 656e 7420 3a20 696e     n_latent : in
-00018770: 740d 0a20 2020 2020 2020 2020 2020 204e  t..            N
-00018780: 756d 6265 7220 6f66 206c 6174 656e 7420  umber of latent 
-00018790: 636f 6d70 6f6e 656e 7473 2e0d 0a20 2020  components...   
-000187a0: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
-000187b0: 7320 746f 2033 322e 0d0a 0d0a 2020 2020  s to 32.....    
-000187c0: 2020 2020 6e6f 6e6c 696e 203a 2063 616c      nonlin : cal
-000187d0: 6c61 626c 650d 0a20 2020 2020 2020 2020  lable..         
-000187e0: 2020 2041 6374 6976 6174 696f 6e20 6675     Activation fu
-000187f0: 6e63 7469 6f6e 206f 6620 7468 6520 7465  nction of the te
-00018800: 6d70 6f72 616c 2063 6f6e 766f 6c75 7469  mporal convoluti
-00018810: 6f6e 206c 6179 6572 2e0d 0a20 2020 2020  on layer...     
-00018820: 2020 2020 2020 2044 6566 6175 6c74 7320         Defaults 
-00018830: 746f 2074 662e 6e6e 2e72 656c 750d 0a0d  to tf.nn.relu...
-00018840: 0a20 2020 2020 2020 2066 696c 7465 725f  .        filter_
-00018850: 6c65 6e67 7468 203a 2069 6e74 0d0a 2020  length : int..  
-00018860: 2020 2020 2020 2020 2020 4c65 6e67 7468            Length
-00018870: 206f 6620 7370 6174 696f 2d74 656d 706f   of spatio-tempo
-00018880: 7261 6c20 6b65 726e 656c 7320 696e 2074  ral kernels in t
-00018890: 6865 2074 656d 706f 7261 6c0d 0a20 2020  he temporal..   
-000188a0: 2020 2020 2020 2020 2063 6f6e 766f 6c75           convolu
-000188b0: 7469 6f6e 206c 6179 6572 2e20 4465 6661  tion layer. Defa
-000188c0: 756c 7473 2074 6f20 372e 0d0a 0d0a 2020  ults to 7.....  
-000188d0: 2020 2020 2020 706f 6f6c 696e 6720 3a20        pooling : 
-000188e0: 696e 740d 0a20 2020 2020 2020 2020 2020  int..           
-000188f0: 2050 6f6f 6c69 6e67 2066 6163 746f 7220   Pooling factor 
-00018900: 6f66 2074 6865 206d 6178 2070 6f6f 6c69  of the max pooli
-00018910: 6e67 206c 6179 6572 2e20 4465 6661 756c  ng layer. Defaul
-00018920: 7473 2074 6f20 320d 0a0d 0a20 2020 2020  ts to 2....     
-00018930: 2020 2070 6f6f 6c5f 7479 7065 203a 2073     pool_type : s
-00018940: 7472 207b 2761 7667 272c 2027 6d61 7827  tr {'avg', 'max'
-00018950: 7d0d 0a20 2020 2020 2020 2020 2020 2054  }..            T
-00018960: 7970 6520 6f66 2070 6f6f 6c69 6e67 206f  ype of pooling o
-00018970: 7065 7261 7469 6f6e 2e20 4465 6661 756c  peration. Defaul
-00018980: 7473 2074 6f20 276d 6178 272e 0d0a 0d0a  ts to 'max'.....
-00018990: 2020 2020 2020 2020 7061 6464 696e 6720          padding 
-000189a0: 3a20 7374 7220 7b27 5341 4d45 272c 2027  : str {'SAME', '
-000189b0: 4655 4c4c 272c 2027 5641 4c49 4427 7d0d  FULL', 'VALID'}.
-000189c0: 0a20 2020 2020 2020 2020 2020 2043 6f6e  .            Con
-000189d0: 766f 6c75 7469 6f6e 2070 6164 6469 6e67  volution padding
-000189e0: 2e20 4465 6661 756c 7473 2074 6f20 2753  . Defaults to 'S
-000189f0: 414d 4527 2e7d 0d0a 0d0a 2020 2020 2020  AME'.}....      
-00018a00: 2020 7374 7269 6465 203a 2069 6e74 0d0a    stride : int..
-00018a10: 2020 2020 2020 2020 5374 7269 6465 206f          Stride o
-00018a20: 6620 7468 6520 6d61 7820 706f 6f6c 696e  f the max poolin
-00018a30: 6720 6c61 7965 722e 2044 6566 6175 6c74  g layer. Default
-00018a40: 7320 746f 2031 2e0d 0a20 2020 2020 2020  s to 1...       
-00018a50: 2022 2222 0d0a 2020 2020 2020 2020 2373   """..        #s
-00018a60: 656c 662e 7363 6f70 6520 3d20 276c 666c  elf.scope = 'lfl
-00018a70: 7374 6d27 0d0a 2020 2020 2020 2020 7365  stm'..        se
-00018a80: 6c66 2e73 636f 7065 203d 2027 6c66 2d63  lf.scope = 'lf-c
-00018a90: 6e6e 2d6c 7374 6d27 0d0a 2020 2020 2020  nn-lstm'..      
-00018aa0: 2020 6d65 7461 2e6d 6f64 656c 5f73 7065    meta.model_spe
-00018ab0: 6373 2e73 6574 6465 6661 756c 7428 2766  cs.setdefault('f
-00018ac0: 696c 7465 725f 6c65 6e67 7468 272c 2037  ilter_length', 7
-00018ad0: 290d 0a20 2020 2020 2020 206d 6574 612e  )..        meta.
-00018ae0: 6d6f 6465 6c5f 7370 6563 732e 7365 7464  model_specs.setd
-00018af0: 6566 6175 6c74 2827 6e5f 6c61 7465 6e74  efault('n_latent
-00018b00: 272c 2033 3229 0d0a 2020 2020 2020 2020  ', 32)..        
-00018b10: 6d65 7461 2e6d 6f64 656c 5f73 7065 6373  meta.model_specs
-00018b20: 2e73 6574 6465 6661 756c 7428 2770 6f6f  .setdefault('poo
-00018b30: 6c69 6e67 272c 2032 290d 0a20 2020 2020  ling', 2)..     
-00018b40: 2020 206d 6574 612e 6d6f 6465 6c5f 7370     meta.model_sp
-00018b50: 6563 732e 7365 7464 6566 6175 6c74 2827  ecs.setdefault('
-00018b60: 7374 7269 6465 272c 2032 290d 0a20 2020  stride', 2)..   
-00018b70: 2020 2020 206d 6574 612e 6d6f 6465 6c5f       meta.model_
-00018b80: 7370 6563 732e 7365 7464 6566 6175 6c74  specs.setdefault
-00018b90: 2827 7061 6464 696e 6727 2c20 2753 414d  ('padding', 'SAM
-00018ba0: 4527 290d 0a20 2020 2020 2020 206d 6574  E')..        met
-00018bb0: 612e 6d6f 6465 6c5f 7370 6563 732e 7365  a.model_specs.se
-00018bc0: 7464 6566 6175 6c74 2827 706f 6f6c 5f74  tdefault('pool_t
-00018bd0: 7970 6527 2c20 276d 6178 2729 0d0a 2020  ype', 'max')..  
-00018be0: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
-00018bf0: 5f73 7065 6373 2e73 6574 6465 6661 756c  _specs.setdefaul
-00018c00: 7428 276e 6f6e 6c69 6e27 2c20 7466 2e6e  t('nonlin', tf.n
-00018c10: 6e2e 7265 6c75 290d 0a20 2020 2020 2020  n.relu)..       
-00018c20: 206d 6574 612e 6d6f 6465 6c5f 7370 6563   meta.model_spec
-00018c30: 732e 7365 7464 6566 6175 6c74 2827 6c31  s.setdefault('l1
-00018c40: 5f6c 616d 6264 6127 2c20 302e 290d 0a20  _lambda', 0.).. 
-00018c50: 2020 2020 2020 206d 6574 612e 6d6f 6465         meta.mode
-00018c60: 6c5f 7370 6563 732e 7365 7464 6566 6175  l_specs.setdefau
-00018c70: 6c74 2827 6c32 5f6c 616d 6264 6127 2c20  lt('l2_lambda', 
-00018c80: 302e 290d 0a20 2020 2020 2020 206d 6574  0.)..        met
-00018c90: 612e 6d6f 6465 6c5f 7370 6563 732e 7365  a.model_specs.se
-00018ca0: 7464 6566 6175 6c74 2827 6c31 5f73 636f  tdefault('l1_sco
-00018cb0: 7065 272c 205b 5d29 0d0a 2020 2020 2020  pe', [])..      
-00018cc0: 2020 6d65 7461 2e6d 6f64 656c 5f73 7065    meta.model_spe
-00018cd0: 6373 2e73 6574 6465 6661 756c 7428 276c  cs.setdefault('l
-00018ce0: 325f 7363 6f70 6527 2c20 5b5d 290d 0a20  2_scope', []).. 
-00018cf0: 2020 2020 2020 206d 6574 612e 6d6f 6465         meta.mode
-00018d00: 6c5f 7370 6563 735b 2773 636f 7065 275d  l_specs['scope']
-00018d10: 203d 2073 656c 662e 7363 6f70 650d 0a20   = self.scope.. 
-00018d20: 2020 2020 2020 206d 6574 612e 6d6f 6465         meta.mode
-00018d30: 6c5f 7370 6563 732e 7365 7464 6566 6175  l_specs.setdefau
-00018d40: 6c74 2827 756e 6974 6e6f 726d 5f73 636f  lt('unitnorm_sco
-00018d50: 7065 272c 205b 5d29 0d0a 2020 2020 2020  pe', [])..      
-00018d60: 2020 2373 7065 6373 2e73 6574 6465 6661    #specs.setdefa
-00018d70: 756c 7428 276d 6f64 656c 5f70 6174 6827  ult('model_path'
-00018d80: 2c20 2073 656c 662e 6461 7461 7365 742e  ,  self.dataset.
-00018d90: 685f 7061 7261 6d73 5b27 7361 7665 5f70  h_params['save_p
-00018da0: 6174 6827 5d29 0d0a 2020 2020 2020 2020  ath'])..        
-00018db0: 7375 7065 7228 4c46 4c53 544d 2c20 7365  super(LFLSTM, se
-00018dc0: 6c66 292e 5f5f 696e 6974 5f5f 286d 6574  lf).__init__(met
-00018dd0: 612c 2064 6174 6173 6574 290d 0a0d 0a0d  a, dataset).....
-00018de0: 0a20 2020 2064 6566 2062 7569 6c64 5f67  .    def build_g
-00018df0: 7261 7068 2873 656c 6629 3a0d 0a20 2020  raph(self):..   
-00018e00: 2020 2020 200d 0a20 2020 2020 2020 2073       ..        s
-00018e10: 656c 662e 7265 7475 726e 5f73 6571 7565  elf.return_seque
-00018e20: 6e63 6520 3d20 5472 7565 0d0a 2020 2020  nce = True..    
-00018e30: 2020 2020 7365 6c66 2e64 6d78 203d 2044      self.dmx = D
-00018e40: 654d 6978 696e 6728 7369 7a65 3d73 656c  eMixing(size=sel
-00018e50: 662e 7370 6563 735b 276e 5f6c 6174 656e  f.specs['n_laten
-00018e60: 7427 5d2c 206e 6f6e 6c69 6e3d 7466 2e69  t'], nonlin=tf.i
-00018e70: 6465 6e74 6974 792c 0d0a 2020 2020 2020  dentity,..      
-00018e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018e90: 2020 2020 2020 6178 6973 3d33 2c20 7370        axis=3, sp
-00018ea0: 6563 733d 7365 6c66 2e73 7065 6373 290d  ecs=self.specs).
-00018eb0: 0a20 2020 2020 2020 2064 6d78 203d 2073  .        dmx = s
-00018ec0: 656c 662e 646d 7828 7365 6c66 2e69 6e70  elf.dmx(self.inp
-00018ed0: 7574 7329 0d0a 2020 2020 2020 2020 2364  uts)..        #d
-00018ee0: 6d78 203d 2074 662e 7265 7368 6170 6528  mx = tf.reshape(
-00018ef0: 646d 782c 205b 2d31 2c20 7365 6c66 2e64  dmx, [-1, self.d
-00018f00: 6174 6173 6574 2e68 5f70 6172 616d 735b  ataset.h_params[
-00018f10: 276e 5f74 275d 2c0d 0a20 2020 2020 2020  'n_t'],..       
-00018f20: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-00018f30: 2020 2020 2020 2020 2073 656c 662e 7370           self.sp
-00018f40: 6563 735b 276e 5f6c 6174 656e 7427 5d5d  ecs['n_latent']]
-00018f50: 290d 0a20 2020 2020 2020 2023 646d 7820  )..        #dmx 
-00018f60: 3d20 7466 2e65 7870 616e 645f 6469 6d73  = tf.expand_dims
-00018f70: 2864 6d78 2c20 2d31 290d 0a20 2020 2020  (dmx, -1)..     
-00018f80: 2020 2070 7269 6e74 2827 646d 782d 7371     print('dmx-sq
-00018f90: 6f75 743a 272c 2064 6d78 2e73 6861 7065  out:', dmx.shape
-00018fa0: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-00018fb0: 662e 7463 6f6e 7631 203d 204c 4654 436f  f.tconv1 = LFTCo
-00018fc0: 6e76 2873 636f 7065 3d22 636f 6e76 222c  nv(scope="conv",
-00018fd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00018fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ff0: 7369 7a65 3d73 656c 662e 7370 6563 735b  size=self.specs[
-00019000: 276e 5f6c 6174 656e 7427 5d2c 0d0a 2020  'n_latent'],..  
-00019010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019020: 2020 2020 2020 2020 2020 2020 6e6f 6e6c              nonl
-00019030: 696e 3d74 662e 6e6e 2e72 656c 752c 0d0a  in=tf.nn.relu,..
-00019040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019050: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-00019060: 6c74 6572 5f6c 656e 6774 683d 7365 6c66  lter_length=self
-00019070: 2e73 7065 6373 5b27 6669 6c74 6572 5f6c  .specs['filter_l
-00019080: 656e 6774 6827 5d2c 0d0a 2320 2020 2020  ength'],..#     
+00017570: 2020 2020 2020 2020 2020 2020 2928 7365              )(se
+00017580: 6c66 2e74 636f 6e76 290d 0a0d 0a20 2020  lf.tconv)....   
+00017590: 2020 2020 2064 726f 706f 7574 203d 2044       dropout = D
+000175a0: 726f 706f 7574 2873 656c 662e 7370 6563  ropout(self.spec
+000175b0: 735b 2764 726f 706f 7574 275d 2c0d 0a20  s['dropout'],.. 
+000175c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000175d0: 2020 2020 2020 2020 206e 6f69 7365 5f73           noise_s
+000175e0: 6861 7065 3d4e 6f6e 6529 2873 656c 662e  hape=None)(self.
+000175f0: 706f 6f6c 6564 290d 0a0d 0a20 2020 2020  pooled)....     
+00017600: 2020 2023 6663 3120 3d20 4675 6c6c 7943     #fc1 = FullyC
+00017610: 6f6e 6e65 6374 6564 2873 697a 653d 3132  onnected(size=12
+00017620: 382c 206e 6f6e 6c69 6e3d 7466 2e6e 6e2e  8, nonlin=tf.nn.
+00017630: 656c 752c 0d0a 2020 2020 2020 2020 2320  elu,..        # 
+00017640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017650: 2020 2073 7065 6373 3d73 656c 662e 7370     specs=self.sp
+00017660: 6563 7329 2864 726f 706f 7574 290d 0a0d  ecs)(dropout)...
+00017670: 0a20 2020 2020 2020 2073 656c 662e 6669  .        self.fi
+00017680: 6e5f 6663 203d 2046 756c 6c79 436f 6e6e  n_fc = FullyConn
+00017690: 6563 7465 6428 7369 7a65 3d73 656c 662e  ected(size=self.
+000176a0: 6f75 745f 6469 6d2c 206e 6f6e 6c69 6e3d  out_dim, nonlin=
+000176b0: 7466 2e69 6465 6e74 6974 792c 0d0a 2020  tf.identity,..  
+000176c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000176d0: 2020 2020 2020 2020 2020 7370 6563 733d            specs=
+000176e0: 7365 6c66 2e73 7065 6373 290d 0a0d 0a20  self.specs).... 
+000176f0: 2020 2020 2020 2079 5f70 7265 6420 3d20         y_pred = 
+00017700: 7365 6c66 2e66 696e 5f66 6328 6472 6f70  self.fin_fc(drop
+00017710: 6f75 7429 0d0a 0d0a 2020 2020 2020 2020  out)....        
+00017720: 7265 7475 726e 2079 5f70 7265 640d 0a0d  return y_pred...
+00017730: 0a0d 0a0d 0a63 6c61 7373 2046 4243 5350  .....class FBCSP
+00017740: 5f53 6861 6c6c 6f77 4e65 7428 4261 7365  _ShallowNet(Base
+00017750: 4d6f 6465 6c29 3a0d 0a20 2020 2022 2222  Model):..    """
+00017760: 0d0a 2020 2020 5368 616c 6c6f 7720 436f  ..    Shallow Co
+00017770: 6e76 4e65 7420 6d6f 6465 6c20 6672 6f6d  nvNet model from
+00017780: 205b 3261 5d5f 2e0d 0a20 2020 2052 6566   [2a]_...    Ref
+00017790: 6572 656e 6365 730d 0a20 2020 202d 2d2d  erences..    ---
+000177a0: 2d2d 2d2d 2d2d 2d0d 0a20 2020 202e 2e20  -------..    .. 
+000177b0: 5b32 615d 2053 6368 6972 726d 6569 7374  [2a] Schirrmeist
+000177c0: 6572 2c20 522e 2054 2e2c 2053 7072 696e  er, R. T., Sprin
+000177d0: 6765 6e62 6572 672c 204a 2e20 542e 2c20  genberg, J. T., 
+000177e0: 4669 6564 6572 6572 2c20 4c2e 2044 2e20  Fiederer, L. D. 
+000177f0: 4a2e 2c0d 0a20 2020 2020 2020 476c 6173  J.,..       Glas
+00017800: 7374 6574 7465 722c 204d 2e2c 2045 6767  stetter, M., Egg
+00017810: 656e 7370 6572 6765 722c 204b 2e2c 2054  ensperger, K., T
+00017820: 616e 6765 726d 616e 6e2c 204d 2e2c 2048  angermann, M., H
+00017830: 7574 7465 722c 2046 2e20 2620 4261 6c6c  utter, F. & Ball
+00017840: 2c20 542e 2028 3230 3137 292e 0d0a 2020  , T. (2017)...  
+00017850: 2020 2020 2044 6565 7020 6c65 6172 6e69       Deep learni
+00017860: 6e67 2077 6974 6820 636f 6e76 6f6c 7574  ng with convolut
+00017870: 696f 6e61 6c20 6e65 7572 616c 206e 6574  ional neural net
+00017880: 776f 726b 7320 666f 7220 4545 4720 6465  works for EEG de
+00017890: 636f 6469 6e67 2061 6e64 0d0a 2020 2020  coding and..    
+000178a0: 2020 2076 6973 7561 6c69 7a61 7469 6f6e     visualization
+000178b0: 2e0d 0a20 2020 2020 2020 4875 6d61 6e20  ...       Human 
+000178c0: 4272 6169 6e20 4d61 7070 696e 6720 2c20  Brain Mapping , 
+000178d0: 4175 672e 2032 3031 372e 204f 6e6c 696e  Aug. 2017. Onlin
+000178e0: 653a 2068 7474 703a 2f2f 6478 2e64 6f69  e: http://dx.doi
+000178f0: 2e6f 7267 2f31 302e 3130 3032 2f68 626d  .org/10.1002/hbm
+00017900: 2e32 3337 3330 0d0a 2020 2020 2222 220d  .23730..    """.
+00017910: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+00017920: 5f28 7365 6c66 2c20 6d65 7461 2c20 6461  _(self, meta, da
+00017930: 7461 7365 743d 4e6f 6e65 293a 0d0a 2020  taset=None):..  
+00017940: 2020 2020 2020 7365 6c66 2e73 636f 7065        self.scope
+00017950: 203d 2027 6662 6373 702d 5368 616c 6c6f   = 'fbcsp-Shallo
+00017960: 774e 6574 270d 0a20 2020 2020 2020 206d  wNet'..        m
+00017970: 6574 612e 6d6f 6465 6c5f 7370 6563 732e  eta.model_specs.
+00017980: 7365 7464 6566 6175 6c74 2827 6669 6c74  setdefault('filt
+00017990: 6572 5f6c 656e 6774 6827 2c20 3235 290d  er_length', 25).
+000179a0: 0a20 2020 2020 2020 206d 6574 612e 6d6f  .        meta.mo
+000179b0: 6465 6c5f 7370 6563 732e 7365 7464 6566  del_specs.setdef
+000179c0: 6175 6c74 2827 6e5f 6c61 7465 6e74 272c  ault('n_latent',
+000179d0: 2034 3029 0d0a 2020 2020 2020 2020 6d65   40)..        me
+000179e0: 7461 2e6d 6f64 656c 5f73 7065 6373 2e73  ta.model_specs.s
+000179f0: 6574 6465 6661 756c 7428 2770 6f6f 6c69  etdefault('pooli
+00017a00: 6e67 272c 2037 3529 0d0a 2020 2020 2020  ng', 75)..      
+00017a10: 2020 6d65 7461 2e6d 6f64 656c 5f73 7065    meta.model_spe
+00017a20: 6373 2e73 6574 6465 6661 756c 7428 2773  cs.setdefault('s
+00017a30: 7472 6964 6527 2c20 3135 290d 0a20 2020  tride', 15)..   
+00017a40: 2020 2020 206d 6574 612e 6d6f 6465 6c5f       meta.model_
+00017a50: 7370 6563 732e 7365 7464 6566 6175 6c74  specs.setdefault
+00017a60: 2827 706f 6f6c 5f74 7970 6527 2c20 2761  ('pool_type', 'a
+00017a70: 7667 2729 0d0a 2020 2020 2020 2020 6d65  vg')..        me
+00017a80: 7461 2e6d 6f64 656c 5f73 7065 6373 2e73  ta.model_specs.s
+00017a90: 6574 6465 6661 756c 7428 2770 6164 6469  etdefault('paddi
+00017aa0: 6e67 272c 2027 5341 4d45 2729 0d0a 2020  ng', 'SAME')..  
+00017ab0: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
+00017ac0: 5f73 7065 6373 2e73 6574 6465 6661 756c  _specs.setdefaul
+00017ad0: 7428 276e 6f6e 6c69 6e27 2c20 7466 2e6e  t('nonlin', tf.n
+00017ae0: 6e2e 7265 6c75 290d 0a20 2020 2020 2020  n.relu)..       
+00017af0: 206d 6574 612e 6d6f 6465 6c5f 7370 6563   meta.model_spec
+00017b00: 732e 7365 7464 6566 6175 6c74 2827 6c31  s.setdefault('l1
+00017b10: 5f6c 616d 6264 6127 2c20 3365 2d34 290d  _lambda', 3e-4).
+00017b20: 0a20 2020 2020 2020 206d 6574 612e 6d6f  .        meta.mo
+00017b30: 6465 6c5f 7370 6563 732e 7365 7464 6566  del_specs.setdef
+00017b40: 6175 6c74 2827 6c32 5f6c 616d 6264 6127  ault('l2_lambda'
+00017b50: 2c20 3365 2d32 290d 0a20 2020 2020 2020  , 3e-2)..       
+00017b60: 206d 6574 612e 6d6f 6465 6c5f 7370 6563   meta.model_spec
+00017b70: 732e 7365 7464 6566 6175 6c74 2827 6c31  s.setdefault('l1
+00017b80: 5f73 636f 7065 272c 205b 5d29 0d0a 2020  _scope', [])..  
+00017b90: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
+00017ba0: 5f73 7065 6373 2e73 6574 6465 6661 756c  _specs.setdefaul
+00017bb0: 7428 276c 325f 7363 6f70 6527 2c20 5b27  t('l2_scope', ['
+00017bc0: 636f 6e76 272c 2027 6663 275d 290d 0a0d  conv', 'fc'])...
+00017bd0: 0a20 2020 2020 2020 206d 6574 612e 6d6f  .        meta.mo
+00017be0: 6465 6c5f 7370 6563 732e 7365 7464 6566  del_specs.setdef
+00017bf0: 6175 6c74 2827 756e 6974 6e6f 726d 5f73  ault('unitnorm_s
+00017c00: 636f 7065 272c 205b 5d29 0d0a 2020 2020  cope', [])..    
+00017c10: 2020 2020 2373 7065 6373 2e73 6574 6465      #specs.setde
+00017c20: 6661 756c 7428 276d 6f64 656c 5f70 6174  fault('model_pat
+00017c30: 6827 2c20 6f73 2e70 6174 682e 6a6f 696e  h', os.path.join
+00017c40: 2873 656c 662e 6461 7461 7365 742e 685f  (self.dataset.h_
+00017c50: 7061 7261 6d73 5b27 7061 7468 275d 2c20  params['path'], 
+00017c60: 276d 6f64 656c 7327 2929 0d0a 2020 2020  'models'))..    
+00017c70: 2020 2020 7375 7065 7228 4642 4353 505f      super(FBCSP_
+00017c80: 5368 616c 6c6f 774e 6574 2c20 7365 6c66  ShallowNet, self
+00017c90: 292e 5f5f 696e 6974 5f5f 286d 6574 612c  ).__init__(meta,
+00017ca0: 2064 6174 6173 6574 290d 0a0d 0a20 2020   dataset)....   
+00017cb0: 2064 6566 2062 7569 6c64 5f67 7261 7068   def build_graph
+00017cc0: 2873 656c 6629 3a0d 0a0d 0a20 2020 2020  (self):....     
+00017cd0: 2020 2022 2222 5465 6d70 6f72 616c 2063     """Temporal c
+00017ce0: 6f6e 765f 3120 3235 2031 3078 3120 6b65  onv_1 25 10x1 ke
+00017cf0: 726e 656c 7322 2222 0d0a 2020 2020 2020  rnels"""..      
+00017d00: 2020 2328 7365 6c66 2e69 6e70 7574 7329    #(self.inputs)
+00017d10: 0d0a 2020 2020 2020 2020 696e 7075 7473  ..        inputs
+00017d20: 203d 2074 662e 7472 616e 7370 6f73 6528   = tf.transpose(
+00017d30: 7365 6c66 2e69 6e70 7574 732c 5b30 2c33  self.inputs,[0,3
+00017d40: 2c32 2c31 5d29 0d0a 2020 2020 2020 2020  ,2,1])..        
+00017d50: 2370 7269 6e74 2869 6e70 7574 732e 7368  #print(inputs.sh
+00017d60: 6170 6529 0d0a 2020 2020 2020 2020 2364  ape)..        #d
+00017d70: 6620 3d20 2263 6861 6e6e 656c 735f 6669  f = "channels_fi
+00017d80: 7273 7422 0d0a 2020 2020 2020 2020 7463  rst"..        tc
+00017d90: 6f6e 7631 203d 2044 6570 7468 7769 7365  onv1 = Depthwise
+00017da0: 436f 6e76 3244 280d 0a20 2020 2020 2020  Conv2D(..       
+00017db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017dc0: 206b 6572 6e65 6c5f 7369 7a65 3d28 312c   kernel_size=(1,
+00017dd0: 2073 656c 662e 7370 6563 735b 2766 696c   self.specs['fil
+00017de0: 7465 725f 6c65 6e67 7468 275d 292c 0d0a  ter_length']),..
+00017df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017e00: 2020 2020 2020 2020 6465 7074 685f 6d75          depth_mu
+00017e10: 6c74 6970 6c69 6572 203d 2073 656c 662e  ltiplier = self.
+00017e20: 7370 6563 735b 276e 5f6c 6174 656e 7427  specs['n_latent'
+00017e30: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+00017e40: 2020 2020 2020 2020 2020 2020 7374 7269              stri
+00017e50: 6465 733d 312c 0d0a 2020 2020 2020 2020  des=1,..        
+00017e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017e70: 7061 6464 696e 673d 2256 414c 4944 222c  padding="VALID",
+00017e80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00017e90: 2020 2020 2020 2020 2020 6163 7469 7661            activa
+00017ea0: 7469 6f6e 203d 2074 662e 6964 656e 7469  tion = tf.identi
+00017eb0: 7479 2c0d 0a20 2020 2020 2020 2020 2020  ty,..           
+00017ec0: 2020 2020 2020 2020 2020 2020 206b 6572               ker
+00017ed0: 6e65 6c5f 696e 6974 6961 6c69 7a65 723d  nel_initializer=
+00017ee0: 2268 655f 756e 6966 6f72 6d22 2c0d 0a20  "he_uniform",.. 
+00017ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f00: 2020 2020 2020 2062 6961 735f 696e 6974         bias_init
+00017f10: 6961 6c69 7a65 723d 436f 6e73 7461 6e74  ializer=Constant
+00017f20: 2830 2e31 292c 0d0a 2020 2020 2020 2020  (0.1),..        
+00017f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f40: 6461 7461 5f66 6f72 6d61 743d 2263 6861  data_format="cha
+00017f50: 6e6e 656c 735f 6c61 7374 222c 0d0a 2020  nnels_last",..  
+00017f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f70: 2020 2020 2020 6b65 726e 656c 5f72 6567        kernel_reg
+00017f80: 756c 6172 697a 6572 3d6b 5f72 6567 2e6c  ularizer=k_reg.l
+00017f90: 3228 7365 6c66 2e73 7065 6373 5b27 6c32  2(self.specs['l2
+00017fa0: 5f6c 616d 6264 6127 5d29 0d0a 2020 2020  _lambda'])..    
+00017fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017fc0: 2020 2020 236b 6572 6e65 6c5f 636f 6e73      #kernel_cons
+00017fd0: 7472 6169 6e74 3d22 6d61 786e 6f72 6d22  traint="maxnorm"
+00017fe0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00017ff0: 2020 2020 2020 2020 2020 290d 0a0d 0a20            ).... 
+00018000: 2020 2020 2020 2074 636f 6e76 315f 6f75         tconv1_ou
+00018010: 7420 3d20 7463 6f6e 7631 2869 6e70 7574  t = tconv1(input
+00018020: 7329 0d0a 2020 2020 2020 2020 7072 696e  s)..        prin
+00018030: 7428 2774 636f 6e76 313a 2027 2c20 7463  t('tconv1: ', tc
+00018040: 6f6e 7631 5f6f 7574 2e73 6861 7065 2920  onv1_out.shape) 
+00018050: 2373 686f 756c 6420 6265 206e 5f62 6174  #should be n_bat
+00018060: 6368 2c20 7365 6e73 6f72 732c 2074 696d  ch, sensors, tim
+00018070: 6573 2c20 6b65 726e 656c 730d 0a0d 0a20  es, kernels.... 
+00018080: 2020 2020 2020 2073 636f 6e76 3120 3d20         sconv1 = 
+00018090: 436f 6e76 3244 2866 696c 7465 7273 3d73  Conv2D(filters=s
+000180a0: 656c 662e 7370 6563 735b 276e 5f6c 6174  elf.specs['n_lat
+000180b0: 656e 7427 5d2c 0d0a 2020 2020 2020 2020  ent'],..        
+000180c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000180d0: 6b65 726e 656c 5f73 697a 653d 2873 656c  kernel_size=(sel
+000180e0: 662e 6461 7461 7365 742e 685f 7061 7261  f.dataset.h_para
+000180f0: 6d73 5b27 6e5f 6368 275d 2c20 3129 2c0d  ms['n_ch'], 1),.
+00018100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018110: 2020 2020 2020 2020 2073 7472 6964 6573           strides
+00018120: 3d31 2c0d 0a20 2020 2020 2020 2020 2020  =1,..           
+00018130: 2020 2020 2020 2020 2020 2020 2070 6164               pad
+00018140: 6469 6e67 3d22 5641 4c49 4422 2c0d 0a20  ding="VALID",.. 
+00018150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018160: 2020 2020 2020 2061 6374 6976 6174 696f         activatio
+00018170: 6e20 3d20 7466 2e73 7175 6172 652c 0d0a  n = tf.square,..
+00018180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018190: 2020 2020 2020 2020 6b65 726e 656c 5f69          kernel_i
+000181a0: 6e69 7469 616c 697a 6572 3d22 6865 5f75  nitializer="he_u
+000181b0: 6e69 666f 726d 222c 0d0a 2020 2020 2020  niform",..      
+000181c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000181d0: 2020 6269 6173 5f69 6e69 7469 616c 697a    bias_initializ
+000181e0: 6572 3d43 6f6e 7374 616e 7428 302e 3129  er=Constant(0.1)
+000181f0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00018200: 2020 2020 2020 2020 2020 2064 6174 615f             data_
+00018210: 666f 726d 6174 3d22 6368 616e 6e65 6c73  format="channels
+00018220: 5f6c 6173 7422 2c0d 0a20 2020 2020 2020  _last",..       
+00018230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018240: 2023 6461 7461 5f66 6f72 6d61 743d 2263   #data_format="c
+00018250: 6861 6e6e 656c 735f 6669 7273 7422 2c0d  hannels_first",.
+00018260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018270: 2020 2020 2020 2020 206b 6572 6e65 6c5f           kernel_
+00018280: 7265 6775 6c61 7269 7a65 723d 6b5f 7265  regularizer=k_re
+00018290: 672e 6c32 2873 656c 662e 7370 6563 735b  g.l2(self.specs[
+000182a0: 276c 325f 6c61 6d62 6461 275d 2929 0d0a  'l2_lambda']))..
+000182b0: 0d0a 0d0a 2020 2020 2020 2020 7363 6f6e  ....        scon
+000182c0: 7631 5f6f 7574 203d 2073 636f 6e76 3128  v1_out = sconv1(
+000182d0: 7463 6f6e 7631 5f6f 7574 290d 0a20 2020  tconv1_out)..   
+000182e0: 2020 2020 2070 7269 6e74 2827 7363 6f6e       print('scon
+000182f0: 7631 3a27 2c20 2073 636f 6e76 315f 6f75  v1:',  sconv1_ou
+00018300: 742e 7368 6170 6529 0d0a 0d0a 2020 2020  t.shape)....    
+00018310: 2020 2020 706f 6f6c 3120 3d20 5465 6d70      pool1 = Temp
+00018320: 506f 6f6c 696e 6728 706f 6f6c 696e 673d  Pooling(pooling=
+00018330: 7365 6c66 2e73 7065 6373 5b27 706f 6f6c  self.specs['pool
+00018340: 696e 6727 5d2c 0d0a 2020 2020 2020 2020  ing'],..        
+00018350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018360: 2020 2020 2020 2020 2020 706f 6f6c 5f74            pool_t
+00018370: 7970 653d 2261 7667 222c 0d0a 2020 2020  ype="avg",..    
+00018380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018390: 2020 2020 2020 2020 2020 2020 2020 7374                st
+000183a0: 7269 6465 3d73 656c 662e 7370 6563 735b  ride=self.specs[
+000183b0: 2773 7472 6964 6527 5d2c 0d0a 2020 2020  'stride'],..    
+000183c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000183d0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+000183e0: 6464 696e 673d 2753 414d 4527 2c0d 0a20  dding='SAME',.. 
+000183f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018410: 2029 2873 636f 6e76 315f 6f75 7429 0d0a   )(sconv1_out)..
+00018420: 0d0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
+00018430: 2770 6f6f 6c31 3a20 272c 2070 6f6f 6c31  'pool1: ', pool1
+00018440: 2e73 6861 7065 290d 0a20 2020 2020 2020  .shape)..       
+00018450: 2066 635f 6f75 7420 3d20 4675 6c6c 7943   fc_out = FullyC
+00018460: 6f6e 6e65 6374 6564 2873 697a 653d 7365  onnected(size=se
+00018470: 6c66 2e6f 7574 5f64 696d 2c20 6e6f 6e6c  lf.out_dim, nonl
+00018480: 696e 3d74 662e 6964 656e 7469 7479 2c0d  in=tf.identity,.
+00018490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000184a0: 2020 2020 2020 2020 2020 2020 2073 7065               spe
+000184b0: 6373 3d73 656c 662e 7370 6563 7329 0d0a  cs=self.specs)..
+000184c0: 2020 2020 2020 2020 795f 7072 6564 203d          y_pred =
+000184d0: 2066 635f 6f75 7428 7466 2e6b 6572 6173   fc_out(tf.keras
+000184e0: 2e62 6163 6b65 6e64 2e6c 6f67 2870 6f6f  .backend.log(poo
+000184f0: 6c31 2929 0d0a 2020 2020 2020 2020 7265  l1))..        re
+00018500: 7475 726e 2079 5f70 7265 640d 0a23 0d0a  turn y_pred..#..
+00018510: 230d 0a63 6c61 7373 204c 464c 5354 4d28  #..class LFLSTM(
+00018520: 4261 7365 4d6f 6465 6c29 3a0d 0a20 2020  BaseModel):..   
+00018530: 2023 2054 4f44 4f21 2047 6162 693a 2063   # TODO! Gabi: c
+00018540: 6865 636b 2074 6861 7420 7468 6520 6465  heck that the de
+00018550: 7363 7269 7074 696f 6e20 6465 7363 7269  scription descri
+00018560: 6265 7320 7468 6520 6d6f 6465 6c0d 0a20  bes the model.. 
+00018570: 2020 2022 2222 4c46 2d43 4e4e 2d4c 5354     """LF-CNN-LST
+00018580: 4d0d 0a0d 0a20 2020 2046 6f72 2064 6574  M....    For det
+00018590: 6169 6c73 2073 6565 205b 315d 2e0d 0a0d  ails see [1]....
+000185a0: 0a20 2020 2050 6172 616d 6574 6572 730d  .    Parameters.
+000185b0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d  .    ----------.
+000185c0: 0a20 2020 206e 5f6c 6174 656e 7420 3a20  .    n_latent : 
+000185d0: 696e 740d 0a20 2020 2020 2020 206e 756d  int..        num
+000185e0: 6265 7220 6f66 206c 6174 656e 7420 636f  ber of latent co
+000185f0: 6d70 6f6e 656e 7473 0d0a 2020 2020 2020  mponents..      
+00018600: 2020 4465 6661 756c 7473 2074 6f20 3332    Defaults to 32
+00018610: 0d0a 0d0a 2020 2020 6669 6c74 6572 5f6c  ....    filter_l
+00018620: 656e 6774 6820 3a20 696e 740d 0a20 2020  ength : int..   
+00018630: 2020 2020 206c 656e 6774 6820 6f66 2073       length of s
+00018640: 7061 7469 6f2d 7465 6d70 6f72 616c 206b  patio-temporal k
+00018650: 6572 6e65 6c73 2069 6e20 7468 6520 7465  ernels in the te
+00018660: 6d70 6f72 616c 0d0a 2020 2020 2020 2020  mporal..        
+00018670: 636f 6e76 6f6c 7574 696f 6e20 6c61 7965  convolution laye
+00018680: 722e 2044 6566 6175 6c74 7320 746f 2037  r. Defaults to 7
+00018690: 0d0a 0d0a 2020 2020 7374 7269 6465 203a  ....    stride :
+000186a0: 2069 6e74 0d0a 2020 2020 2020 2020 7374   int..        st
+000186b0: 7269 6465 206f 6620 7468 6520 6d61 7820  ride of the max 
+000186c0: 706f 6f6c 696e 6720 6c61 7965 722e 2044  pooling layer. D
+000186d0: 6566 6175 6c74 7320 746f 2031 0d0a 0d0a  efaults to 1....
+000186e0: 2020 2020 706f 6f6c 696e 6720 3a20 696e      pooling : in
+000186f0: 740d 0a20 2020 2020 2020 2070 6f6f 6c69  t..        pooli
+00018700: 6e67 2066 6163 746f 7220 6f66 2074 6865  ng factor of the
+00018710: 206d 6178 2070 6f6f 6c69 6e67 206c 6179   max pooling lay
+00018720: 6572 2e20 4465 6661 756c 7473 2074 6f20  er. Defaults to 
+00018730: 320d 0a0d 0a20 2020 2052 6566 6572 656e  2....    Referen
+00018740: 6365 730d 0a20 2020 202d 2d2d 2d2d 2d2d  ces..    -------
+00018750: 2d2d 2d0d 0a20 2020 2020 2020 205b 315d  ---..        [1]
+00018760: 2020 492e 205a 7562 6172 6576 2c20 6574    I. Zubarev, et
+00018770: 2061 6c2e 2c20 4164 6170 7469 7665 206e   al., Adaptive n
+00018780: 6575 7261 6c20 6e65 7477 6f72 6b20 636c  eural network cl
+00018790: 6173 7369 6669 6572 2066 6f72 0d0a 2020  assifier for..  
+000187a0: 2020 2020 2020 6465 636f 6469 6e67 204d        decoding M
+000187b0: 4547 2073 6967 6e61 6c73 2e20 4e65 7572  EG signals. Neur
+000187c0: 6f69 6d61 6765 2e20 2832 3031 3929 204d  oimage. (2019) M
+000187d0: 6179 2034 3b31 3937 3a34 3235 2d34 3334  ay 4;197:425-434
+000187e0: 0d0a 2020 2020 2222 220d 0a20 2020 2064  ..    """..    d
+000187f0: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+00018800: 2c20 6d65 7461 2c20 6461 7461 7365 743d  , meta, dataset=
+00018810: 4e6f 6e65 293a 0d0a 2020 2020 2020 2020  None):..        
+00018820: 2222 220d 0a0d 0a20 2020 2020 2020 2050  """....        P
+00018830: 6172 616d 6574 6572 730d 0a20 2020 2020  arameters..     
+00018840: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20     ----------.. 
+00018850: 2020 2020 2020 2044 6174 6173 6574 203a         Dataset :
+00018860: 206d 6e65 666c 6f77 2e44 6174 6173 6574   mneflow.Dataset
+00018870: 0d0a 0d0a 2020 2020 2020 2020 7370 6563  ....        spec
+00018880: 7320 3a20 6469 6374 0d0a 2020 2020 2020  s : dict..      
+00018890: 2020 2020 2020 2020 2020 6469 6374 696f            dictio
+000188a0: 6e61 7279 206f 6620 6d6f 6465 6c20 6879  nary of model hy
+000188b0: 7065 7270 6172 616d 6574 6572 7320 7b0d  perparameters {.
+000188c0: 0a0d 0a20 2020 2020 2020 206e 5f6c 6174  ...        n_lat
+000188d0: 656e 7420 3a20 696e 740d 0a20 2020 2020  ent : int..     
+000188e0: 2020 2020 2020 204e 756d 6265 7220 6f66         Number of
+000188f0: 206c 6174 656e 7420 636f 6d70 6f6e 656e   latent componen
+00018900: 7473 2e0d 0a20 2020 2020 2020 2020 2020  ts...           
+00018910: 2044 6566 6175 6c74 7320 746f 2033 322e   Defaults to 32.
+00018920: 0d0a 0d0a 2020 2020 2020 2020 6e6f 6e6c  ....        nonl
+00018930: 696e 203a 2063 616c 6c61 626c 650d 0a20  in : callable.. 
+00018940: 2020 2020 2020 2020 2020 2041 6374 6976             Activ
+00018950: 6174 696f 6e20 6675 6e63 7469 6f6e 206f  ation function o
+00018960: 6620 7468 6520 7465 6d70 6f72 616c 2063  f the temporal c
+00018970: 6f6e 766f 6c75 7469 6f6e 206c 6179 6572  onvolution layer
+00018980: 2e0d 0a20 2020 2020 2020 2020 2020 2044  ...            D
+00018990: 6566 6175 6c74 7320 746f 2074 662e 6e6e  efaults to tf.nn
+000189a0: 2e72 656c 750d 0a0d 0a20 2020 2020 2020  .relu....       
+000189b0: 2066 696c 7465 725f 6c65 6e67 7468 203a   filter_length :
+000189c0: 2069 6e74 0d0a 2020 2020 2020 2020 2020   int..          
+000189d0: 2020 4c65 6e67 7468 206f 6620 7370 6174    Length of spat
+000189e0: 696f 2d74 656d 706f 7261 6c20 6b65 726e  io-temporal kern
+000189f0: 656c 7320 696e 2074 6865 2074 656d 706f  els in the tempo
+00018a00: 7261 6c0d 0a20 2020 2020 2020 2020 2020  ral..           
+00018a10: 2063 6f6e 766f 6c75 7469 6f6e 206c 6179   convolution lay
+00018a20: 6572 2e20 4465 6661 756c 7473 2074 6f20  er. Defaults to 
+00018a30: 372e 0d0a 0d0a 2020 2020 2020 2020 706f  7.....        po
+00018a40: 6f6c 696e 6720 3a20 696e 740d 0a20 2020  oling : int..   
+00018a50: 2020 2020 2020 2020 2050 6f6f 6c69 6e67           Pooling
+00018a60: 2066 6163 746f 7220 6f66 2074 6865 206d   factor of the m
+00018a70: 6178 2070 6f6f 6c69 6e67 206c 6179 6572  ax pooling layer
+00018a80: 2e20 4465 6661 756c 7473 2074 6f20 320d  . Defaults to 2.
+00018a90: 0a0d 0a20 2020 2020 2020 2070 6f6f 6c5f  ...        pool_
+00018aa0: 7479 7065 203a 2073 7472 207b 2761 7667  type : str {'avg
+00018ab0: 272c 2027 6d61 7827 7d0d 0a20 2020 2020  ', 'max'}..     
+00018ac0: 2020 2020 2020 2054 7970 6520 6f66 2070         Type of p
+00018ad0: 6f6f 6c69 6e67 206f 7065 7261 7469 6f6e  ooling operation
+00018ae0: 2e20 4465 6661 756c 7473 2074 6f20 276d  . Defaults to 'm
+00018af0: 6178 272e 0d0a 0d0a 2020 2020 2020 2020  ax'.....        
+00018b00: 7061 6464 696e 6720 3a20 7374 7220 7b27  padding : str {'
+00018b10: 5341 4d45 272c 2027 4655 4c4c 272c 2027  SAME', 'FULL', '
+00018b20: 5641 4c49 4427 7d0d 0a20 2020 2020 2020  VALID'}..       
+00018b30: 2020 2020 2043 6f6e 766f 6c75 7469 6f6e       Convolution
+00018b40: 2070 6164 6469 6e67 2e20 4465 6661 756c   padding. Defaul
+00018b50: 7473 2074 6f20 2753 414d 4527 2e7d 0d0a  ts to 'SAME'.}..
+00018b60: 0d0a 2020 2020 2020 2020 7374 7269 6465  ..        stride
+00018b70: 203a 2069 6e74 0d0a 2020 2020 2020 2020   : int..        
+00018b80: 5374 7269 6465 206f 6620 7468 6520 6d61  Stride of the ma
+00018b90: 7820 706f 6f6c 696e 6720 6c61 7965 722e  x pooling layer.
+00018ba0: 2044 6566 6175 6c74 7320 746f 2031 2e0d   Defaults to 1..
+00018bb0: 0a20 2020 2020 2020 2022 2222 0d0a 2020  .        """..  
+00018bc0: 2020 2020 2020 2373 656c 662e 7363 6f70        #self.scop
+00018bd0: 6520 3d20 276c 666c 7374 6d27 0d0a 2020  e = 'lflstm'..  
+00018be0: 2020 2020 2020 7365 6c66 2e73 636f 7065        self.scope
+00018bf0: 203d 2027 6c66 2d63 6e6e 2d6c 7374 6d27   = 'lf-cnn-lstm'
+00018c00: 0d0a 2020 2020 2020 2020 6d65 7461 2e6d  ..        meta.m
+00018c10: 6f64 656c 5f73 7065 6373 2e73 6574 6465  odel_specs.setde
+00018c20: 6661 756c 7428 2766 696c 7465 725f 6c65  fault('filter_le
+00018c30: 6e67 7468 272c 2037 290d 0a20 2020 2020  ngth', 7)..     
+00018c40: 2020 206d 6574 612e 6d6f 6465 6c5f 7370     meta.model_sp
+00018c50: 6563 732e 7365 7464 6566 6175 6c74 2827  ecs.setdefault('
+00018c60: 6e5f 6c61 7465 6e74 272c 2033 3229 0d0a  n_latent', 32)..
+00018c70: 2020 2020 2020 2020 6d65 7461 2e6d 6f64          meta.mod
+00018c80: 656c 5f73 7065 6373 2e73 6574 6465 6661  el_specs.setdefa
+00018c90: 756c 7428 2770 6f6f 6c69 6e67 272c 2032  ult('pooling', 2
+00018ca0: 290d 0a20 2020 2020 2020 206d 6574 612e  )..        meta.
+00018cb0: 6d6f 6465 6c5f 7370 6563 732e 7365 7464  model_specs.setd
+00018cc0: 6566 6175 6c74 2827 7374 7269 6465 272c  efault('stride',
+00018cd0: 2032 290d 0a20 2020 2020 2020 206d 6574   2)..        met
+00018ce0: 612e 6d6f 6465 6c5f 7370 6563 732e 7365  a.model_specs.se
+00018cf0: 7464 6566 6175 6c74 2827 7061 6464 696e  tdefault('paddin
+00018d00: 6727 2c20 2753 414d 4527 290d 0a20 2020  g', 'SAME')..   
+00018d10: 2020 2020 206d 6574 612e 6d6f 6465 6c5f       meta.model_
+00018d20: 7370 6563 732e 7365 7464 6566 6175 6c74  specs.setdefault
+00018d30: 2827 706f 6f6c 5f74 7970 6527 2c20 276d  ('pool_type', 'm
+00018d40: 6178 2729 0d0a 2020 2020 2020 2020 6d65  ax')..        me
+00018d50: 7461 2e6d 6f64 656c 5f73 7065 6373 2e73  ta.model_specs.s
+00018d60: 6574 6465 6661 756c 7428 276e 6f6e 6c69  etdefault('nonli
+00018d70: 6e27 2c20 7466 2e6e 6e2e 7265 6c75 290d  n', tf.nn.relu).
+00018d80: 0a20 2020 2020 2020 206d 6574 612e 6d6f  .        meta.mo
+00018d90: 6465 6c5f 7370 6563 732e 7365 7464 6566  del_specs.setdef
+00018da0: 6175 6c74 2827 6c31 5f6c 616d 6264 6127  ault('l1_lambda'
+00018db0: 2c20 302e 290d 0a20 2020 2020 2020 206d  , 0.)..        m
+00018dc0: 6574 612e 6d6f 6465 6c5f 7370 6563 732e  eta.model_specs.
+00018dd0: 7365 7464 6566 6175 6c74 2827 6c32 5f6c  setdefault('l2_l
+00018de0: 616d 6264 6127 2c20 302e 290d 0a20 2020  ambda', 0.)..   
+00018df0: 2020 2020 206d 6574 612e 6d6f 6465 6c5f       meta.model_
+00018e00: 7370 6563 732e 7365 7464 6566 6175 6c74  specs.setdefault
+00018e10: 2827 6c31 5f73 636f 7065 272c 205b 5d29  ('l1_scope', [])
+00018e20: 0d0a 2020 2020 2020 2020 6d65 7461 2e6d  ..        meta.m
+00018e30: 6f64 656c 5f73 7065 6373 2e73 6574 6465  odel_specs.setde
+00018e40: 6661 756c 7428 276c 325f 7363 6f70 6527  fault('l2_scope'
+00018e50: 2c20 5b5d 290d 0a20 2020 2020 2020 206d  , [])..        m
+00018e60: 6574 612e 6d6f 6465 6c5f 7370 6563 735b  eta.model_specs[
+00018e70: 2773 636f 7065 275d 203d 2073 656c 662e  'scope'] = self.
+00018e80: 7363 6f70 650d 0a20 2020 2020 2020 206d  scope..        m
+00018e90: 6574 612e 6d6f 6465 6c5f 7370 6563 732e  eta.model_specs.
+00018ea0: 7365 7464 6566 6175 6c74 2827 756e 6974  setdefault('unit
+00018eb0: 6e6f 726d 5f73 636f 7065 272c 205b 5d29  norm_scope', [])
+00018ec0: 0d0a 2020 2020 2020 2020 2373 7065 6373  ..        #specs
+00018ed0: 2e73 6574 6465 6661 756c 7428 276d 6f64  .setdefault('mod
+00018ee0: 656c 5f70 6174 6827 2c20 2073 656c 662e  el_path',  self.
+00018ef0: 6461 7461 7365 742e 685f 7061 7261 6d73  dataset.h_params
+00018f00: 5b27 7361 7665 5f70 6174 6827 5d29 0d0a  ['save_path'])..
+00018f10: 2020 2020 2020 2020 7375 7065 7228 4c46          super(LF
+00018f20: 4c53 544d 2c20 7365 6c66 292e 5f5f 696e  LSTM, self).__in
+00018f30: 6974 5f5f 286d 6574 612c 2064 6174 6173  it__(meta, datas
+00018f40: 6574 290d 0a0d 0a0d 0a20 2020 2064 6566  et)......    def
+00018f50: 2062 7569 6c64 5f67 7261 7068 2873 656c   build_graph(sel
+00018f60: 6629 3a0d 0a20 2020 2020 2020 200d 0a20  f):..        .. 
+00018f70: 2020 2020 2020 2073 656c 662e 7265 7475         self.retu
+00018f80: 726e 5f73 6571 7565 6e63 6520 3d20 5472  rn_sequence = Tr
+00018f90: 7565 0d0a 2020 2020 2020 2020 7365 6c66  ue..        self
+00018fa0: 2e64 6d78 203d 2044 654d 6978 696e 6728  .dmx = DeMixing(
+00018fb0: 7369 7a65 3d73 656c 662e 7370 6563 735b  size=self.specs[
+00018fc0: 276e 5f6c 6174 656e 7427 5d2c 206e 6f6e  'n_latent'], non
+00018fd0: 6c69 6e3d 7466 2e69 6465 6e74 6974 792c  lin=tf.identity,
+00018fe0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018ff0: 2020 2020 2020 2020 2020 2020 2020 6178                ax
+00019000: 6973 3d33 2c20 7370 6563 733d 7365 6c66  is=3, specs=self
+00019010: 2e73 7065 6373 290d 0a20 2020 2020 2020  .specs)..       
+00019020: 2064 6d78 203d 2073 656c 662e 646d 7828   dmx = self.dmx(
+00019030: 7365 6c66 2e69 6e70 7574 7329 0d0a 2020  self.inputs)..  
+00019040: 2020 2020 2020 2364 6d78 203d 2074 662e        #dmx = tf.
+00019050: 7265 7368 6170 6528 646d 782c 205b 2d31  reshape(dmx, [-1
+00019060: 2c20 7365 6c66 2e64 6174 6173 6574 2e68  , self.dataset.h
+00019070: 5f70 6172 616d 735b 276e 5f74 275d 2c0d  _params['n_t'],.
+00019080: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
 00019090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000190a0: 2020 2020 2020 2020 2073 7472 6964 653d           stride=
-000190b0: 7365 6c66 2e73 7065 6373 5b27 7374 7269  self.specs['stri
-000190c0: 6465 275d 2c0d 0a23 2020 2020 2020 2020  de'],..#        
-000190d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000190e0: 2020 2020 2020 706f 6f6c 696e 673d 7365        pooling=se
-000190f0: 6c66 2e73 7065 6373 5b27 706f 6f6c 696e  lf.specs['poolin
-00019100: 6727 5d2c 0d0a 2020 2020 2020 2020 2020  g'],..          
-00019110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019120: 2020 2020 7061 6464 696e 673d 7365 6c66      padding=self
-00019130: 2e73 7065 6373 5b27 7061 6464 696e 6727  .specs['padding'
-00019140: 5d29 0d0a 0d0a 2020 2020 2020 2020 6665  ])....        fe
-00019150: 6174 7572 6573 203d 2073 656c 662e 7463  atures = self.tc
-00019160: 6f6e 7631 2864 6d78 290d 0a20 2020 2020  onv1(dmx)..     
-00019170: 2020 2070 6f6f 6c31 203d 2054 656d 7050     pool1 = TempP
-00019180: 6f6f 6c69 6e67 2873 7472 6964 653d 7365  ooling(stride=se
-00019190: 6c66 2e73 7065 6373 5b27 7374 7269 6465  lf.specs['stride
-000191a0: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
+000190a0: 2073 656c 662e 7370 6563 735b 276e 5f6c   self.specs['n_l
+000190b0: 6174 656e 7427 5d5d 290d 0a20 2020 2020  atent']])..     
+000190c0: 2020 2023 646d 7820 3d20 7466 2e65 7870     #dmx = tf.exp
+000190d0: 616e 645f 6469 6d73 2864 6d78 2c20 2d31  and_dims(dmx, -1
+000190e0: 290d 0a20 2020 2020 2020 2070 7269 6e74  )..        print
+000190f0: 2827 646d 782d 7371 6f75 743a 272c 2064  ('dmx-sqout:', d
+00019100: 6d78 2e73 6861 7065 290d 0a0d 0a20 2020  mx.shape)....   
+00019110: 2020 2020 2073 656c 662e 7463 6f6e 7631       self.tconv1
+00019120: 203d 204c 4654 436f 6e76 2873 636f 7065   = LFTConv(scope
+00019130: 3d22 636f 6e76 222c 0d0a 2020 2020 2020  ="conv",..      
+00019140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019150: 2020 2020 2020 2020 7369 7a65 3d73 656c          size=sel
+00019160: 662e 7370 6563 735b 276e 5f6c 6174 656e  f.specs['n_laten
+00019170: 7427 5d2c 0d0a 2020 2020 2020 2020 2020  t'],..          
+00019180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019190: 2020 2020 6e6f 6e6c 696e 3d74 662e 6e6e      nonlin=tf.nn
+000191a0: 2e72 656c 752c 0d0a 2020 2020 2020 2020  .relu,..        
 000191b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000191c0: 2070 6f6f 6c69 6e67 3d73 656c 662e 7370   pooling=self.sp
-000191d0: 6563 735b 2770 6f6f 6c69 6e67 275d 2c0d  ecs['pooling'],.
-000191e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000191f0: 2020 2020 2020 2020 2020 2020 2070 6164               pad
-00019200: 6469 6e67 3d27 5341 4d45 272c 0d0a 2020  ding='SAME',..  
-00019210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019220: 2020 2020 2020 2020 2020 706f 6f6c 5f74            pool_t
-00019230: 7970 653d 276d 6178 2729 0d0a 0d0a 0d0a  ype='max')......
-00019240: 2020 2020 2020 2020 706f 6f6c 6564 203d          pooled =
-00019250: 2070 6f6f 6c31 2866 6561 7475 7265 7329   pool1(features)
-00019260: 0d0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
-00019270: 2766 6561 7475 7265 733a 272c 2070 6f6f  'features:', poo
-00019280: 6c65 642e 7368 6170 6529 0d0a 0d0a 2020  led.shape)....  
-00019290: 2020 2020 2020 6673 6861 7065 203d 2074        fshape = t
-000192a0: 662e 6d75 6c74 6970 6c79 2870 6f6f 6c65  f.multiply(poole
-000192b0: 642e 7368 6170 655b 325d 2c20 706f 6f6c  d.shape[2], pool
-000192c0: 6564 2e73 6861 7065 5b33 5d29 0d0a 0d0a  ed.shape[3])....
-000192d0: 2020 2020 2020 2020 6666 6561 7475 7265          ffeature
-000192e0: 7320 3d20 7466 2e72 6573 6861 7065 2870  s = tf.reshape(p
-000192f0: 6f6f 6c65 642c 0d0a 2020 2020 2020 2020  ooled,..        
-00019300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019310: 2020 2020 2020 5b2d 312c 2073 656c 662e        [-1, self.
-00019320: 6461 7461 7365 742e 685f 7061 7261 6d73  dataset.h_params
-00019330: 5b27 6e5f 7365 7127 5d2c 2066 7368 6170  ['n_seq'], fshap
-00019340: 655d 290d 0a20 2020 2020 2020 2023 2020  e])..        #  
-00019350: 6665 6174 7572 6573 203d 2074 662e 6578  features = tf.ex
-00019360: 7061 6e64 5f64 696d 7328 6665 6174 7572  pand_dims(featur
-00019370: 6573 2c20 3029 0d0a 2020 2020 2020 2020  es, 0)..        
-00019380: 236c 315f 6c61 6d62 6461 203d 2073 656c  #l1_lambda = sel
-00019390: 662e 6f70 7469 6d69 7a65 722e 7061 7261  f.optimizer.para
-000193a0: 6d73 5b27 6c31 5f6c 616d 6264 6127 5d0d  ms['l1_lambda'].
-000193b0: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-000193c0: 666c 6174 2066 6561 7475 7265 733a 272c  flat features:',
-000193d0: 2066 6665 6174 7572 6573 2e73 6861 7065   ffeatures.shape
-000193e0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000193f0: 6c73 746d 203d 204c 5354 4d28 7363 6f70  lstm = LSTM(scop
-00019400: 653d 226c 7374 6d22 2c0d 0a20 2020 2020  e="lstm",..     
-00019410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019420: 2020 2020 2020 7369 7a65 3d73 656c 662e        size=self.
-00019430: 7370 6563 735b 276e 5f6c 6174 656e 7427  specs['n_latent'
-00019440: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-00019450: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-00019460: 6572 6e65 6c5f 696e 6974 6961 6c69 7a65  ernel_initialize
-00019470: 723d 2767 6c6f 726f 745f 756e 6966 6f72  r='glorot_unifor
-00019480: 6d27 2c0d 0a20 2020 2020 2020 2020 2020  m',..           
-00019490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000194a0: 7265 6375 7272 656e 745f 696e 6974 6961  recurrent_initia
-000194b0: 6c69 7a65 723d 276f 7274 686f 676f 6e61  lizer='orthogona
-000194c0: 6c27 2c0d 0a20 2020 2020 2020 2020 2020  l',..           
-000194d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000194e0: 7265 6375 7272 656e 745f 7265 6775 6c61  recurrent_regula
-000194f0: 7269 7a65 723d 6b5f 7265 672e 6c31 2873  rizer=k_reg.l1(s
-00019500: 656c 662e 7370 6563 735b 276c 315f 6c61  elf.specs['l1_la
-00019510: 6d62 6461 275d 292c 0d0a 2020 2020 2020  mbda']),..      
-00019520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019530: 2020 2020 206b 6572 6e65 6c5f 7265 6775       kernel_regu
-00019540: 6c61 7269 7a65 723d 6b5f 7265 672e 6c32  larizer=k_reg.l2
-00019550: 2873 656c 662e 7370 6563 735b 276c 325f  (self.specs['l2_
-00019560: 6c61 6d62 6461 275d 292c 0d0a 2020 2020  lambda']),..    
-00019570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019580: 2020 2020 2020 2062 6961 735f 7265 6775         bias_regu
-00019590: 6c61 7269 7a65 723d 4e6f 6e65 2c0d 0a20  larizer=None,.. 
-000195a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000195b0: 2020 2020 2020 2020 2020 2320 6163 7469            # acti
-000195c0: 7669 7479 5f72 6567 756c 6172 697a 6572  vity_regularizer
-000195d0: 3d20 7265 6775 6c61 7269 7a65 7273 2e6c  = regularizers.l
-000195e0: 3128 302e 3031 292c 0d0a 2020 2020 2020  1(0.01),..      
+000191c0: 2020 2020 2020 6669 6c74 6572 5f6c 656e        filter_len
+000191d0: 6774 683d 7365 6c66 2e73 7065 6373 5b27  gth=self.specs['
+000191e0: 6669 6c74 6572 5f6c 656e 6774 6827 5d2c  filter_length'],
+000191f0: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+00019200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019210: 2073 7472 6964 653d 7365 6c66 2e73 7065   stride=self.spe
+00019220: 6373 5b27 7374 7269 6465 275d 2c0d 0a23  cs['stride'],..#
+00019230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019240: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00019250: 6f6c 696e 673d 7365 6c66 2e73 7065 6373  oling=self.specs
+00019260: 5b27 706f 6f6c 696e 6727 5d2c 0d0a 2020  ['pooling'],..  
+00019270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019280: 2020 2020 2020 2020 2020 2020 7061 6464              padd
+00019290: 696e 673d 7365 6c66 2e73 7065 6373 5b27  ing=self.specs['
+000192a0: 7061 6464 696e 6727 5d29 0d0a 0d0a 2020  padding'])....  
+000192b0: 2020 2020 2020 6665 6174 7572 6573 203d        features =
+000192c0: 2073 656c 662e 7463 6f6e 7631 2864 6d78   self.tconv1(dmx
+000192d0: 290d 0a20 2020 2020 2020 2070 6f6f 6c31  )..        pool1
+000192e0: 203d 2054 656d 7050 6f6f 6c69 6e67 2873   = TempPooling(s
+000192f0: 7472 6964 653d 7365 6c66 2e73 7065 6373  tride=self.specs
+00019300: 5b27 7374 7269 6465 275d 2c0d 0a20 2020  ['stride'],..   
+00019310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019320: 2020 2020 2020 2020 2070 6f6f 6c69 6e67           pooling
+00019330: 3d73 656c 662e 7370 6563 735b 2770 6f6f  =self.specs['poo
+00019340: 6c69 6e67 275d 2c0d 0a20 2020 2020 2020  ling'],..       
+00019350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019360: 2020 2020 2070 6164 6469 6e67 3d27 5341       padding='SA
+00019370: 4d45 272c 0d0a 2020 2020 2020 2020 2020  ME',..          
+00019380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019390: 2020 706f 6f6c 5f74 7970 653d 276d 6178    pool_type='max
+000193a0: 2729 0d0a 0d0a 0d0a 2020 2020 2020 2020  ')......        
+000193b0: 706f 6f6c 6564 203d 2070 6f6f 6c31 2866  pooled = pool1(f
+000193c0: 6561 7475 7265 7329 0d0a 2020 2020 2020  eatures)..      
+000193d0: 2020 7072 696e 7428 2766 6561 7475 7265    print('feature
+000193e0: 733a 272c 2070 6f6f 6c65 642e 7368 6170  s:', pooled.shap
+000193f0: 6529 0d0a 0d0a 2020 2020 2020 2020 6673  e)....        fs
+00019400: 6861 7065 203d 2074 662e 6d75 6c74 6970  hape = tf.multip
+00019410: 6c79 2870 6f6f 6c65 642e 7368 6170 655b  ly(pooled.shape[
+00019420: 325d 2c20 706f 6f6c 6564 2e73 6861 7065  2], pooled.shape
+00019430: 5b33 5d29 0d0a 0d0a 2020 2020 2020 2020  [3])....        
+00019440: 6666 6561 7475 7265 7320 3d20 7466 2e72  ffeatures = tf.r
+00019450: 6573 6861 7065 2870 6f6f 6c65 642c 0d0a  eshape(pooled,..
+00019460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019470: 2020 2020 2020 2020 2020 2020 2020 5b2d                [-
+00019480: 312c 2073 656c 662e 6461 7461 7365 742e  1, self.dataset.
+00019490: 685f 7061 7261 6d73 5b27 6e5f 7365 7127  h_params['n_seq'
+000194a0: 5d2c 2066 7368 6170 655d 290d 0a20 2020  ], fshape])..   
+000194b0: 2020 2020 2023 2020 6665 6174 7572 6573       #  features
+000194c0: 203d 2074 662e 6578 7061 6e64 5f64 696d   = tf.expand_dim
+000194d0: 7328 6665 6174 7572 6573 2c20 3029 0d0a  s(features, 0)..
+000194e0: 2020 2020 2020 2020 236c 315f 6c61 6d62          #l1_lamb
+000194f0: 6461 203d 2073 656c 662e 6f70 7469 6d69  da = self.optimi
+00019500: 7a65 722e 7061 7261 6d73 5b27 6c31 5f6c  zer.params['l1_l
+00019510: 616d 6264 6127 5d0d 0a20 2020 2020 2020  ambda']..       
+00019520: 2070 7269 6e74 2827 666c 6174 2066 6561   print('flat fea
+00019530: 7475 7265 733a 272c 2066 6665 6174 7572  tures:', ffeatur
+00019540: 6573 2e73 6861 7065 290d 0a20 2020 2020  es.shape)..     
+00019550: 2020 2073 656c 662e 6c73 746d 203d 204c     self.lstm = L
+00019560: 5354 4d28 7363 6f70 653d 226c 7374 6d22  STM(scope="lstm"
+00019570: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00019580: 2020 2020 2020 2020 2020 2020 2020 7369                si
+00019590: 7a65 3d73 656c 662e 7370 6563 735b 276e  ze=self.specs['n
+000195a0: 5f6c 6174 656e 7427 5d2c 0d0a 2020 2020  _latent'],..    
+000195b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000195c0: 2020 2020 2020 206b 6572 6e65 6c5f 696e         kernel_in
+000195d0: 6974 6961 6c69 7a65 723d 2767 6c6f 726f  itializer='gloro
+000195e0: 745f 756e 6966 6f72 6d27 2c0d 0a20 2020  t_uniform',..   
 000195f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019600: 2020 2020 2023 206b 6572 6e65 6c5f 636f       # kernel_co
-00019610: 6e73 7472 6169 6e74 3d20 636f 6e73 7472  nstraint= constr
-00019620: 6169 6e74 732e 556e 6974 4e6f 726d 2861  aints.UnitNorm(a
-00019630: 7869 733d 3029 2c0d 0a20 2020 2020 2020  xis=0),..       
-00019640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019650: 2020 2020 2320 7265 6375 7272 656e 745f      # recurrent_
-00019660: 636f 6e73 7472 6169 6e74 3d20 636f 6e73  constraint= cons
-00019670: 7472 6169 6e74 732e 4e6f 6e4e 6567 2829  traints.NonNeg()
-00019680: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00019690: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000196a0: 6269 6173 5f63 6f6e 7374 7261 696e 743d  bias_constraint=
-000196b0: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2020  None,..         
-000196c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000196d0: 2020 6472 6f70 6f75 743d 302e 312c 2072    dropout=0.1, r
-000196e0: 6563 7572 7265 6e74 5f64 726f 706f 7574  ecurrent_dropout
-000196f0: 3d30 2e31 2c0d 0a20 2020 2020 2020 2020  =0.1,..         
-00019700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019710: 2020 6e6f 6e6c 696e 3d74 662e 6964 656e    nonlin=tf.iden
-00019720: 7469 7479 2c0d 0a20 2020 2020 2020 2020  tity,..         
-00019730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019740: 2020 756e 6974 5f66 6f72 6765 745f 6269    unit_forget_bi
-00019750: 6173 3d46 616c 7365 2c0d 0a20 2020 2020  as=False,..     
-00019760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019770: 2020 2020 2020 7265 7475 726e 5f73 6571        return_seq
-00019780: 7565 6e63 6573 3d73 656c 662e 7265 7475  uences=self.retu
-00019790: 726e 5f73 6571 7565 6e63 652c 0d0a 2020  rn_sequence,..  
-000197a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000197b0: 2020 2020 2020 2020 2075 6e72 6f6c 6c3d           unroll=
-000197c0: 4661 6c73 6529 0d0a 0d0a 2020 2020 2020  False)....      
-000197d0: 2020 7365 6c66 2e6c 7374 6d5f 6f75 7420    self.lstm_out 
-000197e0: 3d20 7365 6c66 2e6c 7374 6d28 6666 6561  = self.lstm(ffea
-000197f0: 7475 7265 7329 0d0a 2020 2020 2020 2020  tures)..        
-00019800: 7072 696e 7428 276c 7374 6d5f 6f75 743a  print('lstm_out:
-00019810: 272c 2073 656c 662e 6c73 746d 5f6f 7574  ', self.lstm_out
-00019820: 2e73 6861 7065 290d 0a0d 0a20 2020 2020  .shape)....     
-00019830: 2020 2069 6620 7365 6c66 2e72 6574 7572     if self.retur
-00019840: 6e5f 7365 7175 656e 6365 203d 3d20 5472  n_sequence == Tr
-00019850: 7565 3a0d 0a20 2020 2020 2020 2020 2020  ue:..           
-00019860: 2073 656c 662e 6669 6e5f 6663 203d 2044   self.fin_fc = D
-00019870: 654d 6978 696e 6728 7369 7a65 3d73 656c  eMixing(size=sel
-00019880: 662e 6f75 745f 6469 6d2c 0d0a 2020 2020  f.out_dim,..    
+00019600: 2020 2020 2020 2020 7265 6375 7272 656e          recurren
+00019610: 745f 696e 6974 6961 6c69 7a65 723d 276f  t_initializer='o
+00019620: 7274 686f 676f 6e61 6c27 2c0d 0a20 2020  rthogonal',..   
+00019630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019640: 2020 2020 2020 2020 7265 6375 7272 656e          recurren
+00019650: 745f 7265 6775 6c61 7269 7a65 723d 6b5f  t_regularizer=k_
+00019660: 7265 672e 6c31 2873 656c 662e 7370 6563  reg.l1(self.spec
+00019670: 735b 276c 315f 6c61 6d62 6461 275d 292c  s['l1_lambda']),
+00019680: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00019690: 2020 2020 2020 2020 2020 2020 206b 6572               ker
+000196a0: 6e65 6c5f 7265 6775 6c61 7269 7a65 723d  nel_regularizer=
+000196b0: 6b5f 7265 672e 6c32 2873 656c 662e 7370  k_reg.l2(self.sp
+000196c0: 6563 735b 276c 325f 6c61 6d62 6461 275d  ecs['l2_lambda']
+000196d0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+000196e0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+000196f0: 6961 735f 7265 6775 6c61 7269 7a65 723d  ias_regularizer=
+00019700: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2020  None,..         
+00019710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019720: 2020 2320 6163 7469 7669 7479 5f72 6567    # activity_reg
+00019730: 756c 6172 697a 6572 3d20 7265 6775 6c61  ularizer= regula
+00019740: 7269 7a65 7273 2e6c 3128 302e 3031 292c  rizers.l1(0.01),
+00019750: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00019760: 2020 2020 2020 2020 2020 2020 2023 206b               # k
+00019770: 6572 6e65 6c5f 636f 6e73 7472 6169 6e74  ernel_constraint
+00019780: 3d20 636f 6e73 7472 6169 6e74 732e 556e  = constraints.Un
+00019790: 6974 4e6f 726d 2861 7869 733d 3029 2c0d  itNorm(axis=0),.
+000197a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000197b0: 2020 2020 2020 2020 2020 2020 2320 7265              # re
+000197c0: 6375 7272 656e 745f 636f 6e73 7472 6169  current_constrai
+000197d0: 6e74 3d20 636f 6e73 7472 6169 6e74 732e  nt= constraints.
+000197e0: 4e6f 6e4e 6567 2829 2c0d 0a20 2020 2020  NonNeg(),..     
+000197f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019800: 2020 2020 2020 2320 6269 6173 5f63 6f6e        # bias_con
+00019810: 7374 7261 696e 743d 4e6f 6e65 2c0d 0a20  straint=None,.. 
+00019820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019830: 2020 2020 2020 2020 2020 6472 6f70 6f75            dropou
+00019840: 743d 302e 312c 2072 6563 7572 7265 6e74  t=0.1, recurrent
+00019850: 5f64 726f 706f 7574 3d30 2e31 2c0d 0a20  _dropout=0.1,.. 
+00019860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019870: 2020 2020 2020 2020 2020 6e6f 6e6c 696e            nonlin
+00019880: 3d74 662e 6964 656e 7469 7479 2c0d 0a20  =tf.identity,.. 
 00019890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000198a0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-000198b0: 6f6e 6c69 6e3d 7466 2e69 6465 6e74 6974  onlin=tf.identit
-000198c0: 792c 2061 7869 733d 3229 0d0a 2020 2020  y, axis=2)..    
-000198d0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-000198e0: 2020 2020 2020 2073 656c 662e 6669 6e5f         self.fin_
-000198f0: 6663 203d 2046 756c 6c79 436f 6e6e 6563  fc = FullyConnec
-00019900: 7465 6428 7369 7a65 3d73 656c 662e 6f75  ted(size=self.ou
-00019910: 745f 6469 6d2c 206e 6f6e 6c69 6e3d 7466  t_dim, nonlin=tf
-00019920: 2e69 6465 6e74 6974 792c 0d0a 2020 2020  .identity,..    
-00019930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019940: 2020 2020 2020 2020 2020 2020 7370 6563              spec
-00019950: 733d 7365 6c66 2e73 7065 6373 290d 0a20  s=self.specs).. 
-00019960: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
-00019970: 2020 2020 2079 5f70 7265 6420 3d20 7365       y_pred = se
-00019980: 6c66 2e66 696e 5f66 6328 7365 6c66 2e6c  lf.fin_fc(self.l
-00019990: 7374 6d5f 6f75 7429 0d0a 2020 2020 2020  stm_out)..      
-000199a0: 2020 7072 696e 7428 2266 696e 2066 6320    print("fin fc 
-000199b0: 6f75 743a 222c 2079 5f70 7265 642e 7368  out:", y_pred.sh
-000199c0: 6170 6529 0d0a 2020 2020 2020 2020 7265  ape)..        re
-000199d0: 7475 726e 2079 5f70 7265 640d 0a23 0d0a  turn y_pred..#..
-000199e0: 230d 0a0d 0a0d 0a63 6c61 7373 2044 6565  #......class Dee
-000199f0: 7034 2842 6173 654d 6f64 656c 293a 0d0a  p4(BaseModel):..
-00019a00: 2020 2020 2222 220d 0a20 2020 2044 6565      """..    Dee
-00019a10: 7020 436f 6e76 4e65 7420 6d6f 6465 6c20  p ConvNet model 
-00019a20: 6672 6f6d 205b 3262 5d5f 2e0d 0a20 2020  from [2b]_...   
-00019a30: 2052 6566 6572 656e 6365 730d 0a20 2020   References..   
-00019a40: 202d 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020   ----------..   
-00019a50: 202e 2e20 5b32 625d 2053 6368 6972 726d   .. [2b] Schirrm
-00019a60: 6569 7374 6572 2c20 522e 2054 2e2c 2053  eister, R. T., S
-00019a70: 7072 696e 6765 6e62 6572 672c 204a 2e20  pringenberg, J. 
-00019a80: 542e 2c20 4669 6564 6572 6572 2c20 4c2e  T., Fiederer, L.
-00019a90: 2044 2e20 4a2e 2c0d 0a20 2020 2020 2020   D. J.,..       
-00019aa0: 476c 6173 7374 6574 7465 722c 204d 2e2c  Glasstetter, M.,
-00019ab0: 2045 6767 656e 7370 6572 6765 722c 204b   Eggensperger, K
-00019ac0: 2e2c 2054 616e 6765 726d 616e 6e2c 204d  ., Tangermann, M
-00019ad0: 2e2c 2048 7574 7465 722c 2046 2e20 2620  ., Hutter, F. & 
-00019ae0: 4261 6c6c 2c20 542e 2028 3230 3137 292e  Ball, T. (2017).
-00019af0: 0d0a 2020 2020 2020 2044 6565 7020 6c65  ..       Deep le
-00019b00: 6172 6e69 6e67 2077 6974 6820 636f 6e76  arning with conv
-00019b10: 6f6c 7574 696f 6e61 6c20 6e65 7572 616c  olutional neural
-00019b20: 206e 6574 776f 726b 7320 666f 7220 4545   networks for EE
-00019b30: 4720 6465 636f 6469 6e67 2061 6e64 0d0a  G decoding and..
-00019b40: 2020 2020 2020 2076 6973 7561 6c69 7a61         visualiza
-00019b50: 7469 6f6e 2e0d 0a20 2020 2020 2020 4875  tion...       Hu
-00019b60: 6d61 6e20 4272 6169 6e20 4d61 7070 696e  man Brain Mappin
-00019b70: 6720 2c20 4175 672e 2032 3031 372e 204f  g , Aug. 2017. O
-00019b80: 6e6c 696e 653a 2068 7474 703a 2f2f 6478  nline: http://dx
-00019b90: 2e64 6f69 2e6f 7267 2f31 302e 3130 3032  .doi.org/10.1002
-00019ba0: 2f68 626d 2e32 3337 3330 0d0a 2020 2020  /hbm.23730..    
-00019bb0: 2222 220d 0a20 2020 2064 6566 205f 5f69  """..    def __i
-00019bc0: 6e69 745f 5f28 7365 6c66 2c20 6d65 7461  nit__(self, meta
-00019bd0: 2c20 6461 7461 7365 743d 4e6f 6e65 293a  , dataset=None):
-00019be0: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-00019bf0: 636f 7065 203d 2027 6465 6570 3427 0d0a  cope = 'deep4'..
-00019c00: 2020 2020 2020 2020 6d65 7461 2e6d 6f64          meta.mod
-00019c10: 656c 5f73 7065 6373 2e73 6574 6465 6661  el_specs.setdefa
-00019c20: 756c 7428 2766 696c 7465 725f 6c65 6e67  ult('filter_leng
-00019c30: 7468 272c 2031 3029 0d0a 2020 2020 2020  th', 10)..      
-00019c40: 2020 6d65 7461 2e6d 6f64 656c 5f73 7065    meta.model_spe
-00019c50: 6373 2e73 6574 6465 6661 756c 7428 276e  cs.setdefault('n
-00019c60: 5f6c 6174 656e 7427 2c20 3235 290d 0a20  _latent', 25).. 
-00019c70: 2020 2020 2020 206d 6574 612e 6d6f 6465         meta.mode
-00019c80: 6c5f 7370 6563 732e 7365 7464 6566 6175  l_specs.setdefau
-00019c90: 6c74 2827 706f 6f6c 696e 6727 2c20 3329  lt('pooling', 3)
-00019ca0: 0d0a 2020 2020 2020 2020 6d65 7461 2e6d  ..        meta.m
-00019cb0: 6f64 656c 5f73 7065 6373 2e73 6574 6465  odel_specs.setde
-00019cc0: 6661 756c 7428 2773 7472 6964 6527 2c20  fault('stride', 
-00019cd0: 3329 0d0a 2020 2020 2020 2020 6d65 7461  3)..        meta
-00019ce0: 2e6d 6f64 656c 5f73 7065 6373 2e73 6574  .model_specs.set
-00019cf0: 6465 6661 756c 7428 2770 6f6f 6c5f 7479  default('pool_ty
-00019d00: 7065 272c 2027 6d61 7827 290d 0a20 2020  pe', 'max')..   
-00019d10: 2020 2020 206d 6574 612e 6d6f 6465 6c5f       meta.model_
-00019d20: 7370 6563 732e 7365 7464 6566 6175 6c74  specs.setdefault
-00019d30: 2827 7061 6464 696e 6727 2c20 2753 414d  ('padding', 'SAM
-00019d40: 4527 290d 0a20 2020 2020 2020 206d 6574  E')..        met
-00019d50: 612e 6d6f 6465 6c5f 7370 6563 732e 7365  a.model_specs.se
-00019d60: 7464 6566 6175 6c74 2827 6e6f 6e6c 696e  tdefault('nonlin
-00019d70: 272c 2074 662e 6e6e 2e65 6c75 290d 0a20  ', tf.nn.elu).. 
-00019d80: 2020 2020 2020 206d 6574 612e 6d6f 6465         meta.mode
-00019d90: 6c5f 7370 6563 732e 7365 7464 6566 6175  l_specs.setdefau
-00019da0: 6c74 2827 6c31 5f6c 616d 6264 6127 2c20  lt('l1_lambda', 
-00019db0: 3029 0d0a 2020 2020 2020 2020 6d65 7461  0)..        meta
-00019dc0: 2e6d 6f64 656c 5f73 7065 6373 2e73 6574  .model_specs.set
-00019dd0: 6465 6661 756c 7428 276c 325f 6c61 6d62  default('l2_lamb
-00019de0: 6461 272c 2030 290d 0a20 2020 2020 2020  da', 0)..       
-00019df0: 206d 6574 612e 6d6f 6465 6c5f 7370 6563   meta.model_spec
-00019e00: 732e 7365 7464 6566 6175 6c74 2827 6c31  s.setdefault('l1
-00019e10: 5f73 636f 7065 272c 205b 5d29 0d0a 2020  _scope', [])..  
-00019e20: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
-00019e30: 5f73 7065 6373 2e73 6574 6465 6661 756c  _specs.setdefaul
-00019e40: 7428 276c 325f 7363 6f70 6527 2c20 5b5d  t('l2_scope', []
-00019e50: 290d 0a20 2020 2020 2020 206d 6574 612e  )..        meta.
-00019e60: 6d6f 6465 6c5f 7370 6563 732e 7365 7464  model_specs.setd
-00019e70: 6566 6175 6c74 2827 756e 6974 6e6f 726d  efault('unitnorm
-00019e80: 5f73 636f 7065 272c 205b 5d29 0d0a 2020  _scope', [])..  
-00019e90: 2020 2020 2020 2373 7065 6373 2e73 6574        #specs.set
-00019ea0: 6465 6661 756c 7428 276d 6f64 656c 5f70  default('model_p
-00019eb0: 6174 6827 2c20 6f73 2e70 6174 682e 6a6f  ath', os.path.jo
-00019ec0: 696e 2873 656c 662e 6461 7461 7365 742e  in(self.dataset.
-00019ed0: 685f 7061 7261 6d73 5b27 7061 7468 275d  h_params['path']
-00019ee0: 2c20 276d 6f64 656c 7327 2929 0d0a 2020  , 'models'))..  
-00019ef0: 2020 2020 2020 7375 7065 7228 4465 6570        super(Deep
-00019f00: 342c 2073 656c 6629 2e5f 5f69 6e69 745f  4, self).__init_
-00019f10: 5f28 6d65 7461 2c20 6461 7461 7365 7429  _(meta, dataset)
-00019f20: 0d0a 0d0a 2020 2020 6465 6620 6275 696c  ....    def buil
-00019f30: 645f 6772 6170 6828 7365 6c66 293a 0d0a  d_graph(self):..
-00019f40: 2020 2020 2020 2020 7365 6c66 2e73 636f          self.sco
-00019f50: 7065 203d 2027 6465 6570 3427 0d0a 0d0a  pe = 'deep4'....
-00019f60: 2020 2020 2020 2020 696e 7075 7473 203d          inputs =
-00019f70: 2074 662e 7472 616e 7370 6f73 6528 7365   tf.transpose(se
-00019f80: 6c66 2e69 6e70 7574 732c 5b30 2c33 2c32  lf.inputs,[0,3,2
-00019f90: 2c31 5d29 0d0a 0d0a 2020 2020 2020 2020  ,1])....        
-00019fa0: 7463 6f6e 7631 203d 2044 6570 7468 7769  tconv1 = Depthwi
-00019fb0: 7365 436f 6e76 3244 280d 0a20 2020 2020  seConv2D(..     
-00019fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019fd0: 2020 206b 6572 6e65 6c5f 7369 7a65 3d28     kernel_size=(
-00019fe0: 312c 2073 656c 662e 7370 6563 735b 2766  1, self.specs['f
-00019ff0: 696c 7465 725f 6c65 6e67 7468 275d 292c  ilter_length']),
-0001a000: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001a010: 2020 2020 2020 2020 2020 6465 7074 685f            depth_
-0001a020: 6d75 6c74 6970 6c69 6572 203d 2073 656c  multiplier = sel
-0001a030: 662e 7370 6563 735b 276e 5f6c 6174 656e  f.specs['n_laten
-0001a040: 7427 5d2c 0d0a 2020 2020 2020 2020 2020  t'],..          
-0001a050: 2020 2020 2020 2020 2020 2020 2020 7374                st
-0001a060: 7269 6465 733d 312c 0d0a 2020 2020 2020  rides=1,..      
-0001a070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a080: 2020 7061 6464 696e 673d 7365 6c66 2e73    padding=self.s
-0001a090: 7065 6373 5b27 7061 6464 696e 6727 5d2c  pecs['padding'],
-0001a0a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001a0b0: 2020 2020 2020 2020 2020 6163 7469 7661            activa
-0001a0c0: 7469 6f6e 203d 2074 662e 6964 656e 7469  tion = tf.identi
-0001a0d0: 7479 2c0d 0a20 2020 2020 2020 2020 2020  ty,..           
-0001a0e0: 2020 2020 2020 2020 2020 2020 206b 6572               ker
-0001a0f0: 6e65 6c5f 696e 6974 6961 6c69 7a65 723d  nel_initializer=
-0001a100: 2268 655f 756e 6966 6f72 6d22 2c0d 0a20  "he_uniform",.. 
-0001a110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a120: 2020 2020 2020 2062 6961 735f 696e 6974         bias_init
-0001a130: 6961 6c69 7a65 723d 436f 6e73 7461 6e74  ializer=Constant
-0001a140: 2830 2e31 292c 0d0a 2020 2020 2020 2020  (0.1),..        
-0001a150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a160: 6461 7461 5f66 6f72 6d61 743d 2263 6861  data_format="cha
-0001a170: 6e6e 656c 735f 6c61 7374 222c 0d0a 2020  nnels_last",..  
-0001a180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a190: 2020 2020 2020 6b65 726e 656c 5f72 6567        kernel_reg
-0001a1a0: 756c 6172 697a 6572 3d6b 5f72 6567 2e6c  ularizer=k_reg.l
-0001a1b0: 3228 7365 6c66 2e73 7065 6373 5b27 6c32  2(self.specs['l2
-0001a1c0: 5f6c 616d 6264 6127 5d29 0d0a 2020 2020  _lambda'])..    
-0001a1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a1e0: 2020 2020 236b 6572 6e65 6c5f 636f 6e73      #kernel_cons
-0001a1f0: 7472 6169 6e74 3d22 6d61 786e 6f72 6d22  traint="maxnorm"
-0001a200: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001a210: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-0001a220: 2020 2020 2074 636f 6e76 315f 6f75 7420       tconv1_out 
-0001a230: 3d20 7463 6f6e 7631 2869 6e70 7574 7329  = tconv1(inputs)
-0001a240: 0d0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
-0001a250: 2774 636f 6e76 313a 2027 2c20 7463 6f6e  'tconv1: ', tcon
-0001a260: 7631 5f6f 7574 2e73 6861 7065 2920 2373  v1_out.shape) #s
-0001a270: 686f 756c 6420 6265 206e 5f62 6174 6368  hould be n_batch
-0001a280: 2c20 7365 6e73 6f72 732c 2074 696d 6573  , sensors, times
-0001a290: 2c20 6b65 726e 656c 730d 0a0d 0a20 2020  , kernels....   
-0001a2a0: 2020 2020 2073 636f 6e76 3120 3d20 436f       sconv1 = Co
-0001a2b0: 6e76 3244 2866 696c 7465 7273 3d73 656c  nv2D(filters=sel
-0001a2c0: 662e 7370 6563 735b 276e 5f6c 6174 656e  f.specs['n_laten
-0001a2d0: 7427 5d2c 0d0a 2020 2020 2020 2020 2020  t'],..          
-0001a2e0: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
-0001a2f0: 726e 656c 5f73 697a 653d 2873 656c 662e  rnel_size=(self.
-0001a300: 6461 7461 7365 742e 685f 7061 7261 6d73  dataset.h_params
-0001a310: 5b27 6e5f 6368 275d 2c20 3129 2c0d 0a20  ['n_ch'], 1),.. 
-0001a320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a330: 2020 2020 2020 2073 7472 6964 6573 3d31         strides=1
-0001a340: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0001a350: 2020 2020 2020 2020 2020 2070 6164 6469             paddi
-0001a360: 6e67 3d73 656c 662e 7370 6563 735b 2770  ng=self.specs['p
-0001a370: 6164 6469 6e67 275d 2c0d 0a20 2020 2020  adding'],..     
-0001a380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a390: 2020 2061 6374 6976 6174 696f 6e3d 7365     activation=se
-0001a3a0: 6c66 2e73 7065 6373 5b27 6e6f 6e6c 696e  lf.specs['nonlin
-0001a3b0: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
-0001a3c0: 2020 2020 2020 2020 2020 2020 206b 6572               ker
-0001a3d0: 6e65 6c5f 696e 6974 6961 6c69 7a65 723d  nel_initializer=
-0001a3e0: 2268 655f 756e 6966 6f72 6d22 2c0d 0a20  "he_uniform",.. 
-0001a3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a400: 2020 2020 2020 2062 6961 735f 696e 6974         bias_init
-0001a410: 6961 6c69 7a65 723d 436f 6e73 7461 6e74  ializer=Constant
-0001a420: 2830 2e31 292c 0d0a 2020 2020 2020 2020  (0.1),..        
-0001a430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a440: 6461 7461 5f66 6f72 6d61 743d 2263 6861  data_format="cha
-0001a450: 6e6e 656c 735f 6c61 7374 222c 0d0a 2020  nnels_last",..  
-0001a460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a470: 2020 2020 2020 2364 6174 615f 666f 726d        #data_form
-0001a480: 6174 3d22 6368 616e 6e65 6c73 5f66 6972  at="channels_fir
-0001a490: 7374 222c 0d0a 2020 2020 2020 2020 2020  st",..          
-0001a4a0: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
-0001a4b0: 726e 656c 5f72 6567 756c 6172 697a 6572  rnel_regularizer
-0001a4c0: 3d6b 5f72 6567 2e6c 3228 7365 6c66 2e73  =k_reg.l2(self.s
-0001a4d0: 7065 6373 5b27 6c32 5f6c 616d 6264 6127  pecs['l2_lambda'
-0001a4e0: 5d29 290d 0a20 2020 2020 2020 2073 636f  ]))..        sco
-0001a4f0: 6e76 315f 6f75 7420 3d20 7363 6f6e 7631  nv1_out = sconv1
-0001a500: 2874 636f 6e76 315f 6f75 7429 0d0a 2020  (tconv1_out)..  
-0001a510: 2020 2020 2020 7072 696e 7428 2773 636f        print('sco
-0001a520: 6e76 313a 272c 2020 7363 6f6e 7631 5f6f  nv1:',  sconv1_o
-0001a530: 7574 2e73 6861 7065 290d 0a0d 0a20 2020  ut.shape)....   
-0001a540: 2020 2020 2070 6f6f 6c31 203d 2054 656d       pool1 = Tem
-0001a550: 7050 6f6f 6c69 6e67 2870 6f6f 6c69 6e67  pPooling(pooling
-0001a560: 3d73 656c 662e 7370 6563 735b 2770 6f6f  =self.specs['poo
-0001a570: 6c69 6e67 275d 2c0d 0a20 2020 2020 2020  ling'],..       
-0001a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a590: 2020 2020 2020 2020 2020 2070 6f6f 6c5f             pool_
-0001a5a0: 7479 7065 3d22 6176 6722 2c0d 0a20 2020  type="avg",..   
-0001a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a5c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001a5d0: 7472 6964 653d 7365 6c66 2e73 7065 6373  tride=self.specs
-0001a5e0: 5b27 7374 7269 6465 275d 2c0d 0a20 2020  ['stride'],..   
-0001a5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a600: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001a610: 6164 6469 6e67 3d27 5341 4d45 272c 0d0a  adding='SAME',..
-0001a620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a640: 2020 2928 7363 6f6e 7631 5f6f 7574 290d    )(sconv1_out).
-0001a650: 0a0d 0a20 2020 2020 2020 2070 7269 6e74  ...        print
-0001a660: 2827 706f 6f6c 313a 2027 2c20 706f 6f6c  ('pool1: ', pool
-0001a670: 312e 7368 6170 6529 0d0a 0d0a 2020 2020  1.shape)....    
-0001a680: 2020 2020 2323 2323 2323 2323 2323 2323      ############
-0001a690: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a6a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a6b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001a6c0: 0d0a 0d0a 2020 2020 2020 2020 7473 636f  ....        tsco
-0001a6d0: 6e76 3220 3d20 436f 6e76 3244 2866 696c  nv2 = Conv2D(fil
-0001a6e0: 7465 7273 3d73 656c 662e 7370 6563 735b  ters=self.specs[
-0001a6f0: 276e 5f6c 6174 656e 7427 5d2a 322c 0d0a  'n_latent']*2,..
-0001a700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a710: 2020 2020 2020 2020 6b65 726e 656c 5f73          kernel_s
-0001a720: 697a 653d 2831 2c20 7365 6c66 2e73 7065  ize=(1, self.spe
-0001a730: 6373 5b27 6669 6c74 6572 5f6c 656e 6774  cs['filter_lengt
-0001a740: 6827 5d29 2c0d 0a20 2020 2020 2020 2020  h']),..         
-0001a750: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001a760: 7472 6964 6573 3d31 2c0d 0a20 2020 2020  trides=1,..     
-0001a770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a780: 2020 2070 6164 6469 6e67 3d73 656c 662e     padding=self.
-0001a790: 7370 6563 735b 2770 6164 6469 6e67 275d  specs['padding']
-0001a7a0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0001a7b0: 2020 2020 2020 2020 2020 2061 6374 6976             activ
-0001a7c0: 6174 696f 6e3d 7365 6c66 2e73 7065 6373  ation=self.specs
-0001a7d0: 5b27 6e6f 6e6c 696e 275d 2c0d 0a20 2020  ['nonlin'],..   
-0001a7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a7f0: 2020 2020 206b 6572 6e65 6c5f 696e 6974       kernel_init
-0001a800: 6961 6c69 7a65 723d 2268 655f 756e 6966  ializer="he_unif
-0001a810: 6f72 6d22 2c0d 0a20 2020 2020 2020 2020  orm",..         
-0001a820: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0001a830: 6961 735f 696e 6974 6961 6c69 7a65 723d  ias_initializer=
-0001a840: 436f 6e73 7461 6e74 2830 2e31 292c 0d0a  Constant(0.1),..
-0001a850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a860: 2020 2020 2020 2020 6461 7461 5f66 6f72          data_for
-0001a870: 6d61 743d 2263 6861 6e6e 656c 735f 6c61  mat="channels_la
-0001a880: 7374 222c 0d0a 2020 2020 2020 2020 2020  st",..          
-0001a890: 2020 2020 2020 2020 2020 2020 2020 2364                #d
-0001a8a0: 6174 615f 666f 726d 6174 3d22 6368 616e  ata_format="chan
-0001a8b0: 6e65 6c73 5f66 6972 7374 222c 0d0a 2020  nels_first",..  
-0001a8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a8d0: 2020 2020 2020 6b65 726e 656c 5f72 6567        kernel_reg
-0001a8e0: 756c 6172 697a 6572 3d6b 5f72 6567 2e6c  ularizer=k_reg.l
-0001a8f0: 3228 7365 6c66 2e73 7065 6373 5b27 6c32  2(self.specs['l2
-0001a900: 5f6c 616d 6264 6127 5d29 290d 0a0d 0a0d  _lambda'])).....
-0001a910: 0a20 2020 2020 2020 2074 7363 6f6e 7632  .        tsconv2
-0001a920: 5f6f 7574 203d 2074 7363 6f6e 7632 2870  _out = tsconv2(p
-0001a930: 6f6f 6c31 290d 0a20 2020 2020 2020 2070  ool1)..        p
-0001a940: 7269 6e74 2827 7473 636f 6e76 323a 272c  rint('tsconv2:',
-0001a950: 2020 7473 636f 6e76 325f 6f75 742e 7368    tsconv2_out.sh
-0001a960: 6170 6529 0d0a 0d0a 2020 2020 2020 2020  ape)....        
-0001a970: 706f 6f6c 3220 3d20 5465 6d70 506f 6f6c  pool2 = TempPool
-0001a980: 696e 6728 706f 6f6c 696e 673d 7365 6c66  ing(pooling=self
-0001a990: 2e73 7065 6373 5b27 706f 6f6c 696e 6727  .specs['pooling'
-0001a9a0: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-0001a9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a9c0: 2020 2020 2020 706f 6f6c 5f74 7970 653d        pool_type=
-0001a9d0: 2261 7667 222c 0d0a 2020 2020 2020 2020  "avg",..        
-0001a9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a9f0: 2020 2020 2020 2020 2020 7374 7269 6465            stride
-0001aa00: 3d73 656c 662e 7370 6563 735b 2773 7472  =self.specs['str
-0001aa10: 6964 6527 5d2c 0d0a 2020 2020 2020 2020  ide'],..        
-0001aa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa30: 2020 2020 2020 2020 2020 7061 6464 696e            paddin
-0001aa40: 673d 2753 414d 4527 2c0d 0a20 2020 2020  g='SAME',..     
-0001aa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa60: 2020 2020 2020 2020 2020 2020 2029 2874               )(t
-0001aa70: 7363 6f6e 7632 5f6f 7574 290d 0a0d 0a20  sconv2_out).... 
-0001aa80: 2020 2020 2020 2070 7269 6e74 2827 706f         print('po
-0001aa90: 6f6c 323a 2027 2c20 706f 6f6c 322e 7368  ol2: ', pool2.sh
-0001aaa0: 6170 6529 0d0a 0d0a 0d0a 2020 2020 2020  ape)......      
-0001aab0: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
-0001aac0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001aad0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001aae0: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
-0001aaf0: 0d0a 2020 2020 2020 2020 7473 636f 6e76  ..        tsconv
-0001ab00: 3320 3d20 436f 6e76 3244 2866 696c 7465  3 = Conv2D(filte
-0001ab10: 7273 3d73 656c 662e 7370 6563 735b 276e  rs=self.specs['n
-0001ab20: 5f6c 6174 656e 7427 5d2a 342c 0d0a 2020  _latent']*4,..  
-0001ab30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab40: 2020 2020 2020 6b65 726e 656c 5f73 697a        kernel_siz
-0001ab50: 653d 2831 2c20 7365 6c66 2e73 7065 6373  e=(1, self.specs
-0001ab60: 5b27 6669 6c74 6572 5f6c 656e 6774 6827  ['filter_length'
-0001ab70: 5d29 2c0d 0a20 2020 2020 2020 2020 2020  ]),..           
-0001ab80: 2020 2020 2020 2020 2020 2020 2073 7472               str
-0001ab90: 6964 6573 3d31 2c0d 0a20 2020 2020 2020  ides=1,..       
-0001aba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001abb0: 2070 6164 6469 6e67 3d73 656c 662e 7370   padding=self.sp
-0001abc0: 6563 735b 2770 6164 6469 6e67 275d 2c0d  ecs['padding'],.
-0001abd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001abe0: 2020 2020 2020 2020 2061 6374 6976 6174           activat
-0001abf0: 696f 6e3d 7365 6c66 2e73 7065 6373 5b27  ion=self.specs['
-0001ac00: 6e6f 6e6c 696e 275d 2c0d 0a20 2020 2020  nonlin'],..     
-0001ac10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac20: 2020 206b 6572 6e65 6c5f 696e 6974 6961     kernel_initia
-0001ac30: 6c69 7a65 723d 2268 655f 756e 6966 6f72  lizer="he_unifor
-0001ac40: 6d22 2c0d 0a20 2020 2020 2020 2020 2020  m",..           
-0001ac50: 2020 2020 2020 2020 2020 2020 2062 6961               bia
-0001ac60: 735f 696e 6974 6961 6c69 7a65 723d 436f  s_initializer=Co
-0001ac70: 6e73 7461 6e74 2830 2e31 292c 0d0a 2020  nstant(0.1),..  
-0001ac80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac90: 2020 2020 2020 6461 7461 5f66 6f72 6d61        data_forma
-0001aca0: 743d 2263 6861 6e6e 656c 735f 6c61 7374  t="channels_last
-0001acb0: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
-0001acc0: 2020 2020 2020 2020 2020 2020 2364 6174              #dat
-0001acd0: 615f 666f 726d 6174 3d22 6368 616e 6e65  a_format="channe
-0001ace0: 6c73 5f66 6972 7374 222c 0d0a 2020 2020  ls_first",..    
-0001acf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad00: 2020 2020 6b65 726e 656c 5f72 6567 756c      kernel_regul
-0001ad10: 6172 697a 6572 3d6b 5f72 6567 2e6c 3228  arizer=k_reg.l2(
-0001ad20: 7365 6c66 2e73 7065 6373 5b27 6c32 5f6c  self.specs['l2_l
-0001ad30: 616d 6264 6127 5d29 290d 0a0d 0a0d 0a20  ambda']))...... 
-0001ad40: 2020 2020 2020 2074 7363 6f6e 7633 5f6f         tsconv3_o
-0001ad50: 7574 203d 2074 7363 6f6e 7633 2870 6f6f  ut = tsconv3(poo
-0001ad60: 6c32 290d 0a20 2020 2020 2020 2070 7269  l2)..        pri
-0001ad70: 6e74 2827 7473 636f 6e76 333a 272c 2020  nt('tsconv3:',  
-0001ad80: 7473 636f 6e76 335f 6f75 742e 7368 6170  tsconv3_out.shap
-0001ad90: 6529 0d0a 0d0a 2020 2020 2020 2020 706f  e)....        po
-0001ada0: 6f6c 3320 3d20 5465 6d70 506f 6f6c 696e  ol3 = TempPoolin
-0001adb0: 6728 706f 6f6c 696e 673d 7365 6c66 2e73  g(pooling=self.s
-0001adc0: 7065 6373 5b27 706f 6f6c 696e 6727 5d2c  pecs['pooling'],
-0001add0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001ade0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001adf0: 2020 2020 706f 6f6c 5f74 7970 653d 2261      pool_type="a
-0001ae00: 7667 222c 0d0a 2020 2020 2020 2020 2020  vg",..          
-0001ae10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae20: 2020 2020 2020 2020 7374 7269 6465 3d73          stride=s
-0001ae30: 656c 662e 7370 6563 735b 2773 7472 6964  elf.specs['strid
-0001ae40: 6527 5d2c 0d0a 2020 2020 2020 2020 2020  e'],..          
-0001ae50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae60: 2020 2020 2020 2020 7061 6464 696e 673d          padding=
-0001ae70: 2753 414d 4527 2c0d 0a20 2020 2020 2020  'SAME',..       
-0001ae80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae90: 2020 2020 2020 2020 2020 2029 2874 7363             )(tsc
-0001aea0: 6f6e 7633 5f6f 7574 290d 0a0d 0a20 2020  onv3_out)....   
-0001aeb0: 2020 2020 2070 7269 6e74 2827 706f 6f6c       print('pool
-0001aec0: 333a 2027 2c20 706f 6f6c 332e 7368 6170  3: ', pool3.shap
-0001aed0: 6529 0d0a 0d0a 2020 2020 2020 2020 2323  e)....        ##
-0001aee0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001aef0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001af00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001af10: 2323 2323 2323 2323 2323 0d0a 0d0a 2020  ##########....  
-0001af20: 2020 2020 2020 7473 636f 6e76 3420 3d20        tsconv4 = 
-0001af30: 436f 6e76 3244 2866 696c 7465 7273 3d73  Conv2D(filters=s
-0001af40: 656c 662e 7370 6563 735b 276e 5f6c 6174  elf.specs['n_lat
-0001af50: 656e 7427 5d2a 382c 0d0a 2020 2020 2020  ent']*8,..      
-0001af60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af70: 2020 6b65 726e 656c 5f73 697a 653d 2831    kernel_size=(1
-0001af80: 2c20 7365 6c66 2e73 7065 6373 5b27 6669  , self.specs['fi
-0001af90: 6c74 6572 5f6c 656e 6774 6827 5d29 2c0d  lter_length']),.
-0001afa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001afb0: 2020 2020 2020 2020 2073 7472 6964 6573           strides
-0001afc0: 3d31 2c0d 0a20 2020 2020 2020 2020 2020  =1,..           
-0001afd0: 2020 2020 2020 2020 2020 2020 2070 6164               pad
-0001afe0: 6469 6e67 3d73 656c 662e 7370 6563 735b  ding=self.specs[
-0001aff0: 2770 6164 6469 6e67 275d 2c0d 0a20 2020  'padding'],..   
-0001b000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b010: 2020 2020 2061 6374 6976 6174 696f 6e3d       activation=
-0001b020: 7365 6c66 2e73 7065 6373 5b27 6e6f 6e6c  self.specs['nonl
-0001b030: 696e 275d 2c0d 0a20 2020 2020 2020 2020  in'],..         
-0001b040: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-0001b050: 6572 6e65 6c5f 696e 6974 6961 6c69 7a65  ernel_initialize
-0001b060: 723d 2268 655f 756e 6966 6f72 6d22 2c0d  r="he_uniform",.
-0001b070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b080: 2020 2020 2020 2020 2062 6961 735f 696e           bias_in
-0001b090: 6974 6961 6c69 7a65 723d 436f 6e73 7461  itializer=Consta
-0001b0a0: 6e74 2830 2e31 292c 0d0a 2020 2020 2020  nt(0.1),..      
-0001b0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b0c0: 2020 6461 7461 5f66 6f72 6d61 743d 2263    data_format="c
-0001b0d0: 6861 6e6e 656c 735f 6c61 7374 222c 0d0a  hannels_last",..
-0001b0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b0f0: 2020 2020 2020 2020 2364 6174 615f 666f          #data_fo
-0001b100: 726d 6174 3d22 6368 616e 6e65 6c73 5f66  rmat="channels_f
-0001b110: 6972 7374 222c 0d0a 2020 2020 2020 2020  irst",..        
-0001b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b130: 6b65 726e 656c 5f72 6567 756c 6172 697a  kernel_regulariz
-0001b140: 6572 3d6b 5f72 6567 2e6c 3228 7365 6c66  er=k_reg.l2(self
-0001b150: 2e73 7065 6373 5b27 6c32 5f6c 616d 6264  .specs['l2_lambd
-0001b160: 6127 5d29 290d 0a0d 0a0d 0a20 2020 2020  a']))......     
-0001b170: 2020 2074 7363 6f6e 7634 5f6f 7574 203d     tsconv4_out =
-0001b180: 2074 7363 6f6e 7634 2870 6f6f 6c33 290d   tsconv4(pool3).
-0001b190: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
-0001b1a0: 7473 636f 6e76 343a 272c 2020 7473 636f  tsconv4:',  tsco
-0001b1b0: 6e76 345f 6f75 742e 7368 6170 6529 0d0a  nv4_out.shape)..
-0001b1c0: 0d0a 2020 2020 2020 2020 706f 6f6c 3420  ..        pool4 
-0001b1d0: 3d20 5465 6d70 506f 6f6c 696e 6728 706f  = TempPooling(po
-0001b1e0: 6f6c 696e 673d 7365 6c66 2e73 7065 6373  oling=self.specs
-0001b1f0: 5b27 706f 6f6c 696e 6727 5d2c 0d0a 2020  ['pooling'],..  
-0001b200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b220: 706f 6f6c 5f74 7970 653d 2261 7667 222c  pool_type="avg",
-0001b230: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b250: 2020 2020 7374 7269 6465 3d73 656c 662e      stride=self.
-0001b260: 7370 6563 735b 2773 7472 6964 6527 5d2c  specs['stride'],
-0001b270: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000198a0: 2020 2020 2020 2020 2020 756e 6974 5f66            unit_f
+000198b0: 6f72 6765 745f 6269 6173 3d46 616c 7365  orget_bias=False
+000198c0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000198d0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000198e0: 7475 726e 5f73 6571 7565 6e63 6573 3d73  turn_sequences=s
+000198f0: 656c 662e 7265 7475 726e 5f73 6571 7565  elf.return_seque
+00019900: 6e63 652c 0d0a 2020 2020 2020 2020 2020  nce,..          
+00019910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019920: 2075 6e72 6f6c 6c3d 4661 6c73 6529 0d0a   unroll=False)..
+00019930: 0d0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
+00019940: 7374 6d5f 6f75 7420 3d20 7365 6c66 2e6c  stm_out = self.l
+00019950: 7374 6d28 6666 6561 7475 7265 7329 0d0a  stm(ffeatures)..
+00019960: 2020 2020 2020 2020 7072 696e 7428 276c          print('l
+00019970: 7374 6d5f 6f75 743a 272c 2073 656c 662e  stm_out:', self.
+00019980: 6c73 746d 5f6f 7574 2e73 6861 7065 290d  lstm_out.shape).
+00019990: 0a0d 0a20 2020 2020 2020 2069 6620 7365  ...        if se
+000199a0: 6c66 2e72 6574 7572 6e5f 7365 7175 656e  lf.return_sequen
+000199b0: 6365 203d 3d20 5472 7565 3a0d 0a20 2020  ce == True:..   
+000199c0: 2020 2020 2020 2020 2073 656c 662e 6669           self.fi
+000199d0: 6e5f 6663 203d 2044 654d 6978 696e 6728  n_fc = DeMixing(
+000199e0: 7369 7a65 3d73 656c 662e 6f75 745f 6469  size=self.out_di
+000199f0: 6d2c 0d0a 2020 2020 2020 2020 2020 2020  m,..            
+00019a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019a10: 2020 2020 2020 206e 6f6e 6c69 6e3d 7466         nonlin=tf
+00019a20: 2e69 6465 6e74 6974 792c 2061 7869 733d  .identity, axis=
+00019a30: 3229 0d0a 2020 2020 2020 2020 656c 7365  2)..        else
+00019a40: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00019a50: 656c 662e 6669 6e5f 6663 203d 2046 756c  elf.fin_fc = Ful
+00019a60: 6c79 436f 6e6e 6563 7465 6428 7369 7a65  lyConnected(size
+00019a70: 3d73 656c 662e 6f75 745f 6469 6d2c 206e  =self.out_dim, n
+00019a80: 6f6e 6c69 6e3d 7466 2e69 6465 6e74 6974  onlin=tf.identit
+00019a90: 792c 0d0a 2020 2020 2020 2020 2020 2020  y,..            
+00019aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ab0: 2020 2020 7370 6563 733d 7365 6c66 2e73      specs=self.s
+00019ac0: 7065 6373 290d 0a20 2020 2020 2020 2020  pecs)..         
+00019ad0: 2020 200d 0a20 2020 2020 2020 2079 5f70     ..        y_p
+00019ae0: 7265 6420 3d20 7365 6c66 2e66 696e 5f66  red = self.fin_f
+00019af0: 6328 7365 6c66 2e6c 7374 6d5f 6f75 7429  c(self.lstm_out)
+00019b00: 0d0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
+00019b10: 2266 696e 2066 6320 6f75 743a 222c 2079  "fin fc out:", y
+00019b20: 5f70 7265 642e 7368 6170 6529 0d0a 2020  _pred.shape)..  
+00019b30: 2020 2020 2020 7265 7475 726e 2079 5f70        return y_p
+00019b40: 7265 640d 0a23 0d0a 230d 0a0d 0a0d 0a63  red..#..#......c
+00019b50: 6c61 7373 2044 6565 7034 2842 6173 654d  lass Deep4(BaseM
+00019b60: 6f64 656c 293a 0d0a 2020 2020 2222 220d  odel):..    """.
+00019b70: 0a20 2020 2044 6565 7020 436f 6e76 4e65  .    Deep ConvNe
+00019b80: 7420 6d6f 6465 6c20 6672 6f6d 205b 3262  t model from [2b
+00019b90: 5d5f 2e0d 0a20 2020 2052 6566 6572 656e  ]_...    Referen
+00019ba0: 6365 730d 0a20 2020 202d 2d2d 2d2d 2d2d  ces..    -------
+00019bb0: 2d2d 2d0d 0a20 2020 202e 2e20 5b32 625d  ---..    .. [2b]
+00019bc0: 2053 6368 6972 726d 6569 7374 6572 2c20   Schirrmeister, 
+00019bd0: 522e 2054 2e2c 2053 7072 696e 6765 6e62  R. T., Springenb
+00019be0: 6572 672c 204a 2e20 542e 2c20 4669 6564  erg, J. T., Fied
+00019bf0: 6572 6572 2c20 4c2e 2044 2e20 4a2e 2c0d  erer, L. D. J.,.
+00019c00: 0a20 2020 2020 2020 476c 6173 7374 6574  .       Glasstet
+00019c10: 7465 722c 204d 2e2c 2045 6767 656e 7370  ter, M., Eggensp
+00019c20: 6572 6765 722c 204b 2e2c 2054 616e 6765  erger, K., Tange
+00019c30: 726d 616e 6e2c 204d 2e2c 2048 7574 7465  rmann, M., Hutte
+00019c40: 722c 2046 2e20 2620 4261 6c6c 2c20 542e  r, F. & Ball, T.
+00019c50: 2028 3230 3137 292e 0d0a 2020 2020 2020   (2017)...      
+00019c60: 2044 6565 7020 6c65 6172 6e69 6e67 2077   Deep learning w
+00019c70: 6974 6820 636f 6e76 6f6c 7574 696f 6e61  ith convolutiona
+00019c80: 6c20 6e65 7572 616c 206e 6574 776f 726b  l neural network
+00019c90: 7320 666f 7220 4545 4720 6465 636f 6469  s for EEG decodi
+00019ca0: 6e67 2061 6e64 0d0a 2020 2020 2020 2076  ng and..       v
+00019cb0: 6973 7561 6c69 7a61 7469 6f6e 2e0d 0a20  isualization... 
+00019cc0: 2020 2020 2020 4875 6d61 6e20 4272 6169        Human Brai
+00019cd0: 6e20 4d61 7070 696e 6720 2c20 4175 672e  n Mapping , Aug.
+00019ce0: 2032 3031 372e 204f 6e6c 696e 653a 2068   2017. Online: h
+00019cf0: 7474 703a 2f2f 6478 2e64 6f69 2e6f 7267  ttp://dx.doi.org
+00019d00: 2f31 302e 3130 3032 2f68 626d 2e32 3337  /10.1002/hbm.237
+00019d10: 3330 0d0a 2020 2020 2222 220d 0a20 2020  30..    """..   
+00019d20: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+00019d30: 6c66 2c20 6d65 7461 2c20 6461 7461 7365  lf, meta, datase
+00019d40: 743d 4e6f 6e65 293a 0d0a 2020 2020 2020  t=None):..      
+00019d50: 2020 7365 6c66 2e73 636f 7065 203d 2027    self.scope = '
+00019d60: 6465 6570 3427 0d0a 2020 2020 2020 2020  deep4'..        
+00019d70: 6d65 7461 2e6d 6f64 656c 5f73 7065 6373  meta.model_specs
+00019d80: 2e73 6574 6465 6661 756c 7428 2766 696c  .setdefault('fil
+00019d90: 7465 725f 6c65 6e67 7468 272c 2031 3029  ter_length', 10)
+00019da0: 0d0a 2020 2020 2020 2020 6d65 7461 2e6d  ..        meta.m
+00019db0: 6f64 656c 5f73 7065 6373 2e73 6574 6465  odel_specs.setde
+00019dc0: 6661 756c 7428 276e 5f6c 6174 656e 7427  fault('n_latent'
+00019dd0: 2c20 3235 290d 0a20 2020 2020 2020 206d  , 25)..        m
+00019de0: 6574 612e 6d6f 6465 6c5f 7370 6563 732e  eta.model_specs.
+00019df0: 7365 7464 6566 6175 6c74 2827 706f 6f6c  setdefault('pool
+00019e00: 696e 6727 2c20 3329 0d0a 2020 2020 2020  ing', 3)..      
+00019e10: 2020 6d65 7461 2e6d 6f64 656c 5f73 7065    meta.model_spe
+00019e20: 6373 2e73 6574 6465 6661 756c 7428 2773  cs.setdefault('s
+00019e30: 7472 6964 6527 2c20 3329 0d0a 2020 2020  tride', 3)..    
+00019e40: 2020 2020 6d65 7461 2e6d 6f64 656c 5f73      meta.model_s
+00019e50: 7065 6373 2e73 6574 6465 6661 756c 7428  pecs.setdefault(
+00019e60: 2770 6f6f 6c5f 7479 7065 272c 2027 6d61  'pool_type', 'ma
+00019e70: 7827 290d 0a20 2020 2020 2020 206d 6574  x')..        met
+00019e80: 612e 6d6f 6465 6c5f 7370 6563 732e 7365  a.model_specs.se
+00019e90: 7464 6566 6175 6c74 2827 7061 6464 696e  tdefault('paddin
+00019ea0: 6727 2c20 2753 414d 4527 290d 0a20 2020  g', 'SAME')..   
+00019eb0: 2020 2020 206d 6574 612e 6d6f 6465 6c5f       meta.model_
+00019ec0: 7370 6563 732e 7365 7464 6566 6175 6c74  specs.setdefault
+00019ed0: 2827 6e6f 6e6c 696e 272c 2074 662e 6e6e  ('nonlin', tf.nn
+00019ee0: 2e65 6c75 290d 0a20 2020 2020 2020 206d  .elu)..        m
+00019ef0: 6574 612e 6d6f 6465 6c5f 7370 6563 732e  eta.model_specs.
+00019f00: 7365 7464 6566 6175 6c74 2827 6c31 5f6c  setdefault('l1_l
+00019f10: 616d 6264 6127 2c20 3029 0d0a 2020 2020  ambda', 0)..    
+00019f20: 2020 2020 6d65 7461 2e6d 6f64 656c 5f73      meta.model_s
+00019f30: 7065 6373 2e73 6574 6465 6661 756c 7428  pecs.setdefault(
+00019f40: 276c 325f 6c61 6d62 6461 272c 2030 290d  'l2_lambda', 0).
+00019f50: 0a20 2020 2020 2020 206d 6574 612e 6d6f  .        meta.mo
+00019f60: 6465 6c5f 7370 6563 732e 7365 7464 6566  del_specs.setdef
+00019f70: 6175 6c74 2827 6c31 5f73 636f 7065 272c  ault('l1_scope',
+00019f80: 205b 5d29 0d0a 2020 2020 2020 2020 6d65   [])..        me
+00019f90: 7461 2e6d 6f64 656c 5f73 7065 6373 2e73  ta.model_specs.s
+00019fa0: 6574 6465 6661 756c 7428 276c 325f 7363  etdefault('l2_sc
+00019fb0: 6f70 6527 2c20 5b5d 290d 0a20 2020 2020  ope', [])..     
+00019fc0: 2020 206d 6574 612e 6d6f 6465 6c5f 7370     meta.model_sp
+00019fd0: 6563 732e 7365 7464 6566 6175 6c74 2827  ecs.setdefault('
+00019fe0: 756e 6974 6e6f 726d 5f73 636f 7065 272c  unitnorm_scope',
+00019ff0: 205b 5d29 0d0a 2020 2020 2020 2020 2373   [])..        #s
+0001a000: 7065 6373 2e73 6574 6465 6661 756c 7428  pecs.setdefault(
+0001a010: 276d 6f64 656c 5f70 6174 6827 2c20 6f73  'model_path', os
+0001a020: 2e70 6174 682e 6a6f 696e 2873 656c 662e  .path.join(self.
+0001a030: 6461 7461 7365 742e 685f 7061 7261 6d73  dataset.h_params
+0001a040: 5b27 7061 7468 275d 2c20 276d 6f64 656c  ['path'], 'model
+0001a050: 7327 2929 0d0a 2020 2020 2020 2020 7375  s'))..        su
+0001a060: 7065 7228 4465 6570 342c 2073 656c 6629  per(Deep4, self)
+0001a070: 2e5f 5f69 6e69 745f 5f28 6d65 7461 2c20  .__init__(meta, 
+0001a080: 6461 7461 7365 7429 0d0a 0d0a 2020 2020  dataset)....    
+0001a090: 6465 6620 6275 696c 645f 6772 6170 6828  def build_graph(
+0001a0a0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+0001a0b0: 7365 6c66 2e73 636f 7065 203d 2027 6465  self.scope = 'de
+0001a0c0: 6570 3427 0d0a 0d0a 2020 2020 2020 2020  ep4'....        
+0001a0d0: 696e 7075 7473 203d 2074 662e 7472 616e  inputs = tf.tran
+0001a0e0: 7370 6f73 6528 7365 6c66 2e69 6e70 7574  spose(self.input
+0001a0f0: 732c 5b30 2c33 2c32 2c31 5d29 0d0a 0d0a  s,[0,3,2,1])....
+0001a100: 2020 2020 2020 2020 7463 6f6e 7631 203d          tconv1 =
+0001a110: 2044 6570 7468 7769 7365 436f 6e76 3244   DepthwiseConv2D
+0001a120: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+0001a130: 2020 2020 2020 2020 2020 206b 6572 6e65             kerne
+0001a140: 6c5f 7369 7a65 3d28 312c 2073 656c 662e  l_size=(1, self.
+0001a150: 7370 6563 735b 2766 696c 7465 725f 6c65  specs['filter_le
+0001a160: 6e67 7468 275d 292c 0d0a 2020 2020 2020  ngth']),..      
+0001a170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a180: 2020 6465 7074 685f 6d75 6c74 6970 6c69    depth_multipli
+0001a190: 6572 203d 2073 656c 662e 7370 6563 735b  er = self.specs[
+0001a1a0: 276e 5f6c 6174 656e 7427 5d2c 0d0a 2020  'n_latent'],..  
+0001a1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a1c0: 2020 2020 2020 7374 7269 6465 733d 312c        strides=1,
+0001a1d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001a1e0: 2020 2020 2020 2020 2020 7061 6464 696e            paddin
+0001a1f0: 673d 7365 6c66 2e73 7065 6373 5b27 7061  g=self.specs['pa
+0001a200: 6464 696e 6727 5d2c 0d0a 2020 2020 2020  dding'],..      
+0001a210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a220: 2020 6163 7469 7661 7469 6f6e 203d 2074    activation = t
+0001a230: 662e 6964 656e 7469 7479 2c0d 0a20 2020  f.identity,..   
+0001a240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a250: 2020 2020 206b 6572 6e65 6c5f 696e 6974       kernel_init
+0001a260: 6961 6c69 7a65 723d 2268 655f 756e 6966  ializer="he_unif
+0001a270: 6f72 6d22 2c0d 0a20 2020 2020 2020 2020  orm",..         
+0001a280: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0001a290: 6961 735f 696e 6974 6961 6c69 7a65 723d  ias_initializer=
+0001a2a0: 436f 6e73 7461 6e74 2830 2e31 292c 0d0a  Constant(0.1),..
+0001a2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a2c0: 2020 2020 2020 2020 6461 7461 5f66 6f72          data_for
+0001a2d0: 6d61 743d 2263 6861 6e6e 656c 735f 6c61  mat="channels_la
+0001a2e0: 7374 222c 0d0a 2020 2020 2020 2020 2020  st",..          
+0001a2f0: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
+0001a300: 726e 656c 5f72 6567 756c 6172 697a 6572  rnel_regularizer
+0001a310: 3d6b 5f72 6567 2e6c 3228 7365 6c66 2e73  =k_reg.l2(self.s
+0001a320: 7065 6373 5b27 6c32 5f6c 616d 6264 6127  pecs['l2_lambda'
+0001a330: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+0001a340: 2020 2020 2020 2020 2020 2020 236b 6572              #ker
+0001a350: 6e65 6c5f 636f 6e73 7472 6169 6e74 3d22  nel_constraint="
+0001a360: 6d61 786e 6f72 6d22 0d0a 2020 2020 2020  maxnorm"..      
+0001a370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a380: 2020 290d 0a20 2020 2020 2020 2074 636f    )..        tco
+0001a390: 6e76 315f 6f75 7420 3d20 7463 6f6e 7631  nv1_out = tconv1
+0001a3a0: 2869 6e70 7574 7329 0d0a 2020 2020 2020  (inputs)..      
+0001a3b0: 2020 7072 696e 7428 2774 636f 6e76 313a    print('tconv1:
+0001a3c0: 2027 2c20 7463 6f6e 7631 5f6f 7574 2e73   ', tconv1_out.s
+0001a3d0: 6861 7065 2920 2373 686f 756c 6420 6265  hape) #should be
+0001a3e0: 206e 5f62 6174 6368 2c20 7365 6e73 6f72   n_batch, sensor
+0001a3f0: 732c 2074 696d 6573 2c20 6b65 726e 656c  s, times, kernel
+0001a400: 730d 0a0d 0a20 2020 2020 2020 2073 636f  s....        sco
+0001a410: 6e76 3120 3d20 436f 6e76 3244 2866 696c  nv1 = Conv2D(fil
+0001a420: 7465 7273 3d73 656c 662e 7370 6563 735b  ters=self.specs[
+0001a430: 276e 5f6c 6174 656e 7427 5d2c 0d0a 2020  'n_latent'],..  
+0001a440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a450: 2020 2020 2020 6b65 726e 656c 5f73 697a        kernel_siz
+0001a460: 653d 2873 656c 662e 6461 7461 7365 742e  e=(self.dataset.
+0001a470: 685f 7061 7261 6d73 5b27 6e5f 6368 275d  h_params['n_ch']
+0001a480: 2c20 3129 2c0d 0a20 2020 2020 2020 2020  , 1),..         
+0001a490: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001a4a0: 7472 6964 6573 3d31 2c0d 0a20 2020 2020  trides=1,..     
+0001a4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a4c0: 2020 2070 6164 6469 6e67 3d73 656c 662e     padding=self.
+0001a4d0: 7370 6563 735b 2770 6164 6469 6e67 275d  specs['padding']
+0001a4e0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0001a4f0: 2020 2020 2020 2020 2020 2061 6374 6976             activ
+0001a500: 6174 696f 6e3d 7365 6c66 2e73 7065 6373  ation=self.specs
+0001a510: 5b27 6e6f 6e6c 696e 275d 2c0d 0a20 2020  ['nonlin'],..   
+0001a520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a530: 2020 2020 206b 6572 6e65 6c5f 696e 6974       kernel_init
+0001a540: 6961 6c69 7a65 723d 2268 655f 756e 6966  ializer="he_unif
+0001a550: 6f72 6d22 2c0d 0a20 2020 2020 2020 2020  orm",..         
+0001a560: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0001a570: 6961 735f 696e 6974 6961 6c69 7a65 723d  ias_initializer=
+0001a580: 436f 6e73 7461 6e74 2830 2e31 292c 0d0a  Constant(0.1),..
+0001a590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a5a0: 2020 2020 2020 2020 6461 7461 5f66 6f72          data_for
+0001a5b0: 6d61 743d 2263 6861 6e6e 656c 735f 6c61  mat="channels_la
+0001a5c0: 7374 222c 0d0a 2020 2020 2020 2020 2020  st",..          
+0001a5d0: 2020 2020 2020 2020 2020 2020 2020 2364                #d
+0001a5e0: 6174 615f 666f 726d 6174 3d22 6368 616e  ata_format="chan
+0001a5f0: 6e65 6c73 5f66 6972 7374 222c 0d0a 2020  nels_first",..  
+0001a600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a610: 2020 2020 2020 6b65 726e 656c 5f72 6567        kernel_reg
+0001a620: 756c 6172 697a 6572 3d6b 5f72 6567 2e6c  ularizer=k_reg.l
+0001a630: 3228 7365 6c66 2e73 7065 6373 5b27 6c32  2(self.specs['l2
+0001a640: 5f6c 616d 6264 6127 5d29 290d 0a20 2020  _lambda']))..   
+0001a650: 2020 2020 2073 636f 6e76 315f 6f75 7420       sconv1_out 
+0001a660: 3d20 7363 6f6e 7631 2874 636f 6e76 315f  = sconv1(tconv1_
+0001a670: 6f75 7429 0d0a 2020 2020 2020 2020 7072  out)..        pr
+0001a680: 696e 7428 2773 636f 6e76 313a 272c 2020  int('sconv1:',  
+0001a690: 7363 6f6e 7631 5f6f 7574 2e73 6861 7065  sconv1_out.shape
+0001a6a0: 290d 0a0d 0a20 2020 2020 2020 2070 6f6f  )....        poo
+0001a6b0: 6c31 203d 2054 656d 7050 6f6f 6c69 6e67  l1 = TempPooling
+0001a6c0: 2870 6f6f 6c69 6e67 3d73 656c 662e 7370  (pooling=self.sp
+0001a6d0: 6563 735b 2770 6f6f 6c69 6e67 275d 2c0d  ecs['pooling'],.
+0001a6e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a700: 2020 2070 6f6f 6c5f 7479 7065 3d22 6176     pool_type="av
+0001a710: 6722 2c0d 0a20 2020 2020 2020 2020 2020  g",..           
+0001a720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a730: 2020 2020 2020 2073 7472 6964 653d 7365         stride=se
+0001a740: 6c66 2e73 7065 6373 5b27 7374 7269 6465  lf.specs['stride
+0001a750: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
+0001a760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a770: 2020 2020 2020 2070 6164 6469 6e67 3d27         padding='
+0001a780: 5341 4d45 272c 0d0a 2020 2020 2020 2020  SAME',..        
+0001a790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a7a0: 2020 2020 2020 2020 2020 2928 7363 6f6e            )(scon
+0001a7b0: 7631 5f6f 7574 290d 0a0d 0a20 2020 2020  v1_out)....     
+0001a7c0: 2020 2070 7269 6e74 2827 706f 6f6c 313a     print('pool1:
+0001a7d0: 2027 2c20 706f 6f6c 312e 7368 6170 6529   ', pool1.shape)
+0001a7e0: 0d0a 0d0a 2020 2020 2020 2020 2323 2323  ....        ####
+0001a7f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001a800: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001a810: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001a820: 2323 2323 2323 2323 0d0a 0d0a 2020 2020  ########....    
+0001a830: 2020 2020 7473 636f 6e76 3220 3d20 436f      tsconv2 = Co
+0001a840: 6e76 3244 2866 696c 7465 7273 3d73 656c  nv2D(filters=sel
+0001a850: 662e 7370 6563 735b 276e 5f6c 6174 656e  f.specs['n_laten
+0001a860: 7427 5d2a 322c 0d0a 2020 2020 2020 2020  t']*2,..        
+0001a870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a880: 6b65 726e 656c 5f73 697a 653d 2831 2c20  kernel_size=(1, 
+0001a890: 7365 6c66 2e73 7065 6373 5b27 6669 6c74  self.specs['filt
+0001a8a0: 6572 5f6c 656e 6774 6827 5d29 2c0d 0a20  er_length']),.. 
+0001a8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a8c0: 2020 2020 2020 2073 7472 6964 6573 3d31         strides=1
+0001a8d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0001a8e0: 2020 2020 2020 2020 2020 2070 6164 6469             paddi
+0001a8f0: 6e67 3d73 656c 662e 7370 6563 735b 2770  ng=self.specs['p
+0001a900: 6164 6469 6e67 275d 2c0d 0a20 2020 2020  adding'],..     
+0001a910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a920: 2020 2061 6374 6976 6174 696f 6e3d 7365     activation=se
+0001a930: 6c66 2e73 7065 6373 5b27 6e6f 6e6c 696e  lf.specs['nonlin
+0001a940: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
+0001a950: 2020 2020 2020 2020 2020 2020 206b 6572               ker
+0001a960: 6e65 6c5f 696e 6974 6961 6c69 7a65 723d  nel_initializer=
+0001a970: 2268 655f 756e 6966 6f72 6d22 2c0d 0a20  "he_uniform",.. 
+0001a980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a990: 2020 2020 2020 2062 6961 735f 696e 6974         bias_init
+0001a9a0: 6961 6c69 7a65 723d 436f 6e73 7461 6e74  ializer=Constant
+0001a9b0: 2830 2e31 292c 0d0a 2020 2020 2020 2020  (0.1),..        
+0001a9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a9d0: 6461 7461 5f66 6f72 6d61 743d 2263 6861  data_format="cha
+0001a9e0: 6e6e 656c 735f 6c61 7374 222c 0d0a 2020  nnels_last",..  
+0001a9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa00: 2020 2020 2020 2364 6174 615f 666f 726d        #data_form
+0001aa10: 6174 3d22 6368 616e 6e65 6c73 5f66 6972  at="channels_fir
+0001aa20: 7374 222c 0d0a 2020 2020 2020 2020 2020  st",..          
+0001aa30: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
+0001aa40: 726e 656c 5f72 6567 756c 6172 697a 6572  rnel_regularizer
+0001aa50: 3d6b 5f72 6567 2e6c 3228 7365 6c66 2e73  =k_reg.l2(self.s
+0001aa60: 7065 6373 5b27 6c32 5f6c 616d 6264 6127  pecs['l2_lambda'
+0001aa70: 5d29 290d 0a0d 0a0d 0a20 2020 2020 2020  ]))......       
+0001aa80: 2074 7363 6f6e 7632 5f6f 7574 203d 2074   tsconv2_out = t
+0001aa90: 7363 6f6e 7632 2870 6f6f 6c31 290d 0a20  sconv2(pool1).. 
+0001aaa0: 2020 2020 2020 2070 7269 6e74 2827 7473         print('ts
+0001aab0: 636f 6e76 323a 272c 2020 7473 636f 6e76  conv2:',  tsconv
+0001aac0: 325f 6f75 742e 7368 6170 6529 0d0a 0d0a  2_out.shape)....
+0001aad0: 2020 2020 2020 2020 706f 6f6c 3220 3d20          pool2 = 
+0001aae0: 5465 6d70 506f 6f6c 696e 6728 706f 6f6c  TempPooling(pool
+0001aaf0: 696e 673d 7365 6c66 2e73 7065 6373 5b27  ing=self.specs['
+0001ab00: 706f 6f6c 696e 6727 5d2c 0d0a 2020 2020  pooling'],..    
+0001ab10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab20: 2020 2020 2020 2020 2020 2020 2020 706f                po
+0001ab30: 6f6c 5f74 7970 653d 2261 7667 222c 0d0a  ol_type="avg",..
+0001ab40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab60: 2020 7374 7269 6465 3d73 656c 662e 7370    stride=self.sp
+0001ab70: 6563 735b 2773 7472 6964 6527 5d2c 0d0a  ecs['stride'],..
+0001ab80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aba0: 2020 7061 6464 696e 673d 2753 414d 4527    padding='SAME'
+0001abb0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0001abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001abd0: 2020 2020 2029 2874 7363 6f6e 7632 5f6f       )(tsconv2_o
+0001abe0: 7574 290d 0a0d 0a20 2020 2020 2020 2070  ut)....        p
+0001abf0: 7269 6e74 2827 706f 6f6c 323a 2027 2c20  rint('pool2: ', 
+0001ac00: 706f 6f6c 322e 7368 6170 6529 0d0a 0d0a  pool2.shape)....
+0001ac10: 0d0a 2020 2020 2020 2020 2323 2323 2323  ..        ######
+0001ac20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001ac30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001ac40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001ac50: 2323 2323 2323 0d0a 0d0a 2020 2020 2020  ######....      
+0001ac60: 2020 7473 636f 6e76 3320 3d20 436f 6e76    tsconv3 = Conv
+0001ac70: 3244 2866 696c 7465 7273 3d73 656c 662e  2D(filters=self.
+0001ac80: 7370 6563 735b 276e 5f6c 6174 656e 7427  specs['n_latent'
+0001ac90: 5d2a 342c 0d0a 2020 2020 2020 2020 2020  ]*4,..          
+0001aca0: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
+0001acb0: 726e 656c 5f73 697a 653d 2831 2c20 7365  rnel_size=(1, se
+0001acc0: 6c66 2e73 7065 6373 5b27 6669 6c74 6572  lf.specs['filter
+0001acd0: 5f6c 656e 6774 6827 5d29 2c0d 0a20 2020  _length']),..   
+0001ace0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001acf0: 2020 2020 2073 7472 6964 6573 3d31 2c0d       strides=1,.
+0001ad00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ad10: 2020 2020 2020 2020 2070 6164 6469 6e67           padding
+0001ad20: 3d73 656c 662e 7370 6563 735b 2770 6164  =self.specs['pad
+0001ad30: 6469 6e67 275d 2c0d 0a20 2020 2020 2020  ding'],..       
+0001ad40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ad50: 2061 6374 6976 6174 696f 6e3d 7365 6c66   activation=self
+0001ad60: 2e73 7065 6373 5b27 6e6f 6e6c 696e 275d  .specs['nonlin']
+0001ad70: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0001ad80: 2020 2020 2020 2020 2020 206b 6572 6e65             kerne
+0001ad90: 6c5f 696e 6974 6961 6c69 7a65 723d 2268  l_initializer="h
+0001ada0: 655f 756e 6966 6f72 6d22 2c0d 0a20 2020  e_uniform",..   
+0001adb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001adc0: 2020 2020 2062 6961 735f 696e 6974 6961       bias_initia
+0001add0: 6c69 7a65 723d 436f 6e73 7461 6e74 2830  lizer=Constant(0
+0001ade0: 2e31 292c 0d0a 2020 2020 2020 2020 2020  .1),..          
+0001adf0: 2020 2020 2020 2020 2020 2020 2020 6461                da
+0001ae00: 7461 5f66 6f72 6d61 743d 2263 6861 6e6e  ta_format="chann
+0001ae10: 656c 735f 6c61 7374 222c 0d0a 2020 2020  els_last",..    
+0001ae20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae30: 2020 2020 2364 6174 615f 666f 726d 6174      #data_format
+0001ae40: 3d22 6368 616e 6e65 6c73 5f66 6972 7374  ="channels_first
+0001ae50: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+0001ae60: 2020 2020 2020 2020 2020 2020 6b65 726e              kern
+0001ae70: 656c 5f72 6567 756c 6172 697a 6572 3d6b  el_regularizer=k
+0001ae80: 5f72 6567 2e6c 3228 7365 6c66 2e73 7065  _reg.l2(self.spe
+0001ae90: 6373 5b27 6c32 5f6c 616d 6264 6127 5d29  cs['l2_lambda'])
+0001aea0: 290d 0a0d 0a0d 0a20 2020 2020 2020 2074  )......        t
+0001aeb0: 7363 6f6e 7633 5f6f 7574 203d 2074 7363  sconv3_out = tsc
+0001aec0: 6f6e 7633 2870 6f6f 6c32 290d 0a20 2020  onv3(pool2)..   
+0001aed0: 2020 2020 2070 7269 6e74 2827 7473 636f       print('tsco
+0001aee0: 6e76 333a 272c 2020 7473 636f 6e76 335f  nv3:',  tsconv3_
+0001aef0: 6f75 742e 7368 6170 6529 0d0a 0d0a 2020  out.shape)....  
+0001af00: 2020 2020 2020 706f 6f6c 3320 3d20 5465        pool3 = Te
+0001af10: 6d70 506f 6f6c 696e 6728 706f 6f6c 696e  mpPooling(poolin
+0001af20: 673d 7365 6c66 2e73 7065 6373 5b27 706f  g=self.specs['po
+0001af30: 6f6c 696e 6727 5d2c 0d0a 2020 2020 2020  oling'],..      
+0001af40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af50: 2020 2020 2020 2020 2020 2020 706f 6f6c              pool
+0001af60: 5f74 7970 653d 2261 7667 222c 0d0a 2020  _type="avg",..  
+0001af70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af90: 7374 7269 6465 3d73 656c 662e 7370 6563  stride=self.spec
+0001afa0: 735b 2773 7472 6964 6527 5d2c 0d0a 2020  s['stride'],..  
+0001afb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001afc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001afd0: 7061 6464 696e 673d 2753 414d 4527 2c0d  padding='SAME',.
+0001afe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001aff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b000: 2020 2029 2874 7363 6f6e 7633 5f6f 7574     )(tsconv3_out
+0001b010: 290d 0a0d 0a20 2020 2020 2020 2070 7269  )....        pri
+0001b020: 6e74 2827 706f 6f6c 333a 2027 2c20 706f  nt('pool3: ', po
+0001b030: 6f6c 332e 7368 6170 6529 0d0a 0d0a 2020  ol3.shape)....  
+0001b040: 2020 2020 2020 2323 2323 2323 2323 2323        ##########
+0001b050: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001b060: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001b070: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001b080: 2323 0d0a 0d0a 2020 2020 2020 2020 7473  ##....        ts
+0001b090: 636f 6e76 3420 3d20 436f 6e76 3244 2866  conv4 = Conv2D(f
+0001b0a0: 696c 7465 7273 3d73 656c 662e 7370 6563  ilters=self.spec
+0001b0b0: 735b 276e 5f6c 6174 656e 7427 5d2a 382c  s['n_latent']*8,
+0001b0c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001b0d0: 2020 2020 2020 2020 2020 6b65 726e 656c            kernel
+0001b0e0: 5f73 697a 653d 2831 2c20 7365 6c66 2e73  _size=(1, self.s
+0001b0f0: 7065 6373 5b27 6669 6c74 6572 5f6c 656e  pecs['filter_len
+0001b100: 6774 6827 5d29 2c0d 0a20 2020 2020 2020  gth']),..       
+0001b110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b120: 2073 7472 6964 6573 3d31 2c0d 0a20 2020   strides=1,..   
+0001b130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b140: 2020 2020 2070 6164 6469 6e67 3d73 656c       padding=sel
+0001b150: 662e 7370 6563 735b 2770 6164 6469 6e67  f.specs['padding
+0001b160: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
+0001b170: 2020 2020 2020 2020 2020 2020 2061 6374               act
+0001b180: 6976 6174 696f 6e3d 7365 6c66 2e73 7065  ivation=self.spe
+0001b190: 6373 5b27 6e6f 6e6c 696e 275d 2c0d 0a20  cs['nonlin'],.. 
+0001b1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b1b0: 2020 2020 2020 206b 6572 6e65 6c5f 696e         kernel_in
+0001b1c0: 6974 6961 6c69 7a65 723d 2268 655f 756e  itializer="he_un
+0001b1d0: 6966 6f72 6d22 2c0d 0a20 2020 2020 2020  iform",..       
+0001b1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b1f0: 2062 6961 735f 696e 6974 6961 6c69 7a65   bias_initialize
+0001b200: 723d 436f 6e73 7461 6e74 2830 2e31 292c  r=Constant(0.1),
+0001b210: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001b220: 2020 2020 2020 2020 2020 6461 7461 5f66            data_f
+0001b230: 6f72 6d61 743d 2263 6861 6e6e 656c 735f  ormat="channels_
+0001b240: 6c61 7374 222c 0d0a 2020 2020 2020 2020  last",..        
+0001b250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b260: 2364 6174 615f 666f 726d 6174 3d22 6368  #data_format="ch
+0001b270: 616e 6e65 6c73 5f66 6972 7374 222c 0d0a  annels_first",..
 0001b280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b290: 2020 2020 7061 6464 696e 673d 2753 414d      padding='SAM
-0001b2a0: 4527 2c0d 0a20 2020 2020 2020 2020 2020  E',..           
-0001b2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b2c0: 2020 2020 2020 2029 2874 7363 6f6e 7634         )(tsconv4
-0001b2d0: 5f6f 7574 290d 0a0d 0a20 2020 2020 2020  _out)....       
-0001b2e0: 2070 7269 6e74 2827 706f 6f6c 343a 2027   print('pool4: '
-0001b2f0: 2c20 706f 6f6c 342e 7368 6170 6529 0d0a  , pool4.shape)..
-0001b300: 0d0a 0d0a 2020 2020 2020 2020 6663 5f6f  ....        fc_o
-0001b310: 7574 203d 2046 756c 6c79 436f 6e6e 6563  ut = FullyConnec
-0001b320: 7465 6428 7369 7a65 3d73 656c 662e 6f75  ted(size=self.ou
-0001b330: 745f 6469 6d2c 206e 6f6e 6c69 6e3d 7466  t_dim, nonlin=tf
-0001b340: 2e69 6465 6e74 6974 792c 0d0a 2020 2020  .identity,..    
-0001b350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b360: 2020 2020 2020 2020 7370 6563 733d 7365          specs=se
-0001b370: 6c66 2e73 7065 6373 290d 0a20 2020 2020  lf.specs)..     
-0001b380: 2020 2079 5f70 7265 6420 3d20 6663 5f6f     y_pred = fc_o
-0001b390: 7574 2870 6f6f 6c34 290d 0a20 2020 2020  ut(pool4)..     
-0001b3a0: 2020 2072 6574 7572 6e20 795f 7072 6564     return y_pred
-0001b3b0: 0d0a 230d 0a23 0d0a 0d0a 636c 6173 7320  ..#..#....class 
-0001b3c0: 4545 474e 6574 2842 6173 654d 6f64 656c  EEGNet(BaseModel
-0001b3d0: 293a 0d0a 2020 2020 2222 2245 4547 4e65  ):..    """EEGNe
-0001b3e0: 742e 0d0a 0d0a 2020 2020 5061 7261 6d65  t.....    Parame
-0001b3f0: 7465 7273 0d0a 2020 2020 2d2d 2d2d 2d2d  ters..    ------
-0001b400: 2d2d 2d2d 0d0a 2020 2020 7370 6563 7320  ----..    specs 
-0001b410: 3a20 6469 6374 0d0a 0d0a 2020 2020 2020  : dict....      
-0001b420: 2020 6e5f 6c61 7465 6e74 203a 2069 6e74    n_latent : int
-0001b430: 0d0a 2020 2020 2020 2020 2020 2020 4e75  ..            Nu
-0001b440: 6d62 6572 206f 6620 2874 656d 706f 7261  mber of (tempora
-0001b450: 6c29 2063 6f6e 766f 6c75 7469 6f6e 206b  l) convolution k
-0001b460: 6572 6e72 656c 7320 696e 2074 6865 2066  ernrels in the f
-0001b470: 6972 7374 206c 6179 6572 2e0d 0a20 2020  irst layer...   
-0001b480: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
-0001b490: 7320 746f 2038 0d0a 0d0a 2020 2020 2020  s to 8....      
-0001b4a0: 2020 6669 6c74 6572 5f6c 656e 6774 6820    filter_length 
-0001b4b0: 3a20 696e 740d 0a20 2020 2020 2020 2020  : int..         
-0001b4c0: 2020 204c 656e 6774 6820 6f66 2074 656d     Length of tem
-0001b4d0: 706f 7261 6c20 6669 6c74 6572 7320 696e  poral filters in
-0001b4e0: 2074 6865 2066 6972 7374 206c 6179 6572   the first layer
-0001b4f0: 2e0d 0a20 2020 2020 2020 2020 2020 2044  ...            D
-0001b500: 6566 6175 6c74 7320 746f 2033 320d 0a0d  efaults to 32...
-0001b510: 0a20 2020 2020 2020 2073 7472 6964 6520  .        stride 
-0001b520: 3a20 696e 740d 0a20 2020 2020 2020 2020  : int..         
-0001b530: 2020 2053 7472 6964 6520 6f66 2074 6865     Stride of the
-0001b540: 2061 7665 7261 6765 2070 6f6c 6c69 6e67   average polling
-0001b550: 206c 6179 6572 732e 2044 6566 6175 6c74   layers. Default
-0001b560: 7320 746f 2034 2e0d 0a0d 0a20 2020 2020  s to 4.....     
-0001b570: 2020 2070 6f6f 6c69 6e67 203a 2069 6e74     pooling : int
-0001b580: 0d0a 2020 2020 2020 2020 2020 2020 506f  ..            Po
-0001b590: 6f6c 696e 6720 6661 6374 6f72 206f 6620  oling factor of 
-0001b5a0: 7468 6520 6176 6572 6167 6520 706f 6c6c  the average poll
-0001b5b0: 696e 6720 6c61 7965 7273 2e20 4465 6661  ing layers. Defa
-0001b5c0: 756c 7473 2074 6f20 342e 0d0a 0d0a 2020  ults to 4.....  
-0001b5d0: 2020 2020 2020 6472 6f70 6f75 7420 3a20        dropout : 
-0001b5e0: 666c 6f61 740d 0a20 2020 2020 2020 2020  float..         
-0001b5f0: 2020 2044 726f 706f 7574 2063 6f65 6666     Dropout coeff
-0001b600: 6963 6965 6e74 2e0d 0a0d 0a20 2020 2052  icient.....    R
-0001b610: 6566 6572 656e 6365 730d 0a20 2020 202d  eferences..    -
-0001b620: 2d2d 2d2d 2d2d 2d2d 2d0d 0a20 2020 205b  ---------..    [
-0001b630: 335d 2056 2e4a 2e20 4c61 7768 6572 6e2c  3] V.J. Lawhern,
-0001b640: 2065 7420 616c 2e2c 2045 4547 4e65 743a   et al., EEGNet:
-0001b650: 2041 2063 6f6d 7061 6374 2063 6f6e 766f   A compact convo
-0001b660: 6c75 7469 6f6e 616c 206e 6575 7261 6c0d  lutional neural.
-0001b670: 0a20 2020 206e 6574 776f 726b 2066 6f72  .    network for
-0001b680: 2045 4547 2d62 6173 6564 2062 7261 696e   EEG-based brain
-0001b690: e280 9363 6f6d 7075 7465 7220 696e 7465  ...computer inte
-0001b6a0: 7266 6163 6573 2031 3020 4a2e 204e 6575  rfaces 10 J. Neu
-0001b6b0: 7261 6c20 456e 672e 2c0d 0a20 2020 2031  ral Eng.,..    1
-0001b6c0: 3520 2835 2920 2832 3031 3829 2c20 702e  5 (5) (2018), p.
-0001b6d0: 2030 3536 3031 330d 0a0d 0a20 2020 205b   056013....    [
-0001b6e0: 345d 204f 7269 6769 6e61 6c20 4545 474e  4] Original EEGN
-0001b6f0: 6574 2069 6d70 6c65 6d65 6e74 6174 696f  et implementatio
-0001b700: 6e20 6279 2074 6865 2061 7574 686f 7273  n by the authors
-0001b710: 2063 616e 2062 6520 666f 756e 6420 6174   can be found at
-0001b720: 0d0a 2020 2020 6874 7470 733a 2f2f 6769  ..    https://gi
-0001b730: 7468 7562 2e63 6f6d 2f76 6c61 7768 6572  thub.com/vlawher
-0001b740: 6e2f 6172 6c2d 6565 676d 6f64 656c 730d  n/arl-eegmodels.
-0001b750: 0a20 2020 2022 2222 0d0a 2020 2020 6465  .    """..    de
-0001b760: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-0001b770: 206d 6574 612c 2064 6174 6173 6574 3d4e   meta, dataset=N
-0001b780: 6f6e 6529 3a0d 0a20 2020 2020 2020 2073  one):..        s
-0001b790: 656c 662e 7363 6f70 6520 3d20 2765 6567  elf.scope = 'eeg
-0001b7a0: 6e65 7438 270d 0a20 2020 2020 2020 206d  net8'..        m
-0001b7b0: 6574 612e 6d6f 6465 6c5f 7370 6563 732e  eta.model_specs.
-0001b7c0: 7365 7464 6566 6175 6c74 2827 756e 6974  setdefault('unit
-0001b7d0: 6e6f 726d 5f73 636f 7065 272c 205b 5d29  norm_scope', [])
-0001b7e0: 0d0a 2020 2020 2020 2020 6d65 7461 2e6d  ..        meta.m
-0001b7f0: 6f64 656c 5f73 7065 6373 2e73 6574 6465  odel_specs.setde
-0001b800: 6661 756c 7428 2766 696c 7465 725f 6c65  fault('filter_le
-0001b810: 6e67 7468 272c 2036 3429 0d0a 2020 2020  ngth', 64)..    
-0001b820: 2020 2020 6d65 7461 2e6d 6f64 656c 5f73      meta.model_s
-0001b830: 7065 6373 2e73 6574 6465 6661 756c 7428  pecs.setdefault(
-0001b840: 2764 6570 7468 5f6d 756c 7469 706c 6965  'depth_multiplie
-0001b850: 7227 2c20 3229 0d0a 2020 2020 2020 2020  r', 2)..        
-0001b860: 6d65 7461 2e6d 6f64 656c 5f73 7065 6373  meta.model_specs
-0001b870: 2e73 6574 6465 6661 756c 7428 276e 5f6c  .setdefault('n_l
-0001b880: 6174 656e 7427 2c20 3829 0d0a 2020 2020  atent', 8)..    
-0001b890: 2020 2020 6d65 7461 2e6d 6f64 656c 5f73      meta.model_s
-0001b8a0: 7065 6373 2e73 6574 6465 6661 756c 7428  pecs.setdefault(
-0001b8b0: 2770 6f6f 6c69 6e67 272c 2034 290d 0a20  'pooling', 4).. 
-0001b8c0: 2020 2020 2020 206d 6574 612e 6d6f 6465         meta.mode
-0001b8d0: 6c5f 7370 6563 732e 7365 7464 6566 6175  l_specs.setdefau
-0001b8e0: 6c74 2827 7374 7269 6465 272c 2034 290d  lt('stride', 4).
-0001b8f0: 0a20 2020 2020 2020 206d 6574 612e 6d6f  .        meta.mo
-0001b900: 6465 6c5f 7370 6563 732e 7365 7464 6566  del_specs.setdef
-0001b910: 6175 6c74 2827 6472 6f70 6f75 7427 2c20  ault('dropout', 
-0001b920: 302e 3129 0d0a 2020 2020 2020 2020 6d65  0.1)..        me
-0001b930: 7461 2e6d 6f64 656c 5f73 7065 6373 2e73  ta.model_specs.s
-0001b940: 6574 6465 6661 756c 7428 2770 6164 6469  etdefault('paddi
-0001b950: 6e67 272c 2027 7361 6d65 2729 0d0a 2020  ng', 'same')..  
-0001b960: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
-0001b970: 5f73 7065 6373 2e73 6574 6465 6661 756c  _specs.setdefaul
-0001b980: 7428 276e 6f6e 6c69 6e27 2c20 2765 6c75  t('nonlin', 'elu
-0001b990: 2729 0d0a 2020 2020 2020 2020 6d65 7461  ')..        meta
-0001b9a0: 2e6d 6f64 656c 5f73 7065 6373 5b27 7363  .model_specs['sc
-0001b9b0: 6f70 6527 5d20 3d20 7365 6c66 2e73 636f  ope'] = self.sco
-0001b9c0: 7065 0d0a 2020 2020 2020 2020 7375 7065  pe..        supe
-0001b9d0: 7228 4545 474e 6574 2c20 7365 6c66 292e  r(EEGNet, self).
-0001b9e0: 5f5f 696e 6974 5f5f 286d 6574 612c 2064  __init__(meta, d
-0001b9f0: 6174 6173 6574 290d 0a20 2020 2020 2020  ataset)..       
-0001ba00: 200d 0a0d 0a20 2020 2064 6566 2062 7569   ....    def bui
-0001ba10: 6c64 5f67 7261 7068 2873 656c 6629 3a0d  ld_graph(self):.
-0001ba20: 0a0d 0a0d 0a20 2020 2020 2020 2069 6e70  .....        inp
-0001ba30: 7574 7320 3d20 7466 2e74 7261 6e73 706f  uts = tf.transpo
-0001ba40: 7365 2873 656c 662e 696e 7075 7473 2c5b  se(self.inputs,[
-0001ba50: 302c 332c 322c 315d 290d 0a0d 0a20 2020  0,3,2,1])....   
-0001ba60: 2020 2020 2064 726f 706f 7574 5479 7065       dropoutType
-0001ba70: 203d 2044 726f 706f 7574 0d0a 0d0a 2020   = Dropout....  
-0001ba80: 2020 2020 2020 626c 6f63 6b31 2020 2020        block1    
-0001ba90: 2020 203d 2043 6f6e 7632 4428 7365 6c66     = Conv2D(self
-0001baa0: 2e73 7065 6373 5b27 6e5f 6c61 7465 6e74  .specs['n_latent
-0001bab0: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
-0001bac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bad0: 2020 2028 312c 2073 656c 662e 7370 6563     (1, self.spec
-0001bae0: 735b 2766 696c 7465 725f 6c65 6e67 7468  s['filter_length
-0001baf0: 275d 292c 0d0a 2020 2020 2020 2020 2020  ']),..          
-0001bb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb10: 2020 2020 7061 6464 696e 6720 3d20 7365      padding = se
-0001bb20: 6c66 2e73 7065 6373 5b27 7061 6464 696e  lf.specs['paddin
-0001bb30: 6727 5d2c 0d0a 2020 2020 2020 2020 2020  g'],..          
-0001bb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb50: 2020 2020 696e 7075 745f 7368 6170 6520      input_shape 
-0001bb60: 3d20 2831 2c20 7365 6c66 2e64 6174 6173  = (1, self.datas
-0001bb70: 6574 2e68 5f70 6172 616d 735b 276e 5f63  et.h_params['n_c
-0001bb80: 6827 5d2c 0d0a 2020 2020 2020 2020 2020  h'],..          
-0001bb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bbb0: 2020 2073 656c 662e 6461 7461 7365 742e     self.dataset.
-0001bbc0: 685f 7061 7261 6d73 5b27 6e5f 7427 5d29  h_params['n_t'])
-0001bbd0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0001bbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bbf0: 2075 7365 5f62 6961 7320 3d20 4661 6c73   use_bias = Fals
-0001bc00: 6529 2869 6e70 7574 7329 0d0a 2020 2020  e)(inputs)..    
-0001bc10: 2020 2020 626c 6f63 6b31 2020 2020 2020      block1      
-0001bc20: 203d 2042 6174 6368 4e6f 726d 616c 697a   = BatchNormaliz
-0001bc30: 6174 696f 6e28 6178 6973 203d 2031 2928  ation(axis = 1)(
-0001bc40: 626c 6f63 6b31 290d 0a20 2020 2020 2020  block1)..       
-0001bc50: 2023 7072 696e 7428 2242 6174 6368 6e6f   #print("Batchno
-0001bc60: 726d 3a22 2c20 626c 6f63 6b31 2e73 6861  rm:", block1.sha
-0001bc70: 7065 290d 0a20 2020 2020 2020 2062 6c6f  pe)..        blo
-0001bc80: 636b 3120 2020 2020 2020 3d20 4465 7074  ck1       = Dept
-0001bc90: 6877 6973 6543 6f6e 7632 4428 2873 656c  hwiseConv2D((sel
-0001bca0: 662e 6461 7461 7365 742e 685f 7061 7261  f.dataset.h_para
-0001bcb0: 6d73 5b27 6e5f 6368 275d 2c20 3129 2c0d  ms['n_ch'], 1),.
-0001bcc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001bcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bce0: 2020 2020 2020 2020 7573 655f 6269 6173          use_bias
-0001bcf0: 203d 2046 616c 7365 2c0d 0a20 2020 2020   = False,..     
+0001b290: 2020 2020 2020 2020 6b65 726e 656c 5f72          kernel_r
+0001b2a0: 6567 756c 6172 697a 6572 3d6b 5f72 6567  egularizer=k_reg
+0001b2b0: 2e6c 3228 7365 6c66 2e73 7065 6373 5b27  .l2(self.specs['
+0001b2c0: 6c32 5f6c 616d 6264 6127 5d29 290d 0a0d  l2_lambda']))...
+0001b2d0: 0a0d 0a20 2020 2020 2020 2074 7363 6f6e  ...        tscon
+0001b2e0: 7634 5f6f 7574 203d 2074 7363 6f6e 7634  v4_out = tsconv4
+0001b2f0: 2870 6f6f 6c33 290d 0a20 2020 2020 2020  (pool3)..       
+0001b300: 2070 7269 6e74 2827 7473 636f 6e76 343a   print('tsconv4:
+0001b310: 272c 2020 7473 636f 6e76 345f 6f75 742e  ',  tsconv4_out.
+0001b320: 7368 6170 6529 0d0a 0d0a 2020 2020 2020  shape)....      
+0001b330: 2020 706f 6f6c 3420 3d20 5465 6d70 506f    pool4 = TempPo
+0001b340: 6f6c 696e 6728 706f 6f6c 696e 673d 7365  oling(pooling=se
+0001b350: 6c66 2e73 7065 6373 5b27 706f 6f6c 696e  lf.specs['poolin
+0001b360: 6727 5d2c 0d0a 2020 2020 2020 2020 2020  g'],..          
+0001b370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b380: 2020 2020 2020 2020 706f 6f6c 5f74 7970          pool_typ
+0001b390: 653d 2261 7667 222c 0d0a 2020 2020 2020  e="avg",..      
+0001b3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b3b0: 2020 2020 2020 2020 2020 2020 7374 7269              stri
+0001b3c0: 6465 3d73 656c 662e 7370 6563 735b 2773  de=self.specs['s
+0001b3d0: 7472 6964 6527 5d2c 0d0a 2020 2020 2020  tride'],..      
+0001b3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b3f0: 2020 2020 2020 2020 2020 2020 7061 6464              padd
+0001b400: 696e 673d 2753 414d 4527 2c0d 0a20 2020  ing='SAME',..   
+0001b410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b420: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0001b430: 2874 7363 6f6e 7634 5f6f 7574 290d 0a0d  (tsconv4_out)...
+0001b440: 0a20 2020 2020 2020 2070 7269 6e74 2827  .        print('
+0001b450: 706f 6f6c 343a 2027 2c20 706f 6f6c 342e  pool4: ', pool4.
+0001b460: 7368 6170 6529 0d0a 0d0a 0d0a 2020 2020  shape)......    
+0001b470: 2020 2020 6663 5f6f 7574 203d 2046 756c      fc_out = Ful
+0001b480: 6c79 436f 6e6e 6563 7465 6428 7369 7a65  lyConnected(size
+0001b490: 3d73 656c 662e 6f75 745f 6469 6d2c 206e  =self.out_dim, n
+0001b4a0: 6f6e 6c69 6e3d 7466 2e69 6465 6e74 6974  onlin=tf.identit
+0001b4b0: 792c 0d0a 2020 2020 2020 2020 2020 2020  y,..            
+0001b4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b4d0: 7370 6563 733d 7365 6c66 2e73 7065 6373  specs=self.specs
+0001b4e0: 290d 0a20 2020 2020 2020 2079 5f70 7265  )..        y_pre
+0001b4f0: 6420 3d20 6663 5f6f 7574 2870 6f6f 6c34  d = fc_out(pool4
+0001b500: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+0001b510: 6e20 795f 7072 6564 0d0a 230d 0a23 0d0a  n y_pred..#..#..
+0001b520: 0d0a 636c 6173 7320 4545 474e 6574 2842  ..class EEGNet(B
+0001b530: 6173 654d 6f64 656c 293a 0d0a 2020 2020  aseModel):..    
+0001b540: 2222 2245 4547 4e65 742e 0d0a 0d0a 2020  """EEGNet.....  
+0001b550: 2020 5061 7261 6d65 7465 7273 0d0a 2020    Parameters..  
+0001b560: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a 2020    ----------..  
+0001b570: 2020 7370 6563 7320 3a20 6469 6374 0d0a    specs : dict..
+0001b580: 0d0a 2020 2020 2020 2020 6e5f 6c61 7465  ..        n_late
+0001b590: 6e74 203a 2069 6e74 0d0a 2020 2020 2020  nt : int..      
+0001b5a0: 2020 2020 2020 4e75 6d62 6572 206f 6620        Number of 
+0001b5b0: 2874 656d 706f 7261 6c29 2063 6f6e 766f  (temporal) convo
+0001b5c0: 6c75 7469 6f6e 206b 6572 6e72 656c 7320  lution kernrels 
+0001b5d0: 696e 2074 6865 2066 6972 7374 206c 6179  in the first lay
+0001b5e0: 6572 2e0d 0a20 2020 2020 2020 2020 2020  er...           
+0001b5f0: 2044 6566 6175 6c74 7320 746f 2038 0d0a   Defaults to 8..
+0001b600: 0d0a 2020 2020 2020 2020 6669 6c74 6572  ..        filter
+0001b610: 5f6c 656e 6774 6820 3a20 696e 740d 0a20  _length : int.. 
+0001b620: 2020 2020 2020 2020 2020 204c 656e 6774             Lengt
+0001b630: 6820 6f66 2074 656d 706f 7261 6c20 6669  h of temporal fi
+0001b640: 6c74 6572 7320 696e 2074 6865 2066 6972  lters in the fir
+0001b650: 7374 206c 6179 6572 2e0d 0a20 2020 2020  st layer...     
+0001b660: 2020 2020 2020 2044 6566 6175 6c74 7320         Defaults 
+0001b670: 746f 2033 320d 0a0d 0a20 2020 2020 2020  to 32....       
+0001b680: 2073 7472 6964 6520 3a20 696e 740d 0a20   stride : int.. 
+0001b690: 2020 2020 2020 2020 2020 2053 7472 6964             Strid
+0001b6a0: 6520 6f66 2074 6865 2061 7665 7261 6765  e of the average
+0001b6b0: 2070 6f6c 6c69 6e67 206c 6179 6572 732e   polling layers.
+0001b6c0: 2044 6566 6175 6c74 7320 746f 2034 2e0d   Defaults to 4..
+0001b6d0: 0a0d 0a20 2020 2020 2020 2070 6f6f 6c69  ...        pooli
+0001b6e0: 6e67 203a 2069 6e74 0d0a 2020 2020 2020  ng : int..      
+0001b6f0: 2020 2020 2020 506f 6f6c 696e 6720 6661        Pooling fa
+0001b700: 6374 6f72 206f 6620 7468 6520 6176 6572  ctor of the aver
+0001b710: 6167 6520 706f 6c6c 696e 6720 6c61 7965  age polling laye
+0001b720: 7273 2e20 4465 6661 756c 7473 2074 6f20  rs. Defaults to 
+0001b730: 342e 0d0a 0d0a 2020 2020 2020 2020 6472  4.....        dr
+0001b740: 6f70 6f75 7420 3a20 666c 6f61 740d 0a20  opout : float.. 
+0001b750: 2020 2020 2020 2020 2020 2044 726f 706f             Dropo
+0001b760: 7574 2063 6f65 6666 6963 6965 6e74 2e0d  ut coefficient..
+0001b770: 0a0d 0a20 2020 2052 6566 6572 656e 6365  ...    Reference
+0001b780: 730d 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  s..    ---------
+0001b790: 2d0d 0a20 2020 205b 335d 2056 2e4a 2e20  -..    [3] V.J. 
+0001b7a0: 4c61 7768 6572 6e2c 2065 7420 616c 2e2c  Lawhern, et al.,
+0001b7b0: 2045 4547 4e65 743a 2041 2063 6f6d 7061   EEGNet: A compa
+0001b7c0: 6374 2063 6f6e 766f 6c75 7469 6f6e 616c  ct convolutional
+0001b7d0: 206e 6575 7261 6c0d 0a20 2020 206e 6574   neural..    net
+0001b7e0: 776f 726b 2066 6f72 2045 4547 2d62 6173  work for EEG-bas
+0001b7f0: 6564 2062 7261 696e e280 9363 6f6d 7075  ed brain...compu
+0001b800: 7465 7220 696e 7465 7266 6163 6573 2031  ter interfaces 1
+0001b810: 3020 4a2e 204e 6575 7261 6c20 456e 672e  0 J. Neural Eng.
+0001b820: 2c0d 0a20 2020 2031 3520 2835 2920 2832  ,..    15 (5) (2
+0001b830: 3031 3829 2c20 702e 2030 3536 3031 330d  018), p. 056013.
+0001b840: 0a0d 0a20 2020 205b 345d 204f 7269 6769  ...    [4] Origi
+0001b850: 6e61 6c20 4545 474e 6574 2069 6d70 6c65  nal EEGNet imple
+0001b860: 6d65 6e74 6174 696f 6e20 6279 2074 6865  mentation by the
+0001b870: 2061 7574 686f 7273 2063 616e 2062 6520   authors can be 
+0001b880: 666f 756e 6420 6174 0d0a 2020 2020 6874  found at..    ht
+0001b890: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
+0001b8a0: 2f76 6c61 7768 6572 6e2f 6172 6c2d 6565  /vlawhern/arl-ee
+0001b8b0: 676d 6f64 656c 730d 0a20 2020 2022 2222  gmodels..    """
+0001b8c0: 0d0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+0001b8d0: 5f5f 2873 656c 662c 206d 6574 612c 2064  __(self, meta, d
+0001b8e0: 6174 6173 6574 3d4e 6f6e 6529 3a0d 0a20  ataset=None):.. 
+0001b8f0: 2020 2020 2020 2073 656c 662e 7363 6f70         self.scop
+0001b900: 6520 3d20 2765 6567 6e65 7438 270d 0a20  e = 'eegnet8'.. 
+0001b910: 2020 2020 2020 206d 6574 612e 6d6f 6465         meta.mode
+0001b920: 6c5f 7370 6563 732e 7365 7464 6566 6175  l_specs.setdefau
+0001b930: 6c74 2827 756e 6974 6e6f 726d 5f73 636f  lt('unitnorm_sco
+0001b940: 7065 272c 205b 5d29 0d0a 2020 2020 2020  pe', [])..      
+0001b950: 2020 6d65 7461 2e6d 6f64 656c 5f73 7065    meta.model_spe
+0001b960: 6373 2e73 6574 6465 6661 756c 7428 2766  cs.setdefault('f
+0001b970: 696c 7465 725f 6c65 6e67 7468 272c 2036  ilter_length', 6
+0001b980: 3429 0d0a 2020 2020 2020 2020 6d65 7461  4)..        meta
+0001b990: 2e6d 6f64 656c 5f73 7065 6373 2e73 6574  .model_specs.set
+0001b9a0: 6465 6661 756c 7428 2764 6570 7468 5f6d  default('depth_m
+0001b9b0: 756c 7469 706c 6965 7227 2c20 3229 0d0a  ultiplier', 2)..
+0001b9c0: 2020 2020 2020 2020 6d65 7461 2e6d 6f64          meta.mod
+0001b9d0: 656c 5f73 7065 6373 2e73 6574 6465 6661  el_specs.setdefa
+0001b9e0: 756c 7428 276e 5f6c 6174 656e 7427 2c20  ult('n_latent', 
+0001b9f0: 3829 0d0a 2020 2020 2020 2020 6d65 7461  8)..        meta
+0001ba00: 2e6d 6f64 656c 5f73 7065 6373 2e73 6574  .model_specs.set
+0001ba10: 6465 6661 756c 7428 2770 6f6f 6c69 6e67  default('pooling
+0001ba20: 272c 2034 290d 0a20 2020 2020 2020 206d  ', 4)..        m
+0001ba30: 6574 612e 6d6f 6465 6c5f 7370 6563 732e  eta.model_specs.
+0001ba40: 7365 7464 6566 6175 6c74 2827 7374 7269  setdefault('stri
+0001ba50: 6465 272c 2034 290d 0a20 2020 2020 2020  de', 4)..       
+0001ba60: 206d 6574 612e 6d6f 6465 6c5f 7370 6563   meta.model_spec
+0001ba70: 732e 7365 7464 6566 6175 6c74 2827 6472  s.setdefault('dr
+0001ba80: 6f70 6f75 7427 2c20 302e 3129 0d0a 2020  opout', 0.1)..  
+0001ba90: 2020 2020 2020 6d65 7461 2e6d 6f64 656c        meta.model
+0001baa0: 5f73 7065 6373 2e73 6574 6465 6661 756c  _specs.setdefaul
+0001bab0: 7428 2770 6164 6469 6e67 272c 2027 7361  t('padding', 'sa
+0001bac0: 6d65 2729 0d0a 2020 2020 2020 2020 6d65  me')..        me
+0001bad0: 7461 2e6d 6f64 656c 5f73 7065 6373 2e73  ta.model_specs.s
+0001bae0: 6574 6465 6661 756c 7428 276e 6f6e 6c69  etdefault('nonli
+0001baf0: 6e27 2c20 2765 6c75 2729 0d0a 2020 2020  n', 'elu')..    
+0001bb00: 2020 2020 6d65 7461 2e6d 6f64 656c 5f73      meta.model_s
+0001bb10: 7065 6373 5b27 7363 6f70 6527 5d20 3d20  pecs['scope'] = 
+0001bb20: 7365 6c66 2e73 636f 7065 0d0a 2020 2020  self.scope..    
+0001bb30: 2020 2020 7375 7065 7228 4545 474e 6574      super(EEGNet
+0001bb40: 2c20 7365 6c66 292e 5f5f 696e 6974 5f5f  , self).__init__
+0001bb50: 286d 6574 612c 2064 6174 6173 6574 290d  (meta, dataset).
+0001bb60: 0a20 2020 2020 2020 200d 0a0d 0a20 2020  .        ....   
+0001bb70: 2064 6566 2062 7569 6c64 5f67 7261 7068   def build_graph
+0001bb80: 2873 656c 6629 3a0d 0a0d 0a0d 0a20 2020  (self):......   
+0001bb90: 2020 2020 2069 6e70 7574 7320 3d20 7466       inputs = tf
+0001bba0: 2e74 7261 6e73 706f 7365 2873 656c 662e  .transpose(self.
+0001bbb0: 696e 7075 7473 2c5b 302c 332c 322c 315d  inputs,[0,3,2,1]
+0001bbc0: 290d 0a0d 0a20 2020 2020 2020 2064 726f  )....        dro
+0001bbd0: 706f 7574 5479 7065 203d 2044 726f 706f  poutType = Dropo
+0001bbe0: 7574 0d0a 0d0a 2020 2020 2020 2020 626c  ut....        bl
+0001bbf0: 6f63 6b31 2020 2020 2020 203d 2043 6f6e  ock1       = Con
+0001bc00: 7632 4428 7365 6c66 2e73 7065 6373 5b27  v2D(self.specs['
+0001bc10: 6e5f 6c61 7465 6e74 275d 2c0d 0a20 2020  n_latent'],..   
+0001bc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc30: 2020 2020 2020 2020 2020 2028 312c 2073             (1, s
+0001bc40: 656c 662e 7370 6563 735b 2766 696c 7465  elf.specs['filte
+0001bc50: 725f 6c65 6e67 7468 275d 292c 0d0a 2020  r_length']),..  
+0001bc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc70: 2020 2020 2020 2020 2020 2020 7061 6464              padd
+0001bc80: 696e 6720 3d20 7365 6c66 2e73 7065 6373  ing = self.specs
+0001bc90: 5b27 7061 6464 696e 6727 5d2c 0d0a 2020  ['padding'],..  
+0001bca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bcb0: 2020 2020 2020 2020 2020 2020 696e 7075              inpu
+0001bcc0: 745f 7368 6170 6520 3d20 2831 2c20 7365  t_shape = (1, se
+0001bcd0: 6c66 2e64 6174 6173 6574 2e68 5f70 6172  lf.dataset.h_par
+0001bce0: 616d 735b 276e 5f63 6827 5d2c 0d0a 2020  ams['n_ch'],..  
+0001bcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001bd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bd20: 2020 6465 7074 685f 6d75 6c74 6970 6c69    depth_multipli
-0001bd30: 6572 203d 2073 656c 662e 7370 6563 735b  er = self.specs[
-0001bd40: 2764 6570 7468 5f6d 756c 7469 706c 6965  'depth_multiplie
-0001bd50: 7227 5d2c 0d0a 2020 2020 2020 2020 2020  r'],..          
-0001bd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bd70: 2020 2020 2020 2020 2020 2020 2064 6570               dep
-0001bd80: 7468 7769 7365 5f63 6f6e 7374 7261 696e  thwise_constrain
-0001bd90: 7420 3d20 636f 6e73 7472 6169 6e74 732e  t = constraints.
-0001bda0: 4d61 784e 6f72 6d28 312e 2929 2862 6c6f  MaxNorm(1.))(blo
-0001bdb0: 636b 3129 0d0a 2020 2020 2020 2020 2362  ck1)..        #b
-0001bdc0: 6c6f 636b 3120 2020 2020 2020 3d20 4261  lock1       = Ba
-0001bdd0: 7463 684e 6f72 6d61 6c69 7a61 7469 6f6e  tchNormalization
-0001bde0: 2861 7869 7320 3d20 3129 2862 6c6f 636b  (axis = 1)(block
-0001bdf0: 3129 0d0a 2020 2020 2020 2020 626c 6f63  1)..        bloc
-0001be00: 6b31 2020 2020 2020 203d 206c 6179 6572  k1       = layer
-0001be10: 732e 4163 7469 7661 7469 6f6e 2873 656c  s.Activation(sel
-0001be20: 662e 7370 6563 735b 276e 6f6e 6c69 6e27  f.specs['nonlin'
-0001be30: 5d29 2862 6c6f 636b 3129 0d0a 2020 2020  ])(block1)..    
-0001be40: 2020 2020 626c 6f63 6b31 2020 2020 2020      block1      
-0001be50: 203d 206c 6179 6572 732e 4176 6572 6167   = layers.Averag
-0001be60: 6550 6f6f 6c69 6e67 3244 2828 312c 2073  ePooling2D((1, s
-0001be70: 656c 662e 7370 6563 735b 2770 6f6f 6c69  elf.specs['pooli
-0001be80: 6e67 275d 2929 2862 6c6f 636b 3129 0d0a  ng']))(block1)..
-0001be90: 2020 2020 2020 2020 7072 696e 7428 2242          print("B
-0001bea0: 6c6f 636b 2031 3a22 2c20 626c 6f63 6b31  lock 1:", block1
-0001beb0: 2e73 6861 7065 290d 0a20 2020 2020 2020  .shape)..       
-0001bec0: 2062 6c6f 636b 3120 2020 2020 2020 3d20   block1       = 
-0001bed0: 6472 6f70 6f75 7454 7970 6528 7365 6c66  dropoutType(self
-0001bee0: 2e73 7065 6373 5b27 6472 6f70 6f75 7427  .specs['dropout'
-0001bef0: 5d29 2862 6c6f 636b 3129 0d0a 0d0a 2020  ])(block1)....  
-0001bf00: 2020 2020 2020 626c 6f63 6b32 2020 2020        block2    
-0001bf10: 2020 203d 2053 6570 6172 6162 6c65 436f     = SeparableCo
-0001bf20: 6e76 3244 2873 656c 662e 7370 6563 735b  nv2D(self.specs[
-0001bf30: 276e 5f6c 6174 656e 7427 5d2a 7365 6c66  'n_latent']*self
-0001bf40: 2e73 7065 6373 5b27 6465 7074 685f 6d75  .specs['depth_mu
-0001bf50: 6c74 6970 6c69 6572 275d 2c20 2831 2c20  ltiplier'], (1, 
-0001bf60: 7365 6c66 2e73 7065 6373 5b27 6669 6c74  self.specs['filt
-0001bf70: 6572 5f6c 656e 6774 6827 5d2f 2f73 656c  er_length']//sel
-0001bf80: 662e 7370 6563 735b 2270 6f6f 6c69 6e67  f.specs["pooling
-0001bf90: 225d 292c 0d0a 2020 2020 2020 2020 2020  "]),..          
-0001bfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bfb0: 2020 2020 2020 2020 2020 2020 2075 7365               use
-0001bfc0: 5f62 6961 7320 3d20 4661 6c73 652c 2070  _bias = False, p
-0001bfd0: 6164 6469 6e67 203d 2073 656c 662e 7370  adding = self.sp
-0001bfe0: 6563 735b 2770 6164 6469 6e67 275d 2928  ecs['padding'])(
-0001bff0: 626c 6f63 6b31 290d 0a20 2020 2020 2020  block1)..       
-0001c000: 2023 626c 6f63 6b32 2020 2020 2020 203d   #block2       =
-0001c010: 2042 6174 6368 4e6f 726d 616c 697a 6174   BatchNormalizat
-0001c020: 696f 6e28 6178 6973 203d 2031 2928 626c  ion(axis = 1)(bl
-0001c030: 6f63 6b32 290d 0a0d 0a20 2020 2020 2020  ock2)....       
-0001c040: 2023 7072 696e 7428 2242 6174 6368 6e6f   #print("Batchno
-0001c050: 726d 2032 3a22 2c20 626c 6f63 6b32 2e73  rm 2:", block2.s
-0001c060: 6861 7065 290d 0a0d 0a20 2020 2020 2020  hape)....       
-0001c070: 2062 6c6f 636b 3220 2020 2020 2020 3d20   block2       = 
-0001c080: 6c61 7965 7273 2e41 6374 6976 6174 696f  layers.Activatio
-0001c090: 6e28 7365 6c66 2e73 7065 6373 5b27 6e6f  n(self.specs['no
-0001c0a0: 6e6c 696e 275d 2928 626c 6f63 6b32 290d  nlin'])(block2).
-0001c0b0: 0a20 2020 2020 2020 2062 6c6f 636b 3220  .        block2 
-0001c0c0: 2020 2020 2020 3d20 6c61 7965 7273 2e41        = layers.A
-0001c0d0: 7665 7261 6765 506f 6f6c 696e 6732 4428  veragePooling2D(
-0001c0e0: 2831 2c20 7365 6c66 2e73 7065 6373 5b27  (1, self.specs['
-0001c0f0: 706f 6f6c 696e 6727 5d2a 3229 2928 626c  pooling']*2))(bl
-0001c100: 6f63 6b32 290d 0a20 2020 2020 2020 2062  ock2)..        b
-0001c110: 6c6f 636b 3220 2020 2020 2020 3d20 6472  lock2       = dr
-0001c120: 6f70 6f75 7454 7970 6528 7365 6c66 2e73  opoutType(self.s
-0001c130: 7065 6373 5b27 6472 6f70 6f75 7427 5d29  pecs['dropout'])
-0001c140: 2862 6c6f 636b 3229 0d0a 2020 2020 2020  (block2)..      
-0001c150: 2020 7072 696e 7428 2242 6c6f 636b 2032    print("Block 2
-0001c160: 3a22 2c20 626c 6f63 6b32 2e73 6861 7065  :", block2.shape
-0001c170: 290d 0a0d 0a20 2020 2020 2020 2066 696e  )....        fin
-0001c180: 5f66 6320 3d20 4675 6c6c 7943 6f6e 6e65  _fc = FullyConne
-0001c190: 6374 6564 2873 697a 653d 7365 6c66 2e6f  cted(size=self.o
-0001c1a0: 7574 5f64 696d 2c20 6e6f 6e6c 696e 3d74  ut_dim, nonlin=t
-0001c1b0: 662e 6964 656e 7469 7479 2c0d 0a20 2020  f.identity,..   
-0001c1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c1d0: 2020 2020 2020 2020 2073 7065 6373 3d73           specs=s
-0001c1e0: 656c 662e 7370 6563 7329 0d0a 2020 2020  elf.specs)..    
-0001c1f0: 2020 2020 795f 7072 6564 203d 2066 696e      y_pred = fin
-0001c200: 5f66 6328 626c 6f63 6b32 290d 0a0d 0a20  _fc(block2).... 
-0001c210: 2020 2020 2020 2072 6574 7572 6e20 795f         return y_
-0001c220: 7072 6564 0d0a 0d0a 2320 636c 6173 7320  pred....# class 
-0001c230: 5369 6d70 6c65 4e65 7428 4c46 434e 4e29  SimpleNet(LFCNN)
-0001c240: 3a0d 0a23 2020 2020 2022 2222 0d0a 2320  :..#     """..# 
-0001c250: 2020 2020 2020 2020 5065 7472 6f73 7961          Petrosya
-0001c260: 6e2c 2041 2e2c 2053 696e 6b69 6e2c 204d  n, A., Sinkin, M
-0001c270: 2e2c 204c 6562 6564 6576 2c20 4d2e 2041  ., Lebedev, M. A
-0001c280: 2e2c 2026 204f 7373 6164 7463 6869 2c20  ., & Ossadtchi, 
-0001c290: 412e 2020 4465 636f 6469 6e67 2061 6e64  A.  Decoding and
-0001c2a0: 2069 6e74 6572 7072 6574 696e 6720 636f   interpreting co
-0001c2b0: 7274 6963 616c 2073 6967 6e61 6c73 2077  rtical signals w
-0001c2c0: 6974 680d 0a23 2020 2020 2020 2020 2061  ith..#         a
-0001c2d0: 2063 6f6d 7061 6374 2063 6f6e 766f 6c75   compact convolu
-0001c2e0: 7469 6f6e 616c 206e 6575 7261 6c20 6e65  tional neural ne
-0001c2f0: 7477 6f72 6b2c 2032 3032 312c 204a 6f75  twork, 2021, Jou
-0001c300: 726e 616c 206f 6620 4e65 7572 616c 2045  rnal of Neural E
-0001c310: 6e67 696e 6565 7269 6e67 2c20 3230 3231  ngineering, 2021
-0001c320: 2c0d 0a23 2020 2020 2020 2020 2068 7474  ,..#         htt
-0001c330: 7073 3a2f 2f64 6f69 2e6f 7267 2f31 302e  ps://doi.org/10.
-0001c340: 3130 3838 2f31 3734 312d 3235 3532 2f61  1088/1741-2552/a
-0001c350: 6265 3230 650d 0a23 2020 2020 2022 2222  be20e..#     """
-0001c360: 0d0a 2320 2020 2020 6465 6620 5f5f 696e  ..#     def __in
-0001c370: 6974 5f5f 2873 656c 662c 2044 6174 6173  it__(self, Datas
-0001c380: 6574 2c20 7370 6563 733d 4e6f 6e65 293a  et, specs=None):
-0001c390: 0d0a 2320 2020 2020 2020 2020 6966 2073  ..#         if s
-0001c3a0: 7065 6373 2069 7320 4e6f 6e65 3a0d 0a23  pecs is None:..#
-0001c3b0: 2020 2020 2020 2020 2020 2020 2073 7065               spe
-0001c3c0: 6373 3d64 6963 7428 290d 0a23 2020 2020  cs=dict()..#    
-0001c3d0: 2020 2020 2073 7570 6572 2829 2e5f 5f69       super().__i
-0001c3e0: 6e69 745f 5f28 4461 7461 7365 742c 2073  nit__(Dataset, s
-0001c3f0: 7065 6373 290d 0a0d 0a23 2020 2020 2064  pecs)....#     d
-0001c400: 6566 2062 7569 6c64 5f67 7261 7068 2873  ef build_graph(s
-0001c410: 656c 6629 3a0d 0a23 2020 2020 2020 2020  elf):..#        
-0001c420: 2073 656c 662e 646d 7820 3d20 4465 4d69   self.dmx = DeMi
-0001c430: 7869 6e67 2873 697a 653d 7365 6c66 2e73  xing(size=self.s
-0001c440: 7065 6373 5b27 6e5f 6c61 7465 6e74 275d  pecs['n_latent']
-0001c450: 2c20 6e6f 6e6c 696e 3d74 662e 6964 656e  , nonlin=tf.iden
-0001c460: 7469 7479 2c0d 0a23 2020 2020 2020 2020  tity,..#        
-0001c470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c480: 2020 2020 2061 7869 733d 332c 2073 7065       axis=3, spe
-0001c490: 6373 3d73 656c 662e 7370 6563 7329 0d0a  cs=self.specs)..
-0001c4a0: 2320 2020 2020 2020 2020 7365 6c66 2e64  #         self.d
-0001c4b0: 6d78 5f6f 7574 203d 2073 656c 662e 646d  mx_out = self.dm
-0001c4c0: 7828 7365 6c66 2e69 6e70 7574 7329 0d0a  x(self.inputs)..
-0001c4d0: 0d0a 2320 2020 2020 2020 2020 7365 6c66  ..#         self
-0001c4e0: 2e74 636f 6e76 203d 204c 4654 436f 6e76  .tconv = LFTConv
-0001c4f0: 280d 0a23 2020 2020 2020 2020 2020 2020  (..#            
-0001c500: 2073 697a 653d 7365 6c66 2e73 7065 6373   size=self.specs
-0001c510: 5b27 6e5f 6c61 7465 6e74 275d 2c0d 0a23  ['n_latent'],..#
-0001c520: 2020 2020 2020 2020 2020 2020 206e 6f6e               non
-0001c530: 6c69 6e3d 7365 6c66 2e73 7065 6373 5b27  lin=self.specs['
-0001c540: 6e6f 6e6c 696e 275d 2c0d 0a23 2020 2020  nonlin'],..#    
-0001c550: 2020 2020 2020 2020 2066 696c 7465 725f           filter_
-0001c560: 6c65 6e67 7468 3d73 656c 662e 7370 6563  length=self.spec
-0001c570: 735b 2766 696c 7465 725f 6c65 6e67 7468  s['filter_length
-0001c580: 275d 2c0d 0a23 2020 2020 2020 2020 2020  '],..#          
-0001c590: 2020 2070 6164 6469 6e67 3d73 656c 662e     padding=self.
-0001c5a0: 7370 6563 735b 2770 6164 6469 6e67 275d  specs['padding']
-0001c5b0: 2c0d 0a23 2020 2020 2020 2020 2020 2020  ,..#            
-0001c5c0: 2073 7065 6373 3d73 656c 662e 7370 6563   specs=self.spec
-0001c5d0: 730d 0a23 2020 2020 2020 2020 2029 0d0a  s..#         )..
-0001c5e0: 2320 2020 2020 2020 2020 7365 6c66 2e74  #         self.t
-0001c5f0: 636f 6e76 5f6f 7574 203d 2073 656c 662e  conv_out = self.
-0001c600: 7463 6f6e 7628 7365 6c66 2e64 6d78 5f6f  tconv(self.dmx_o
-0001c610: 7574 290d 0a0d 0a23 2020 2020 2020 2020  ut)....#        
-0001c620: 2073 656c 662e 656e 7663 6f6e 7620 3d20   self.envconv = 
-0001c630: 4c46 5443 6f6e 7628 0d0a 2320 2020 2020  LFTConv(..#     
-0001c640: 2020 2020 2020 2020 7369 7a65 3d73 656c          size=sel
-0001c650: 662e 7370 6563 735b 276e 5f6c 6174 656e  f.specs['n_laten
-0001c660: 7427 5d2c 0d0a 2320 2020 2020 2020 2020  t'],..#         
-0001c670: 2020 2020 6e6f 6e6c 696e 3d73 656c 662e      nonlin=self.
-0001c680: 7370 6563 735b 276e 6f6e 6c69 6e27 5d2c  specs['nonlin'],
-0001c690: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-0001c6a0: 6669 6c74 6572 5f6c 656e 6774 683d 7365  filter_length=se
-0001c6b0: 6c66 2e73 7065 6373 5b27 6669 6c74 6572  lf.specs['filter
-0001c6c0: 5f6c 656e 6774 6827 5d2c 0d0a 2320 2020  _length'],..#   
-0001c6d0: 2020 2020 2020 2020 2020 7061 6464 696e            paddin
-0001c6e0: 673d 7365 6c66 2e73 7065 6373 5b27 7061  g=self.specs['pa
-0001c6f0: 6464 696e 6727 5d2c 0d0a 2320 2020 2020  dding'],..#     
-0001c700: 2020 2020 2020 2020 7370 6563 733d 7365          specs=se
-0001c710: 6c66 2e73 7065 6373 0d0a 2320 2020 2020  lf.specs..#     
-0001c720: 2020 2020 290d 0a0d 0a23 2020 2020 2020      )....#      
-0001c730: 2020 2073 656c 662e 656e 7663 6f6e 765f     self.envconv_
-0001c740: 6f75 7420 3d20 7365 6c66 2e65 6e76 636f  out = self.envco
-0001c750: 6e76 2873 656c 662e 7463 6f6e 765f 6f75  nv(self.tconv_ou
-0001c760: 7429 0d0a 2320 2020 2020 2020 2020 7365  t)..#         se
-0001c770: 6c66 2e70 6f6f 6c20 3d20 6c61 6d62 6461  lf.pool = lambda
-0001c780: 2058 3a20 585b 3a2c 203a 2c20 3a3a 7365   X: X[:, :, ::se
-0001c790: 6c66 2e73 7065 6373 5b27 706f 6f6c 696e  lf.specs['poolin
-0001c7a0: 6727 5d2c 203a 5d0d 0a0d 0a23 2020 2020  g'], :]....#    
-0001c7b0: 2020 2020 2073 656c 662e 706f 6f6c 6564       self.pooled
-0001c7c0: 203d 2073 656c 662e 706f 6f6c 2873 656c   = self.pool(sel
-0001c7d0: 662e 656e 7663 6f6e 765f 6f75 7429 0d0a  f.envconv_out)..
-0001c7e0: 0d0a 2320 2020 2020 2020 2020 6472 6f70  ..#         drop
-0001c7f0: 6f75 7420 3d20 4472 6f70 6f75 7428 0d0a  out = Dropout(..
-0001c800: 2320 2020 2020 2020 2020 2020 2020 7365  #             se
-0001c810: 6c66 2e73 7065 6373 5b27 6472 6f70 6f75  lf.specs['dropou
-0001c820: 7427 5d2c 0d0a 2320 2020 2020 2020 2020  t'],..#         
-0001c830: 2020 2020 6e6f 6973 655f 7368 6170 653d      noise_shape=
-0001c840: 4e6f 6e65 0d0a 2320 2020 2020 2020 2020  None..#         
-0001c850: 2928 7365 6c66 2e70 6f6f 6c65 6429 0d0a  )(self.pooled)..
-0001c860: 0d0a 2320 2020 2020 2020 2020 7365 6c66  ..#         self
-0001c870: 2e66 696e 5f66 6320 3d20 4675 6c6c 7943  .fin_fc = FullyC
-0001c880: 6f6e 6e65 6374 6564 2873 697a 653d 7365  onnected(size=se
-0001c890: 6c66 2e6f 7574 5f64 696d 2c20 6e6f 6e6c  lf.out_dim, nonl
-0001c8a0: 696e 3d74 662e 6964 656e 7469 7479 2c0d  in=tf.identity,.
-0001c8b0: 0a23 2020 2020 2020 2020 2020 2020 2020  .#              
-0001c8c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001c8d0: 7065 6373 3d73 656c 662e 7370 6563 7329  pecs=self.specs)
-0001c8e0: 0d0a 0d0a 2320 2020 2020 2020 2020 795f  ....#         y_
-0001c8f0: 7072 6564 203d 2073 656c 662e 6669 6e5f  pred = self.fin_
-0001c900: 6663 2864 726f 706f 7574 290d 0a0d 0a23  fc(dropout)....#
-0001c910: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001c920: 795f 7072 6564 0d0a 0d0a 2320 2020 2020  y_pred....#     
-0001c930: 6465 6620 636f 6d70 7574 655f 7061 7474  def compute_patt
-0001c940: 6572 6e73 2873 656c 662c 2064 6174 615f  erns(self, data_
-0001c950: 7061 7468 3d4e 6f6e 652c 202a 2c20 6f75  path=None, *, ou
-0001c960: 7470 7574 3d27 7061 7474 6572 6e73 2729  tput='patterns')
-0001c970: 3a0d 0a0d 0a23 2020 2020 2020 2020 2069  :....#         i
-0001c980: 6620 6e6f 7420 6461 7461 5f70 6174 683a  f not data_path:
-0001c990: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-0001c9a0: 7072 696e 7428 2243 6f6d 7075 7469 6e67  print("Computing
-0001c9b0: 2070 6174 7465 726e 733a 204e 6f20 7061   patterns: No pa
-0001c9c0: 7468 2073 7065 6369 6669 6564 2c20 7573  th specified, us
-0001c9d0: 696e 6720 7661 6c69 6461 7469 6f6e 2064  ing validation d
-0001c9e0: 6174 6173 6574 2028 4465 6661 756c 7429  ataset (Default)
-0001c9f0: 2229 0d0a 2320 2020 2020 2020 2020 2020  ")..#           
-0001ca00: 2020 6473 203d 2073 656c 662e 6461 7461    ds = self.data
-0001ca10: 7365 742e 7661 6c0d 0a23 2020 2020 2020  set.val..#      
-0001ca20: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-0001ca30: 6365 2864 6174 615f 7061 7468 2c20 7374  ce(data_path, st
-0001ca40: 7229 206f 7220 6973 696e 7374 616e 6365  r) or isinstance
-0001ca50: 2864 6174 615f 7061 7468 2c20 286c 6973  (data_path, (lis
-0001ca60: 742c 2074 7570 6c65 2929 3a0d 0a23 2020  t, tuple)):..#  
-0001ca70: 2020 2020 2020 2020 2020 2064 7320 3d20             ds = 
-0001ca80: 7365 6c66 2e64 6174 6173 6574 2e5f 6275  self.dataset._bu
-0001ca90: 696c 645f 6461 7461 7365 7428 0d0a 2320  ild_dataset(..# 
-0001caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cab0: 6461 7461 5f70 6174 682c 0d0a 2320 2020  data_path,..#   
-0001cac0: 2020 2020 2020 2020 2020 2020 2020 7370                sp
-0001cad0: 6c69 743d 4661 6c73 652c 0d0a 2320 2020  lit=False,..#   
-0001cae0: 2020 2020 2020 2020 2020 2020 2020 7465                te
-0001caf0: 7374 5f62 6174 6368 3d4e 6f6e 652c 0d0a  st_batch=None,..
-0001cb00: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0001cb10: 2020 7265 7065 6174 3d54 7275 650d 0a23    repeat=True..#
-0001cb20: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-0001cb30: 2320 2020 2020 2020 2020 656c 6966 2069  #         elif i
-0001cb40: 7369 6e73 7461 6e63 6528 6461 7461 5f70  sinstance(data_p
-0001cb50: 6174 682c 2044 6174 6173 6574 293a 0d0a  ath, Dataset):..
-0001cb60: 2320 2020 2020 2020 2020 2020 2020 6966  #             if
-0001cb70: 2068 6173 6174 7472 2864 6174 615f 7061   hasattr(data_pa
-0001cb80: 7468 2c20 2774 6573 7427 293a 0d0a 2320  th, 'test'):..# 
-0001cb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cba0: 6473 203d 2064 6174 615f 7061 7468 2e74  ds = data_path.t
-0001cbb0: 6573 740d 0a23 2020 2020 2020 2020 2020  est..#          
-0001cbc0: 2020 2065 6c73 653a 0d0a 2320 2020 2020     else:..#     
-0001cbd0: 2020 2020 2020 2020 2020 2020 6473 203d              ds =
-0001cbe0: 2064 6174 615f 7061 7468 2e76 616c 0d0a   data_path.val..
-0001cbf0: 2320 2020 2020 2020 2020 656c 6966 2069  #         elif i
-0001cc00: 7369 6e73 7461 6e63 6528 6461 7461 5f70  sinstance(data_p
-0001cc10: 6174 682c 2074 662e 6461 7461 2e44 6174  ath, tf.data.Dat
-0001cc20: 6173 6574 293a 0d0a 2320 2020 2020 2020  aset):..#       
-0001cc30: 2020 2020 2020 6473 203d 2064 6174 615f        ds = data_
-0001cc40: 7061 7468 0d0a 2320 2020 2020 2020 2020  path..#         
-0001cc50: 656c 7365 3a0d 0a23 2020 2020 2020 2020  else:..#        
-0001cc60: 2020 2020 2072 6169 7365 2041 7474 7269       raise Attri
-0001cc70: 6275 7465 4572 726f 7228 2753 7065 6369  buteError('Speci
-0001cc80: 6679 2064 6174 6173 6574 206f 7220 6461  fy dataset or da
-0001cc90: 7461 2070 6174 682e 2729 0d0a 0d0a 2320  ta path.')....# 
-0001cca0: 2020 2020 2020 2020 582c 2079 203d 205b          X, y = [
-0001ccb0: 726f 7720 666f 7220 726f 7720 696e 2064  row for row in d
-0001ccc0: 732e 7461 6b65 2831 295d 5b30 5d0d 0a0d  s.take(1)][0]...
-0001ccd0: 0a23 2020 2020 2020 2020 2073 656c 662e  .#         self.
-0001cce0: 6f75 745f 775f 666c 6174 203d 2073 656c  out_w_flat = sel
-0001ccf0: 662e 6669 6e5f 6663 2e77 2e6e 756d 7079  f.fin_fc.w.numpy
-0001cd00: 2829 0d0a 2320 2020 2020 2020 2020 7365  ()..#         se
-0001cd10: 6c66 2e6f 7574 5f77 6569 6768 7473 203d  lf.out_weights =
-0001cd20: 206e 702e 7265 7368 6170 6528 0d0a 2320   np.reshape(..# 
-0001cd30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001cd40: 2e6f 7574 5f77 5f66 6c61 742c 0d0a 2320  .out_w_flat,..# 
-0001cd50: 2020 2020 2020 2020 2020 2020 5b2d 312c              [-1,
-0001cd60: 2073 656c 662e 646d 782e 7369 7a65 2c20   self.dmx.size, 
-0001cd70: 7365 6c66 2e6f 7574 5f64 696d 5d0d 0a23  self.out_dim]..#
-0001cd80: 2020 2020 2020 2020 2029 0d0a 2320 2020           )..#   
-0001cd90: 2020 2020 2020 7365 6c66 2e6f 7574 5f62        self.out_b
-0001cda0: 6961 7365 7320 3d20 7365 6c66 2e66 696e  iases = self.fin
-0001cdb0: 5f66 632e 622e 6e75 6d70 7928 290d 0a23  _fc.b.numpy()..#
-0001cdc0: 2020 2020 2020 2020 2073 656c 662e 6665           self.fe
-0001cdd0: 6174 7572 655f 7265 6c65 7661 6e63 6573  ature_relevances
-0001cde0: 203d 2073 656c 662e 636f 6d70 6f6e 656e   = self.componen
-0001cdf0: 7477 6973 655f 6c6f 7373 2858 2c20 7929  twise_loss(X, y)
-0001ce00: 0d0a 2320 2020 2020 2020 2020 7365 6c66  ..#         self
-0001ce10: 2e62 7261 6e63 6877 6973 655f 6c6f 7373  .branchwise_loss
-0001ce20: 2858 2c20 7929 0d0a 0d0a 2320 2020 2020  (X, y)....#     
-0001ce30: 2020 2020 2320 636f 6d70 7574 6520 7465      # compute te
-0001ce40: 6d70 6f72 616c 2063 6f6e 766f 6c75 7469  mporal convoluti
-0001ce50: 6f6e 206c 6179 6572 206f 7574 7075 7473  on layer outputs
-0001ce60: 2066 6f72 2076 6973 5f64 6963 730d 0a23   for vis_dics..#
-0001ce70: 2020 2020 2020 2020 2074 635f 6f75 7420           tc_out 
-0001ce80: 3d20 7365 6c66 2e70 6f6f 6c28 7365 6c66  = self.pool(self
-0001ce90: 2e74 636f 6e76 2873 656c 662e 646d 7828  .tconv(self.dmx(
-0001cea0: 5829 292e 6e75 6d70 7928 2929 0d0a 0d0a  X)).numpy())....
-0001ceb0: 2320 2020 2020 2020 2020 2320 636f 6d70  #         # comp
-0001cec0: 7574 6520 6461 7461 2063 6f76 6172 6961  ute data covaria
-0001ced0: 6e63 650d 0a23 2020 2020 2020 2020 2058  nce..#         X
-0001cee0: 203d 2058 202d 2074 662e 7265 6475 6365   = X - tf.reduce
-0001cef0: 5f6d 6561 6e28 582c 2061 7869 733d 2d32  _mean(X, axis=-2
-0001cf00: 2c20 6b65 6570 6469 6d73 3d54 7275 6529  , keepdims=True)
-0001cf10: 0d0a 2320 2020 2020 2020 2020 5820 3d20  ..#         X = 
-0001cf20: 7466 2e74 7261 6e73 706f 7365 2858 2c20  tf.transpose(X, 
-0001cf30: 5b33 2c20 302c 2031 2c20 325d 290d 0a23  [3, 0, 1, 2])..#
-0001cf40: 2020 2020 2020 2020 2058 203d 2074 662e           X = tf.
-0001cf50: 7265 7368 6170 6528 582c 205b 582e 7368  reshape(X, [X.sh
-0001cf60: 6170 655b 305d 2c20 2d31 5d29 0d0a 2320  ape[0], -1])..# 
-0001cf70: 2020 2020 2020 2020 7365 6c66 2e64 636f          self.dco
-0001cf80: 7620 3d20 7466 2e6d 6174 6d75 6c28 582c  v = tf.matmul(X,
-0001cf90: 2074 662e 7472 616e 7370 6f73 6528 5829   tf.transpose(X)
-0001cfa0: 290d 0a0d 0a23 2020 2020 2020 2020 2023  )....#         #
-0001cfb0: 2067 6574 2073 7061 7469 616c 2065 7874   get spatial ext
-0001cfc0: 7261 6374 696f 6e20 6669 7465 7220 7765  raction fiter we
-0001cfd0: 6967 6874 730d 0a23 2020 2020 2020 2020  ights..#        
-0001cfe0: 2064 656d 7820 3d20 7365 6c66 2e64 6d78   demx = self.dmx
-0001cff0: 2e77 2e6e 756d 7079 2829 0d0a 0d0a 2320  .w.numpy()....# 
-0001d000: 2020 2020 2020 2020 6b65 726e 203d 206e          kern = n
-0001d010: 702e 7371 7565 657a 6528 7365 6c66 2e74  p.squeeze(self.t
-0001d020: 636f 6e76 2e66 696c 7465 7273 2e6e 756d  conv.filters.num
-0001d030: 7079 2829 292e 540d 0a0d 0a23 2020 2020  py()).T....#    
-0001d040: 2020 2020 2058 203d 2058 2e6e 756d 7079       X = X.numpy
-0001d050: 2829 2e54 0d0a 0d0a 2320 2020 2020 2020  ().T....#       
-0001d060: 2020 7061 7474 6572 6e73 203d 205b 5d0d    patterns = [].
-0001d070: 0a23 2020 2020 2020 2020 2058 5f66 696c  .#         X_fil
-0001d080: 7420 3d20 6e70 2e7a 6572 6f73 5f6c 696b  t = np.zeros_lik
-0001d090: 6528 5829 0d0a 2320 2020 2020 2020 2020  e(X)..#         
-0001d0a0: 666f 7220 695f 636f 6d70 2069 6e20 7261  for i_comp in ra
-0001d0b0: 6e67 6528 6b65 726e 2e73 6861 7065 5b30  nge(kern.shape[0
-0001d0c0: 5d29 3a0d 0a23 2020 2020 2020 2020 2020  ]):..#          
-0001d0d0: 2020 2066 6f72 2069 5f63 6820 696e 2072     for i_ch in r
-0001d0e0: 616e 6765 2858 2e73 6861 7065 5b31 5d29  ange(X.shape[1])
-0001d0f0: 3a0d 0a23 2020 2020 2020 2020 2020 2020  :..#            
-0001d100: 2020 2020 2078 203d 2058 5b3a 2c20 695f       x = X[:, i_
-0001d110: 6368 5d0d 0a23 2020 2020 2020 2020 2020  ch]..#          
-0001d120: 2020 2020 2020 2058 5f66 696c 745b 3a2c         X_filt[:,
-0001d130: 2069 5f63 685d 203d 206e 702e 636f 6e76   i_ch] = np.conv
-0001d140: 6f6c 7665 2878 2c20 6b65 726e 5b69 5f63  olve(x, kern[i_c
-0001d150: 6f6d 702c 203a 5d2c 206d 6f64 653d 2273  omp, :], mode="s
-0001d160: 616d 6522 290d 0a23 2020 2020 2020 2020  ame")..#        
-0001d170: 2020 2020 2070 6174 7465 726e 732e 6170       patterns.ap
-0001d180: 7065 6e64 286e 702e 636f 7628 585f 6669  pend(np.cov(X_fi
-0001d190: 6c74 2e54 2920 4020 6465 6d78 5b3a 2c20  lt.T) @ demx[:, 
-0001d1a0: 695f 636f 6d70 5d29 0d0a 2320 2020 2020  i_comp])..#     
-0001d1b0: 2020 2020 7365 6c66 2e70 6174 7465 726e      self.pattern
-0001d1c0: 7320 3d20 6e70 2e61 7272 6179 2870 6174  s = np.array(pat
-0001d1d0: 7465 726e 7329 2e54 0d0a 0d0a 0d0a 2320  terns).T......# 
-0001d1e0: 2020 2020 2020 2020 6966 2027 7061 7474          if 'patt
-0001d1f0: 6572 6e73 2720 696e 206f 7574 7075 743a  erns' in output:
-0001d200: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-0001d210: 6966 2027 6f6c 6427 2069 6e20 6f75 7470  if 'old' in outp
-0001d220: 7574 3a0d 0a23 2020 2020 2020 2020 2020  ut:..#          
-0001d230: 2020 2020 2020 2073 656c 662e 7061 7474         self.patt
-0001d240: 6572 6e73 203d 206e 702e 646f 7428 7365  erns = np.dot(se
-0001d250: 6c66 2e64 636f 762c 2064 656d 7829 0d0a  lf.dcov, demx)..
-0001d260: 2320 2020 2020 2020 2020 2020 2020 656c  #             el
-0001d270: 7365 3a0d 0a23 2020 2020 2020 2020 2020  se:..#          
-0001d280: 2020 2020 2020 2070 6174 7465 726e 7320         patterns 
-0001d290: 3d20 5b5d 0d0a 2320 2020 2020 2020 2020  = []..#         
-0001d2a0: 2020 2020 2020 2020 585f 6669 6c74 203d          X_filt =
-0001d2b0: 206e 702e 7a65 726f 735f 6c69 6b65 2858   np.zeros_like(X
-0001d2c0: 290d 0a23 2020 2020 2020 2020 2020 2020  )..#            
-0001d2d0: 2020 2020 2066 6f72 2069 5f63 6f6d 7020       for i_comp 
-0001d2e0: 696e 2072 616e 6765 286b 6572 6e2e 7368  in range(kern.sh
-0001d2f0: 6170 655b 305d 293a 0d0a 2320 2020 2020  ape[0]):..#     
-0001d300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d310: 666f 7220 695f 6368 2069 6e20 7261 6e67  for i_ch in rang
-0001d320: 6528 582e 7368 6170 655b 315d 293a 0d0a  e(X.shape[1]):..
-0001d330: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0001d340: 2020 2020 2020 2020 2020 7820 3d20 585b            x = X[
-0001d350: 3a2c 2069 5f63 685d 0d0a 2320 2020 2020  :, i_ch]..#     
-0001d360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d370: 2020 2020 585f 6669 6c74 5b3a 2c20 695f      X_filt[:, i_
-0001d380: 6368 5d20 3d20 6e70 2e63 6f6e 766f 6c76  ch] = np.convolv
-0001d390: 6528 782c 206b 6572 6e5b 695f 636f 6d70  e(x, kern[i_comp
-0001d3a0: 2c20 3a5d 2c20 6d6f 6465 3d22 7361 6d65  , :], mode="same
-0001d3b0: 2229 0d0a 2320 2020 2020 2020 2020 2020  ")..#           
-0001d3c0: 2020 2020 2020 2020 2020 7061 7474 6572            patter
-0001d3d0: 6e73 2e61 7070 656e 6428 6e70 2e63 6f76  ns.append(np.cov
-0001d3e0: 2858 5f66 696c 742e 5429 2040 2064 656d  (X_filt.T) @ dem
-0001d3f0: 785b 3a2c 2069 5f63 6f6d 705d 290d 0a23  x[:, i_comp])..#
+0001bd10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001bd20: 6461 7461 7365 742e 685f 7061 7261 6d73  dataset.h_params
+0001bd30: 5b27 6e5f 7427 5d29 2c0d 0a20 2020 2020  ['n_t']),..     
+0001bd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bd50: 2020 2020 2020 2020 2075 7365 5f62 6961           use_bia
+0001bd60: 7320 3d20 4661 6c73 6529 2869 6e70 7574  s = False)(input
+0001bd70: 7329 0d0a 2020 2020 2020 2020 626c 6f63  s)..        bloc
+0001bd80: 6b31 2020 2020 2020 203d 2042 6174 6368  k1       = Batch
+0001bd90: 4e6f 726d 616c 697a 6174 696f 6e28 6178  Normalization(ax
+0001bda0: 6973 203d 2031 2928 626c 6f63 6b31 290d  is = 1)(block1).
+0001bdb0: 0a20 2020 2020 2020 2023 7072 696e 7428  .        #print(
+0001bdc0: 2242 6174 6368 6e6f 726d 3a22 2c20 626c  "Batchnorm:", bl
+0001bdd0: 6f63 6b31 2e73 6861 7065 290d 0a20 2020  ock1.shape)..   
+0001bde0: 2020 2020 2062 6c6f 636b 3120 2020 2020       block1     
+0001bdf0: 2020 3d20 4465 7074 6877 6973 6543 6f6e    = DepthwiseCon
+0001be00: 7632 4428 2873 656c 662e 6461 7461 7365  v2D((self.datase
+0001be10: 742e 685f 7061 7261 6d73 5b27 6e5f 6368  t.h_params['n_ch
+0001be20: 275d 2c20 3129 2c0d 0a20 2020 2020 2020  '], 1),..       
+0001be30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be50: 7573 655f 6269 6173 203d 2046 616c 7365  use_bias = False
+0001be60: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0001be70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be80: 2020 2020 2020 2020 2020 6465 7074 685f            depth_
+0001be90: 6d75 6c74 6970 6c69 6572 203d 2073 656c  multiplier = sel
+0001bea0: 662e 7370 6563 735b 2764 6570 7468 5f6d  f.specs['depth_m
+0001beb0: 756c 7469 706c 6965 7227 5d2c 0d0a 2020  ultiplier'],..  
+0001bec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bee0: 2020 2020 2064 6570 7468 7769 7365 5f63       depthwise_c
+0001bef0: 6f6e 7374 7261 696e 7420 3d20 636f 6e73  onstraint = cons
+0001bf00: 7472 6169 6e74 732e 4d61 784e 6f72 6d28  traints.MaxNorm(
+0001bf10: 312e 2929 2862 6c6f 636b 3129 0d0a 2020  1.))(block1)..  
+0001bf20: 2020 2020 2020 2362 6c6f 636b 3120 2020        #block1   
+0001bf30: 2020 2020 3d20 4261 7463 684e 6f72 6d61      = BatchNorma
+0001bf40: 6c69 7a61 7469 6f6e 2861 7869 7320 3d20  lization(axis = 
+0001bf50: 3129 2862 6c6f 636b 3129 0d0a 2020 2020  1)(block1)..    
+0001bf60: 2020 2020 626c 6f63 6b31 2020 2020 2020      block1      
+0001bf70: 203d 206c 6179 6572 732e 4163 7469 7661   = layers.Activa
+0001bf80: 7469 6f6e 2873 656c 662e 7370 6563 735b  tion(self.specs[
+0001bf90: 276e 6f6e 6c69 6e27 5d29 2862 6c6f 636b  'nonlin'])(block
+0001bfa0: 3129 0d0a 2020 2020 2020 2020 626c 6f63  1)..        bloc
+0001bfb0: 6b31 2020 2020 2020 203d 206c 6179 6572  k1       = layer
+0001bfc0: 732e 4176 6572 6167 6550 6f6f 6c69 6e67  s.AveragePooling
+0001bfd0: 3244 2828 312c 2073 656c 662e 7370 6563  2D((1, self.spec
+0001bfe0: 735b 2770 6f6f 6c69 6e67 275d 2929 2862  s['pooling']))(b
+0001bff0: 6c6f 636b 3129 0d0a 2020 2020 2020 2020  lock1)..        
+0001c000: 7072 696e 7428 2242 6c6f 636b 2031 3a22  print("Block 1:"
+0001c010: 2c20 626c 6f63 6b31 2e73 6861 7065 290d  , block1.shape).
+0001c020: 0a20 2020 2020 2020 2062 6c6f 636b 3120  .        block1 
+0001c030: 2020 2020 2020 3d20 6472 6f70 6f75 7454        = dropoutT
+0001c040: 7970 6528 7365 6c66 2e73 7065 6373 5b27  ype(self.specs['
+0001c050: 6472 6f70 6f75 7427 5d29 2862 6c6f 636b  dropout'])(block
+0001c060: 3129 0d0a 0d0a 2020 2020 2020 2020 626c  1)....        bl
+0001c070: 6f63 6b32 2020 2020 2020 203d 2053 6570  ock2       = Sep
+0001c080: 6172 6162 6c65 436f 6e76 3244 2873 656c  arableConv2D(sel
+0001c090: 662e 7370 6563 735b 276e 5f6c 6174 656e  f.specs['n_laten
+0001c0a0: 7427 5d2a 7365 6c66 2e73 7065 6373 5b27  t']*self.specs['
+0001c0b0: 6465 7074 685f 6d75 6c74 6970 6c69 6572  depth_multiplier
+0001c0c0: 275d 2c20 2831 2c20 7365 6c66 2e73 7065  '], (1, self.spe
+0001c0d0: 6373 5b27 6669 6c74 6572 5f6c 656e 6774  cs['filter_lengt
+0001c0e0: 6827 5d2f 2f73 656c 662e 7370 6563 735b  h']//self.specs[
+0001c0f0: 2270 6f6f 6c69 6e67 225d 292c 0d0a 2020  "pooling"]),..  
+0001c100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c120: 2020 2020 2075 7365 5f62 6961 7320 3d20       use_bias = 
+0001c130: 4661 6c73 652c 2070 6164 6469 6e67 203d  False, padding =
+0001c140: 2073 656c 662e 7370 6563 735b 2770 6164   self.specs['pad
+0001c150: 6469 6e67 275d 2928 626c 6f63 6b31 290d  ding'])(block1).
+0001c160: 0a20 2020 2020 2020 2023 626c 6f63 6b32  .        #block2
+0001c170: 2020 2020 2020 203d 2042 6174 6368 4e6f         = BatchNo
+0001c180: 726d 616c 697a 6174 696f 6e28 6178 6973  rmalization(axis
+0001c190: 203d 2031 2928 626c 6f63 6b32 290d 0a0d   = 1)(block2)...
+0001c1a0: 0a20 2020 2020 2020 2023 7072 696e 7428  .        #print(
+0001c1b0: 2242 6174 6368 6e6f 726d 2032 3a22 2c20  "Batchnorm 2:", 
+0001c1c0: 626c 6f63 6b32 2e73 6861 7065 290d 0a0d  block2.shape)...
+0001c1d0: 0a20 2020 2020 2020 2062 6c6f 636b 3220  .        block2 
+0001c1e0: 2020 2020 2020 3d20 6c61 7965 7273 2e41        = layers.A
+0001c1f0: 6374 6976 6174 696f 6e28 7365 6c66 2e73  ctivation(self.s
+0001c200: 7065 6373 5b27 6e6f 6e6c 696e 275d 2928  pecs['nonlin'])(
+0001c210: 626c 6f63 6b32 290d 0a20 2020 2020 2020  block2)..       
+0001c220: 2062 6c6f 636b 3220 2020 2020 2020 3d20   block2       = 
+0001c230: 6c61 7965 7273 2e41 7665 7261 6765 506f  layers.AveragePo
+0001c240: 6f6c 696e 6732 4428 2831 2c20 7365 6c66  oling2D((1, self
+0001c250: 2e73 7065 6373 5b27 706f 6f6c 696e 6727  .specs['pooling'
+0001c260: 5d2a 3229 2928 626c 6f63 6b32 290d 0a20  ]*2))(block2).. 
+0001c270: 2020 2020 2020 2062 6c6f 636b 3220 2020         block2   
+0001c280: 2020 2020 3d20 6472 6f70 6f75 7454 7970      = dropoutTyp
+0001c290: 6528 7365 6c66 2e73 7065 6373 5b27 6472  e(self.specs['dr
+0001c2a0: 6f70 6f75 7427 5d29 2862 6c6f 636b 3229  opout'])(block2)
+0001c2b0: 0d0a 2020 2020 2020 2020 7072 696e 7428  ..        print(
+0001c2c0: 2242 6c6f 636b 2032 3a22 2c20 626c 6f63  "Block 2:", bloc
+0001c2d0: 6b32 2e73 6861 7065 290d 0a0d 0a20 2020  k2.shape)....   
+0001c2e0: 2020 2020 2066 696e 5f66 6320 3d20 4675       fin_fc = Fu
+0001c2f0: 6c6c 7943 6f6e 6e65 6374 6564 2873 697a  llyConnected(siz
+0001c300: 653d 7365 6c66 2e6f 7574 5f64 696d 2c20  e=self.out_dim, 
+0001c310: 6e6f 6e6c 696e 3d74 662e 6964 656e 7469  nonlin=tf.identi
+0001c320: 7479 2c0d 0a20 2020 2020 2020 2020 2020  ty,..           
+0001c330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c340: 2073 7065 6373 3d73 656c 662e 7370 6563   specs=self.spec
+0001c350: 7329 0d0a 2020 2020 2020 2020 795f 7072  s)..        y_pr
+0001c360: 6564 203d 2066 696e 5f66 6328 626c 6f63  ed = fin_fc(bloc
+0001c370: 6b32 290d 0a0d 0a20 2020 2020 2020 2072  k2)....        r
+0001c380: 6574 7572 6e20 795f 7072 6564 0d0a 0d0a  eturn y_pred....
+0001c390: 2320 636c 6173 7320 5369 6d70 6c65 4e65  # class SimpleNe
+0001c3a0: 7428 4c46 434e 4e29 3a0d 0a23 2020 2020  t(LFCNN):..#    
+0001c3b0: 2022 2222 0d0a 2320 2020 2020 2020 2020   """..#         
+0001c3c0: 5065 7472 6f73 7961 6e2c 2041 2e2c 2053  Petrosyan, A., S
+0001c3d0: 696e 6b69 6e2c 204d 2e2c 204c 6562 6564  inkin, M., Lebed
+0001c3e0: 6576 2c20 4d2e 2041 2e2c 2026 204f 7373  ev, M. A., & Oss
+0001c3f0: 6164 7463 6869 2c20 412e 2020 4465 636f  adtchi, A.  Deco
+0001c400: 6469 6e67 2061 6e64 2069 6e74 6572 7072  ding and interpr
+0001c410: 6574 696e 6720 636f 7274 6963 616c 2073  eting cortical s
+0001c420: 6967 6e61 6c73 2077 6974 680d 0a23 2020  ignals with..#  
+0001c430: 2020 2020 2020 2061 2063 6f6d 7061 6374         a compact
+0001c440: 2063 6f6e 766f 6c75 7469 6f6e 616c 206e   convolutional n
+0001c450: 6575 7261 6c20 6e65 7477 6f72 6b2c 2032  eural network, 2
+0001c460: 3032 312c 204a 6f75 726e 616c 206f 6620  021, Journal of 
+0001c470: 4e65 7572 616c 2045 6e67 696e 6565 7269  Neural Engineeri
+0001c480: 6e67 2c20 3230 3231 2c0d 0a23 2020 2020  ng, 2021,..#    
+0001c490: 2020 2020 2068 7474 7073 3a2f 2f64 6f69       https://doi
+0001c4a0: 2e6f 7267 2f31 302e 3130 3838 2f31 3734  .org/10.1088/174
+0001c4b0: 312d 3235 3532 2f61 6265 3230 650d 0a23  1-2552/abe20e..#
+0001c4c0: 2020 2020 2022 2222 0d0a 2320 2020 2020       """..#     
+0001c4d0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+0001c4e0: 662c 2044 6174 6173 6574 2c20 7370 6563  f, Dataset, spec
+0001c4f0: 733d 4e6f 6e65 293a 0d0a 2320 2020 2020  s=None):..#     
+0001c500: 2020 2020 6966 2073 7065 6373 2069 7320      if specs is 
+0001c510: 4e6f 6e65 3a0d 0a23 2020 2020 2020 2020  None:..#        
+0001c520: 2020 2020 2073 7065 6373 3d64 6963 7428       specs=dict(
+0001c530: 290d 0a23 2020 2020 2020 2020 2073 7570  )..#         sup
+0001c540: 6572 2829 2e5f 5f69 6e69 745f 5f28 4461  er().__init__(Da
+0001c550: 7461 7365 742c 2073 7065 6373 290d 0a0d  taset, specs)...
+0001c560: 0a23 2020 2020 2064 6566 2062 7569 6c64  .#     def build
+0001c570: 5f67 7261 7068 2873 656c 6629 3a0d 0a23  _graph(self):..#
+0001c580: 2020 2020 2020 2020 2073 656c 662e 646d           self.dm
+0001c590: 7820 3d20 4465 4d69 7869 6e67 2873 697a  x = DeMixing(siz
+0001c5a0: 653d 7365 6c66 2e73 7065 6373 5b27 6e5f  e=self.specs['n_
+0001c5b0: 6c61 7465 6e74 275d 2c20 6e6f 6e6c 696e  latent'], nonlin
+0001c5c0: 3d74 662e 6964 656e 7469 7479 2c0d 0a23  =tf.identity,..#
+0001c5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c5e0: 2020 2020 2020 2020 2020 2020 2061 7869               axi
+0001c5f0: 733d 332c 2073 7065 6373 3d73 656c 662e  s=3, specs=self.
+0001c600: 7370 6563 7329 0d0a 2320 2020 2020 2020  specs)..#       
+0001c610: 2020 7365 6c66 2e64 6d78 5f6f 7574 203d    self.dmx_out =
+0001c620: 2073 656c 662e 646d 7828 7365 6c66 2e69   self.dmx(self.i
+0001c630: 6e70 7574 7329 0d0a 0d0a 2320 2020 2020  nputs)....#     
+0001c640: 2020 2020 7365 6c66 2e74 636f 6e76 203d      self.tconv =
+0001c650: 204c 4654 436f 6e76 280d 0a23 2020 2020   LFTConv(..#    
+0001c660: 2020 2020 2020 2020 2073 697a 653d 7365           size=se
+0001c670: 6c66 2e73 7065 6373 5b27 6e5f 6c61 7465  lf.specs['n_late
+0001c680: 6e74 275d 2c0d 0a23 2020 2020 2020 2020  nt'],..#        
+0001c690: 2020 2020 206e 6f6e 6c69 6e3d 7365 6c66       nonlin=self
+0001c6a0: 2e73 7065 6373 5b27 6e6f 6e6c 696e 275d  .specs['nonlin']
+0001c6b0: 2c0d 0a23 2020 2020 2020 2020 2020 2020  ,..#            
+0001c6c0: 2066 696c 7465 725f 6c65 6e67 7468 3d73   filter_length=s
+0001c6d0: 656c 662e 7370 6563 735b 2766 696c 7465  elf.specs['filte
+0001c6e0: 725f 6c65 6e67 7468 275d 2c0d 0a23 2020  r_length'],..#  
+0001c6f0: 2020 2020 2020 2020 2020 2070 6164 6469             paddi
+0001c700: 6e67 3d73 656c 662e 7370 6563 735b 2770  ng=self.specs['p
+0001c710: 6164 6469 6e67 275d 2c0d 0a23 2020 2020  adding'],..#    
+0001c720: 2020 2020 2020 2020 2073 7065 6373 3d73           specs=s
+0001c730: 656c 662e 7370 6563 730d 0a23 2020 2020  elf.specs..#    
+0001c740: 2020 2020 2029 0d0a 2320 2020 2020 2020       )..#       
+0001c750: 2020 7365 6c66 2e74 636f 6e76 5f6f 7574    self.tconv_out
+0001c760: 203d 2073 656c 662e 7463 6f6e 7628 7365   = self.tconv(se
+0001c770: 6c66 2e64 6d78 5f6f 7574 290d 0a0d 0a23  lf.dmx_out)....#
+0001c780: 2020 2020 2020 2020 2073 656c 662e 656e           self.en
+0001c790: 7663 6f6e 7620 3d20 4c46 5443 6f6e 7628  vconv = LFTConv(
+0001c7a0: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+0001c7b0: 7369 7a65 3d73 656c 662e 7370 6563 735b  size=self.specs[
+0001c7c0: 276e 5f6c 6174 656e 7427 5d2c 0d0a 2320  'n_latent'],..# 
+0001c7d0: 2020 2020 2020 2020 2020 2020 6e6f 6e6c              nonl
+0001c7e0: 696e 3d73 656c 662e 7370 6563 735b 276e  in=self.specs['n
+0001c7f0: 6f6e 6c69 6e27 5d2c 0d0a 2320 2020 2020  onlin'],..#     
+0001c800: 2020 2020 2020 2020 6669 6c74 6572 5f6c          filter_l
+0001c810: 656e 6774 683d 7365 6c66 2e73 7065 6373  ength=self.specs
+0001c820: 5b27 6669 6c74 6572 5f6c 656e 6774 6827  ['filter_length'
+0001c830: 5d2c 0d0a 2320 2020 2020 2020 2020 2020  ],..#           
+0001c840: 2020 7061 6464 696e 673d 7365 6c66 2e73    padding=self.s
+0001c850: 7065 6373 5b27 7061 6464 696e 6727 5d2c  pecs['padding'],
+0001c860: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+0001c870: 7370 6563 733d 7365 6c66 2e73 7065 6373  specs=self.specs
+0001c880: 0d0a 2320 2020 2020 2020 2020 290d 0a0d  ..#         )...
+0001c890: 0a23 2020 2020 2020 2020 2073 656c 662e  .#         self.
+0001c8a0: 656e 7663 6f6e 765f 6f75 7420 3d20 7365  envconv_out = se
+0001c8b0: 6c66 2e65 6e76 636f 6e76 2873 656c 662e  lf.envconv(self.
+0001c8c0: 7463 6f6e 765f 6f75 7429 0d0a 2320 2020  tconv_out)..#   
+0001c8d0: 2020 2020 2020 7365 6c66 2e70 6f6f 6c20        self.pool 
+0001c8e0: 3d20 6c61 6d62 6461 2058 3a20 585b 3a2c  = lambda X: X[:,
+0001c8f0: 203a 2c20 3a3a 7365 6c66 2e73 7065 6373   :, ::self.specs
+0001c900: 5b27 706f 6f6c 696e 6727 5d2c 203a 5d0d  ['pooling'], :].
+0001c910: 0a0d 0a23 2020 2020 2020 2020 2073 656c  ...#         sel
+0001c920: 662e 706f 6f6c 6564 203d 2073 656c 662e  f.pooled = self.
+0001c930: 706f 6f6c 2873 656c 662e 656e 7663 6f6e  pool(self.envcon
+0001c940: 765f 6f75 7429 0d0a 0d0a 2320 2020 2020  v_out)....#     
+0001c950: 2020 2020 6472 6f70 6f75 7420 3d20 4472      dropout = Dr
+0001c960: 6f70 6f75 7428 0d0a 2320 2020 2020 2020  opout(..#       
+0001c970: 2020 2020 2020 7365 6c66 2e73 7065 6373        self.specs
+0001c980: 5b27 6472 6f70 6f75 7427 5d2c 0d0a 2320  ['dropout'],..# 
+0001c990: 2020 2020 2020 2020 2020 2020 6e6f 6973              nois
+0001c9a0: 655f 7368 6170 653d 4e6f 6e65 0d0a 2320  e_shape=None..# 
+0001c9b0: 2020 2020 2020 2020 2928 7365 6c66 2e70          )(self.p
+0001c9c0: 6f6f 6c65 6429 0d0a 0d0a 2320 2020 2020  ooled)....#     
+0001c9d0: 2020 2020 7365 6c66 2e66 696e 5f66 6320      self.fin_fc 
+0001c9e0: 3d20 4675 6c6c 7943 6f6e 6e65 6374 6564  = FullyConnected
+0001c9f0: 2873 697a 653d 7365 6c66 2e6f 7574 5f64  (size=self.out_d
+0001ca00: 696d 2c20 6e6f 6e6c 696e 3d74 662e 6964  im, nonlin=tf.id
+0001ca10: 656e 7469 7479 2c0d 0a23 2020 2020 2020  entity,..#      
+0001ca20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca30: 2020 2020 2020 2073 7065 6373 3d73 656c         specs=sel
+0001ca40: 662e 7370 6563 7329 0d0a 0d0a 2320 2020  f.specs)....#   
+0001ca50: 2020 2020 2020 795f 7072 6564 203d 2073        y_pred = s
+0001ca60: 656c 662e 6669 6e5f 6663 2864 726f 706f  elf.fin_fc(dropo
+0001ca70: 7574 290d 0a0d 0a23 2020 2020 2020 2020  ut)....#        
+0001ca80: 2072 6574 7572 6e20 795f 7072 6564 0d0a   return y_pred..
+0001ca90: 0d0a 2320 2020 2020 6465 6620 636f 6d70  ..#     def comp
+0001caa0: 7574 655f 7061 7474 6572 6e73 2873 656c  ute_patterns(sel
+0001cab0: 662c 2064 6174 615f 7061 7468 3d4e 6f6e  f, data_path=Non
+0001cac0: 652c 202a 2c20 6f75 7470 7574 3d27 7061  e, *, output='pa
+0001cad0: 7474 6572 6e73 2729 3a0d 0a0d 0a23 2020  tterns'):....#  
+0001cae0: 2020 2020 2020 2069 6620 6e6f 7420 6461         if not da
+0001caf0: 7461 5f70 6174 683a 0d0a 2320 2020 2020  ta_path:..#     
+0001cb00: 2020 2020 2020 2020 7072 696e 7428 2243          print("C
+0001cb10: 6f6d 7075 7469 6e67 2070 6174 7465 726e  omputing pattern
+0001cb20: 733a 204e 6f20 7061 7468 2073 7065 6369  s: No path speci
+0001cb30: 6669 6564 2c20 7573 696e 6720 7661 6c69  fied, using vali
+0001cb40: 6461 7469 6f6e 2064 6174 6173 6574 2028  dation dataset (
+0001cb50: 4465 6661 756c 7429 2229 0d0a 2320 2020  Default)")..#   
+0001cb60: 2020 2020 2020 2020 2020 6473 203d 2073            ds = s
+0001cb70: 656c 662e 6461 7461 7365 742e 7661 6c0d  elf.dataset.val.
+0001cb80: 0a23 2020 2020 2020 2020 2065 6c69 6620  .#         elif 
+0001cb90: 6973 696e 7374 616e 6365 2864 6174 615f  isinstance(data_
+0001cba0: 7061 7468 2c20 7374 7229 206f 7220 6973  path, str) or is
+0001cbb0: 696e 7374 616e 6365 2864 6174 615f 7061  instance(data_pa
+0001cbc0: 7468 2c20 286c 6973 742c 2074 7570 6c65  th, (list, tuple
+0001cbd0: 2929 3a0d 0a23 2020 2020 2020 2020 2020  )):..#          
+0001cbe0: 2020 2064 7320 3d20 7365 6c66 2e64 6174     ds = self.dat
+0001cbf0: 6173 6574 2e5f 6275 696c 645f 6461 7461  aset._build_data
+0001cc00: 7365 7428 0d0a 2320 2020 2020 2020 2020  set(..#         
+0001cc10: 2020 2020 2020 2020 6461 7461 5f70 6174          data_pat
+0001cc20: 682c 0d0a 2320 2020 2020 2020 2020 2020  h,..#           
+0001cc30: 2020 2020 2020 7370 6c69 743d 4661 6c73        split=Fals
+0001cc40: 652c 0d0a 2320 2020 2020 2020 2020 2020  e,..#           
+0001cc50: 2020 2020 2020 7465 7374 5f62 6174 6368        test_batch
+0001cc60: 3d4e 6f6e 652c 0d0a 2320 2020 2020 2020  =None,..#       
+0001cc70: 2020 2020 2020 2020 2020 7265 7065 6174            repeat
+0001cc80: 3d54 7275 650d 0a23 2020 2020 2020 2020  =True..#        
+0001cc90: 2020 2020 2029 0d0a 2320 2020 2020 2020       )..#       
+0001cca0: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+0001ccb0: 6528 6461 7461 5f70 6174 682c 2044 6174  e(data_path, Dat
+0001ccc0: 6173 6574 293a 0d0a 2320 2020 2020 2020  aset):..#       
+0001ccd0: 2020 2020 2020 6966 2068 6173 6174 7472        if hasattr
+0001cce0: 2864 6174 615f 7061 7468 2c20 2774 6573  (data_path, 'tes
+0001ccf0: 7427 293a 0d0a 2320 2020 2020 2020 2020  t'):..#         
+0001cd00: 2020 2020 2020 2020 6473 203d 2064 6174          ds = dat
+0001cd10: 615f 7061 7468 2e74 6573 740d 0a23 2020  a_path.test..#  
+0001cd20: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0001cd30: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+0001cd40: 2020 2020 6473 203d 2064 6174 615f 7061      ds = data_pa
+0001cd50: 7468 2e76 616c 0d0a 2320 2020 2020 2020  th.val..#       
+0001cd60: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+0001cd70: 6528 6461 7461 5f70 6174 682c 2074 662e  e(data_path, tf.
+0001cd80: 6461 7461 2e44 6174 6173 6574 293a 0d0a  data.Dataset):..
+0001cd90: 2320 2020 2020 2020 2020 2020 2020 6473  #             ds
+0001cda0: 203d 2064 6174 615f 7061 7468 0d0a 2320   = data_path..# 
+0001cdb0: 2020 2020 2020 2020 656c 7365 3a0d 0a23          else:..#
+0001cdc0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0001cdd0: 7365 2041 7474 7269 6275 7465 4572 726f  se AttributeErro
+0001cde0: 7228 2753 7065 6369 6679 2064 6174 6173  r('Specify datas
+0001cdf0: 6574 206f 7220 6461 7461 2070 6174 682e  et or data path.
+0001ce00: 2729 0d0a 0d0a 2320 2020 2020 2020 2020  ')....#         
+0001ce10: 582c 2079 203d 205b 726f 7720 666f 7220  X, y = [row for 
+0001ce20: 726f 7720 696e 2064 732e 7461 6b65 2831  row in ds.take(1
+0001ce30: 295d 5b30 5d0d 0a0d 0a23 2020 2020 2020  )][0]....#      
+0001ce40: 2020 2073 656c 662e 6f75 745f 775f 666c     self.out_w_fl
+0001ce50: 6174 203d 2073 656c 662e 6669 6e5f 6663  at = self.fin_fc
+0001ce60: 2e77 2e6e 756d 7079 2829 0d0a 2320 2020  .w.numpy()..#   
+0001ce70: 2020 2020 2020 7365 6c66 2e6f 7574 5f77        self.out_w
+0001ce80: 6569 6768 7473 203d 206e 702e 7265 7368  eights = np.resh
+0001ce90: 6170 6528 0d0a 2320 2020 2020 2020 2020  ape(..#         
+0001cea0: 2020 2020 7365 6c66 2e6f 7574 5f77 5f66      self.out_w_f
+0001ceb0: 6c61 742c 0d0a 2320 2020 2020 2020 2020  lat,..#         
+0001cec0: 2020 2020 5b2d 312c 2073 656c 662e 646d      [-1, self.dm
+0001ced0: 782e 7369 7a65 2c20 7365 6c66 2e6f 7574  x.size, self.out
+0001cee0: 5f64 696d 5d0d 0a23 2020 2020 2020 2020  _dim]..#        
+0001cef0: 2029 0d0a 2320 2020 2020 2020 2020 7365   )..#         se
+0001cf00: 6c66 2e6f 7574 5f62 6961 7365 7320 3d20  lf.out_biases = 
+0001cf10: 7365 6c66 2e66 696e 5f66 632e 622e 6e75  self.fin_fc.b.nu
+0001cf20: 6d70 7928 290d 0a23 2020 2020 2020 2020  mpy()..#        
+0001cf30: 2073 656c 662e 6665 6174 7572 655f 7265   self.feature_re
+0001cf40: 6c65 7661 6e63 6573 203d 2073 656c 662e  levances = self.
+0001cf50: 636f 6d70 6f6e 656e 7477 6973 655f 6c6f  componentwise_lo
+0001cf60: 7373 2858 2c20 7929 0d0a 2320 2020 2020  ss(X, y)..#     
+0001cf70: 2020 2020 7365 6c66 2e62 7261 6e63 6877      self.branchw
+0001cf80: 6973 655f 6c6f 7373 2858 2c20 7929 0d0a  ise_loss(X, y)..
+0001cf90: 0d0a 2320 2020 2020 2020 2020 2320 636f  ..#         # co
+0001cfa0: 6d70 7574 6520 7465 6d70 6f72 616c 2063  mpute temporal c
+0001cfb0: 6f6e 766f 6c75 7469 6f6e 206c 6179 6572  onvolution layer
+0001cfc0: 206f 7574 7075 7473 2066 6f72 2076 6973   outputs for vis
+0001cfd0: 5f64 6963 730d 0a23 2020 2020 2020 2020  _dics..#        
+0001cfe0: 2074 635f 6f75 7420 3d20 7365 6c66 2e70   tc_out = self.p
+0001cff0: 6f6f 6c28 7365 6c66 2e74 636f 6e76 2873  ool(self.tconv(s
+0001d000: 656c 662e 646d 7828 5829 292e 6e75 6d70  elf.dmx(X)).nump
+0001d010: 7928 2929 0d0a 0d0a 2320 2020 2020 2020  y())....#       
+0001d020: 2020 2320 636f 6d70 7574 6520 6461 7461    # compute data
+0001d030: 2063 6f76 6172 6961 6e63 650d 0a23 2020   covariance..#  
+0001d040: 2020 2020 2020 2058 203d 2058 202d 2074         X = X - t
+0001d050: 662e 7265 6475 6365 5f6d 6561 6e28 582c  f.reduce_mean(X,
+0001d060: 2061 7869 733d 2d32 2c20 6b65 6570 6469   axis=-2, keepdi
+0001d070: 6d73 3d54 7275 6529 0d0a 2320 2020 2020  ms=True)..#     
+0001d080: 2020 2020 5820 3d20 7466 2e74 7261 6e73      X = tf.trans
+0001d090: 706f 7365 2858 2c20 5b33 2c20 302c 2031  pose(X, [3, 0, 1
+0001d0a0: 2c20 325d 290d 0a23 2020 2020 2020 2020  , 2])..#        
+0001d0b0: 2058 203d 2074 662e 7265 7368 6170 6528   X = tf.reshape(
+0001d0c0: 582c 205b 582e 7368 6170 655b 305d 2c20  X, [X.shape[0], 
+0001d0d0: 2d31 5d29 0d0a 2320 2020 2020 2020 2020  -1])..#         
+0001d0e0: 7365 6c66 2e64 636f 7620 3d20 7466 2e6d  self.dcov = tf.m
+0001d0f0: 6174 6d75 6c28 582c 2074 662e 7472 616e  atmul(X, tf.tran
+0001d100: 7370 6f73 6528 5829 290d 0a0d 0a23 2020  spose(X))....#  
+0001d110: 2020 2020 2020 2023 2067 6574 2073 7061         # get spa
+0001d120: 7469 616c 2065 7874 7261 6374 696f 6e20  tial extraction 
+0001d130: 6669 7465 7220 7765 6967 6874 730d 0a23  fiter weights..#
+0001d140: 2020 2020 2020 2020 2064 656d 7820 3d20           demx = 
+0001d150: 7365 6c66 2e64 6d78 2e77 2e6e 756d 7079  self.dmx.w.numpy
+0001d160: 2829 0d0a 0d0a 2320 2020 2020 2020 2020  ()....#         
+0001d170: 6b65 726e 203d 206e 702e 7371 7565 657a  kern = np.squeez
+0001d180: 6528 7365 6c66 2e74 636f 6e76 2e66 696c  e(self.tconv.fil
+0001d190: 7465 7273 2e6e 756d 7079 2829 292e 540d  ters.numpy()).T.
+0001d1a0: 0a0d 0a23 2020 2020 2020 2020 2058 203d  ...#         X =
+0001d1b0: 2058 2e6e 756d 7079 2829 2e54 0d0a 0d0a   X.numpy().T....
+0001d1c0: 2320 2020 2020 2020 2020 7061 7474 6572  #         patter
+0001d1d0: 6e73 203d 205b 5d0d 0a23 2020 2020 2020  ns = []..#      
+0001d1e0: 2020 2058 5f66 696c 7420 3d20 6e70 2e7a     X_filt = np.z
+0001d1f0: 6572 6f73 5f6c 696b 6528 5829 0d0a 2320  eros_like(X)..# 
+0001d200: 2020 2020 2020 2020 666f 7220 695f 636f          for i_co
+0001d210: 6d70 2069 6e20 7261 6e67 6528 6b65 726e  mp in range(kern
+0001d220: 2e73 6861 7065 5b30 5d29 3a0d 0a23 2020  .shape[0]):..#  
+0001d230: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+0001d240: 5f63 6820 696e 2072 616e 6765 2858 2e73  _ch in range(X.s
+0001d250: 6861 7065 5b31 5d29 3a0d 0a23 2020 2020  hape[1]):..#    
+0001d260: 2020 2020 2020 2020 2020 2020 2078 203d               x =
+0001d270: 2058 5b3a 2c20 695f 6368 5d0d 0a23 2020   X[:, i_ch]..#  
+0001d280: 2020 2020 2020 2020 2020 2020 2020 2058                 X
+0001d290: 5f66 696c 745b 3a2c 2069 5f63 685d 203d  _filt[:, i_ch] =
+0001d2a0: 206e 702e 636f 6e76 6f6c 7665 2878 2c20   np.convolve(x, 
+0001d2b0: 6b65 726e 5b69 5f63 6f6d 702c 203a 5d2c  kern[i_comp, :],
+0001d2c0: 206d 6f64 653d 2273 616d 6522 290d 0a23   mode="same")..#
+0001d2d0: 2020 2020 2020 2020 2020 2020 2070 6174               pat
+0001d2e0: 7465 726e 732e 6170 7065 6e64 286e 702e  terns.append(np.
+0001d2f0: 636f 7628 585f 6669 6c74 2e54 2920 4020  cov(X_filt.T) @ 
+0001d300: 6465 6d78 5b3a 2c20 695f 636f 6d70 5d29  demx[:, i_comp])
+0001d310: 0d0a 2320 2020 2020 2020 2020 7365 6c66  ..#         self
+0001d320: 2e70 6174 7465 726e 7320 3d20 6e70 2e61  .patterns = np.a
+0001d330: 7272 6179 2870 6174 7465 726e 7329 2e54  rray(patterns).T
+0001d340: 0d0a 0d0a 0d0a 2320 2020 2020 2020 2020  ......#         
+0001d350: 6966 2027 7061 7474 6572 6e73 2720 696e  if 'patterns' in
+0001d360: 206f 7574 7075 743a 0d0a 2320 2020 2020   output:..#     
+0001d370: 2020 2020 2020 2020 6966 2027 6f6c 6427          if 'old'
+0001d380: 2069 6e20 6f75 7470 7574 3a0d 0a23 2020   in output:..#  
+0001d390: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001d3a0: 656c 662e 7061 7474 6572 6e73 203d 206e  elf.patterns = n
+0001d3b0: 702e 646f 7428 7365 6c66 2e64 636f 762c  p.dot(self.dcov,
+0001d3c0: 2064 656d 7829 0d0a 2320 2020 2020 2020   demx)..#       
+0001d3d0: 2020 2020 2020 656c 7365 3a0d 0a23 2020        else:..#  
+0001d3e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001d3f0: 6174 7465 726e 7320 3d20 5b5d 0d0a 2320  atterns = []..# 
 0001d400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d410: 2073 656c 662e 7061 7474 6572 6e73 203d   self.patterns =
-0001d420: 206e 702e 6172 7261 7928 7061 7474 6572   np.array(patter
-0001d430: 6e73 292e 540d 0a23 2020 2020 2020 2020  ns).T..#        
-0001d440: 2065 6c73 653a 0d0a 2320 2020 2020 2020   else:..#       
-0001d450: 2020 2020 2020 7365 6c66 2e70 6174 7465        self.patte
-0001d460: 726e 7320 3d20 6465 6d78 0d0a 0d0a 2320  rns = demx....# 
-0001d470: 2020 2020 2020 2020 7365 6c66 2e6c 6174          self.lat
-0001d480: 5f74 6373 203d 206e 702e 646f 7428 6465  _tcs = np.dot(de
-0001d490: 6d78 2e54 2c20 582e 5429 0d0a 0d0a 2320  mx.T, X.T)....# 
-0001d4a0: 2020 2020 2020 2020 6465 6c20 580d 0a0d          del X...
-0001d4b0: 0a23 2020 2020 2020 2020 2023 2020 5465  .#         #  Te
-0001d4c0: 6d70 6f72 616c 2063 6f6e 7620 7374 7566  mporal conv stuf
-0001d4d0: 660d 0a23 2020 2020 2020 2020 2073 656c  f..#         sel
-0001d4e0: 662e 6669 6c74 6572 7320 3d20 6b65 726e  f.filters = kern
-0001d4f0: 2e54 0d0a 2320 2020 2020 2020 2020 7365  .T..#         se
-0001d500: 6c66 2e74 635f 6f75 7420 3d20 6e70 2e73  lf.tc_out = np.s
-0001d510: 7175 6565 7a65 2874 635f 6f75 7429 0d0a  queeze(tc_out)..
-0001d520: 2320 2020 2020 2020 2020 7365 6c66 2e63  #         self.c
-0001d530: 6f72 725f 746f 5f6f 7574 7075 7420 3d20  orr_to_output = 
-0001d540: 7365 6c66 2e67 6574 5f6f 7574 7075 745f  self.get_output_
-0001d550: 636f 7272 656c 6174 696f 6e73 2879 290d  correlations(y).
-0001d560: 0a0d 0a23 2020 2020 2064 6566 2070 6c6f  ...#     def plo
-0001d570: 745f 7061 7474 6572 6e73 280d 0a23 2020  t_patterns(..#  
-0001d580: 2020 2020 2020 2073 656c 662c 2073 656e         self, sen
-0001d590: 736f 725f 6c61 796f 7574 3d4e 6f6e 652c  sor_layout=None,
-0001d5a0: 2073 6f72 7469 6e67 3d27 6c32 272c 2070   sorting='l2', p
-0001d5b0: 6572 6365 6e74 696c 653d 3930 2c0d 0a23  ercentile=90,..#
-0001d5c0: 2020 2020 2020 2020 2073 6361 6c65 3d46           scale=F
-0001d5d0: 616c 7365 2c20 636c 6173 735f 6e61 6d65  alse, class_name
-0001d5e0: 733d 4e6f 6e65 2c20 696e 666f 3d4e 6f6e  s=None, info=Non
-0001d5f0: 650d 0a23 2020 2020 2029 3a0d 0a23 2020  e..#     ):..#  
-0001d600: 2020 2020 2020 206f 7264 6572 2c20 7473         order, ts
-0001d610: 203d 2073 656c 662e 5f73 6f72 7469 6e67   = self._sorting
-0001d620: 2873 6f72 7469 6e67 290d 0a23 2020 2020  (sorting)..#    
-0001d630: 2020 2020 2073 656c 662e 756f 7264 6572       self.uorder
-0001d640: 203d 206f 7264 6572 2e72 6176 656c 2829   = order.ravel()
-0001d650: 0d0a 2320 2020 2020 2020 2020 6c5f 7520  ..#         l_u 
-0001d660: 3d20 6c65 6e28 7365 6c66 2e75 6f72 6465  = len(self.uorde
-0001d670: 7229 0d0a 2320 2020 2020 2020 2020 6966  r)..#         if
-0001d680: 2069 6e66 6f3a 0d0a 2320 2020 2020 2020   info:..#       
-0001d690: 2020 2020 2020 696e 666f 2e5f 5f73 6574        info.__set
-0001d6a0: 7374 6174 655f 5f28 6469 6374 285f 756e  state__(dict(_un
-0001d6b0: 6c6f 636b 6564 3d54 7275 6529 290d 0a23  locked=True))..#
-0001d6c0: 2020 2020 2020 2020 2020 2020 2069 6e66               inf
-0001d6d0: 6f5b 2773 6672 6571 275d 203d 2031 2e0d  o['sfreq'] = 1..
-0001d6e0: 0a23 2020 2020 2020 2020 2020 2020 2073  .#             s
-0001d6f0: 656c 662e 6661 6b65 5f65 766f 6b65 6420  elf.fake_evoked 
-0001d700: 3d20 6576 6f6b 6564 2e45 766f 6b65 6441  = evoked.EvokedA
-0001d710: 7272 6179 2873 656c 662e 7061 7474 6572  rray(self.patter
-0001d720: 6e73 2c20 696e 666f 2c20 746d 696e 3d30  ns, info, tmin=0
-0001d730: 290d 0a23 2020 2020 2020 2020 2020 2020  )..#            
-0001d740: 2069 6620 6c5f 7520 3e20 313a 0d0a 2320   if l_u > 1:..# 
-0001d750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d760: 7365 6c66 2e66 616b 655f 6576 6f6b 6564  self.fake_evoked
-0001d770: 2e64 6174 615b 3a2c 203a 6c5f 755d 203d  .data[:, :l_u] =
-0001d780: 2073 656c 662e 6661 6b65 5f65 766f 6b65   self.fake_evoke
-0001d790: 642e 6461 7461 5b3a 2c20 7365 6c66 2e75  d.data[:, self.u
-0001d7a0: 6f72 6465 725d 0d0a 2320 2020 2020 2020  order]..#       
-0001d7b0: 2020 2020 2020 656c 6966 206c 5f75 203d        elif l_u =
-0001d7c0: 3d20 313a 0d0a 2320 2020 2020 2020 2020  = 1:..#         
-0001d7d0: 2020 2020 2020 2020 7365 6c66 2e66 616b          self.fak
-0001d7e0: 655f 6576 6f6b 6564 2e64 6174 615b 3a2c  e_evoked.data[:,
-0001d7f0: 206c 5f75 5d20 3d20 7365 6c66 2e66 616b   l_u] = self.fak
-0001d800: 655f 6576 6f6b 6564 2e64 6174 615b 3a2c  e_evoked.data[:,
-0001d810: 2073 656c 662e 756f 7264 6572 5b30 5d5d   self.uorder[0]]
-0001d820: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-0001d830: 7365 6c66 2e66 616b 655f 6576 6f6b 6564  self.fake_evoked
-0001d840: 2e63 726f 7028 746d 6178 3d66 6c6f 6174  .crop(tmax=float
-0001d850: 286c 5f75 2929 0d0a 2320 2020 2020 2020  (l_u))..#       
-0001d860: 2020 2020 2020 6966 2073 6361 6c65 3a0d        if scale:.
-0001d870: 0a23 2020 2020 2020 2020 2020 2020 2020  .#              
-0001d880: 2020 205f 7374 6420 3d20 7365 6c66 2e66     _std = self.f
-0001d890: 616b 655f 6576 6f6b 6564 2e64 6174 615b  ake_evoked.data[
-0001d8a0: 3a2c 203a 6c5f 755d 2e73 7464 2830 290d  :, :l_u].std(0).
-0001d8b0: 0a23 2020 2020 2020 2020 2020 2020 2020  .#              
-0001d8c0: 2020 2073 656c 662e 6661 6b65 5f65 766f     self.fake_evo
-0001d8d0: 6b65 642e 6461 7461 5b3a 2c20 3a6c 5f75  ked.data[:, :l_u
-0001d8e0: 5d20 2f3d 205f 7374 640d 0a23 2020 2020  ] /= _std..#    
-0001d8f0: 2020 2020 2065 6c69 6620 7365 6e73 6f72       elif sensor
-0001d900: 5f6c 6179 6f75 743a 0d0a 2320 2020 2020  _layout:..#     
-0001d910: 2020 2020 2020 2020 6c6f 203d 2063 6861          lo = cha
-0001d920: 6e6e 656c 732e 7265 6164 5f6c 6179 6f75  nnels.read_layou
-0001d930: 7428 7365 6e73 6f72 5f6c 6179 6f75 7429  t(sensor_layout)
-0001d940: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-0001d950: 696e 666f 203d 2063 7265 6174 655f 696e  info = create_in
-0001d960: 666f 286c 6f2e 6e61 6d65 732c 2031 2e2c  fo(lo.names, 1.,
-0001d970: 2073 656e 736f 725f 6c61 796f 7574 2e73   sensor_layout.s
-0001d980: 706c 6974 2827 2d27 295b 2d31 5d29 0d0a  plit('-')[-1])..
-0001d990: 2320 2020 2020 2020 2020 2020 2020 6f72  #             or
-0001d9a0: 6967 5f78 7920 3d20 6e70 2e6d 6561 6e28  ig_xy = np.mean(
-0001d9b0: 6c6f 2e70 6f73 5b3a 2c20 3a32 5d2c 2030  lo.pos[:, :2], 0
-0001d9c0: 290d 0a23 2020 2020 2020 2020 2020 2020  )..#            
-0001d9d0: 2066 6f72 2069 2c20 6368 2069 6e20 656e   for i, ch in en
-0001d9e0: 756d 6572 6174 6528 6c6f 2e6e 616d 6573  umerate(lo.names
-0001d9f0: 293a 0d0a 2320 2020 2020 2020 2020 2020  ):..#           
-0001da00: 2020 2020 2020 6966 2069 6e66 6f5b 2763        if info['c
-0001da10: 6873 275d 5b69 5d5b 2763 685f 6e61 6d65  hs'][i]['ch_name
-0001da20: 275d 203d 3d20 6368 3a0d 0a23 2020 2020  '] == ch:..#    
-0001da30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da40: 2069 6e66 6f5b 2763 6873 275d 5b69 5d5b   info['chs'][i][
-0001da50: 276c 6f63 275d 5b3a 325d 203d 2028 6c6f  'loc'][:2] = (lo
-0001da60: 2e70 6f73 5b69 2c20 3a32 5d20 2d20 6f72  .pos[i, :2] - or
-0001da70: 6967 5f78 7929 2f33 2e0d 0a23 2020 2020  ig_xy)/3...#    
-0001da80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da90: 2023 696e 666f 5b27 6368 7327 5d5b 695d   #info['chs'][i]
-0001daa0: 5b27 6c6f 6327 5d5b 343a 5d20 3d20 300d  ['loc'][4:] = 0.
-0001dab0: 0a23 2020 2020 2020 2020 2020 2020 2020  .#              
-0001dac0: 2020 2065 6c73 653a 0d0a 2320 2020 2020     else:..#     
-0001dad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dae0: 7072 696e 7428 2243 6861 6e6e 656c 206e  print("Channel n
-0001daf0: 616d 6520 6d69 736d 6174 6368 2e20 696e  ame mismatch. in
-0001db00: 666f 3a20 7b7d 2076 7320 6c6f 3a20 7b7d  fo: {} vs lo: {}
-0001db10: 222e 666f 726d 6174 280d 0a23 2020 2020  ".format(..#    
-0001db20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db30: 2020 2020 2069 6e66 6f5b 2763 6873 275d       info['chs']
-0001db40: 5b69 5d5b 2763 685f 6e61 6d65 275d 2c20  [i]['ch_name'], 
-0001db50: 6368 2929 0d0a 0d0a 2320 2020 2020 2020  ch))....#       
-0001db60: 2020 2020 2020 7365 6c66 2e66 616b 655f        self.fake_
-0001db70: 6576 6f6b 6564 203d 2065 766f 6b65 642e  evoked = evoked.
-0001db80: 4576 6f6b 6564 4172 7261 7928 7365 6c66  EvokedArray(self
-0001db90: 2e70 6174 7465 726e 732c 2069 6e66 6f29  .patterns, info)
-0001dba0: 0d0a 0d0a 2320 2020 2020 2020 2020 2020  ....#           
-0001dbb0: 2020 6966 206c 5f75 203e 2031 3a0d 0a23    if l_u > 1:..#
-0001dbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dbd0: 2073 656c 662e 6661 6b65 5f65 766f 6b65   self.fake_evoke
-0001dbe0: 642e 6461 7461 5b3a 2c20 3a6c 5f75 5d20  d.data[:, :l_u] 
-0001dbf0: 3d20 7365 6c66 2e66 616b 655f 6576 6f6b  = self.fake_evok
-0001dc00: 6564 2e64 6174 615b 3a2c 2073 656c 662e  ed.data[:, self.
-0001dc10: 756f 7264 6572 5d0d 0a23 2020 2020 2020  uorder]..#      
-0001dc20: 2020 2020 2020 2065 6c69 6620 6c5f 7520         elif l_u 
-0001dc30: 3d3d 2031 3a0d 0a23 2020 2020 2020 2020  == 1:..#        
-0001dc40: 2020 2020 2020 2020 2073 656c 662e 6661           self.fa
-0001dc50: 6b65 5f65 766f 6b65 642e 6461 7461 5b3a  ke_evoked.data[:
-0001dc60: 2c20 6c5f 755d 203d 2073 656c 662e 6661  , l_u] = self.fa
-0001dc70: 6b65 5f65 766f 6b65 642e 6461 7461 5b3a  ke_evoked.data[:
-0001dc80: 2c20 7365 6c66 2e75 6f72 6465 725b 305d  , self.uorder[0]
-0001dc90: 5d0d 0a23 2020 2020 2020 2020 2020 2020  ]..#            
-0001dca0: 2073 656c 662e 6661 6b65 5f65 766f 6b65   self.fake_evoke
-0001dcb0: 642e 6372 6f70 2874 6d61 783d 666c 6f61  d.crop(tmax=floa
-0001dcc0: 7428 6c5f 7529 290d 0a23 2020 2020 2020  t(l_u))..#      
-0001dcd0: 2020 2020 2020 2069 6620 7363 616c 653a         if scale:
-0001dce0: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-0001dcf0: 2020 2020 5f73 7464 203d 2073 656c 662e      _std = self.
-0001dd00: 6661 6b65 5f65 766f 6b65 642e 6461 7461  fake_evoked.data
-0001dd10: 5b3a 2c20 3a6c 5f75 5d2e 7374 6428 3029  [:, :l_u].std(0)
-0001dd20: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-0001dd30: 2020 2020 7365 6c66 2e66 616b 655f 6576      self.fake_ev
-0001dd40: 6f6b 6564 2e64 6174 615b 3a2c 203a 6c5f  oked.data[:, :l_
-0001dd50: 755d 202f 3d20 5f73 7464 0d0a 2320 2020  u] /= _std..#   
-0001dd60: 2020 2020 2020 656c 7365 3a0d 0a23 2020        else:..#  
-0001dd70: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0001dd80: 2056 616c 7565 4572 726f 7228 2253 7065   ValueError("Spe
-0001dd90: 6369 6679 2073 656e 736f 7220 6c61 796f  cify sensor layo
-0001dda0: 7574 2229 0d0a 0d0a 0d0a 2320 2020 2020  ut")......#     
-0001ddb0: 2020 2020 6966 206e 702e 616e 7928 7365      if np.any(se
-0001ddc0: 6c66 2e75 6f72 6465 7229 3a0d 0a23 2020  lf.uorder):..#  
-0001ddd0: 2020 2020 2020 2020 2020 206e 6669 6c74             nfilt
-0001dde0: 203d 206d 6178 2873 656c 662e 6f75 745f   = max(self.out_
-0001ddf0: 6469 6d2c 2038 290d 0a23 2020 2020 2020  dim, 8)..#      
-0001de00: 2020 2020 2020 206e 726f 7773 203d 206d         nrows = m
-0001de10: 6178 2831 2c20 6c5f 752f 2f6e 6669 6c74  ax(1, l_u//nfilt
-0001de20: 290d 0a23 2020 2020 2020 2020 2020 2020  )..#            
-0001de30: 206e 636f 6c73 203d 206d 696e 286e 6669   ncols = min(nfi
-0001de40: 6c74 2c20 6c5f 7529 0d0a 2320 2020 2020  lt, l_u)..#     
-0001de50: 2020 2020 2020 2020 662c 2061 7820 3d20          f, ax = 
-0001de60: 706c 742e 7375 6270 6c6f 7473 286e 726f  plt.subplots(nro
-0001de70: 7773 2c20 6e63 6f6c 732c 2073 6861 7265  ws, ncols, share
-0001de80: 793d 5472 7565 290d 0a23 2020 2020 2020  y=True)..#      
-0001de90: 2020 2020 2020 2070 6c74 2e74 6967 6874         plt.tight
-0001dea0: 5f6c 6179 6f75 7428 290d 0a23 2020 2020  _layout()..#    
-0001deb0: 2020 2020 2020 2020 2066 2e73 6574 5f73           f.set_s
-0001dec0: 697a 655f 696e 6368 6573 285b 3136 2c20  ize_inches([16, 
-0001ded0: 335d 290d 0a23 2020 2020 2020 2020 2020  3])..#          
-0001dee0: 2020 2061 7820 3d20 6e70 2e61 746c 6561     ax = np.atlea
-0001def0: 7374 5f32 6428 6178 290d 0a0d 0a23 2020  st_2d(ax)....#  
-0001df00: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-0001df10: 6920 696e 2072 616e 6765 286e 726f 7773  i in range(nrows
-0001df20: 293a 0d0a 2320 2020 2020 2020 2020 2020  ):..#           
-0001df30: 2020 2020 2020 6661 6b65 5f74 696d 6573        fake_times
-0001df40: 203d 206e 702e 6172 616e 6765 2869 6920   = np.arange(ii 
-0001df50: 2a20 6e63 6f6c 732c 2020 2869 6920 2b20  * ncols,  (ii + 
-0001df60: 3129 202a 206e 636f 6c73 2c20 312e 290d  1) * ncols, 1.).
-0001df70: 0a23 2020 2020 2020 2020 2020 2020 2020  .#              
-0001df80: 2020 2076 6d61 7820 3d20 6e70 2e70 6572     vmax = np.per
-0001df90: 6365 6e74 696c 6528 7365 6c66 2e66 616b  centile(self.fak
-0001dfa0: 655f 6576 6f6b 6564 2e64 6174 615b 3a2c  e_evoked.data[:,
-0001dfb0: 203a 6c5f 755d 2c20 3935 290d 0a23 2020   :l_u], 95)..#  
-0001dfc0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001dfd0: 656c 662e 6661 6b65 5f65 766f 6b65 642e  elf.fake_evoked.
-0001dfe0: 706c 6f74 5f74 6f70 6f6d 6170 280d 0a23  plot_topomap(..#
-0001dff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e000: 2020 2020 2074 696d 6573 3d66 616b 655f       times=fake_
-0001e010: 7469 6d65 732c 0d0a 2320 2020 2020 2020  times,..#       
-0001e020: 2020 2020 2020 2020 2020 2020 2020 6178                ax
-0001e030: 6573 3d61 785b 6969 5d2c 0d0a 2320 2020  es=ax[ii],..#   
-0001e040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e050: 2020 636f 6c6f 7262 6172 3d46 616c 7365    colorbar=False
-0001e060: 2c0d 0a23 2020 2020 2020 2020 2020 2020  ,..#            
-0001e070: 2020 2020 2020 2020 2076 6d61 783d 766d           vmax=vm
-0001e080: 6178 2c0d 0a23 2020 2020 2020 2020 2020  ax,..#          
-0001e090: 2020 2020 2020 2020 2020 2073 6361 6c69             scali
-0001e0a0: 6e67 733d 312c 0d0a 2320 2020 2020 2020  ngs=1,..#       
-0001e0b0: 2020 2020 2020 2020 2020 2020 2020 7469                ti
-0001e0c0: 6d65 5f66 6f72 6d61 743d 2242 7261 6e63  me_format="Branc
-0001e0d0: 6820 2325 6722 2c0d 0a23 2020 2020 2020  h #%g",..#      
-0001e0e0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0001e0f0: 6974 6c65 3d27 5061 7474 6572 6e73 2028  itle='Patterns (
-0001e100: 272b 7374 7228 736f 7274 696e 6729 2b27  '+str(sorting)+'
-0001e110: 2927 2c0d 0a23 2020 2020 2020 2020 2020  )',..#          
-0001e120: 2020 2020 2020 2020 2020 206f 7574 6c69             outli
-0001e130: 6e65 733d 2768 6561 6427 2c0d 0a23 2020  nes='head',..#  
-0001e140: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0001e150: 0d0a 0d0a 2320 2020 2020 6465 6620 6272  ....#     def br
-0001e160: 616e 6368 7769 7365 5f6c 6f73 7328 7365  anchwise_loss(se
-0001e170: 6c66 2c20 582c 2079 293a 0d0a 2320 2020  lf, X, y):..#   
-0001e180: 2020 2020 2020 6d6f 6465 6c5f 7765 6967        model_weig
-0001e190: 6874 735f 6f72 6967 696e 616c 203d 2073  hts_original = s
-0001e1a0: 656c 662e 6b6d 2e67 6574 5f77 6569 6768  elf.km.get_weigh
-0001e1b0: 7473 2829 2e63 6f70 7928 290d 0a23 2020  ts().copy()..#  
-0001e1c0: 2020 2020 2020 2062 6173 655f 6c6f 7373         base_loss
-0001e1d0: 2c20 5f20 3d20 7365 6c66 2e6b 6d2e 6576  , _ = self.km.ev
-0001e1e0: 616c 7561 7465 2858 2c20 792c 2076 6572  aluate(X, y, ver
-0001e1f0: 626f 7365 3d30 290d 0a0d 0a23 2020 2020  bose=0)....#    
-0001e200: 2020 2020 206c 6f73 7365 7320 3d20 5b5d       losses = []
-0001e210: 0d0a 2320 2020 2020 2020 2020 666f 7220  ..#         for 
-0001e220: 6920 696e 2072 616e 6765 2873 656c 662e  i in range(self.
-0001e230: 7370 6563 735b 226e 5f6c 6174 656e 7422  specs["n_latent"
-0001e240: 5d29 3a0d 0a23 2020 2020 2020 2020 2020  ]):..#          
-0001e250: 2020 206d 6f64 656c 5f77 6569 6768 7473     model_weights
-0001e260: 203d 206d 6f64 656c 5f77 6569 6768 7473   = model_weights
-0001e270: 5f6f 7269 6769 6e61 6c2e 636f 7079 2829  _original.copy()
-0001e280: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-0001e290: 7370 6174 6961 6c5f 7765 6967 6874 7320  spatial_weights 
-0001e2a0: 3d20 6d6f 6465 6c5f 7765 6967 6874 735b  = model_weights[
-0001e2b0: 305d 2e63 6f70 7928 290d 0a23 2020 2020  0].copy()..#    
-0001e2c0: 2020 2020 2020 2020 2073 7061 7469 616c           spatial
-0001e2d0: 5f62 6961 7365 7320 3d20 6d6f 6465 6c5f  _biases = model_
-0001e2e0: 7765 6967 6874 735b 315d 2e63 6f70 7928  weights[1].copy(
-0001e2f0: 290d 0a23 2020 2020 2020 2020 2020 2020  )..#            
-0001e300: 2074 656d 706f 7261 6c5f 6269 6173 6573   temporal_biases
-0001e310: 203d 206d 6f64 656c 5f77 6569 6768 7473   = model_weights
-0001e320: 5b33 5d2e 636f 7079 2829 0d0a 2320 2020  [3].copy()..#   
-0001e330: 2020 2020 2020 2020 2020 656e 765f 6269            env_bi
-0001e340: 6173 6573 203d 206d 6f64 656c 5f77 6569  ases = model_wei
-0001e350: 6768 7473 5b35 5d2e 636f 7079 2829 0d0a  ghts[5].copy()..
-0001e360: 2320 2020 2020 2020 2020 2020 2020 7370  #             sp
-0001e370: 6174 6961 6c5f 7765 6967 6874 735b 3a2c  atial_weights[:,
-0001e380: 2069 5d20 3d20 300d 0a23 2020 2020 2020   i] = 0..#      
-0001e390: 2020 2020 2020 2073 7061 7469 616c 5f62         spatial_b
-0001e3a0: 6961 7365 735b 695d 203d 2030 0d0a 2320  iases[i] = 0..# 
-0001e3b0: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
-0001e3c0: 6f72 616c 5f62 6961 7365 735b 695d 203d  oral_biases[i] =
-0001e3d0: 2030 0d0a 2320 2020 2020 2020 2020 2020   0..#           
-0001e3e0: 2020 656e 765f 6269 6173 6573 5b69 5d20    env_biases[i] 
-0001e3f0: 3d20 300d 0a23 2020 2020 2020 2020 2020  = 0..#          
-0001e400: 2020 206d 6f64 656c 5f77 6569 6768 7473     model_weights
-0001e410: 5b30 5d20 3d20 7370 6174 6961 6c5f 7765  [0] = spatial_we
-0001e420: 6967 6874 730d 0a23 2020 2020 2020 2020  ights..#        
-0001e430: 2020 2020 206d 6f64 656c 5f77 6569 6768       model_weigh
-0001e440: 7473 5b31 5d20 3d20 7370 6174 6961 6c5f  ts[1] = spatial_
-0001e450: 6269 6173 6573 0d0a 2320 2020 2020 2020  biases..#       
-0001e460: 2020 2020 2020 6d6f 6465 6c5f 7765 6967        model_weig
-0001e470: 6874 735b 335d 203d 2074 656d 706f 7261  hts[3] = tempora
-0001e480: 6c5f 6269 6173 6573 0d0a 2320 2020 2020  l_biases..#     
-0001e490: 2020 2020 2020 2020 6d6f 6465 6c5f 7765          model_we
-0001e4a0: 6967 6874 735b 355d 203d 2065 6e76 5f62  ights[5] = env_b
-0001e4b0: 6961 7365 730d 0a23 2020 2020 2020 2020  iases..#        
-0001e4c0: 2020 2020 2073 656c 662e 6b6d 2e73 6574       self.km.set
-0001e4d0: 5f77 6569 6768 7473 286d 6f64 656c 5f77  _weights(model_w
-0001e4e0: 6569 6768 7473 290d 0a23 2020 2020 2020  eights)..#      
-0001e4f0: 2020 2020 2020 206c 6f73 7365 732e 6170         losses.ap
-0001e500: 7065 6e64 2873 656c 662e 6b6d 2e65 7661  pend(self.km.eva
-0001e510: 6c75 6174 6528 582c 2079 2c20 7665 7262  luate(X, y, verb
-0001e520: 6f73 653d 3029 5b30 5d29 0d0a 2320 2020  ose=0)[0])..#   
-0001e530: 2020 2020 2020 7365 6c66 2e6b 6d2e 7365        self.km.se
-0001e540: 745f 7765 6967 6874 7328 6d6f 6465 6c5f  t_weights(model_
-0001e550: 7765 6967 6874 735f 6f72 6967 696e 616c  weights_original
-0001e560: 290d 0a23 2020 2020 2020 2020 2073 656c  )..#         sel
-0001e570: 662e 6272 616e 6368 5f72 656c 6576 616e  f.branch_relevan
-0001e580: 6365 5f6c 6f73 7320 3d20 6261 7365 5f6c  ce_loss = base_l
-0001e590: 6f73 7320 2d20 6e70 2e61 7272 6179 286c  oss - np.array(l
-0001e5a0: 6f73 7365 7329 0d0a 0d0a 2320 2020 2020  osses)....#     
-0001e5b0: 6465 6620 706c 6f74 5f62 7261 6e63 6828  def plot_branch(
-0001e5c0: 0d0a 2320 2020 2020 2020 2020 7365 6c66  ..#         self
-0001e5d0: 2c0d 0a23 2020 2020 2020 2020 2062 7261  ,..#         bra
-0001e5e0: 6e63 685f 6e75 6d3a 2069 6e74 2c0d 0a23  nch_num: int,..#
-0001e5f0: 2020 2020 2020 2020 2069 6e66 6f3a 2049           info: I
-0001e600: 6e66 6f2c 0d0a 2320 2020 2020 2020 2020  nfo,..#         
-0001e610: 7061 7261 6d73 3a20 4f70 7469 6f6e 616c  params: Optional
-0001e620: 5b6c 6973 745b 7374 725d 5d20 3d20 5b27  [list[str]] = ['
-0001e630: 696e 7075 7427 2c20 276f 7574 7075 7427  input', 'output'
-0001e640: 2c20 2772 6573 706f 6e73 6527 5d0d 0a23  , 'response']..#
-0001e650: 2020 2020 2029 3a0d 0a23 2020 2020 2020       ):..#      
-0001e660: 2020 2069 6e66 6f2e 5f5f 7365 7473 7461     info.__setsta
-0001e670: 7465 5f5f 2864 6963 7428 5f75 6e6c 6f63  te__(dict(_unloc
-0001e680: 6b65 643d 5472 7565 2929 0d0a 2320 2020  ked=True))..#   
-0001e690: 2020 2020 2020 696e 666f 5b27 7366 7265        info['sfre
-0001e6a0: 7127 5d20 3d20 312e 0d0a 2320 2020 2020  q'] = 1...#     
-0001e6b0: 2020 2020 736f 7274 696e 6720 3d20 6e70      sorting = np
-0001e6c0: 2e61 7267 736f 7274 2873 656c 662e 6272  .argsort(self.br
-0001e6d0: 616e 6368 5f72 656c 6576 616e 6365 5f6c  anch_relevance_l
-0001e6e0: 6f73 7329 5b3a 3a2d 315d 0d0a 2320 2020  oss)[::-1]..#   
-0001e6f0: 2020 2020 2020 6461 7461 203d 2073 656c        data = sel
-0001e700: 662e 7061 7474 6572 6e73 5b3a 2c20 736f  f.patterns[:, so
-0001e710: 7274 696e 675d 0d0a 2320 2020 2020 2020  rting]..#       
-0001e720: 2020 6669 6c74 6572 7320 3d20 7365 6c66    filters = self
-0001e730: 2e66 696c 7465 7273 5b3a 2c20 736f 7274  .filters[:, sort
-0001e740: 696e 675d 0d0a 2320 2020 2020 2020 2020  ing]..#         
-0001e750: 7265 6c65 7661 6e63 6573 203d 2073 656c  relevances = sel
-0001e760: 662e 6272 616e 6368 5f72 656c 6576 616e  f.branch_relevan
-0001e770: 6365 5f6c 6f73 7320 2d20 7365 6c66 2e62  ce_loss - self.b
-0001e780: 7261 6e63 685f 7265 6c65 7661 6e63 655f  ranch_relevance_
-0001e790: 6c6f 7373 2e6d 696e 2829 0d0a 2320 2020  loss.min()..#   
-0001e7a0: 2020 2020 2020 7265 6c65 7661 6e63 6520        relevance 
-0001e7b0: 3d20 736f 7274 6564 285b 6e70 2e72 6f75  = sorted([np.rou
-0001e7c0: 6e64 2872 656c 2f72 656c 6576 616e 6365  nd(rel/relevance
-0001e7d0: 732e 7375 6d28 292c 2032 2920 666f 7220  s.sum(), 2) for 
-0001e7e0: 7265 6c20 696e 2072 656c 6576 616e 6365  rel in relevance
-0001e7f0: 735d 2c20 7265 7665 7273 653d 5472 7565  s], reverse=True
-0001e800: 295b 6272 616e 6368 5f6e 756d 5d0d 0a23  )[branch_num]..#
-0001e810: 2020 2020 2020 2020 2073 656c 662e 6661           self.fa
-0001e820: 6b65 5f65 766f 6b65 6420 3d20 6576 6f6b  ke_evoked = evok
-0001e830: 6564 2e45 766f 6b65 6441 7272 6179 2864  ed.EvokedArray(d
-0001e840: 6174 612c 2069 6e66 6f2c 2074 6d69 6e3d  ata, info, tmin=
-0001e850: 3029 0d0a 2320 2020 2020 2020 2020 6669  0)..#         fi
-0001e860: 672c 2028 6178 312c 2061 7832 2920 3d20  g, (ax1, ax2) = 
-0001e870: 706c 742e 7375 6270 6c6f 7473 286e 636f  plt.subplots(nco
-0001e880: 6c73 3d32 2c20 6e72 6f77 733d 3129 0d0a  ls=2, nrows=1)..
-0001e890: 2320 2020 2020 2020 2020 6669 672e 7469  #         fig.ti
-0001e8a0: 6768 745f 6c61 796f 7574 2829 0d0a 0d0a  ght_layout()....
-0001e8b0: 2320 2020 2020 2020 2020 7365 6c66 2e66  #         self.f
-0001e8c0: 7320 3d20 7365 6c66 2e64 6174 6173 6574  s = self.dataset
-0001e8d0: 2e68 5f70 6172 616d 735b 2766 7327 5d0d  .h_params['fs'].
-0001e8e0: 0a0d 0a23 2020 2020 2020 2020 206f 7574  ...#         out
-0001e8f0: 5f66 696c 7465 7220 3d20 6669 6c74 6572  _filter = filter
-0001e900: 735b 3a2c 2062 7261 6e63 685f 6e75 6d5d  s[:, branch_num]
-0001e910: 0d0a 2320 2020 2020 2020 2020 5f2c 2070  ..#         _, p
-0001e920: 7364 203d 2077 656c 6368 2873 656c 662e  sd = welch(self.
-0001e930: 6c61 745f 7463 735b 6272 616e 6368 5f6e  lat_tcs[branch_n
-0001e940: 756d 5d2c 2066 733d 7365 6c66 2e66 732c  um], fs=self.fs,
-0001e950: 206e 7065 7273 6567 3d73 656c 662e 6673   nperseg=self.fs
-0001e960: 202a 2032 290d 0a23 2020 2020 2020 2020   * 2)..#        
-0001e970: 2077 2c20 6820 3d20 286c 616d 6264 6120   w, h = (lambda 
-0001e980: 772c 2068 3a20 2877 2c20 6829 2928 2a66  w, h: (w, h))(*f
-0001e990: 7265 717a 286f 7574 5f66 696c 7465 722c  reqz(out_filter,
-0001e9a0: 2031 2c20 776f 724e 3d73 656c 662e 6673   1, worN=self.fs
-0001e9b0: 2929 0d0a 2320 2020 2020 2020 2020 6672  ))..#         fr
-0001e9c0: 616e 6765 203d 2077 202f 206e 702e 7069  ange = w / np.pi
-0001e9d0: 202a 2073 656c 662e 6673 202f 2032 0d0a   * self.fs / 2..
-0001e9e0: 2320 2020 2020 2020 2020 7a20 3d20 6c61  #         z = la
-0001e9f0: 6d62 6461 2078 3a20 2878 202d 2078 2e6d  mbda x: (x - x.m
-0001ea00: 6561 6e28 2929 2f78 2e73 7464 2829 0d0a  ean())/x.std()..
-0001ea10: 0d0a 2320 2020 2020 2020 2020 666f 7220  ..#         for 
-0001ea20: 7061 7261 6d20 696e 2070 6172 616d 733a  param in params:
-0001ea30: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-0001ea40: 6966 2070 6172 616d 203d 3d20 2769 6e70  if param == 'inp
-0001ea50: 7574 273a 0d0a 2320 2020 2020 2020 2020  ut':..#         
-0001ea60: 2020 2020 2020 2020 6669 6e70 7574 203d          finput =
-0001ea70: 2070 7364 5b3a 2d31 5d0d 0a23 2020 2020   psd[:-1]..#    
-0001ea80: 2020 2020 2020 2020 2020 2020 2066 696e               fin
-0001ea90: 7075 7420 3d20 7a28 6669 6e70 7574 290d  put = z(finput).
-0001eaa0: 0a23 2020 2020 2020 2020 2020 2020 2020  .#              
-0001eab0: 2020 2061 7832 2e70 6c6f 7428 6672 616e     ax2.plot(fran
-0001eac0: 6765 2c20 6669 6e70 7574 202d 2066 696e  ge, finput - fin
-0001ead0: 7075 742e 6d69 6e28 292c 2063 6f6c 6f72  put.min(), color
-0001eae0: 3d27 7461 623a 626c 7565 2729 0d0a 2320  ='tab:blue')..# 
-0001eaf0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0001eb00: 2070 6172 616d 203d 3d20 276f 7574 7075   param == 'outpu
-0001eb10: 7427 3a0d 0a23 2020 2020 2020 2020 2020  t':..#          
-0001eb20: 2020 2020 2020 2066 6f75 7470 7574 203d         foutput =
-0001eb30: 206e 702e 7265 616c 2866 696e 7075 7420   np.real(finput 
-0001eb40: 2a20 6820 2a20 6e70 2e63 6f6e 6a28 6829  * h * np.conj(h)
-0001eb50: 290d 0a23 2020 2020 2020 2020 2020 2020  )..#            
-0001eb60: 2020 2020 2066 6f75 7470 7574 203d 207a       foutput = z
-0001eb70: 2866 6f75 7470 7574 290d 0a23 2020 2020  (foutput)..#    
-0001eb80: 2020 2020 2020 2020 2020 2020 2061 7832               ax2
-0001eb90: 2e70 6c6f 7428 6672 616e 6765 2c20 666f  .plot(frange, fo
-0001eba0: 7574 7075 7420 2d20 666f 7574 7075 742e  utput - foutput.
-0001ebb0: 6d69 6e28 292c 2063 6f6c 6f72 3d27 7461  min(), color='ta
-0001ebc0: 623a 6f72 616e 6765 2729 0d0a 2320 2020  b:orange')..#   
-0001ebd0: 2020 2020 2020 2020 2020 656c 6966 2070            elif p
-0001ebe0: 6172 616d 203d 3d20 2772 6573 706f 6e73  aram == 'respons
-0001ebf0: 6527 3a0d 0a23 2020 2020 2020 2020 2020  e':..#          
-0001ec00: 2020 2020 2020 2066 7265 7370 6f6e 6365         fresponce
-0001ec10: 203d 206e 702e 6162 7328 6829 0d0a 2320   = np.abs(h)..# 
-0001ec20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ec30: 6672 6573 706f 6e63 6520 3d20 7a28 6672  fresponce = z(fr
-0001ec40: 6573 706f 6e63 6529 0d0a 2320 2020 2020  esponce)..#     
-0001ec50: 2020 2020 2020 2020 2020 2020 6178 322e              ax2.
-0001ec60: 706c 6f74 2866 7261 6e67 652c 2066 7265  plot(frange, fre
-0001ec70: 7370 6f6e 6365 202d 2066 7265 7370 6f6e  sponce - frespon
-0001ec80: 6365 2e6d 696e 2829 2c20 636f 6c6f 723d  ce.min(), color=
-0001ec90: 2774 6162 3a67 7265 656e 2729 0d0a 2320  'tab:green')..# 
-0001eca0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0001ecb0: 2070 6172 616d 203d 3d20 2770 6174 7465   param == 'patte
-0001ecc0: 726e 273a 0d0a 2320 2020 2020 2020 2020  rn':..#         
-0001ecd0: 2020 2020 2020 2020 6670 6174 7465 726e          fpattern
-0001ece0: 203d 2066 696e 7075 7420 2a20 6e70 2e61   = finput * np.a
-0001ecf0: 6273 2868 290d 0a23 2020 2020 2020 2020  bs(h)..#        
-0001ed00: 2020 2020 2020 2020 2066 7061 7474 6572           fpatter
-0001ed10: 6e20 3d20 7a28 6670 6174 7465 726e 290d  n = z(fpattern).
-0001ed20: 0a23 2020 2020 2020 2020 2020 2020 2020  .#              
-0001ed30: 2020 2061 7832 2e70 6c6f 7428 6672 616e     ax2.plot(fran
-0001ed40: 6765 2c20 6670 6174 7465 726e 202d 2066  ge, fpattern - f
-0001ed50: 7061 7474 6572 6e2e 6d69 6e28 292c 2063  pattern.min(), c
-0001ed60: 6f6c 6f72 3d27 7461 623a 7069 6e6b 2729  olor='tab:pink')
-0001ed70: 0d0a 0d0a 2320 2020 2020 2020 2020 6178  ....#         ax
-0001ed80: 322e 6c65 6765 6e64 285b 7061 7261 6d2e  2.legend([param.
-0001ed90: 6361 7069 7461 6c69 7a65 2829 2066 6f72  capitalize() for
-0001eda0: 2070 6172 616d 2069 6e20 7061 7261 6d73   param in params
-0001edb0: 5d29 0d0a 2320 2020 2020 2020 2020 6178  ])..#         ax
-0001edc0: 322e 7365 745f 786c 696d 2830 2c20 3130  2.set_xlim(0, 10
-0001edd0: 3029 0d0a 0d0a 2320 2020 2020 2020 2020  0)....#         
-0001ede0: 6669 672e 7375 7074 6974 6c65 2866 2742  fig.suptitle(f'B
-0001edf0: 7261 6e63 6820 7b62 7261 6e63 685f 6e75  ranch {branch_nu
-0001ee00: 6d7d 272c 2079 3d30 2e39 352c 2078 3d30  m}', y=0.95, x=0
-0001ee10: 2e32 2c20 666f 6e74 7369 7a65 3d33 3029  .2, fontsize=30)
-0001ee20: 0d0a 2320 2020 2020 2020 2020 6669 672e  ..#         fig.
-0001ee30: 7365 745f 7369 7a65 5f69 6e63 6865 7328  set_size_inches(
-0001ee40: 3130 2c20 3529 0d0a 2320 2020 2020 2020  10, 5)..#       
-0001ee50: 2020 7365 6c66 2e66 616b 655f 6576 6f6b    self.fake_evok
-0001ee60: 6564 2e70 6c6f 745f 746f 706f 6d61 7028  ed.plot_topomap(
-0001ee70: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-0001ee80: 7469 6d65 733d 6272 616e 6368 5f6e 756d  times=branch_num
-0001ee90: 2c0d 0a23 2020 2020 2020 2020 2020 2020  ,..#            
-0001eea0: 2061 7865 733d 6178 312c 0d0a 2320 2020   axes=ax1,..#   
-0001eeb0: 2020 2020 2020 2020 2020 636f 6c6f 7262            colorb
-0001eec0: 6172 3d46 616c 7365 2c0d 0a23 2020 2020  ar=False,..#    
-0001eed0: 2020 2020 2020 2020 2073 6361 6c69 6e67           scaling
-0001eee0: 733d 312c 0d0a 2320 2020 2020 2020 2020  s=1,..#         
-0001eef0: 2020 2020 7469 6d65 5f66 6f72 6d61 743d      time_format=
-0001ef00: 2222 2c0d 0a23 2020 2020 2020 2020 2020  "",..#          
-0001ef10: 2020 206f 7574 6c69 6e65 733d 2768 6561     outlines='hea
-0001ef20: 6427 2c0d 0a23 2020 2020 2020 2020 2029  d',..#         )
-0001ef30: 0d0a 0d0a 2320 2020 2020 2020 2020 7265  ....#         re
-0001ef40: 7475 726e 2066 6967 0d0a 0d0a 0d0a       turn fig......
+0001d410: 585f 6669 6c74 203d 206e 702e 7a65 726f  X_filt = np.zero
+0001d420: 735f 6c69 6b65 2858 290d 0a23 2020 2020  s_like(X)..#    
+0001d430: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0001d440: 2069 5f63 6f6d 7020 696e 2072 616e 6765   i_comp in range
+0001d450: 286b 6572 6e2e 7368 6170 655b 305d 293a  (kern.shape[0]):
+0001d460: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+0001d470: 2020 2020 2020 2020 666f 7220 695f 6368          for i_ch
+0001d480: 2069 6e20 7261 6e67 6528 582e 7368 6170   in range(X.shap
+0001d490: 655b 315d 293a 0d0a 2320 2020 2020 2020  e[1]):..#       
+0001d4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d4b0: 2020 7820 3d20 585b 3a2c 2069 5f63 685d    x = X[:, i_ch]
+0001d4c0: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+0001d4d0: 2020 2020 2020 2020 2020 2020 585f 6669              X_fi
+0001d4e0: 6c74 5b3a 2c20 695f 6368 5d20 3d20 6e70  lt[:, i_ch] = np
+0001d4f0: 2e63 6f6e 766f 6c76 6528 782c 206b 6572  .convolve(x, ker
+0001d500: 6e5b 695f 636f 6d70 2c20 3a5d 2c20 6d6f  n[i_comp, :], mo
+0001d510: 6465 3d22 7361 6d65 2229 0d0a 2320 2020  de="same")..#   
+0001d520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d530: 2020 7061 7474 6572 6e73 2e61 7070 656e    patterns.appen
+0001d540: 6428 6e70 2e63 6f76 2858 5f66 696c 742e  d(np.cov(X_filt.
+0001d550: 5429 2040 2064 656d 785b 3a2c 2069 5f63  T) @ demx[:, i_c
+0001d560: 6f6d 705d 290d 0a23 2020 2020 2020 2020  omp])..#        
+0001d570: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
+0001d580: 7474 6572 6e73 203d 206e 702e 6172 7261  tterns = np.arra
+0001d590: 7928 7061 7474 6572 6e73 292e 540d 0a23  y(patterns).T..#
+0001d5a0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+0001d5b0: 2320 2020 2020 2020 2020 2020 2020 7365  #             se
+0001d5c0: 6c66 2e70 6174 7465 726e 7320 3d20 6465  lf.patterns = de
+0001d5d0: 6d78 0d0a 0d0a 2320 2020 2020 2020 2020  mx....#         
+0001d5e0: 7365 6c66 2e6c 6174 5f74 6373 203d 206e  self.lat_tcs = n
+0001d5f0: 702e 646f 7428 6465 6d78 2e54 2c20 582e  p.dot(demx.T, X.
+0001d600: 5429 0d0a 0d0a 2320 2020 2020 2020 2020  T)....#         
+0001d610: 6465 6c20 580d 0a0d 0a23 2020 2020 2020  del X....#      
+0001d620: 2020 2023 2020 5465 6d70 6f72 616c 2063     #  Temporal c
+0001d630: 6f6e 7620 7374 7566 660d 0a23 2020 2020  onv stuff..#    
+0001d640: 2020 2020 2073 656c 662e 6669 6c74 6572       self.filter
+0001d650: 7320 3d20 6b65 726e 2e54 0d0a 2320 2020  s = kern.T..#   
+0001d660: 2020 2020 2020 7365 6c66 2e74 635f 6f75        self.tc_ou
+0001d670: 7420 3d20 6e70 2e73 7175 6565 7a65 2874  t = np.squeeze(t
+0001d680: 635f 6f75 7429 0d0a 2320 2020 2020 2020  c_out)..#       
+0001d690: 2020 7365 6c66 2e63 6f72 725f 746f 5f6f    self.corr_to_o
+0001d6a0: 7574 7075 7420 3d20 7365 6c66 2e67 6574  utput = self.get
+0001d6b0: 5f6f 7574 7075 745f 636f 7272 656c 6174  _output_correlat
+0001d6c0: 696f 6e73 2879 290d 0a0d 0a23 2020 2020  ions(y)....#    
+0001d6d0: 2064 6566 2070 6c6f 745f 7061 7474 6572   def plot_patter
+0001d6e0: 6e73 280d 0a23 2020 2020 2020 2020 2073  ns(..#         s
+0001d6f0: 656c 662c 2073 656e 736f 725f 6c61 796f  elf, sensor_layo
+0001d700: 7574 3d4e 6f6e 652c 2073 6f72 7469 6e67  ut=None, sorting
+0001d710: 3d27 6c32 272c 2070 6572 6365 6e74 696c  ='l2', percentil
+0001d720: 653d 3930 2c0d 0a23 2020 2020 2020 2020  e=90,..#        
+0001d730: 2073 6361 6c65 3d46 616c 7365 2c20 636c   scale=False, cl
+0001d740: 6173 735f 6e61 6d65 733d 4e6f 6e65 2c20  ass_names=None, 
+0001d750: 696e 666f 3d4e 6f6e 650d 0a23 2020 2020  info=None..#    
+0001d760: 2029 3a0d 0a23 2020 2020 2020 2020 206f   ):..#         o
+0001d770: 7264 6572 2c20 7473 203d 2073 656c 662e  rder, ts = self.
+0001d780: 5f73 6f72 7469 6e67 2873 6f72 7469 6e67  _sorting(sorting
+0001d790: 290d 0a23 2020 2020 2020 2020 2073 656c  )..#         sel
+0001d7a0: 662e 756f 7264 6572 203d 206f 7264 6572  f.uorder = order
+0001d7b0: 2e72 6176 656c 2829 0d0a 2320 2020 2020  .ravel()..#     
+0001d7c0: 2020 2020 6c5f 7520 3d20 6c65 6e28 7365      l_u = len(se
+0001d7d0: 6c66 2e75 6f72 6465 7229 0d0a 2320 2020  lf.uorder)..#   
+0001d7e0: 2020 2020 2020 6966 2069 6e66 6f3a 0d0a        if info:..
+0001d7f0: 2320 2020 2020 2020 2020 2020 2020 696e  #             in
+0001d800: 666f 2e5f 5f73 6574 7374 6174 655f 5f28  fo.__setstate__(
+0001d810: 6469 6374 285f 756e 6c6f 636b 6564 3d54  dict(_unlocked=T
+0001d820: 7275 6529 290d 0a23 2020 2020 2020 2020  rue))..#        
+0001d830: 2020 2020 2069 6e66 6f5b 2773 6672 6571       info['sfreq
+0001d840: 275d 203d 2031 2e0d 0a23 2020 2020 2020  '] = 1...#      
+0001d850: 2020 2020 2020 2073 656c 662e 6661 6b65         self.fake
+0001d860: 5f65 766f 6b65 6420 3d20 6576 6f6b 6564  _evoked = evoked
+0001d870: 2e45 766f 6b65 6441 7272 6179 2873 656c  .EvokedArray(sel
+0001d880: 662e 7061 7474 6572 6e73 2c20 696e 666f  f.patterns, info
+0001d890: 2c20 746d 696e 3d30 290d 0a23 2020 2020  , tmin=0)..#    
+0001d8a0: 2020 2020 2020 2020 2069 6620 6c5f 7520           if l_u 
+0001d8b0: 3e20 313a 0d0a 2320 2020 2020 2020 2020  > 1:..#         
+0001d8c0: 2020 2020 2020 2020 7365 6c66 2e66 616b          self.fak
+0001d8d0: 655f 6576 6f6b 6564 2e64 6174 615b 3a2c  e_evoked.data[:,
+0001d8e0: 203a 6c5f 755d 203d 2073 656c 662e 6661   :l_u] = self.fa
+0001d8f0: 6b65 5f65 766f 6b65 642e 6461 7461 5b3a  ke_evoked.data[:
+0001d900: 2c20 7365 6c66 2e75 6f72 6465 725d 0d0a  , self.uorder]..
+0001d910: 2320 2020 2020 2020 2020 2020 2020 656c  #             el
+0001d920: 6966 206c 5f75 203d 3d20 313a 0d0a 2320  if l_u == 1:..# 
+0001d930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d940: 7365 6c66 2e66 616b 655f 6576 6f6b 6564  self.fake_evoked
+0001d950: 2e64 6174 615b 3a2c 206c 5f75 5d20 3d20  .data[:, l_u] = 
+0001d960: 7365 6c66 2e66 616b 655f 6576 6f6b 6564  self.fake_evoked
+0001d970: 2e64 6174 615b 3a2c 2073 656c 662e 756f  .data[:, self.uo
+0001d980: 7264 6572 5b30 5d5d 0d0a 2320 2020 2020  rder[0]]..#     
+0001d990: 2020 2020 2020 2020 7365 6c66 2e66 616b          self.fak
+0001d9a0: 655f 6576 6f6b 6564 2e63 726f 7028 746d  e_evoked.crop(tm
+0001d9b0: 6178 3d66 6c6f 6174 286c 5f75 2929 0d0a  ax=float(l_u))..
+0001d9c0: 2320 2020 2020 2020 2020 2020 2020 6966  #             if
+0001d9d0: 2073 6361 6c65 3a0d 0a23 2020 2020 2020   scale:..#      
+0001d9e0: 2020 2020 2020 2020 2020 205f 7374 6420             _std 
+0001d9f0: 3d20 7365 6c66 2e66 616b 655f 6576 6f6b  = self.fake_evok
+0001da00: 6564 2e64 6174 615b 3a2c 203a 6c5f 755d  ed.data[:, :l_u]
+0001da10: 2e73 7464 2830 290d 0a23 2020 2020 2020  .std(0)..#      
+0001da20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001da30: 6661 6b65 5f65 766f 6b65 642e 6461 7461  fake_evoked.data
+0001da40: 5b3a 2c20 3a6c 5f75 5d20 2f3d 205f 7374  [:, :l_u] /= _st
+0001da50: 640d 0a23 2020 2020 2020 2020 2065 6c69  d..#         eli
+0001da60: 6620 7365 6e73 6f72 5f6c 6179 6f75 743a  f sensor_layout:
+0001da70: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+0001da80: 6c6f 203d 2063 6861 6e6e 656c 732e 7265  lo = channels.re
+0001da90: 6164 5f6c 6179 6f75 7428 7365 6e73 6f72  ad_layout(sensor
+0001daa0: 5f6c 6179 6f75 7429 0d0a 2320 2020 2020  _layout)..#     
+0001dab0: 2020 2020 2020 2020 696e 666f 203d 2063          info = c
+0001dac0: 7265 6174 655f 696e 666f 286c 6f2e 6e61  reate_info(lo.na
+0001dad0: 6d65 732c 2031 2e2c 2073 656e 736f 725f  mes, 1., sensor_
+0001dae0: 6c61 796f 7574 2e73 706c 6974 2827 2d27  layout.split('-'
+0001daf0: 295b 2d31 5d29 0d0a 2320 2020 2020 2020  )[-1])..#       
+0001db00: 2020 2020 2020 6f72 6967 5f78 7920 3d20        orig_xy = 
+0001db10: 6e70 2e6d 6561 6e28 6c6f 2e70 6f73 5b3a  np.mean(lo.pos[:
+0001db20: 2c20 3a32 5d2c 2030 290d 0a23 2020 2020  , :2], 0)..#    
+0001db30: 2020 2020 2020 2020 2066 6f72 2069 2c20           for i, 
+0001db40: 6368 2069 6e20 656e 756d 6572 6174 6528  ch in enumerate(
+0001db50: 6c6f 2e6e 616d 6573 293a 0d0a 2320 2020  lo.names):..#   
+0001db60: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001db70: 2069 6e66 6f5b 2763 6873 275d 5b69 5d5b   info['chs'][i][
+0001db80: 2763 685f 6e61 6d65 275d 203d 3d20 6368  'ch_name'] == ch
+0001db90: 3a0d 0a23 2020 2020 2020 2020 2020 2020  :..#            
+0001dba0: 2020 2020 2020 2020 2069 6e66 6f5b 2763           info['c
+0001dbb0: 6873 275d 5b69 5d5b 276c 6f63 275d 5b3a  hs'][i]['loc'][:
+0001dbc0: 325d 203d 2028 6c6f 2e70 6f73 5b69 2c20  2] = (lo.pos[i, 
+0001dbd0: 3a32 5d20 2d20 6f72 6967 5f78 7929 2f33  :2] - orig_xy)/3
+0001dbe0: 2e0d 0a23 2020 2020 2020 2020 2020 2020  ...#            
+0001dbf0: 2020 2020 2020 2020 2023 696e 666f 5b27           #info['
+0001dc00: 6368 7327 5d5b 695d 5b27 6c6f 6327 5d5b  chs'][i]['loc'][
+0001dc10: 343a 5d20 3d20 300d 0a23 2020 2020 2020  4:] = 0..#      
+0001dc20: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0001dc30: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+0001dc40: 2020 2020 2020 2020 7072 696e 7428 2243          print("C
+0001dc50: 6861 6e6e 656c 206e 616d 6520 6d69 736d  hannel name mism
+0001dc60: 6174 6368 2e20 696e 666f 3a20 7b7d 2076  atch. info: {} v
+0001dc70: 7320 6c6f 3a20 7b7d 222e 666f 726d 6174  s lo: {}".format
+0001dc80: 280d 0a23 2020 2020 2020 2020 2020 2020  (..#            
+0001dc90: 2020 2020 2020 2020 2020 2020 2069 6e66               inf
+0001dca0: 6f5b 2763 6873 275d 5b69 5d5b 2763 685f  o['chs'][i]['ch_
+0001dcb0: 6e61 6d65 275d 2c20 6368 2929 0d0a 0d0a  name'], ch))....
+0001dcc0: 2320 2020 2020 2020 2020 2020 2020 7365  #             se
+0001dcd0: 6c66 2e66 616b 655f 6576 6f6b 6564 203d  lf.fake_evoked =
+0001dce0: 2065 766f 6b65 642e 4576 6f6b 6564 4172   evoked.EvokedAr
+0001dcf0: 7261 7928 7365 6c66 2e70 6174 7465 726e  ray(self.pattern
+0001dd00: 732c 2069 6e66 6f29 0d0a 0d0a 2320 2020  s, info)....#   
+0001dd10: 2020 2020 2020 2020 2020 6966 206c 5f75            if l_u
+0001dd20: 203e 2031 3a0d 0a23 2020 2020 2020 2020   > 1:..#        
+0001dd30: 2020 2020 2020 2020 2073 656c 662e 6661           self.fa
+0001dd40: 6b65 5f65 766f 6b65 642e 6461 7461 5b3a  ke_evoked.data[:
+0001dd50: 2c20 3a6c 5f75 5d20 3d20 7365 6c66 2e66  , :l_u] = self.f
+0001dd60: 616b 655f 6576 6f6b 6564 2e64 6174 615b  ake_evoked.data[
+0001dd70: 3a2c 2073 656c 662e 756f 7264 6572 5d0d  :, self.uorder].
+0001dd80: 0a23 2020 2020 2020 2020 2020 2020 2065  .#             e
+0001dd90: 6c69 6620 6c5f 7520 3d3d 2031 3a0d 0a23  lif l_u == 1:..#
+0001dda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ddb0: 2073 656c 662e 6661 6b65 5f65 766f 6b65   self.fake_evoke
+0001ddc0: 642e 6461 7461 5b3a 2c20 6c5f 755d 203d  d.data[:, l_u] =
+0001ddd0: 2073 656c 662e 6661 6b65 5f65 766f 6b65   self.fake_evoke
+0001dde0: 642e 6461 7461 5b3a 2c20 7365 6c66 2e75  d.data[:, self.u
+0001ddf0: 6f72 6465 725b 305d 5d0d 0a23 2020 2020  order[0]]..#    
+0001de00: 2020 2020 2020 2020 2073 656c 662e 6661           self.fa
+0001de10: 6b65 5f65 766f 6b65 642e 6372 6f70 2874  ke_evoked.crop(t
+0001de20: 6d61 783d 666c 6f61 7428 6c5f 7529 290d  max=float(l_u)).
+0001de30: 0a23 2020 2020 2020 2020 2020 2020 2069  .#             i
+0001de40: 6620 7363 616c 653a 0d0a 2320 2020 2020  f scale:..#     
+0001de50: 2020 2020 2020 2020 2020 2020 5f73 7464              _std
+0001de60: 203d 2073 656c 662e 6661 6b65 5f65 766f   = self.fake_evo
+0001de70: 6b65 642e 6461 7461 5b3a 2c20 3a6c 5f75  ked.data[:, :l_u
+0001de80: 5d2e 7374 6428 3029 0d0a 2320 2020 2020  ].std(0)..#     
+0001de90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001dea0: 2e66 616b 655f 6576 6f6b 6564 2e64 6174  .fake_evoked.dat
+0001deb0: 615b 3a2c 203a 6c5f 755d 202f 3d20 5f73  a[:, :l_u] /= _s
+0001dec0: 7464 0d0a 2320 2020 2020 2020 2020 656c  td..#         el
+0001ded0: 7365 3a0d 0a23 2020 2020 2020 2020 2020  se:..#          
+0001dee0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0001def0: 726f 7228 2253 7065 6369 6679 2073 656e  ror("Specify sen
+0001df00: 736f 7220 6c61 796f 7574 2229 0d0a 0d0a  sor layout")....
+0001df10: 0d0a 2320 2020 2020 2020 2020 6966 206e  ..#         if n
+0001df20: 702e 616e 7928 7365 6c66 2e75 6f72 6465  p.any(self.uorde
+0001df30: 7229 3a0d 0a23 2020 2020 2020 2020 2020  r):..#          
+0001df40: 2020 206e 6669 6c74 203d 206d 6178 2873     nfilt = max(s
+0001df50: 656c 662e 6f75 745f 6469 6d2c 2038 290d  elf.out_dim, 8).
+0001df60: 0a23 2020 2020 2020 2020 2020 2020 206e  .#             n
+0001df70: 726f 7773 203d 206d 6178 2831 2c20 6c5f  rows = max(1, l_
+0001df80: 752f 2f6e 6669 6c74 290d 0a23 2020 2020  u//nfilt)..#    
+0001df90: 2020 2020 2020 2020 206e 636f 6c73 203d           ncols =
+0001dfa0: 206d 696e 286e 6669 6c74 2c20 6c5f 7529   min(nfilt, l_u)
+0001dfb0: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+0001dfc0: 662c 2061 7820 3d20 706c 742e 7375 6270  f, ax = plt.subp
+0001dfd0: 6c6f 7473 286e 726f 7773 2c20 6e63 6f6c  lots(nrows, ncol
+0001dfe0: 732c 2073 6861 7265 793d 5472 7565 290d  s, sharey=True).
+0001dff0: 0a23 2020 2020 2020 2020 2020 2020 2070  .#             p
+0001e000: 6c74 2e74 6967 6874 5f6c 6179 6f75 7428  lt.tight_layout(
+0001e010: 290d 0a23 2020 2020 2020 2020 2020 2020  )..#            
+0001e020: 2066 2e73 6574 5f73 697a 655f 696e 6368   f.set_size_inch
+0001e030: 6573 285b 3136 2c20 335d 290d 0a23 2020  es([16, 3])..#  
+0001e040: 2020 2020 2020 2020 2020 2061 7820 3d20             ax = 
+0001e050: 6e70 2e61 746c 6561 7374 5f32 6428 6178  np.atleast_2d(ax
+0001e060: 290d 0a0d 0a23 2020 2020 2020 2020 2020  )....#          
+0001e070: 2020 2066 6f72 2069 6920 696e 2072 616e     for ii in ran
+0001e080: 6765 286e 726f 7773 293a 0d0a 2320 2020  ge(nrows):..#   
+0001e090: 2020 2020 2020 2020 2020 2020 2020 6661                fa
+0001e0a0: 6b65 5f74 696d 6573 203d 206e 702e 6172  ke_times = np.ar
+0001e0b0: 616e 6765 2869 6920 2a20 6e63 6f6c 732c  ange(ii * ncols,
+0001e0c0: 2020 2869 6920 2b20 3129 202a 206e 636f    (ii + 1) * nco
+0001e0d0: 6c73 2c20 312e 290d 0a23 2020 2020 2020  ls, 1.)..#      
+0001e0e0: 2020 2020 2020 2020 2020 2076 6d61 7820             vmax 
+0001e0f0: 3d20 6e70 2e70 6572 6365 6e74 696c 6528  = np.percentile(
+0001e100: 7365 6c66 2e66 616b 655f 6576 6f6b 6564  self.fake_evoked
+0001e110: 2e64 6174 615b 3a2c 203a 6c5f 755d 2c20  .data[:, :l_u], 
+0001e120: 3935 290d 0a23 2020 2020 2020 2020 2020  95)..#          
+0001e130: 2020 2020 2020 2073 656c 662e 6661 6b65         self.fake
+0001e140: 5f65 766f 6b65 642e 706c 6f74 5f74 6f70  _evoked.plot_top
+0001e150: 6f6d 6170 280d 0a23 2020 2020 2020 2020  omap(..#        
+0001e160: 2020 2020 2020 2020 2020 2020 2074 696d               tim
+0001e170: 6573 3d66 616b 655f 7469 6d65 732c 0d0a  es=fake_times,..
+0001e180: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+0001e190: 2020 2020 2020 6178 6573 3d61 785b 6969        axes=ax[ii
+0001e1a0: 5d2c 0d0a 2320 2020 2020 2020 2020 2020  ],..#           
+0001e1b0: 2020 2020 2020 2020 2020 636f 6c6f 7262            colorb
+0001e1c0: 6172 3d46 616c 7365 2c0d 0a23 2020 2020  ar=False,..#    
+0001e1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e1e0: 2076 6d61 783d 766d 6178 2c0d 0a23 2020   vmax=vmax,..#  
+0001e1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e200: 2020 2073 6361 6c69 6e67 733d 312c 0d0a     scalings=1,..
+0001e210: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+0001e220: 2020 2020 2020 7469 6d65 5f66 6f72 6d61        time_forma
+0001e230: 743d 2242 7261 6e63 6820 2325 6722 2c0d  t="Branch #%g",.
+0001e240: 0a23 2020 2020 2020 2020 2020 2020 2020  .#              
+0001e250: 2020 2020 2020 2074 6974 6c65 3d27 5061         title='Pa
+0001e260: 7474 6572 6e73 2028 272b 7374 7228 736f  tterns ('+str(so
+0001e270: 7274 696e 6729 2b27 2927 2c0d 0a23 2020  rting)+')',..#  
+0001e280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e290: 2020 206f 7574 6c69 6e65 733d 2768 6561     outlines='hea
+0001e2a0: 6427 2c0d 0a23 2020 2020 2020 2020 2020  d',..#          
+0001e2b0: 2020 2020 2020 2029 0d0a 0d0a 2320 2020         )....#   
+0001e2c0: 2020 6465 6620 6272 616e 6368 7769 7365    def branchwise
+0001e2d0: 5f6c 6f73 7328 7365 6c66 2c20 582c 2079  _loss(self, X, y
+0001e2e0: 293a 0d0a 2320 2020 2020 2020 2020 6d6f  ):..#         mo
+0001e2f0: 6465 6c5f 7765 6967 6874 735f 6f72 6967  del_weights_orig
+0001e300: 696e 616c 203d 2073 656c 662e 6b6d 2e67  inal = self.km.g
+0001e310: 6574 5f77 6569 6768 7473 2829 2e63 6f70  et_weights().cop
+0001e320: 7928 290d 0a23 2020 2020 2020 2020 2062  y()..#         b
+0001e330: 6173 655f 6c6f 7373 2c20 5f20 3d20 7365  ase_loss, _ = se
+0001e340: 6c66 2e6b 6d2e 6576 616c 7561 7465 2858  lf.km.evaluate(X
+0001e350: 2c20 792c 2076 6572 626f 7365 3d30 290d  , y, verbose=0).
+0001e360: 0a0d 0a23 2020 2020 2020 2020 206c 6f73  ...#         los
+0001e370: 7365 7320 3d20 5b5d 0d0a 2320 2020 2020  ses = []..#     
+0001e380: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+0001e390: 6765 2873 656c 662e 7370 6563 735b 226e  ge(self.specs["n
+0001e3a0: 5f6c 6174 656e 7422 5d29 3a0d 0a23 2020  _latent"]):..#  
+0001e3b0: 2020 2020 2020 2020 2020 206d 6f64 656c             model
+0001e3c0: 5f77 6569 6768 7473 203d 206d 6f64 656c  _weights = model
+0001e3d0: 5f77 6569 6768 7473 5f6f 7269 6769 6e61  _weights_origina
+0001e3e0: 6c2e 636f 7079 2829 0d0a 2320 2020 2020  l.copy()..#     
+0001e3f0: 2020 2020 2020 2020 7370 6174 6961 6c5f          spatial_
+0001e400: 7765 6967 6874 7320 3d20 6d6f 6465 6c5f  weights = model_
+0001e410: 7765 6967 6874 735b 305d 2e63 6f70 7928  weights[0].copy(
+0001e420: 290d 0a23 2020 2020 2020 2020 2020 2020  )..#            
+0001e430: 2073 7061 7469 616c 5f62 6961 7365 7320   spatial_biases 
+0001e440: 3d20 6d6f 6465 6c5f 7765 6967 6874 735b  = model_weights[
+0001e450: 315d 2e63 6f70 7928 290d 0a23 2020 2020  1].copy()..#    
+0001e460: 2020 2020 2020 2020 2074 656d 706f 7261           tempora
+0001e470: 6c5f 6269 6173 6573 203d 206d 6f64 656c  l_biases = model
+0001e480: 5f77 6569 6768 7473 5b33 5d2e 636f 7079  _weights[3].copy
+0001e490: 2829 0d0a 2320 2020 2020 2020 2020 2020  ()..#           
+0001e4a0: 2020 656e 765f 6269 6173 6573 203d 206d    env_biases = m
+0001e4b0: 6f64 656c 5f77 6569 6768 7473 5b35 5d2e  odel_weights[5].
+0001e4c0: 636f 7079 2829 0d0a 2320 2020 2020 2020  copy()..#       
+0001e4d0: 2020 2020 2020 7370 6174 6961 6c5f 7765        spatial_we
+0001e4e0: 6967 6874 735b 3a2c 2069 5d20 3d20 300d  ights[:, i] = 0.
+0001e4f0: 0a23 2020 2020 2020 2020 2020 2020 2073  .#             s
+0001e500: 7061 7469 616c 5f62 6961 7365 735b 695d  patial_biases[i]
+0001e510: 203d 2030 0d0a 2320 2020 2020 2020 2020   = 0..#         
+0001e520: 2020 2020 7465 6d70 6f72 616c 5f62 6961      temporal_bia
+0001e530: 7365 735b 695d 203d 2030 0d0a 2320 2020  ses[i] = 0..#   
+0001e540: 2020 2020 2020 2020 2020 656e 765f 6269            env_bi
+0001e550: 6173 6573 5b69 5d20 3d20 300d 0a23 2020  ases[i] = 0..#  
+0001e560: 2020 2020 2020 2020 2020 206d 6f64 656c             model
+0001e570: 5f77 6569 6768 7473 5b30 5d20 3d20 7370  _weights[0] = sp
+0001e580: 6174 6961 6c5f 7765 6967 6874 730d 0a23  atial_weights..#
+0001e590: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
+0001e5a0: 656c 5f77 6569 6768 7473 5b31 5d20 3d20  el_weights[1] = 
+0001e5b0: 7370 6174 6961 6c5f 6269 6173 6573 0d0a  spatial_biases..
+0001e5c0: 2320 2020 2020 2020 2020 2020 2020 6d6f  #             mo
+0001e5d0: 6465 6c5f 7765 6967 6874 735b 335d 203d  del_weights[3] =
+0001e5e0: 2074 656d 706f 7261 6c5f 6269 6173 6573   temporal_biases
+0001e5f0: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+0001e600: 6d6f 6465 6c5f 7765 6967 6874 735b 355d  model_weights[5]
+0001e610: 203d 2065 6e76 5f62 6961 7365 730d 0a23   = env_biases..#
+0001e620: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0001e630: 662e 6b6d 2e73 6574 5f77 6569 6768 7473  f.km.set_weights
+0001e640: 286d 6f64 656c 5f77 6569 6768 7473 290d  (model_weights).
+0001e650: 0a23 2020 2020 2020 2020 2020 2020 206c  .#             l
+0001e660: 6f73 7365 732e 6170 7065 6e64 2873 656c  osses.append(sel
+0001e670: 662e 6b6d 2e65 7661 6c75 6174 6528 582c  f.km.evaluate(X,
+0001e680: 2079 2c20 7665 7262 6f73 653d 3029 5b30   y, verbose=0)[0
+0001e690: 5d29 0d0a 2320 2020 2020 2020 2020 7365  ])..#         se
+0001e6a0: 6c66 2e6b 6d2e 7365 745f 7765 6967 6874  lf.km.set_weight
+0001e6b0: 7328 6d6f 6465 6c5f 7765 6967 6874 735f  s(model_weights_
+0001e6c0: 6f72 6967 696e 616c 290d 0a23 2020 2020  original)..#    
+0001e6d0: 2020 2020 2073 656c 662e 6272 616e 6368       self.branch
+0001e6e0: 5f72 656c 6576 616e 6365 5f6c 6f73 7320  _relevance_loss 
+0001e6f0: 3d20 6261 7365 5f6c 6f73 7320 2d20 6e70  = base_loss - np
+0001e700: 2e61 7272 6179 286c 6f73 7365 7329 0d0a  .array(losses)..
+0001e710: 0d0a 2320 2020 2020 6465 6620 706c 6f74  ..#     def plot
+0001e720: 5f62 7261 6e63 6828 0d0a 2320 2020 2020  _branch(..#     
+0001e730: 2020 2020 7365 6c66 2c0d 0a23 2020 2020      self,..#    
+0001e740: 2020 2020 2062 7261 6e63 685f 6e75 6d3a       branch_num:
+0001e750: 2069 6e74 2c0d 0a23 2020 2020 2020 2020   int,..#        
+0001e760: 2069 6e66 6f3a 2049 6e66 6f2c 0d0a 2320   info: Info,..# 
+0001e770: 2020 2020 2020 2020 7061 7261 6d73 3a20          params: 
+0001e780: 4f70 7469 6f6e 616c 5b6c 6973 745b 7374  Optional[list[st
+0001e790: 725d 5d20 3d20 5b27 696e 7075 7427 2c20  r]] = ['input', 
+0001e7a0: 276f 7574 7075 7427 2c20 2772 6573 706f  'output', 'respo
+0001e7b0: 6e73 6527 5d0d 0a23 2020 2020 2029 3a0d  nse']..#     ):.
+0001e7c0: 0a23 2020 2020 2020 2020 2069 6e66 6f2e  .#         info.
+0001e7d0: 5f5f 7365 7473 7461 7465 5f5f 2864 6963  __setstate__(dic
+0001e7e0: 7428 5f75 6e6c 6f63 6b65 643d 5472 7565  t(_unlocked=True
+0001e7f0: 2929 0d0a 2320 2020 2020 2020 2020 696e  ))..#         in
+0001e800: 666f 5b27 7366 7265 7127 5d20 3d20 312e  fo['sfreq'] = 1.
+0001e810: 0d0a 2320 2020 2020 2020 2020 736f 7274  ..#         sort
+0001e820: 696e 6720 3d20 6e70 2e61 7267 736f 7274  ing = np.argsort
+0001e830: 2873 656c 662e 6272 616e 6368 5f72 656c  (self.branch_rel
+0001e840: 6576 616e 6365 5f6c 6f73 7329 5b3a 3a2d  evance_loss)[::-
+0001e850: 315d 0d0a 2320 2020 2020 2020 2020 6461  1]..#         da
+0001e860: 7461 203d 2073 656c 662e 7061 7474 6572  ta = self.patter
+0001e870: 6e73 5b3a 2c20 736f 7274 696e 675d 0d0a  ns[:, sorting]..
+0001e880: 2320 2020 2020 2020 2020 6669 6c74 6572  #         filter
+0001e890: 7320 3d20 7365 6c66 2e66 696c 7465 7273  s = self.filters
+0001e8a0: 5b3a 2c20 736f 7274 696e 675d 0d0a 2320  [:, sorting]..# 
+0001e8b0: 2020 2020 2020 2020 7265 6c65 7661 6e63          relevanc
+0001e8c0: 6573 203d 2073 656c 662e 6272 616e 6368  es = self.branch
+0001e8d0: 5f72 656c 6576 616e 6365 5f6c 6f73 7320  _relevance_loss 
+0001e8e0: 2d20 7365 6c66 2e62 7261 6e63 685f 7265  - self.branch_re
+0001e8f0: 6c65 7661 6e63 655f 6c6f 7373 2e6d 696e  levance_loss.min
+0001e900: 2829 0d0a 2320 2020 2020 2020 2020 7265  ()..#         re
+0001e910: 6c65 7661 6e63 6520 3d20 736f 7274 6564  levance = sorted
+0001e920: 285b 6e70 2e72 6f75 6e64 2872 656c 2f72  ([np.round(rel/r
+0001e930: 656c 6576 616e 6365 732e 7375 6d28 292c  elevances.sum(),
+0001e940: 2032 2920 666f 7220 7265 6c20 696e 2072   2) for rel in r
+0001e950: 656c 6576 616e 6365 735d 2c20 7265 7665  elevances], reve
+0001e960: 7273 653d 5472 7565 295b 6272 616e 6368  rse=True)[branch
+0001e970: 5f6e 756d 5d0d 0a23 2020 2020 2020 2020  _num]..#        
+0001e980: 2073 656c 662e 6661 6b65 5f65 766f 6b65   self.fake_evoke
+0001e990: 6420 3d20 6576 6f6b 6564 2e45 766f 6b65  d = evoked.Evoke
+0001e9a0: 6441 7272 6179 2864 6174 612c 2069 6e66  dArray(data, inf
+0001e9b0: 6f2c 2074 6d69 6e3d 3029 0d0a 2320 2020  o, tmin=0)..#   
+0001e9c0: 2020 2020 2020 6669 672c 2028 6178 312c        fig, (ax1,
+0001e9d0: 2061 7832 2920 3d20 706c 742e 7375 6270   ax2) = plt.subp
+0001e9e0: 6c6f 7473 286e 636f 6c73 3d32 2c20 6e72  lots(ncols=2, nr
+0001e9f0: 6f77 733d 3129 0d0a 2320 2020 2020 2020  ows=1)..#       
+0001ea00: 2020 6669 672e 7469 6768 745f 6c61 796f    fig.tight_layo
+0001ea10: 7574 2829 0d0a 0d0a 2320 2020 2020 2020  ut()....#       
+0001ea20: 2020 7365 6c66 2e66 7320 3d20 7365 6c66    self.fs = self
+0001ea30: 2e64 6174 6173 6574 2e68 5f70 6172 616d  .dataset.h_param
+0001ea40: 735b 2766 7327 5d0d 0a0d 0a23 2020 2020  s['fs']....#    
+0001ea50: 2020 2020 206f 7574 5f66 696c 7465 7220       out_filter 
+0001ea60: 3d20 6669 6c74 6572 735b 3a2c 2062 7261  = filters[:, bra
+0001ea70: 6e63 685f 6e75 6d5d 0d0a 2320 2020 2020  nch_num]..#     
+0001ea80: 2020 2020 5f2c 2070 7364 203d 2077 656c      _, psd = wel
+0001ea90: 6368 2873 656c 662e 6c61 745f 7463 735b  ch(self.lat_tcs[
+0001eaa0: 6272 616e 6368 5f6e 756d 5d2c 2066 733d  branch_num], fs=
+0001eab0: 7365 6c66 2e66 732c 206e 7065 7273 6567  self.fs, nperseg
+0001eac0: 3d73 656c 662e 6673 202a 2032 290d 0a23  =self.fs * 2)..#
+0001ead0: 2020 2020 2020 2020 2077 2c20 6820 3d20           w, h = 
+0001eae0: 286c 616d 6264 6120 772c 2068 3a20 2877  (lambda w, h: (w
+0001eaf0: 2c20 6829 2928 2a66 7265 717a 286f 7574  , h))(*freqz(out
+0001eb00: 5f66 696c 7465 722c 2031 2c20 776f 724e  _filter, 1, worN
+0001eb10: 3d73 656c 662e 6673 2929 0d0a 2320 2020  =self.fs))..#   
+0001eb20: 2020 2020 2020 6672 616e 6765 203d 2077        frange = w
+0001eb30: 202f 206e 702e 7069 202a 2073 656c 662e   / np.pi * self.
+0001eb40: 6673 202f 2032 0d0a 2320 2020 2020 2020  fs / 2..#       
+0001eb50: 2020 7a20 3d20 6c61 6d62 6461 2078 3a20    z = lambda x: 
+0001eb60: 2878 202d 2078 2e6d 6561 6e28 2929 2f78  (x - x.mean())/x
+0001eb70: 2e73 7464 2829 0d0a 0d0a 2320 2020 2020  .std()....#     
+0001eb80: 2020 2020 666f 7220 7061 7261 6d20 696e      for param in
+0001eb90: 2070 6172 616d 733a 0d0a 2320 2020 2020   params:..#     
+0001eba0: 2020 2020 2020 2020 6966 2070 6172 616d          if param
+0001ebb0: 203d 3d20 2769 6e70 7574 273a 0d0a 2320   == 'input':..# 
+0001ebc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ebd0: 6669 6e70 7574 203d 2070 7364 5b3a 2d31  finput = psd[:-1
+0001ebe0: 5d0d 0a23 2020 2020 2020 2020 2020 2020  ]..#            
+0001ebf0: 2020 2020 2066 696e 7075 7420 3d20 7a28       finput = z(
+0001ec00: 6669 6e70 7574 290d 0a23 2020 2020 2020  finput)..#      
+0001ec10: 2020 2020 2020 2020 2020 2061 7832 2e70             ax2.p
+0001ec20: 6c6f 7428 6672 616e 6765 2c20 6669 6e70  lot(frange, finp
+0001ec30: 7574 202d 2066 696e 7075 742e 6d69 6e28  ut - finput.min(
+0001ec40: 292c 2063 6f6c 6f72 3d27 7461 623a 626c  ), color='tab:bl
+0001ec50: 7565 2729 0d0a 2320 2020 2020 2020 2020  ue')..#         
+0001ec60: 2020 2020 656c 6966 2070 6172 616d 203d      elif param =
+0001ec70: 3d20 276f 7574 7075 7427 3a0d 0a23 2020  = 'output':..#  
+0001ec80: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001ec90: 6f75 7470 7574 203d 206e 702e 7265 616c  output = np.real
+0001eca0: 2866 696e 7075 7420 2a20 6820 2a20 6e70  (finput * h * np
+0001ecb0: 2e63 6f6e 6a28 6829 290d 0a23 2020 2020  .conj(h))..#    
+0001ecc0: 2020 2020 2020 2020 2020 2020 2066 6f75               fou
+0001ecd0: 7470 7574 203d 207a 2866 6f75 7470 7574  tput = z(foutput
+0001ece0: 290d 0a23 2020 2020 2020 2020 2020 2020  )..#            
+0001ecf0: 2020 2020 2061 7832 2e70 6c6f 7428 6672       ax2.plot(fr
+0001ed00: 616e 6765 2c20 666f 7574 7075 7420 2d20  ange, foutput - 
+0001ed10: 666f 7574 7075 742e 6d69 6e28 292c 2063  foutput.min(), c
+0001ed20: 6f6c 6f72 3d27 7461 623a 6f72 616e 6765  olor='tab:orange
+0001ed30: 2729 0d0a 2320 2020 2020 2020 2020 2020  ')..#           
+0001ed40: 2020 656c 6966 2070 6172 616d 203d 3d20    elif param == 
+0001ed50: 2772 6573 706f 6e73 6527 3a0d 0a23 2020  'response':..#  
+0001ed60: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001ed70: 7265 7370 6f6e 6365 203d 206e 702e 6162  responce = np.ab
+0001ed80: 7328 6829 0d0a 2320 2020 2020 2020 2020  s(h)..#         
+0001ed90: 2020 2020 2020 2020 6672 6573 706f 6e63          fresponc
+0001eda0: 6520 3d20 7a28 6672 6573 706f 6e63 6529  e = z(fresponce)
+0001edb0: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+0001edc0: 2020 2020 6178 322e 706c 6f74 2866 7261      ax2.plot(fra
+0001edd0: 6e67 652c 2066 7265 7370 6f6e 6365 202d  nge, fresponce -
+0001ede0: 2066 7265 7370 6f6e 6365 2e6d 696e 2829   fresponce.min()
+0001edf0: 2c20 636f 6c6f 723d 2774 6162 3a67 7265  , color='tab:gre
+0001ee00: 656e 2729 0d0a 2320 2020 2020 2020 2020  en')..#         
+0001ee10: 2020 2020 656c 6966 2070 6172 616d 203d      elif param =
+0001ee20: 3d20 2770 6174 7465 726e 273a 0d0a 2320  = 'pattern':..# 
+0001ee30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ee40: 6670 6174 7465 726e 203d 2066 696e 7075  fpattern = finpu
+0001ee50: 7420 2a20 6e70 2e61 6273 2868 290d 0a23  t * np.abs(h)..#
+0001ee60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ee70: 2066 7061 7474 6572 6e20 3d20 7a28 6670   fpattern = z(fp
+0001ee80: 6174 7465 726e 290d 0a23 2020 2020 2020  attern)..#      
+0001ee90: 2020 2020 2020 2020 2020 2061 7832 2e70             ax2.p
+0001eea0: 6c6f 7428 6672 616e 6765 2c20 6670 6174  lot(frange, fpat
+0001eeb0: 7465 726e 202d 2066 7061 7474 6572 6e2e  tern - fpattern.
+0001eec0: 6d69 6e28 292c 2063 6f6c 6f72 3d27 7461  min(), color='ta
+0001eed0: 623a 7069 6e6b 2729 0d0a 0d0a 2320 2020  b:pink')....#   
+0001eee0: 2020 2020 2020 6178 322e 6c65 6765 6e64        ax2.legend
+0001eef0: 285b 7061 7261 6d2e 6361 7069 7461 6c69  ([param.capitali
+0001ef00: 7a65 2829 2066 6f72 2070 6172 616d 2069  ze() for param i
+0001ef10: 6e20 7061 7261 6d73 5d29 0d0a 2320 2020  n params])..#   
+0001ef20: 2020 2020 2020 6178 322e 7365 745f 786c        ax2.set_xl
+0001ef30: 696d 2830 2c20 3130 3029 0d0a 0d0a 2320  im(0, 100)....# 
+0001ef40: 2020 2020 2020 2020 6669 672e 7375 7074          fig.supt
+0001ef50: 6974 6c65 2866 2742 7261 6e63 6820 7b62  itle(f'Branch {b
+0001ef60: 7261 6e63 685f 6e75 6d7d 272c 2079 3d30  ranch_num}', y=0
+0001ef70: 2e39 352c 2078 3d30 2e32 2c20 666f 6e74  .95, x=0.2, font
+0001ef80: 7369 7a65 3d33 3029 0d0a 2320 2020 2020  size=30)..#     
+0001ef90: 2020 2020 6669 672e 7365 745f 7369 7a65      fig.set_size
+0001efa0: 5f69 6e63 6865 7328 3130 2c20 3529 0d0a  _inches(10, 5)..
+0001efb0: 2320 2020 2020 2020 2020 7365 6c66 2e66  #         self.f
+0001efc0: 616b 655f 6576 6f6b 6564 2e70 6c6f 745f  ake_evoked.plot_
+0001efd0: 746f 706f 6d61 7028 0d0a 2320 2020 2020  topomap(..#     
+0001efe0: 2020 2020 2020 2020 7469 6d65 733d 6272          times=br
+0001eff0: 616e 6368 5f6e 756d 2c0d 0a23 2020 2020  anch_num,..#    
+0001f000: 2020 2020 2020 2020 2061 7865 733d 6178           axes=ax
+0001f010: 312c 0d0a 2320 2020 2020 2020 2020 2020  1,..#           
+0001f020: 2020 636f 6c6f 7262 6172 3d46 616c 7365    colorbar=False
+0001f030: 2c0d 0a23 2020 2020 2020 2020 2020 2020  ,..#            
+0001f040: 2073 6361 6c69 6e67 733d 312c 0d0a 2320   scalings=1,..# 
+0001f050: 2020 2020 2020 2020 2020 2020 7469 6d65              time
+0001f060: 5f66 6f72 6d61 743d 2222 2c0d 0a23 2020  _format="",..#  
+0001f070: 2020 2020 2020 2020 2020 206f 7574 6c69             outli
+0001f080: 6e65 733d 2768 6561 6427 2c0d 0a23 2020  nes='head',..#  
+0001f090: 2020 2020 2020 2029 0d0a 0d0a 2320 2020         )....#   
+0001f0a0: 2020 2020 2020 7265 7475 726e 2066 6967        return fig
+0001f0b0: 0d0a 0d0a 0d0a                           ......
```

### Comparing `mneflow-0.5.8/mneflow/utils.py` & `mneflow-0.5.9/mneflow/utils.py`

 * *Files identical despite different names*

### Comparing `mneflow-0.5.8/mneflow.egg-info/PKG-INFO` & `mneflow-0.5.9/mneflow.egg-info/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: mneflow
-Version: 0.5.8
+Version: 0.5.9
 Summary: Neural networks for MEG and EEG data
 Home-page: https://github.com/zubara/mneflow
 Download-URL: https://github.com/zubara/mneflow/archive/master.zip
 Maintainer: Ivan Zubarev
 Maintainer-email: ivan.zubarev@aalto.fi
 License: BSD-3
 Platform: any
@@ -18,10 +18,10 @@
 Classifier: Operating System :: POSIX
 Classifier: Operating System :: Unix
 Classifier: Operating System :: MacOS
 Description-Content-Type: text/x-rst
 License-File: LICENSE.md
 Requires-Dist: numpy
 Requires-Dist: scipy
-Requires-Dist: mne<=1.6,>=1.0
-Requires-Dist: tensorflow<=2.16rc,>=2.12.0
+Requires-Dist: mne<=1.7,>=1.0
+Requires-Dist: tensorflow<=2.16.1,>=2.12.0
 Requires-Dist: matplotlib
```

### Comparing `mneflow-0.5.8/setup.py` & `mneflow-0.5.9/setup.py`

 * *Files 12% similar despite different names*

```diff
@@ -9,15 +9,15 @@
 
     setup(name='mneflow',
         maintainer='Ivan Zubarev',
         maintainer_email='ivan.zubarev@aalto.fi',
         description='Neural networks for MEG and EEG data',
         license='BSD-3',
         url='https://github.com/zubara/mneflow',
-        version='0.5.8',
+        version='0.5.9',
         download_url='https://github.com/zubara/mneflow/archive/master.zip',
         #long_description=codecs.open('./docs/intro.rst', encoding='utf8').read(),
         long_description_content_type="text/x-rst",
         classifiers=['Intended Audience :: Science/Research',
                      'Intended Audience :: Developers',
                      'License :: OSI Approved',
                      'Programming Language :: Python',
@@ -27,10 +27,10 @@
                      'Operating System :: POSIX',
                      'Operating System :: Unix',
                      'Operating System :: MacOS'],
         platforms='any',
         packages=['mneflow'],
         install_requires=['numpy', 
                           'scipy', 
-                          'mne >= 1.0, <=1.6', 
-                          'tensorflow >= 2.12.0, <=2.16rc', 
+                          'mne >= 1.0, <=1.7', 
+                          'tensorflow >= 2.12.0, <=2.16.1', 
                           'matplotlib'])
```

