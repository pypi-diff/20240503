# Comparing `tmp/infer_rvc_python-1.0.0-py3-none-any.whl.zip` & `tmp/infer_rvc_python-1.1.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,20 +1,20 @@
-Zip file size: 33807 bytes, number of entries: 18
--rw-rw-rw-  2.0 fat       30 b- defN 24-Apr-27 21:16 infer_rvc_python/__init__.py
--rw-rw-rw-  2.0 fat    23263 b- defN 24-Apr-27 21:10 infer_rvc_python/main.py
--rw-rw-rw-  2.0 fat    16526 b- defN 24-Apr-27 21:13 infer_rvc_python/root_pipe.py
--rw-rw-rw-  2.0 fat        0 b- defN 24-Apr-27 22:10 infer_rvc_python/lib/__init__.py
--rw-rw-rw-  2.0 fat      924 b- defN 24-Apr-04 16:32 infer_rvc_python/lib/audio.py
--rw-rw-rw-  2.0 fat     1106 b- defN 24-Apr-27 20:49 infer_rvc_python/lib/log_config.py
--rw-rw-rw-  2.0 fat    14551 b- defN 24-Apr-27 20:04 infer_rvc_python/lib/rmvpe.py
--rw-rw-rw-  2.0 fat        0 b- defN 24-Apr-27 22:10 infer_rvc_python/lib/infer_pack/__init__.py
--rw-rw-rw-  2.0 fat    14962 b- defN 24-Apr-27 21:14 infer_rvc_python/lib/infer_pack/attentions.py
--rw-rw-rw-  2.0 fat     5317 b- defN 24-Apr-04 16:32 infer_rvc_python/lib/infer_pack/commons.py
--rw-rw-rw-  2.0 fat    40582 b- defN 24-Apr-27 20:53 infer_rvc_python/lib/infer_pack/models.py
--rw-rw-rw-  2.0 fat    17203 b- defN 24-Apr-27 21:14 infer_rvc_python/lib/infer_pack/modules.py
--rw-rw-rw-  2.0 fat     7462 b- defN 24-Apr-04 16:32 infer_rvc_python/lib/infer_pack/transforms.py
--rw-rw-rw-  2.0 fat     1065 b- defN 24-Apr-27 22:11 infer_rvc_python-1.0.0.dist-info/LICENSE.txt
--rw-rw-rw-  2.0 fat     2646 b- defN 24-Apr-27 22:11 infer_rvc_python-1.0.0.dist-info/METADATA
--rw-rw-rw-  2.0 fat       92 b- defN 24-Apr-27 22:11 infer_rvc_python-1.0.0.dist-info/WHEEL
--rw-rw-rw-  2.0 fat       17 b- defN 24-Apr-27 22:11 infer_rvc_python-1.0.0.dist-info/top_level.txt
--rw-rw-r--  2.0 fat     1636 b- defN 24-Apr-27 22:11 infer_rvc_python-1.0.0.dist-info/RECORD
-18 files, 147382 bytes uncompressed, 31075 bytes compressed:  78.9%
+Zip file size: 35073 bytes, number of entries: 18
+-rw-rw-rw-  2.0 unx       30 b- defN 24-May-03 21:22 infer_rvc_python/__init__.py
+-rw-rw-rw-  2.0 unx    29243 b- defN 24-May-03 21:22 infer_rvc_python/main.py
+-rw-rw-rw-  2.0 unx    16526 b- defN 24-May-03 21:22 infer_rvc_python/root_pipe.py
+-rw-rw-rw-  2.0 unx        0 b- defN 24-May-03 21:22 infer_rvc_python/lib/__init__.py
+-rw-rw-rw-  2.0 unx      924 b- defN 24-May-03 21:22 infer_rvc_python/lib/audio.py
+-rw-rw-rw-  2.0 unx     1106 b- defN 24-May-03 21:22 infer_rvc_python/lib/log_config.py
+-rw-rw-rw-  2.0 unx    14551 b- defN 24-May-03 21:22 infer_rvc_python/lib/rmvpe.py
+-rw-rw-rw-  2.0 unx        0 b- defN 24-May-03 21:22 infer_rvc_python/lib/infer_pack/__init__.py
+-rw-rw-rw-  2.0 unx    14962 b- defN 24-May-03 21:22 infer_rvc_python/lib/infer_pack/attentions.py
+-rw-rw-rw-  2.0 unx     5317 b- defN 24-May-03 21:22 infer_rvc_python/lib/infer_pack/commons.py
+-rw-rw-rw-  2.0 unx    40582 b- defN 24-May-03 21:22 infer_rvc_python/lib/infer_pack/models.py
+-rw-rw-rw-  2.0 unx    17203 b- defN 24-May-03 21:22 infer_rvc_python/lib/infer_pack/modules.py
+-rw-rw-rw-  2.0 unx     7462 b- defN 24-May-03 21:22 infer_rvc_python/lib/infer_pack/transforms.py
+-rw-rw-rw-  2.0 unx     1070 b- defN 24-May-03 21:35 infer_rvc_python-1.1.0.dist-info/LICENSE
+-rw-rw-rw-  2.0 unx     3757 b- defN 24-May-03 21:35 infer_rvc_python-1.1.0.dist-info/METADATA
+-rw-rw-rw-  2.0 unx       92 b- defN 24-May-03 21:35 infer_rvc_python-1.1.0.dist-info/WHEEL
+-rw-rw-rw-  2.0 unx       17 b- defN 24-May-03 21:35 infer_rvc_python-1.1.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     1632 b- defN 24-May-03 21:35 infer_rvc_python-1.1.0.dist-info/RECORD
+18 files, 154474 bytes uncompressed, 32349 bytes compressed:  79.1%
```

## zipnote {}

```diff
@@ -33,23 +33,23 @@
 
 Filename: infer_rvc_python/lib/infer_pack/modules.py
 Comment: 
 
 Filename: infer_rvc_python/lib/infer_pack/transforms.py
 Comment: 
 
-Filename: infer_rvc_python-1.0.0.dist-info/LICENSE.txt
+Filename: infer_rvc_python-1.1.0.dist-info/LICENSE
 Comment: 
 
-Filename: infer_rvc_python-1.0.0.dist-info/METADATA
+Filename: infer_rvc_python-1.1.0.dist-info/METADATA
 Comment: 
 
-Filename: infer_rvc_python-1.0.0.dist-info/WHEEL
+Filename: infer_rvc_python-1.1.0.dist-info/WHEEL
 Comment: 
 
-Filename: infer_rvc_python-1.0.0.dist-info/top_level.txt
+Filename: infer_rvc_python-1.1.0.dist-info/top_level.txt
 Comment: 
 
-Filename: infer_rvc_python-1.0.0.dist-info/RECORD
+Filename: infer_rvc_python-1.1.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## infer_rvc_python/main.py

```diff
@@ -1,13 +1,12 @@
 from infer_rvc_python.lib.log_config import logger
 import torch
 import gc
 import numpy as np
 import os
-import shutil
 import warnings
 import threading
 from tqdm import tqdm
 from infer_rvc_python.lib.infer_pack.models import (
     SynthesizerTrnMs256NSFsid,
     SynthesizerTrnMs256NSFsid_nono,
     SynthesizerTrnMs768NSFsid,
@@ -17,14 +16,15 @@
 import soundfile as sf
 from scipy import signal
 from time import time as ttime
 import faiss
 from infer_rvc_python.root_pipe import VC, change_rms, bh, ah
 import librosa
 from urllib.parse import urlparse
+import copy
 
 warnings.filterwarnings("ignore")
 
 
 class Config:
     def __init__(self, only_cpu=False):
         self.device = "cuda:0"
@@ -252,14 +252,15 @@
     return n_spk, tgt_sr, net_g, vc, cpt, version
 
 
 class BaseLoader:
     def __init__(self, only_cpu=False, hubert_path=None, rmvpe_path=None):
         self.model_config = {}
         self.config = None
+        self.cache_model = {}
         self.only_cpu = only_cpu
         self.hubert_path = hubert_path
         self.rmvpe_path = rmvpe_path
 
     def apply_conf(
         self,
         tag="base_model",
@@ -320,33 +321,47 @@
         index,
         big_npy,
         # load f0 file
         inp_f0,
         # audio file
         input_audio_path,
         overwrite,
+        type_output,
     ):
 
         f0_method = params["pitch_algo"]
         f0_up_key = params["pitch_lvl"]
         filter_radius = params["respiration_median_filtering"]
         resample_sr = params["resample_sr"]
         rms_mix_rate = params["envelope_ratio"]
         protect = params["consonant_breath_protection"]
+        base_sr = 16000
 
-        if not os.path.exists(input_audio_path):
+        if isinstance(input_audio_path, tuple):
+            if f0_method == "harvest":
+                raise ValueError("Harvest not support from array")
+            audio = input_audio_path[0]
+            source_sr = input_audio_path[1]
+            if source_sr != base_sr:
+                audio = librosa.resample(
+                    audio.astype(np.float32),
+                    orig_sr=source_sr,
+                    target_sr=base_sr
+                )
+            audio = audio.astype(np.float32).flatten()
+        elif not os.path.exists(input_audio_path):
             raise ValueError(
                 "The audio file was not found or is not "
                 f"a valid file: {input_audio_path}"
             )
+        else:
+            audio = load_audio(input_audio_path, base_sr)
 
         f0_up_key = int(f0_up_key)
 
-        audio = load_audio(input_audio_path, 16000)
-
         # Normalize audio
         audio_max = np.abs(audio).max() / 0.95
         if audio_max > 1:
             audio /= audio_max
 
         times = [0, 0, 0]
 
@@ -492,33 +507,52 @@
             times[0],
             times[1],
             times[2],
         ), (final_sr, audio_opt)
 
         """
 
+        if type_output == "array":
+            return audio_opt, final_sr
+
         if overwrite:
             output_audio_path = input_audio_path  # Overwrite
         else:
             basename = os.path.basename(input_audio_path)
             dirname = os.path.dirname(input_audio_path)
 
             new_basename = basename.split(
                 '.')[0] + "_edited." + basename.split('.')[-1]
             new_path = os.path.join(dirname, new_basename)
-            logger.info(str(new_path))
 
             output_audio_path = new_path
 
         # Save file
-        sf.write(
-            file=output_audio_path,
-            samplerate=final_sr,
-            data=audio_opt
-        )
+        if type_output:
+            output_audio_path = os.path.splitext(
+                output_audio_path
+            )[0]+f".{type_output}"
+
+        try:
+            sf.write(
+                file=output_audio_path,
+                samplerate=final_sr,
+                data=audio_opt
+            )
+        except Exception as e:
+            logger.error(e)
+            logger.error("Error saving file, trying with WAV format")
+            output_audio_path = os.path.splitext(output_audio_path)[0]+".wav"
+            sf.write(
+                file=output_audio_path,
+                samplerate=final_sr,
+                data=audio_opt
+            )
+
+        logger.info(str(output_audio_path))
 
         self.model_config[task_id]["result"].append(output_audio_path)
         self.output_list.append(output_audio_path)
 
     def run_threads(self, threads):
         # Start threads
         for thread in threads:
@@ -530,23 +564,26 @@
 
         gc.collect()
         torch.cuda.empty_cache()
 
     def unload_models(self):
         self.hu_bert_model = None
         self.model_pitch_estimator = None
+        self.model_vc = {}
+        self.cache_model = {}
         gc.collect()
         torch.cuda.empty_cache()
 
     def __call__(
         self,
         audio_files=[],
         tag_list=[],
         overwrite=False,
         parallel_workers=1,
+        type_output=None,  # ["mp3", "wav", "ogg", "flac"]
     ):
         logger.info(f"Parallel workers: {str(parallel_workers)}")
 
         self.output_list = []
 
         if not self.model_config:
             raise ValueError("No model has been configured for inference")
@@ -703,14 +740,15 @@
             #     index,
             #     big_npy,
             #     # load f0 file
             #     inp_f0,
             #     # output file
             #     input_audio_path,
             #     overwrite,
+            #     type_output,
             # )
 
             thread = threading.Thread(
                 target=self.infer,
                 args=(
                     id_tag,
                     params,
@@ -727,14 +765,15 @@
                     index,
                     big_npy,
                     # loaded f0 file
                     inp_f0,
                     # audio file
                     input_audio_path,
                     overwrite,
+                    type_output,
                 )
             )
 
             threads.append(thread)
 
         # Run last
         if threads:
@@ -749,7 +788,135 @@
             if (
                 tag in self.model_config.keys()
                 and "result" in self.model_config[tag].keys()
             ):
                 final_result.extend(self.model_config[tag]["result"])
 
         return final_result
+
+    def generate_from_cache(
+        self,
+        audio_data=None,  # str or tuple (<array data>,<int sampling rate>)
+        tag=None,
+        reload=False,
+    ):
+
+        if not self.model_config:
+            raise ValueError("No model has been configured for inference")
+
+        if not audio_data:
+            raise ValueError(
+                "An audio file or tuple with "
+                "(<numpy data audio>,<sampling rate>) is needed"
+            )
+
+        # Base params
+        if not self.hu_bert_model:
+            self.hu_bert_model = load_hu_bert(self.config, self.hubert_path)
+
+        if tag not in self.model_config.keys():
+            raise ValueError(
+                f"No configured model for {tag}"
+            )
+
+        now_data = self.model_config[tag]
+        now_data["tag"] = tag
+
+        if self.cache_model != now_data and not reload:
+
+            # Unload previous
+            self.model_vc = {}
+            gc.collect()
+            torch.cuda.empty_cache()
+
+            model_path = now_data["file_model"]
+            f0_method = now_data["pitch_algo"]
+            file_index = now_data["file_index"]
+            index_rate = now_data["index_influence"]
+            f0_file = now_data["file_pitch_algo"]
+
+            # Load model
+            (
+                self.model_vc["n_spk"],
+                self.model_vc["tgt_sr"],
+                self.model_vc["net_g"],
+                self.model_vc["pipe"],
+                self.model_vc["cpt"],
+                self.model_vc["version"]
+            ) = load_trained_model(model_path, self.config)
+            self.model_vc["if_f0"] = self.model_vc["cpt"].get("f0", 1)
+
+            # Load index
+            if os.path.exists(file_index) and index_rate != 0:
+                try:
+                    index = faiss.read_index(file_index)
+                    big_npy = index.reconstruct_n(0, index.ntotal)
+                except Exception as error:
+                    logger.error(f"Index: {str(error)}")
+                    index_rate = 0
+                    index = big_npy = None
+            else:
+                logger.warning("File index not found")
+                index_rate = 0
+                index = big_npy = None
+
+            self.model_vc["index_rate"] = index_rate
+            self.model_vc["index"] = index
+            self.model_vc["big_npy"] = big_npy
+
+            # Load f0 file
+            inp_f0 = None
+            if os.path.exists(f0_file):
+                try:
+                    with open(f0_file, "r") as f:
+                        lines = f.read().strip("\n").split("\n")
+                    inp_f0 = []
+                    for line in lines:
+                        inp_f0.append([float(i) for i in line.split(",")])
+                    inp_f0 = np.array(inp_f0, dtype="float32")
+                except Exception as error:
+                    logger.error(f"f0 file: {str(error)}")
+
+            self.model_vc["inp_f0"] = inp_f0
+
+            if "rmvpe" in f0_method:
+                if not self.model_pitch_estimator:
+                    from infer_rvc_python.lib.rmvpe import RMVPE
+
+                    logger.info("Loading vocal pitch estimator model")
+                    if self.rmvpe_path is None:
+                        self.rmvpe_path = ""
+                    rm_local_path = "rmvpe.pt"
+                    if os.path.exists(self.rmvpe_path):
+                        rm_local_path = self.rmvpe_path
+                    self.model_pitch_estimator = RMVPE(
+                        rm_local_path,
+                        is_half=self.config.is_half,
+                        device=self.config.device
+                    )
+
+                self.model_vc["pipe"].model_rmvpe = self.model_pitch_estimator
+
+            self.cache_model = copy.deepcopy(now_data)
+
+        return self.infer(
+            tag,
+            now_data,
+            # load model
+            self.model_vc["n_spk"],
+            self.model_vc["tgt_sr"],
+            self.model_vc["net_g"],
+            self.model_vc["pipe"],
+            self.model_vc["cpt"],
+            self.model_vc["version"],
+            self.model_vc["if_f0"],
+            # load index
+            self.model_vc["index_rate"],
+            self.model_vc["index"],
+            self.model_vc["big_npy"],
+            # load f0 file
+            self.model_vc["inp_f0"],
+            # output file
+            audio_data,
+            False,
+            "array",
+        )
```

## Comparing `infer_rvc_python-1.0.0.dist-info/LICENSE.txt` & `infer_rvc_python-1.1.0.dist-info/LICENSE`

 * *Files 13% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 MIT License
 
-Copyright (c) 2024 RVC-Boss
+Copyright (c) 2024 Roger Condori
 
 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:
```

## Comparing `infer_rvc_python-1.0.0.dist-info/RECORD` & `infer_rvc_python-1.1.0.dist-info/RECORD`

 * *Files 12% similar despite different names*

```diff
@@ -1,18 +1,18 @@
 infer_rvc_python/__init__.py,sha256=HsKnDUG34kbP3xSWmF9jua-u6zWFuBbNNT-ti3tNnSk,30
-infer_rvc_python/main.py,sha256=ceOjWBVj_HbL44sO21UGHaIs17raqDSgq3qbnTh0-uA,23263
+infer_rvc_python/main.py,sha256=2txnGq5KOclqQ4PbTXvR9t9xagh_SqnWBJ2n-WwZulo,29243
 infer_rvc_python/root_pipe.py,sha256=CmYh6rOXi8K4Y7fgLpdQc_rO-T8dNMr-3fl95mcPi3A,16526
 infer_rvc_python/lib/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 infer_rvc_python/lib/audio.py,sha256=_0S3LBwvTtjVccSNJSVKEFEQUdU8dqqggLOsf62yikQ,924
 infer_rvc_python/lib/log_config.py,sha256=HxfMXpVrJwqe85JCLnW4eNukMFV1LltYttiqbfuDntY,1106
 infer_rvc_python/lib/rmvpe.py,sha256=vjKdR2QdEODhKgZoQ20bQR2zDsOkd2oIhDjx2gu4ZAU,14551
 infer_rvc_python/lib/infer_pack/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 infer_rvc_python/lib/infer_pack/attentions.py,sha256=SmdbDjD-xQf7PU8q9J0tZYo-mtUI3z1gcgDKP2wlCyU,14962
 infer_rvc_python/lib/infer_pack/commons.py,sha256=WuR2iuA9m603iPX8mkVmcVEksMwsdomOA_v1DCNsj74,5317
 infer_rvc_python/lib/infer_pack/models.py,sha256=QofG6bNpwC7ygCggIeKrTT0Q5aBHFhscy_PpVzQoHXo,40582
 infer_rvc_python/lib/infer_pack/modules.py,sha256=y50TwUWaMmAU3h2qVgnhjnHCNB6VWQam3_gmdbECbhw,17203
 infer_rvc_python/lib/infer_pack/transforms.py,sha256=Z4gQq5vd1JdSEad68IjUI6aWHVFGIQK7VKVLZI7t7jE,7462
-infer_rvc_python-1.0.0.dist-info/LICENSE.txt,sha256=igZOraGGYB_GAuRf7vYcartiJG1a6cN2TdH8ktlGw8Y,1065
-infer_rvc_python-1.0.0.dist-info/METADATA,sha256=gBoYZd_Wwz6aqfhLTVFkcN76q01Azux6x9l8FOgsbkg,2646
-infer_rvc_python-1.0.0.dist-info/WHEEL,sha256=yQN5g4mg4AybRjkgi-9yy4iQEFibGQmlz78Pik5Or-A,92
-infer_rvc_python-1.0.0.dist-info/top_level.txt,sha256=GLI1Wsz_I7yNyIq8vBR9dErkBWA4ulUZlWxcIftRwPY,17
-infer_rvc_python-1.0.0.dist-info/RECORD,,
+infer_rvc_python-1.1.0.dist-info/LICENSE,sha256=8BAVpQQ-sP3ZmHViWyYI7_vjx7FPZqafwK_dXaaQhX0,1070
+infer_rvc_python-1.1.0.dist-info/METADATA,sha256=RoRgZjoiEoGcVkqHqw9mHxybznYu_ms2K4UAcZugFz0,3757
+infer_rvc_python-1.1.0.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
+infer_rvc_python-1.1.0.dist-info/top_level.txt,sha256=GLI1Wsz_I7yNyIq8vBR9dErkBWA4ulUZlWxcIftRwPY,17
+infer_rvc_python-1.1.0.dist-info/RECORD,,
```

